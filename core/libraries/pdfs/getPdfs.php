<?php
    if(!isset($_SESSION)){
        session_start();
    }

    if(!isset($_SESSION['basePath'])){
        http_response_code(403);
        return;
    }

    if(!isset($_SESSION['user'])){
        http_response_code(403);
        return;
    }
    require_once($_SESSION['basePath'] . "core/expedients/docs/functions.php");
    require_once($_SESSION['basePath'] . "core/tools/utils.php");
    require_once($_SESSION['basePath'] . "model/documentsInfo.php");
    require_once($_SESSION['basePath'] . "defines.php");

    if((isset($_POST['vehicle']) || isset($_POST['order']) || isset($_POST['expedient']) || isset($_POST['deliveryNote']) || (isset($_POST['month']) && isset($_POST['year']))) && isset($_POST['doc'])){
        if(isset($_POST['vehicle'])){
            echo getPdf($_POST['doc'], $_POST['vehicle']);
        }

        if(isset($_POST['expedient'])){
            if(isset($_POST['logo'])){
                if(isset($_POST['withDEP'])){
                    echo getPdf($_POST['doc'], $_POST['expedient'], $_POST['logo'], $_POST['withDEP']);
                }else{
                    echo getPdf($_POST['doc'], $_POST['expedient'], $_POST['logo'], null, (isset($_POST['isProforma']) ? $_POST['isProforma'] : null), (isset($_POST['numHiring']) ? $_POST['numHiring'] : null), (isset($_POST['backgroundMode']) ? $_POST['backgroundMode'] : null));
                }
               
            }else{
                echo getPdf($_POST['doc'], $_POST['expedient']);
            }
        }
        if(isset($_POST['order'])){
            echo getPdf($_POST['doc'], $_POST['order']);
        }
        if(isset($_POST['deliveryNote'])){
            echo getPdf($_POST['doc'], $_POST['deliveryNote']);
        }
        if(isset($_POST['month']) && isset($_POST['year'])){
            echo getPdf($_POST['doc'], array("month" => $_POST['month'], "year" => $_POST['year']));
        }
    }

    //Estadísticas
    if(isset($_POST['doc'])){  
        //esquela  
        if(isset($_POST['img']) && isset($_POST['service'])){
            echo getPdf($_POST['doc'], $_POST);
        }
        if(isset($_POST['data']) && !isset($_POST['service'])){
            echo getPdf($_POST['doc'], $_POST['data']);
        }
        //autoCremacion
        if(isset($_POST['data']) && isset($_POST['service'])){
            echo getPdf($_POST['doc'], $_POST['service']);
        }
        if(isset($_POST['data1'])){
            echo getPdf($_POST['doc'], $_POST['data1']);
        }
        if(isset($_POST['financing'])){
            echo getPdf($_POST['doc'], $_POST['financing']);
        }
    }
    
    //Templates 
    if(isset($_POST['templateID']) && isset($_POST['doc'])){
        echo getPdf( $_POST['doc'], $_POST['templateID']);
    }

    function getMonth($month){
        switch ($month) {
            case '1':
                return "Enero";
            break;
            case '2':
                return "Febrero";
            break;
            case '3':
                return "Marzo";
            break;
            case '4':
                return "Abril";
            break;
            case '5':
                return "Mayo";
            break;
            case '6':
                return "Junio";
            break;
            case '7':
                return "Julio";
            break;
            case '8':
                return "Agosto";
            break;
            case '9':
                return "Septiembre";
            break;
            case '10':
                return "Octubre";
            break;
            case '11':
                return "Noviembre";
            break;
            case '12':
                return "Diciembre";
            break;  
        }
    }

    function searchInArray($array, $key, $val) {
        foreach ($array as $item)
            if (isset($item[$key]) && $item[$key] == $val) return true;
        return false;
    }

    function array_diff_assoc_recursive($array1, $array2){
        foreach($array1 as $key => $value){
            if(is_array($value)){
                if(!isset($array2[$key])){
                    $difference[$key] = $value;
                }
                elseif(!is_array($array2[$key])){
                    $difference[$key] = $value;
                }
                else{
                    $new_diff = array_diff_assoc_recursive($value, $array2[$key]);
                    if($new_diff != FALSE)
                    {
                        $difference[$key] = $new_diff;
                    }
                }
            }
            elseif(!isset($array2[$key]) || $array2[$key] != $value){
                $difference[$key] = $value;
            }
        }
        return !isset($difference) ? 0 : $difference;
    }

    function getPdf(
        $pdf, $expedient, $logo = null, $withDEP = null, $isProformaParam = null, $numHiring = null, $backgroundMode = null
    ){

        require_once($_SESSION['basePath'] . "model/documentsInfo.php");

        $documentsInfo = new DocumentsInfo;

        // Custom font color docs
        $colorStyle = '#1f497d;';
        $fuente = 'fuente';
        $tableContratosColor = '';
        $tableVacacionesColor = '';
        $tablePdfColor = '';
        $tablePdfV2Color = '';
        $tableFloresRegistroColor = '';
        $tableBorderTopColor = '';
        $tableBorderMidColor = '';
        $tableBorderBottomColor = '';
        $firmaColor = '';
        switch(intval($_SESSION['company'])){
            case 18:
                $colorStyle = 'black;';
                $fuente = 'fuente-black';
                $tableContratosColor = '-black';
                $tableVacacionesColor = '-black';
                $tablePdfColor = '-black';
                $tablePdfV2Color = '-black';
                $tableFloresRegistroColor = '-black';
                $tableBorderTopColor = '-black';
                $tableBorderMidColor = '-black';
                $tableBorderBottomColor = '-black';
                $firmaColor = '-black';
            break;
        }
        
        switch($pdf){ 
            case "albaran":
                $utils = new Utils();

                $data = getAlbaran($expedient);

                $deliveryNote = $data[0];
                $deliveryNoteLines = $data[1];
                $orderLines = $data[2];

                switch($deliveryNote['inAgreement']){
                    case null:
                        $deliveryNote['inAgreement'] = "N/A";
                    break;
                    case "1":
                        $deliveryNote['inAgreement'] = "CONFORME";
                    break;
                    case "0":
                        $deliveryNote['inAgreement'] = "NO CONFORME <br><br> <strong>No conformidad:</strong> " . $deliveryNote['nonconformityDescription'] . "<br><strong>Acción correctiva:</strong>  " . $deliveryNote['nonconformitySolution'];
                    break;
                }

                if($deliveryNote['deliveryDate'] != null){
                    $deliveryNote['deliveryDate'] = date("j/n/Y", $deliveryNote['deliveryDate']);
                }

                $background = $utils->getBackgroundDocuments();
                $text = "
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas'>           
                                <div class='col-xs-6 col-xs-offset-6'>
                                    <table style='font-size:10px' class='tablePdf$tablePdfColor text-center'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center'><span style='font-size:12px'>
                                                    <strong>ALBARÁN DE COMPRA</strong></span>
                                                </td>
                                                <td>
                                                    <p style='text-align:center'>";
                                                    if(intval($_SESSION['company']) == 1){
                                                        $text .= "C&oacute;digo:RE-7401<br> ";
                                                    }
                                                    $text .=" Revisi&oacute;n: 01
                                                    </p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <br>
                                <br>
                                <div>
                                    <table style='font-size:10px' class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='width:25%; text-align: center;'><strong>ALBARÁN</strong></td>
                                                <td style='width:25%; text-align: center;'><strong>PEDIDO</strong></td>
                                                <td style='width:25%; text-align: center;'><strong>PROVEEDOR</strong></td>
                                                <td style='width:25%; text-align: center;'><strong>FECHA</strong></td>
                                            </tr>
                                            <tr>
                                                <td style='text-align: center;'>" . $deliveryNote['number'] . "</td>
                                                <td style='text-align: center;'>" . $deliveryNote['order'] . "</td>
                                                <td style='text-align: center;'>" . $deliveryNote['supplierName'] . "</td>
                                                <td style='text-align: center;'>".date("j/n/Y")."</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <br>
                                <div>
                                    <p><u><strong>DESCRIPCIÓN DEL PEDIDO</strong></u></p>
                                </div>
                                <div>
                                    <table style='font-size:12px' class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='width:33%; text-align:center'><p><strong>PRODUCTO</strong></p></td>
                                                <td style='width:33%; text-align:center'><p><strong>MODELO</strong></p></td>
                                                <td style='width:33%; text-align:center'><p><strong>REFERENCIA</strong></p></td>
                                                <td style='width:33%; text-align:center'><p><strong>CANTIDAD</strong></p></td>
                                            </tr>";
                                            foreach($orderLines as $orderLine){
                                                $text .= "<tr>
                                                            <td style='text-align:center'><p>" . $orderLine['productName'] . "</p></td>
                                                            <td style='text-align:center'><p>" . $orderLine['productModelName'] . "</p></td>
                                                            <td style='text-align:center'><p>" . $orderLine['supplierReference'] . "</p></td>
                                                            <td style='text-align:center'><p>" . $orderLine['amount'] . "</p></td>";
                                            }
                                            $text .= "<tr>
                                                <td colspan='3'>
                                                    <table class='tablePdf$tablePdfColor' style='font-size:12px'>
                                                        <tbody>
                                                            <tr>
                                                                <td style='width:50%'>
                                                                    <p><strong>Lugar de entrega:</strong> " . $deliveryNote['mortuaryName'] . "</p><br>
                                                                    <p><strong>Fecha entrega:</strong> ". $deliveryNote['deliveryDate'] ."</p>
                                                                    <br>
                                                                </td>
                                                                <td>
                                                                    <p><strong>Firma y sello:</strong></p>
                                                                    <br>
                                                                    <br>
                                                                    <br>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <br>
                                <div>
                                    <p><u><strong>DESCRIPCIÓN DEL ALBARÁN</strong></u></p>
                                </div>
                                <div>
                                    <table style='font-size:10px' class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='width:33%; text-align:center'><p><strong>PRODUCTO</strong></p></td>
                                                <td style='width:33%; text-align:center'><p><strong>MODELO</strong></p></td>
                                                <td style='width:33%; text-align:center'><p><strong>CANTIDAD</strong></p></td>
                                            </tr>";
                                            foreach($deliveryNoteLines as $deliveryNoteLine){
                                                $text .= "<tr>
                                                <td style='text-align:center'><p>" . $deliveryNoteLine['productName'] . "</p></td>
                                                <td style='text-align:center'><p>" . $deliveryNoteLine['productModelName'] . "</p></td>
                                                <td style='text-align:center'><p>" . $deliveryNoteLine['amount'] . "</p></td>";
                                            }
                                        $text .= "</tbody>
                                    </table>
                                </div>
                                <br>
                                <div>
                                    <p><u><strong>INSPECCIÓN DE RECEPCIÓN</strong></u></p>
                                </div>
                                <div>
                                    <table style='font-size:10px' class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='width:50%; text-align:center'><p><strong>CONFORMIDAD</strong></p></td>
                                                <td style='width:50%; text-align:center'><p><strong>FIRMA RESPONSABLE</strong></p></td>
                                            </tr>
                                            <tr>
                                                <td style='text-align:left'>
                                                    " . $deliveryNote['inAgreement'] . "
                                                </td>
                                                <td style='text-align:left'>
                                                    <p>Firma responsable:</p>
                                                    <br>
                                                    <br>
                                                    <p>Fecha: ".$utils->fechaCastellano2(date('Y'))."</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "noConformidad":
                $utils = new Utils();

                $data = getAlbaran($expedient);
                
                $deliveryNote = $data[0];

                if($deliveryNote['deliveryDate'] != null){
                    $deliveryNote['deliveryDate'] = date("j/n/Y", $deliveryNote['deliveryDate']);
                }

                $background = $utils->getBackgroundDocuments();
                $text = "<div class='fondo'>
                    <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                        <div class='contenidoPompas'>           
                            <div style='text-align: center'>
                                <p><u><strong>NO CONFORMIDAD</strong></u></p>
                            </div>
                            <br>
                            <br>
                            <div>
                                <table style='font-size:10px' class='tablePdf$tablePdfColor'>
                                    <tbody>
                                        <tr>
                                            <td style='width:25%; text-align: center;'><strong>ALBARÁN</strong></td>
                                            <td style='width:25%; text-align: center;'><strong>PEDIDO</strong></td>
                                            <td style='width:25%; text-align: center;'><strong>PROVEEDOR</strong></td>
                                            <td style='width:25%; text-align: center;'><strong>FECHA</strong></td>
                                        </tr>
                                        <tr>
                                            <td style='text-align: center;'>" . $deliveryNote['number'] . "</td>
                                            <td style='text-align: center;'>" . $deliveryNote['order'] . "</td>
                                            <td style='text-align: center;'>" . $deliveryNote['supplierName'] . "</td>
                                            <td style='text-align: center;'>".date("j/n/Y")."</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <br>
                            <div>
                                <p><u><strong>INSPECCIÓN DE RECEPCIÓN</strong></u></p>
                            </div>
                            <div>
                                <table style='font-size:10px' class='tablePdf$tablePdfColor'>
                                    <tbody>
                                        <tr>
                                            <td style='width:25%; text-align:right'><p><strong>NO CONFORMIDAD</strong></p></td>
                                            <td style='text-align:left'>
                                                " . $deliveryNote['nonconformityDescription'] . "
                                            </td>
                                        </tr>";
                                $text.=" </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>";

                return $text;
            break;

            case "accionCorrectiva":
                $utils = new Utils();

                $data = getAlbaran($expedient);
                
                $deliveryNote = $data[0];

                if($deliveryNote['deliveryDate'] != null){
                    $deliveryNote['deliveryDate'] = date("j/n/Y", $deliveryNote['deliveryDate']);
                }

                $background = $utils->getBackgroundDocuments();
                $text = "<div class='fondo'>
                    <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                        <div class='contenidoPompas'>           
                            <div style='text-align: center'>
                                <p><u><strong>NO CONFORMIDAD</strong></u></p>
                            </div>
                            <br>
                            <br>
                            <div>
                                <table style='font-size:10px' class='tablePdf$tablePdfColor'>
                                    <tbody>
                                        <tr>
                                            <td style='width:25%; text-align: center;'><strong>ALBARÁN</strong></td>
                                            <td style='width:25%; text-align: center;'><strong>PEDIDO</strong></td>
                                            <td style='width:25%; text-align: center;'><strong>PROVEEDOR</strong></td>
                                            <td style='width:25%; text-align: center;'><strong>FECHA</strong></td>
                                        </tr>
                                        <tr>
                                            <td style='text-align: center;'>" . $deliveryNote['number'] . "</td>
                                            <td style='text-align: center;'>" . $deliveryNote['order'] . "</td>
                                            <td style='text-align: center;'>" . $deliveryNote['supplierName'] . "</td>
                                            <td style='text-align: center;'>".date("j/n/Y")."</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <br>
                            <div>
                                <p><u><strong>INSPECCIÓN DE RECEPCIÓN</strong></u></p>
                            </div>
                            <div>
                                <table style='font-size:10px' class='tablePdf$tablePdfColor'>
                                    <tbody>
                                        <tr>
                                            <td style='width:25%; text-align:right'><p><strong>NO CONFORMIDAD</strong></p></td>
                                            <td style='text-align:left'>
                                                " . $deliveryNote['nonconformityDescription'] . "
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='width:25%; text-align:right'><p><strong>ACCIÓN CORRECTIVA</strong></p></td>
                                            <td style='text-align:left'>
                                                " . $deliveryNote['nonconformitySolution'] . "
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>";

                return $text;
            break;

            case "noConformidadPedido":
                $utils = new Utils();

                $order = getPedidoNoConformidad($expedient);
                
                if($order['date'] != null){
                    $order['date'] = date("j/n/Y", $order['date']);
                }

                $background = $utils->getBackgroundDocuments();
                $text = "<div class='fondo'>
                    <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                        <div class='contenidoPompas'>           
                            <div style='text-align: center'>
                                <p><u><strong>NO CONFORMIDAD</strong></u></p>
                            </div>
                            <br>
                            <br>
                            <div>
                                <table style='font-size:10px' class='tablePdf$tablePdfColor'>
                                    <tbody>
                                        <tr>
                                            <td style='width:25%; text-align: center;'><strong>PEDIDO</strong></td>
                                            <td style='width:25%; text-align: center;'><strong>PROVEEDOR</strong></td>
                                            <td style='width:25%; text-align: center;'><strong>FECHA</strong></td>
                                        </tr>
                                        <tr>
                                            <td style='text-align: center;'>" . $expedient . "</td>
                                            <td style='text-align: center;'>" . $order['name'] . "</td>
                                            <td style='text-align: center;'>".date("j/n/Y")."</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <br>
                            <div>
                                <p><u><strong>INSPECCIÓN DE RECEPCIÓN</strong></u></p>
                            </div>
                            <div>
                                <table style='font-size:10px' class='tablePdf$tablePdfColor'>
                                    <tbody>
                                        <tr>
                                            <td style='width:25%; text-align:right'><p><strong>NO CONFORMIDAD</strong></p></td>
                                            <td style='text-align:left'>
                                                " . $order['nonApproval'] . "
                                            </td>
                                        </tr>";
                                        // <tr>
                                        //     <td style='width:25%; text-align:right'><p><strong>ACCIÓN CORRECTIVA</strong></p></td>
                                        //     <td style='text-align:left'>
                                        //         " . $order['correctiveAction'] . "
                                        //     </td>
                                        // </tr>
                                $text.=" </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>";

                return $text;
            break;

            case "accionCorrectivaPedido":
                $utils = new Utils();

                $order = getPedidoNoConformidad($expedient);
                
                if($order['date'] != null){
                    $order['date'] = date("j/n/Y", $order['date']);
                }

                $background = $utils->getBackgroundDocuments();
                $text = "<div class='fondo'>
                    <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                        <div class='contenidoPompas'>           
                            <div style='text-align: center'>
                                <p><u><strong>NO CONFORMIDAD</strong></u></p>
                            </div>
                            <br>
                            <br>
                            <div>
                                <table style='font-size:10px' class='tablePdf$tablePdfColor'>
                                    <tbody>
                                        <tr>
                                            <td style='width:25%; text-align: center;'><strong>PEDIDO</strong></td>
                                            <td style='width:25%; text-align: center;'><strong>PROVEEDOR</strong></td>
                                            <td style='width:25%; text-align: center;'><strong>FECHA</strong></td>
                                        </tr>
                                        <tr>
                                            <td style='text-align: center;'>" . $expedient . "</td>
                                            <td style='text-align: center;'>" . $order['name'] . "</td>
                                            <td style='text-align: center;'>".date("j/n/Y")."</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <br>
                            <div>
                                <p><u><strong>INSPECCIÓN DE RECEPCIÓN</strong></u></p>
                            </div>
                            <div>
                                <table style='font-size:10px' class='tablePdf$tablePdfColor'>
                                    <tbody>
                                        <tr>
                                            <td style='width:25%; text-align:right'><p><strong>NO CONFORMIDAD</strong></p></td>
                                            <td style='text-align:left'>
                                                " . $order['nonApproval'] . "
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='width:25%; text-align:right'><p><strong>ACCIÓN CORRECTIVA</strong></p></td>
                                            <td style='text-align:left'>
                                                " . $order['correctiveAction'] . "
                                            </td>
                                        </tr>
                                
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>";

                return $text;
            break;

            case "noConformidades":
                $utils = new Utils();

                $data = getAlbaranes();

                $background = $utils->getBackgroundDocuments();
                $text = "<div class='fondo'>
                    <div style='background-image: url(" . $background . ")' class='fuente folioPompas'>
                        <div class='contenidoPompas'>           
                            <div style='text-align: center'>
                                <p><u><strong>NO CONFORMIDADES</strong></u></p>
                            </div>
                            ";
                            foreach($data AS $key => $order){
                                $deliveryNote = $order[0];
                    
                                if($deliveryNote['deliveryDate'] != null){
                                    $deliveryNote['deliveryDate'] = date("j/n/Y", $deliveryNote['deliveryDate']);
                                }
                                if($key != 0){
                                    $text .= "<br><div style='text-align: center'>
                                        <p><strong>--------------</strong></p>
                                        <p><strong>--------------</strong></p></div>";
                                }else{
                                    $text .= "<br><br>";

                                }
                            $text .="<div>
                                <table style='font-size:10px' class='tablePdf$tablePdfColor'>
                                    <tbody>
                                        <tr>
                                            <td style='width:25%; text-align: center;'><strong>ALBARÁN</strong></td>
                                            <td style='width:25%; text-align: center;'><strong>PEDIDO</strong></td>
                                            <td style='width:25%; text-align: center;'><strong>PROVEEDOR</strong></td>
                                            <td style='width:25%; text-align: center;'><strong>FECHA</strong></td>
                                        </tr>
                                        <tr>
                                            <td style='text-align: center;'>" . $deliveryNote['number'] . "</td>
                                            <td style='text-align: center;'>" . $deliveryNote['order'] . "</td>
                                            <td style='text-align: center;'>" . $deliveryNote['supplierName'] . "</td>
                                            <td style='text-align: center;'>".date("j/n/Y")."</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <br>
                            <div>
                                <p><u><strong>INSPECCIÓN DE RECEPCIÓN</strong></u></p>
                            </div>
                            <div>
                                <table style='font-size:10px' class='tablePdf$tablePdfColor'>
                                    <tbody>
                                        <tr>
                                            <td style='width:25%; text-align:right'><p><strong>NO CONFORMIDAD</strong></p></td>
                                            <td style='text-align:left'>
                                                " . $deliveryNote['nonconformityDescription'] . "
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='width:25%; text-align:right'><p><strong>ACCIÓN CORRECTIVA</strong></p></td>
                                            <td style='text-align:left'>
                                                " . $deliveryNote['nonconformitySolution'] . "
                                            </td>
                                        </tr>
                    </tbody>
                                </table>
                            </div>";
                            }
                        $text .= "</div>
                    </div>
                </div>";

                return $text;
            break;

            case "actaIncineracion":
                $utils = new Utils();

                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/actaIncineracion.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $staticInfo = $documentsInfo->getByDocument('actaIncineracion');
                    if($staticInfo != null){
                        foreach($staticInfo as $elem){
                            switch($elem['name']){
                                case 'responsibleDoc1':
                                    $responsible = $elem['value'];
                                break;

                                case 'nifDoc1':
                                    $nif = $elem['value'];
                                break;

                                case 'postDoc1':
                                    $post = $elem['value'];
                                break;

                                case 'companyDoc1':
                                    $company = $elem['value'];
                                break;
                            }
                        }
                    }else{
                        $responsible = '';
                        $nif = '';
                        $post = '';
                        $company = '';
                    }

                    $data = getActaIncineracion($expedient);
                    if($data['deceasedGender'] == "Mujer"){
                        $gender = "Dña.";
                    }else{
                        $gender = "D.";
                    }
                    if($data['deceasedBirthday'] == null){
                        $deceasedBirthday = '';
                    }else{
                        $deceasedBirthday = date("j/n/Y", strtotime($data['deceasedBirthday']));
                    }
                    if($data['deceasedDate'] == null){
                        $deceasedDate = '';
                    }else{
                        $deceasedDate = date("j/n/Y", strtotime($data['deceasedDate']));
                    }
                    if($data['start'] == null){
                        $data['start'] = "";
                    }else{
                        $data['start'] = $utils->fechaCastellano2($data['start']);
                    }
                    if($data['deceasedName'] == ""){
                        $data['deceasedName'] = "";
                    }
                    if($data['deceasedSurname'] == ""){
                        $data['deceasedSurname'] = "";
                    }
                    $crematoriumAddress = $data['address'];
                    $crematoriumLocation = $data['name'] == null ? '' : $data['name'];
                    $crematoriumProvince = $data['province'] == null ? '' : $data['province'];
                    $trazabilityID = $data['trazabilityId'] == null ? '______' :  $data['trazabilityId'];
                    $background = $utils->getBackgroundDocuments();

                    return "
                        <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div style='margin-right:50px;right:480px; position: absolute; text-align: right; padding-top: 50px;'>
                                <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                            </div>

                            <div class='contenidoPompas' style='margin-top: -15px; line-height: 2em;'>
                                <div class='titulo' style='text-align:center'><span><strong><u>ACTA DE INCINERACI&Oacute;N </u></strong></span></div>
                                <br>
                                <div style='font-size: 14px;'><span >$responsible, con DNI: $nif en calidad de $post de la empresa <strong>$company</strong></span></div>
                                <br>
                                <div style='text-align:center; font-size: 14px;'><span><strong>CERTIFICA</strong>:</span></div>
                                <br>
                                <ul>
                                    <li><div style='font-size: 14px;'><span>Que con fecha " . $data['start'] . ", se ha procedido a la incineraci&oacute;n en nuestras instalaciones en $crematoriumAddress de $crematoriumLocation ($crematoriumProvince), de los restos mortales de: </span></div></li>
                                </ul>
                                <br>
                                <div class='row'>
                                <div class='col-xs-8 col-xs-offset-1'>
                                    <table class='tablePdf$tablePdfColor' style='font-size: 14px;'>
                                        <tbody>
                                            <tr>
                                                <td><span>NOMBRE</span></td>
                                                <td><span> $gender <strong>" . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</strong> (Q.E.P.D.)</span></td>
                                            </tr>
                                            <tr>
                                                <td><span>NIF:</span></td>
                                                <td><span><strong>" . $data['deceasedNIF'] . "</strong></span></td>
                                            </tr>
                                            <tr>
                                                <td><span>Fecha de Nacimiento:</span></td>
                                                <td><span><strong>" . $deceasedBirthday . "</strong></span></td>
                                            </tr>
                                            <tr>
                                                <td><span>Fecha de Fallecimiento:</span></td>
                                                <td><span><strong>" . $deceasedDate . "</strong></span></td>
                                            </tr>
                                        </tbody>
                                    </table>                
                                </div>
                                </div>
                                <br><br>
                                <div style='font-size: 14px;'>
                                <ul>
                                    <li>
                                        <div>
                                            <span>
                                                Que una vez recepcionado el féretro en nuestras instalaciones, se ha iniciado un proceso de identificación para verificar
                                                la trazabilidad en todo momento de $gender " . $data['deceasedName'] . " " . $data['deceasedSurname'] . " (Q.E.P.D.) con la placa de arcilla nº $trazabilityID
                                            </span>
                                        </div>
                                    </li>
                                </ul>
                                <ul>
                                    <li><div><span>Que las cenizas han sido depositadas en su correspondiente urna identificada.</span></div></li>
                                </ul>
                                <ul>
                                    <li><div><span>Que las cenizas son inocuas, no representando riesgo alguno para la salud o el medioambiente. </span></div></li>
                                </ul>
                                </div>
                                <br><br>
                                <div style='font-size: 14px;'><span>Y para que conste a los efectos oportunos, expido la presente en</span></div>
                                <br><br>
                                <div style='font-size: 14px; text-align: right;'><p>$crematoriumLocation, a " . $data['start'] . "</p></div>
                                <br><br><br>
                                <div style='font-size: 14px; text-align: right;'><p>Fdo.: ______________________</p></div>
                                <br><br><br><br>
                            </div></div></div>
                    ";
                }
            break;

            case "actaJuzgado":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/actaJuzgado.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $staticInfo = $documentsInfo->getByDocument('actaJuzgado');
                    if($staticInfo != null){
                        foreach($staticInfo as $elem){
                            switch($elem['name']){
                                case 'juzgadoInstruccionDoc19':
                                    $juzgado = $elem['value'];
                                    break;

                                case 'direccionDoc19':
                                    $direccion = $elem['value'];
                                    break;

                                case 'localidadDoc19':
                                    $localidad = $elem['value'];
                                    break;
                            }
                        }
                    }else{
                        $responsible = '';
                        $nif = '';
                    }

                    $utils = new Utils();
                    $data = getActaJuzgado($expedient);
                    $background = $utils->getBackgroundDocuments();

                    if($data['deceasedGender'] == 'Hombre'){
                        $pre = 'D. ';
                    }else{
                        $pre = 'Dña. ';
                    }

                    $deceasedTime = '__:__';
                    if($data['deceasedTime'] != null && $data['deceasedTime'] != ''){
                        $deceasedTime = date("H:i", strtotime($data['deceasedTime']));
                    }

                    $deceasedDate = '________________';
                    if($data['deceasedTime'] != null && $data['deceasedTime'] != ''){
                        $deceasedDate = date("j-n-Y", strtotime($data['deceasedDate']));
                    }

                    $cemetery = '________________________';
                    if($data['deceasedCemetery'] != null && $data['deceasedCemetery'] != ''){
                        $cemetery = $data['deceasedCemetery'];
                    }

                    return "
                        <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div style='margin-right:50px;right:480px; position: absolute; text-align: right; padding-top: 50px;'>
                                <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                            </div>
                            <div class='contenidoPompas'>
                                <div style='padding-top: 5px; line-height: 1'>
                                    <div>
                                        <strong>JDO. INSTRUCCIÓN: </strong> $juzgado de $localidad
                                    </div>
                                    &nbsp;
                                    <div>
                                        <strong>DIRECCIÓN: </strong>$direccion, $localidad
                                    </div>
                                    &nbsp;
                                    <div>
                                        <strong>INDETERMINADAS</strong> ___/ " . date('Y') . "
                                    </div>
                                    &nbsp;
                                    <div>
                                        <strong>N.I.G: </strong> _______
                                    </div>
                                    &nbsp;
                                    <div>
                                        <strong>Delito/Falta: </strong> _____________________________
                                    </div>
                                </div>
                                &nbsp;
                                &nbsp;
                                <div style='text-align:center' class='text-center'>
                                    <strong>A C T A </strong>
                                </div>
                                &nbsp;
                                <div>
                                    <p>En $localidad, a " . $utils->fechaCastellano2(date('Y')) . ".</p>
                                </div>
                                &nbsp;
                                <div style='text-align:justify'>       
                                    En virtud de lo establecido en los art&iacute;culos 44, n&uacute;meros 3&ordm; y 4&ordm; del Reglamento del Registro Civil; 211 
                                    de la Ley Org&aacute;nica del Poder Judicial; 40.3 del Reglamento 5/95, de 7 de junio, del Consejo General del Poder Judicial sobre 
                                    Aspectos Accesorios de las Actuaciones Judiciales; Disposici&oacute;n Adicional decimotercera del Acuerdo de 7 de junio de 1995, que 
                                    ordena publicar la anterior y otros, as&iacute; como el Acuerdo de 10 de enero de 2001 del Plano del Consejo, 
                                    ante S.S&ordf; D./D&ordf;. , asistido de mi, Secretaría del Juzgado de Instrucci&oacute;n n&ordm; 1 de esta Ciudad se 
                                    levanta la siguiente acta respecto a la defunci&oacute;n a la que se refiere el CERTIFICADO MÉDICO que se presenta, 
                                    con aportaci&oacute;n del Documento Nacional de Identidad del fallecido, para la concesi&oacute;n de la oportuna licencia de 
                                    enterramiento que se realiza en este acto, con remisi&oacute;n posterior de todo lo actuado al &oacute;rgano competente 
                                    para la pr&aacute;ctica de la inscripci&oacute;n de defunci&oacute;n en los t&eacute;rminos legalmente previstos.
                                </div>
                                &nbsp;
                                <div>
                                    Persona compareciente: D./D&ordf;. <strong>" . $data['applicantName'] . " " . $data['applicantSurname'] . "</strong>
                                </div>
                                &nbsp;
                                <div>
                                    Documento Nacional de Identidad: <strong>" . $data['applicantNIF'] . "</strong>
                                </div>
                                &nbsp;
                                <div>
                                    Manifiesta que su comparecencia tiene por objeto el solicitar de este Juzgado, en funciones de guardia, que, previos 
                                    los tr&aacute;mites necesarios, se le conceda la licencia de enterramiento al objeto de proceder a la inhumaci&oacute;n 
                                    del <u><em>cad&aacute;ver</em></u> de $pre <strong>" . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</strong>  (Q.E.P.D.) 
                                    fallecido a las <strong>" . $deceasedTime . "</strong> horas del d&iacute;
                                    a <strong>" . $deceasedDate . "</strong> a consecuencia de ______________________. 
                                    Que es deseo de su familia el proceder a la inhumaci&oacute;n del cad&aacute;ver en el $cemetery.
                                </div>            
                                &nbsp;
                                <div>
                                    Con lo cual se dio por terminado este acto y se extiende la presente que firman todos los intervinientes, previa lectura.
                                </div>
                                <br><br><br><br>
                                <div style='font-size: 14px; text-align: right;'><p>Fdo.: ______________________</p></div>
                                <br><br><br><br>
                                <br>
                            </div></div></div>
                    ";
                }
            break;

            case "actaPreparacion":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/actaPreparacion.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $utils = new Utils();
                    $data1 = getActaPreparacion($expedient);
                    $staticInfo = $documentsInfo->getByDocument('actaPreparacion');
                    if($staticInfo != null){
                        foreach($staticInfo as $elem){
                            switch($elem['name']){
                                case 'staff4':
                                    $staff = $elem['value'];
                                break;

                                case 'location4':
                                    $location = $elem['value'];
                                break;
                            }
                        }
                    }else{
                        $staff = '';
                        $location = '';
                    }
                    if($data1['deceasedGender'] == "Mujer"){
                        $gender = "Dña.";
                    }else{
                        $gender = "D.";
                    }
                    $data = $_POST['data'];

                    if($data[29] == null || $data[29] == "null"){
                        $pickPerson = $data[30];
                    } else{
                        $pickPerson = $data[29];
                    }
                
                    $empresa = '';
                    if(isset($data[28])){
                        $empresa = $data[28];
                    }
                    if($data1['funeralHomeEntryTime'] == null){
                        $data1['funeralHomeEntryTime'] = '______ : ______';
                    }else{
                        $data1['funeralHomeEntryTime'] = date('H:i', strtotime($data1['funeralHomeEntryTime']));
                    }
                    
                    switch($data1['tanatologicalPractice']){
                        case '0':
                            $tanatologicalPractice = '__________________________';
                            break;
                            
                        case '1':
                            $tanatologicalPractice = 'Tanatoestética';
                            break;
                            
                        case '2':
                            $tanatologicalPractice = 'Tanatopraxia';
                            break;
                            
                        case '3':
                            $tanatologicalPractice = 'Embalsamamiento';
                            break;
                            
                        case '4':
                            $tanatologicalPractice = 'Conservación';
                            break;

                        default:
                            $tanatologicalPractice = '__________________________';
                            break;
                    }
                    $notes = $data[19] == '' && $data[25] == '' && $data[26] == '' ? false : true;
                
                    $pertenencias = $data[19] == '' ? '' : "<p><strong> - Lleva pertenencias: </strong></p><div class='firma$firmaColor' style='max-width:560px'>" . nl2br(htmlspecialchars($data[19]))  ."</div>";  
                    $vendas = $data[25] == '' ? '' : "<p><strong> - Vendas, cánulas, implantes retirados: </strong></p><div class='firma$firmaColor' style='max-width:560px'>" . nl2br(htmlspecialchars($data[25]))  ."</div>";  
                    $tratamiento = $data[26] == '' ? '' : "<p><strong> - Tratamiento reconstructivo: </strong></p><div class='firma$firmaColor' style='max-width:560px'>" . nl2br(htmlspecialchars($data[26]))  ."</div>";  
                    $background = $utils->getBackgroundDocuments();
                    $text = "<div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas'>
                                <div>
                                    <div class='col-xs-6 col-xs-offset-6' style='margin-top:-60px; padding-right:15px'>
                                        <table class='tablePdf$tablePdfColor text-center'>
                                            <tbody>
                                                <tr>
                                                    <td style='text-align:center'><strong>ACTIVIDADES DE PREPARACI&Oacute;N</strong></td>
                                                    <td>";
                                                        if(intval($_SESSION['company']) == 1){
                                                            $text .= "<p style='text-align:center'>C&oacute;digo:RE-7502</p>";
                                                        }
                                                        $text .= "<p style='text-align:center'>Revisi&oacute;n: 03</p>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <br>
                                <p>&nbsp;</p>
                                <p>DEF. DE <strong>" . $gender . " " . $data1['deceasedName'] . " " . $data1['deceasedSurname'] . "</strong> (Q.E.P.D.)</p>
                                <p>FECHA: <strong>" . $utils->fechaCastellano2(date('Y')) . "</strong></p>
                                <p>HORA RECOGIDA: <strong>" . $data1['funeralHomeEntryTime'] . "</strong></p>
                                <p>FUNERARIA QUE ENTREGA: <strong>" .$data1['funeralHome']."</strong></p>
                                <p>AGENTE QUE RECOGE: <strong>$pickPerson</strong></p>
                                <p>PRÁCTICA TANATOLÓGICA: <strong>$tanatologicalPractice</strong></p>
                                <br>
                                <p><strong><u>ACTA</u></strong></p>
                                <table class='$fuente'>
                                    <tr>
                                        <td style='height: 35px; width:40%; text-align: left'><p>Identificaci&oacute;n del fallecido: </p></td>
                                        <td style='height: 35px; width:5%; text-align: left'><p><strong> " . $data[31] . "</strong></p></td>
                                        <td style='height: 35px; width:5%;'>&nbsp;&nbsp;&nbsp;&nbsp;</td>
                                        <td style='height: 35px; width:45%; text-align: left'>" . $data[32] . "</td>
                                    </tr>
                                    <tr>
                                        <td style='height: 35px; width:40%; text-align: left'><p>El cad&aacute;ver viene vestido: </p></td>
                                        <td style='height: 35px; width:5%; text-align: left'><p><strong> " . $data[2] . "</strong></p></td>
                                        <td style='height: 35px; width:5%;'>&nbsp;&nbsp;&nbsp;&nbsp;</td>
                                        <td style='height: 35px; width:40%; text-align: left'><p>Entrega ropa para amortajamiento: </p></td>
                                        <td style='height: 35px; width:5%; text-align: left'><p><strong> " . $data[5] . "</strong></p></td>
                                    </tr>
                                    <tr>
                                        <td style='height: 35px; width:40%; text-align: left'><p>Se revisa la ropa: </p></td>
                                        <td style='height: 35px; width:5%; text-align: left'><p><strong> " . $data[10] . "</strong></p></td>
                                        <td style='height: 35px; width:5%;'>&nbsp;&nbsp;&nbsp;&nbsp;</td>
                                        <td style='height: 35px; width:40%; text-align: left'><p>Lleva pertenencias: </p></td>
                                        <td style='height: 35px; width:5%; text-align: left'><p><strong> " . $data[1] . "</strong></p></td>
                                    </tr>
                                    <tr>
                                        <td style='height: 35px; width:40%; text-align: left'><p>Vendas, c&aacute;nulas, implantes retirados: </p></td>
                                        <td style='height: 35px; width:5%; text-align: left'><p><strong> " . $data[0] . "</strong></p></td>
                                        <td style='height: 35px; width:5%;'>&nbsp;&nbsp;&nbsp;&nbsp;</td>
                                        <td style='height: 35px; width:40%; text-align: left'><p>Lavado superficial: </p></td>
                                        <td style='height: 35px; width:5%; text-align: left'><p><strong> " . $data[3] . "</strong></p></td>
                                    </tr>
                                    <tr>
                                        <td style='height: 35px; width:40%; text-align: left'><p>Cierre de orificios, relajamiento de expresi&oacute;n: </p></td>
                                        <td style='height: 35px; width:5%; text-align: left'><p><strong> " . $data[8] . "</strong></p></td>
                                        <td style='height: 35px; width:5%;'>&nbsp;&nbsp;&nbsp;&nbsp;</td>
                                        <td style='height: 35px; width:40%; text-align: left'><p>Afeitado: </p></td>
                                        <td style='height: 35px; width:5%; text-align: left'><p><strong> " . $data[11] . "</strong></p></td>
                                    </tr>
                                    <tr>
                                        <td style='height: 35px; width:40%; text-align: left'><p>Sustituci&oacute; de dentaduras postizas: </p></td>
                                        <td style='height: 35px; width:5%; text-align: left'><p><strong> " . $data[7] . "</strong></p></td>
                                        <td style='height: 35px; width:5%;'>&nbsp;&nbsp;&nbsp;&nbsp;</td>
                                        <td style='height: 35px; width:40%; text-align: left'><p>Cierre de ojos y boca: </p></td>
                                        <td style='height: 35px; width:5%; text-align: left'><p><strong> " . $data[6] . "</strong></p></td>
                                    </tr>
                                    <tr>
                                        <td style='height: 35px; width:40%; text-align: left'><p>Peinado, peliquer&iacute;a, aplicaci&oacute;n cosm&eacute;tica: </p></td>
                                        <td style='height: 35px; width:5%; text-align: left'><p><strong> " . $data[4] . "</strong></p></td>
                                        <td style='height: 35px; width:5%;'>&nbsp;&nbsp;&nbsp;&nbsp;</td>
                                        <td style='height: 35px; width:40%; text-align: left'><p>Tratamiento reconstructivo: </p></td>
                                        <td style='height: 35px; width:5%; text-align: left'><p><strong> " . $data[9] . "</strong></p></td>
                                    </tr>
                                </table>
                                <p><strong>(1)</strong> No aplica</p>
                                <br><br>
                                <p><strong><u>ENFERETRAMIENTO</u></strong></p>       
                                <table border='0' cellpadding='0' cellspacing='0' style='width:650px;font-size:11px;color:$colorStyle'>
                                    <tbody>
                                        <tr>
                                            <td></td>
                                            <td></td>
                                            <td style='text-align: center;vertical-align: middle;'>OBSERVACIONES</td>
                                        </tr>
                                        <tr>
                                            <td style='height: 35px; width:40%'>
                                                <p>POSICI&Oacute;N DEL DIFUNTO</p>                
                                            </td>
                                            <td style='height: 35px; width:5%'>
                                                <p><strong>" . $data[12] . "</strong></p>            
                                            </td>
                                            <td style='height: 35px; width:45%'>"
                                                . nl2br(htmlspecialchars($data[22])) . "
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 35px; width:40%'>
                                                <p>PEINADO</p>                
                                            </td>
                                            <td style='height: 35px; width:5%'>
                                                <p><strong>" . $data[13] . "</strong></p>                
                                            </td>
                                            <td style='height: 35px; width:45%'>"
                                                . nl2br(htmlspecialchars($data[20])) . "
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 35px; width:40%'>
                                                <p>INTERIOR ATA&Uacute;D</p>
                                            </td>
                                            <td style='height: 35px; width:5%'>
                                                <p><strong>" . $data[14] . "</strong></p>
                                            </td>
                                            <td style='height: 35px; width:45%'>"
                                                . nl2br(htmlspecialchars($data[21])) . "
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 35px; width:40%'>
                                                <p>LIMPIEZA Y BRILLO ATA&Uacute;D</p>
                                            </td>
                                            <td style='height: 35px; width:5%'>
                                                <p><strong>" . $data[15] . "</strong></p>
                                            </td>
                                            <td style='height: 35px; width:45%'>"
                                                . nl2br(htmlspecialchars($data[24])) . "
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 35px; width:40%'>
                                                <p>ART&Iacute;CULOS PERSONALES</p>
                                            </td>
                                            <td style='height: 35px; width:5%'>
                                                <p><strong>" . $data[16] . "</strong></p>
                                            </td>
                                            <td style='height: 35px; width:45%'>"
                                                . nl2br(htmlspecialchars($data[18])) . "
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 35px; width:40%'>
                                                <p>ESTADO ATA&Uacute;D</p>
                                            </td>
                                            <td style='height: 35px; width:5%'>
                                                <p><strong>" . $data[17] . "</strong></p>
                                            </td>
                                            <td style='height: 35px; width:45%'>"
                                                . nl2br(htmlspecialchars($data[23])) . "
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <br>";
                                if($pertenencias == '' && $vendas == '' && $tratamiento == ''){
                                    $text .="<br><div>
                                                <div class='col-xs-6'>              
                                                    <table class='tablePdf$tablePdfColor'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <p>Fecha y Firma:</p>                
                                                                    <p>" . $utils->fechaCastellano2(date('Y')) . "</p>  
                                                                    <br><br><br><br>              
                                                                    <p>Fdo.: $pickPerson</p>                
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>";
                                }
                            $text .= "</div>
                        </div>
                    </div>";
                        if($pertenencias != '' || $vendas != '' || $tratamiento != ''){
                            $text .="<pagebreak>
                            <div class='fondo'>
                                <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                    <div class='contenidoPompas'>
                                        <br><br>";
                                        if($notes){
                                            $text .= "  <p><strong><u>OBSERVACIONES</u></strong></p>
                                                        $pertenencias
                                                        $vendas
                                                        $tratamiento";
                                        }

                                $text .=" <br><br>
                                            <div>
                                                <div class='col-xs-12'>              
                                                    <table style='width: 100%; color: #00305c;' class='tablePdf$tablePdfColor'>
                                                        <tr>
                                                            <td>
                                                                <p>Fecha y Firma:</p>                
                                                                <p>" . $utils->fechaCastellano2(date('Y')) . "</p>  
                                                                <br><br><br>         
                                                                <p>Fdo.: $pickPerson</p>                
                                                            </td>
                                                            <td>
                                                                <p>Firma de la familia:</p>                
                                                                <p>" . $utils->fechaCastellano2(date('Y')) . "</p>  
                                                                <br><br><br>      
                                                                <p>Fdo.:</p>                
                                                            </td>
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>";
                        }

                    if($data[1] != 'NO'){
                        $text .= "<pagebreak><div class='fondo'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div class='contenidoPompas'>
                                    <p>Recibí de <strong>$empresa</strong> los siguientes objetos personales que
                                    portaba su familiar " . $gender . " " . $data1['deceasedName'] . " " . $data1['deceasedSurname'] . " (Q.E.P.D.) en el momento de su
                                    recepción por nuestro personal funerario.</p>
                                    <br><br>
                                    <p><strong><u>OBJETOS:</u></strong></p>
                                    <br><br>
                                    <div class='col-xs-12'>              
                                        <table class='tablePdf$tablePdfColor'>
                                            <tbody>
                                                <tr>
                                                    <td>" . nl2br(htmlspecialchars($data[19])) . "</td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div class='col-xs-12' style='margin-top:20px'>
                                        <div style='width:40%; float:left' class='pull-left'>
                                            <table class='tablePdf$tablePdfColor'>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                        <p>Firma:</p>                
                                                        <br><br>                
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <br>
                                            <p>Por la familia:</p> 
                                            <p>Fdo.: ".$data[27]."</p> 
                                            <p>Parentesco: ______________</p> 
                                        </div>
                                        <div style='width:40%; float:right' class='pull-right'>
                                            <table class='tablePdf$tablePdfColor'>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            <p>Firma:</p>                
                                                            <br><br>                       
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <br>
                                            <p>Por la empresa:</p> 
                                            <p>Fdo.: ".$empresa."</p> 
                                            <p>Cargo: ___________________</p> 
                                        </div>
                                    </div>
                                    <div class='col-xs-12' style='margin-top:20px'>
                                        <p><br><br><br><br><br></p>
                                        <p style='margin-top:100px; text-align:right; font-size:12px'>En $location, a ".$utils->fechaCastellano2(date('Y'))."</p>
                                    </div>
                                    <br><br><br><br>
                                    <div style='font-size: 14px; text-align: right;'><p>Fdo.: ______________________</p></div>
                                    <br><br><br>
                                </div>
                            </div>
                        </div>";
                    }
                    return $text;        
                }
            break;

            case "asistencia":
                $utils = new Utils();
                $result = getAsistencia($expedient);
                $data = $result[0];
                $survey = $result[1];
                $background = $utils->getBackgroundDocuments();
                if($data['attendanceDate'] != null){
                    $data['attendanceDate'] = date("j-n-Y", $data['attendanceDate']);
                }else{
                    $data['attendanceDate'] = "N/A";
                }
                if($data['deceasedDate'] != null){
                    $data['deceasedDate'] = date("j-n-Y", strtotime($data['deceasedDate']));
                }else{
                    $data['deceasedDate'] = "N/A";
                }
                if($data['literalDate'] != null){
                    $data['literalDate'] = date("j-n-Y", $data['literalDate']);
                }else{
                    $data['literalDate'] = "N/A";
                }
                if($data['receiptDate'] != null){
                    $data['receiptDate'] = date("j-n-Y", $data['receiptDate']);
                }else{
                    $data['receiptDate'] = "N/A";
                }
                if($data['ssDateStart'] != null){
                    $data['ssDateStart'] = date("j-n-Y", $data['ssDateStart']);
                }else{
                    $data['ssDateStart'] = "N/A";
                }
                if($data['ssDateEnd'] != null){
                    $data['ssDateEnd'] = date("j-n-Y", $data['ssDateEnd']);
                }else{
                    $data['ssDateEnd'] = "N/A";
                }
                if($data['inssDateStart'] != null){
                    $data['inssDateStart'] = date("j-n-Y", $data['inssDateStart']);
                }else{
                    $data['inssDateStart'] = "N/A";
                }
                if($data['inssDateEnd'] != null){
                    $data['inssDateEnd'] = date("j-n-Y", $data['inssDateEnd']);
                }else{
                    $data['inssDateEnd'] = "N/A";
                }
                if($data['ismDateStart'] != null){
                    $data['ismDateStart'] = date("j-n-Y", $data['ismDateStart']);
                }else{
                    $data['ismDateStart'] = "N/A";
                }
                if($data['ismDateEnd'] != null){
                    $data['ismDateEnd'] = date("j-n-Y", $data['ismDateEnd']);
                }else{
                    $data['ismDateEnd'] = "N/A";
                }
                if($data['socialDateStart'] != null){
                    $data['socialDateStart'] = date("j-n-Y", $data['socialDateStart']);
                }else{
                    $data['socialDateStart'] = "N/A";
                }
                if($data['socialDateEnd'] != null){
                    $data['socialDateEnd'] = date("j-n-Y", $data['socialDateEnd']);
                }else{
                    $data['socialDateEnd'] = "N/A";
                }
                if($data['passiveDateStart'] != null){
                    $data['passiveDateStart'] = date("j-n-Y", $data['passiveDateStart']);
                }else{
                    $data['passiveDateStart'] = "N/A";
                }
                if($data['passiveDateEnd'] != null){
                    $data['passiveDateEnd'] = date("j-n-Y", $data['passiveDateEnd']);
                }else{
                    $data['passiveDateEnd'] = "N/A";
                }
                if($data['isfasDateStart'] != null){
                    $data['isfasDateStart'] = date("j-n-Y", $data['isfasDateStart']);
                }else{
                    $data['isfasDateStart'] = "N/A";
                }
                if($data['isfasDateEnd'] != null){
                    $data['isfasDateEnd'] = date("j-n-Y", $data['isfasDateEnd']);
                }else{
                    $data['isfasDateEnd'] = "N/A";
                }
                if($data['lastWishDateStart'] != null){
                    $data['lastWishDateStart'] = date("j-n-Y", $data['lastWishDateStart']);
                }else{
                    $data['lastWishDateStart'] = "N/A";
                }
                if($data['lastWishDateEnd'] != null){
                    $data['lastWishDateEnd'] = date("j-n-Y", $data['lastWishDateEnd']);
                }else{
                    $data['lastWishDateEnd'] = "N/A";
                }
                if($data['spanishPension'] == "0"){
                    $data['spanishPension'] = "";
                }else{
                    $data['spanishPension'] = "España";
                }
                if($data['foreignPension'] == "0"){
                    $data['foreignPension'] = "";
                }else{
                    $data['foreignPension'] = "Extranjero";
                }
                if($data['dniDateGStart'] != null){
                    $data['dniDateGStart'] = date("j-n-Y", $data['dniDateGStart']);
                }else{
                    $data['dniDateGStart'] = "N/A";
                }
                if($data['dniDateGEnd'] != null){
                    $data['dniDateGEnd'] = date("j-n-Y", $data['dniDateGEnd']);
                }else{
                    $data['dniDateGEnd'] = "N/A";
                }
                if($data['familyBookDateGStart'] != null){
                    $data['familyBookDateGStart'] = date("j-n-Y", $data['familyBookDateGStart']);
                }else{
                    $data['familyBookDateGStart'] = "N/A";
                }
                if($data['familyBookDateGEnd'] != null){
                    $data['familyBookDateGEnd'] = date("j-n-Y", $data['familyBookDateGEnd']);
                }else{
                    $data['familyBookDateGEnd'] = "N/A";
                }
                if($data['literalBirthdayDateGStart'] != null){
                    $data['literalBirthdayDateGStart'] = date("j-n-Y", $data['literalBirthdayDateGStart']);
                }else{
                    $data['literalBirthdayDateGStart'] = "N/A";
                }
                if($data['literalBirthdayDateGEnd'] != null){
                    $data['literalBirthdayDateGEnd'] = date("j-n-Y", $data['literalBirthdayDateGEnd']);
                }else{
                    $data['literalBirthdayDateGEnd'] = "N/A";
                }
                if($data['registrationDateGStart'] != null){
                    $data['registrationDateGStart'] = date("j-n-Y", $data['registrationDateGStart']);
                }else{
                    $data['registrationDateGStart'] = "N/A";
                }
                if($data['registrationDateGEnd'] != null){
                    $data['registrationDateGEnd'] = date("j-n-Y", $data['registrationDateGEnd']);
                }else{
                    $data['registrationDateGEnd'] = "N/A";
                }
                if($data['literalMarriageDateGStart'] != null){
                    $data['literalMarriageDateGStart'] = date("j-n-Y", $data['literalMarriageDateGStart']);
                }else{
                    $data['literalMarriageDateGStart'] = "N/A";
                }
                if($data['literalMarriageDateGEnd'] != null){
                    $data['literalMarriageDateGEnd'] = date("j-n-Y", $data['literalMarriageDateGEnd']);
                }else{
                    $data['literalMarriageDateGEnd'] = "N/A";
                }
                if($data['dniDateRStart'] != null){
                    $data['dniDateRStart'] = date("j-n-Y", $data['dniDateRStart']);
                }else{
                    $data['dniDateRStart'] = "N/A";
                }
                if($data['dniDateREnd'] != null){
                    $data['dniDateREnd'] = date("j-n-Y", $data['dniDateREnd']);
                }else{
                    $data['dniDateREnd'] = "N/A";
                }
                if($data['familyBookDateRStart'] != null){
                    $data['familyBookDateRStart'] = date("j-n-Y", $data['familyBookDateRStart']);
                }else{
                    $data['familyBookDateRStart'] = "N/A";
                }
                if($data['familyBookDateREnd'] != null){
                    $data['familyBookDateREnd'] = date("j-n-Y", $data['familyBookDateREnd']);
                }else{
                    $data['familyBookDateREnd'] = "N/A";
                }
                if($data['literalBirthdayDateRStart'] != null){
                    $data['literalBirthdayDateRStart'] = date("j-n-Y", $data['literalBirthdayDateRStart']);
                }else{
                    $data['literalBirthdayDateRStart'] = "N/A";
                }
                if($data['literalBirthdayDateREnd'] != null){
                    $data['literalBirthdayDateREnd'] = date("j-n-Y", $data['literalBirthdayDateREnd']);
                }else{
                    $data['literalBirthdayDateREnd'] = "N/A";
                }
                if($data['registrationDateRStart'] != null){
                    $data['registrationDateRStart'] = date("j-n-Y", $data['registrationDateRStart']);
                }else{
                    $data['registrationDateRStart'] = "N/A";
                }
                if($data['registrationDateREnd'] != null){
                    $data['registrationDateREnd'] = date("j-n-Y", $data['registrationDateREnd']);
                }else{
                    $data['registrationDateREnd'] = "N/A";
                }
                if($data['literalMarriageDateRStart'] != null){
                    $data['literalMarriageDateRStart'] = date("j-n-Y", $data['literalMarriageDateRStart']);
                }else{
                    $data['literalMarriageDateRStart'] = "N/A";
                }
                if($data['literalMarriageDateREnd'] != null){
                    $data['literalMarriageDateREnd'] = date("j-n-Y", $data['literalMarriageDateREnd']);
                }else{
                    $data['literalMarriageDateREnd'] = "N/A";
                }
                if($data['date'] != null){
                    $data['date'] = date("j-n-Y", $data['date']);
                }else{
                    $data['date'] = "N/A";
                }
                if($data['attention'] == null){
                    $data['attention'] = "NO APLICA";
                    //$data['attentionText'] = "";
                }
                if($data['advice'] == null){
                    $data['advice'] = "NO APLICA";
                    //$data['adviceText'] = "";
                }
                if($data['time'] == null){
                    $data['time'] = "NO APLICA";
                    //$data['timeText'] = "";
                }
                if($data['cafe'] == null){
                    $data['cafe'] = "NO APLICA";
                    //$data['cafeText'] = "";
                }
                if($data['room'] == null){
                    $data['room'] = "NO APLICA";
                    //$data['roomText'] = "";
                }
                if($data['building'] == null){
                    $data['building'] = "NO APLICA";
                    //$data['buildingText'] = "";
                }
                if($data['crematorium'] == null){
                    $data['crematorium'] = "NO APLICA";
                    //$data['crematoriumText'] = "";
                }
                if($data['cleaning'] == null){
                    $data['cleaning'] = "NO APLICA";
                    //$data['cleaningText'] = "";
                }
                if($data['organization'] == null){
                    $data['organization'] = "NO APLICA";
                    //$data['organizationText'] = "";
                }
                if($data['doubt'] == null){
                    $data['doubt'] = "NO APLICA";
                    //$data['doubtText'] = "";
                }

                if($data['deceasedGender'] == 'Hombre'){
                    $pre = 'D. ';
                }else{
                    $pre = 'Dña. ';
                }

                $text = "<div class='fondo'>
                    <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                        <div style='right: 520px; position: absolute; text-align: right; padding-top: 50px;'>
                            <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                        </div>
                        <div class='contenidoPompas' style='padding-top: -5px'>
                            <div style='text-align:center' class='text-center'>
                                <p><strong><u>ASISTENCIA</u></strong></p>
                            </div>
                            <div>
                                <div style='text-align:center' class='text-center'>
                                    <p><strong>---------------------------------------------------------------------------------------</strong></p>
                                </div>
                            </div>
                            <div>
                                <p><strong><u>DATOS</u></strong></p>
                                <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                    <tbody>
                                        <tr>
                                            <td><p style='text-align:right'><strong>Nº expediente</strong></p></td>
                                            <td><p>" . $data['number'] . "</p></td>
                                            <td><p style='text-align:right'><strong>Fecha asistencia tanatorio</strong></p></td>
                                            <td><p>" . $data['attendanceDate'] . "</p></td>
                                            <td><p style='text-align:right'><strong>Difunto</strong></p></td>
                                            <td><p>$pre " . $data['deceasedName'] . " " . $data['deceasedSurname'] . " (Q.E.P.D.)</p></td>
                                        </tr>
                                        <tr>
                                            <td><p style='text-align:right'><strong>Viudo/a de</strong></p></td>
                                            <td><p>" . $data['deceasedFirstNuptials'] . "</p></td>
                                            <td><p style='text-align:right'><strong>Capital pólica</strong></p></td>
                                            <td><p>" . $data['capital'] . "</p></td>
                                            <td><p style='text-align:right'><strong>Lugar asistencia</strong></p></td>
                                            <td><p>" . $data['mortuaryName'] . "</p></td>
                                        </tr>
                                        <tr>
                                            <td><p style='text-align:right'><strong>Dirección</strong></p></td>
                                            <td><p>" . $data['address'] . "</p></td>
                                            <td><p style='text-align:right'><strong>Provincia</strong></p></td>
                                            <td><p>" . $data['mortuaryProvince'] . "</p></td>
                                            <td><p style='text-align:right'><strong>Población</strong></p></td>
                                            <td><p>" . $data['mortuaryLocation'] . "</p></td>
                                        </tr>
                                        <tr>
                                            <td><p style='text-align:right'><strong>Teléfono 1</strong></p></td>
                                            <td><p>" . $data['phone1'] . "</p></td>
                                            <td><p style='text-align:right'><strong>Teléfono 2</strong></p></td>
                                            <td><p>" . $data['phone2'] . "</p></td>
                                            <td><p style='text-align:right'><strong>Teléfono 3</strong></p></td>
                                            <td><p>" . $data['phone3'] . "</p></td>
                                        </tr>
                                        <tr>
                                            <td><p style='text-align:right'><strong>Fecha defunción</strong></p></td>
                                            <td><p>" . $data['deceasedDate'] . "</p></td>
                                            <td><p style='text-align:right'><strong>Fecha recogida literales</strong></p></td>
                                            <td><p>" . $data['literalDate'] . "</p></td>
                                            <td><p style='text-align:right'><strong>Fecha entrega factura</strong></p></td>
                                            <td><p>" . $data['receiptDate'] . "</p></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <br><br>
                            <div>
                                <p><strong><u>TRÁMITES</u></strong></p>
                                <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                    <tbody>
                                        <tr>
                                            <td style='width:15%;'><p style='text-align:right'><strong>Baja SS.SS.</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['ssDateStart'] . "<br>" . $data['ssDateEnd'] . "</p></td>
                                            <td style='width:15%;'><p style='text-align:right'><strong>Pensión</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['spanishPension'] . "<br>" . $data['foreignPension'] . "</p></td>
                                            <td style='width:15%;'><p style='text-align:right'><strong>INSS</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['inssDateStart'] . "<br>" . $data['inssDateEnd'] . "</p></td>
                                        </tr>
                                        <tr>
                                            <td style='width:15%;'><p style='text-align:right'><strong>ISM</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['ismDateStart'] . "<br>" . $data['ismDateEnd'] . "</p></td>
                                            <td style='width:15%;'><p style='text-align:right'><strong>T. Social</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['socialDateStart'] . "<br>" . $data['socialDateEnd'] . "</p></td>
                                            <td style='width:15%;'><p style='text-align:right'><strong>C. Pasivas</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['passiveDateStart'] . "<br>" . $data['passiveDateEnd'] . "</p></td>
                                        </tr>
                                        <tr>
                                            <td style='width:15%;'><p style='text-align:right'><strong>Isfas</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['isfasDateStart'] . "<br>" . $data['isfasDateEnd'] . "</p></td>
                                            <td style='width:15%;'><p style='text-align:right'><strong>Últimas voluntades</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['lastWishDateStart'] . "<br>" . $data['lastWishDateEnd'] . "</p></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <br><br>
                            <div>
                                <p><strong><u>RECEPCIÓN DE DOCUMENTACIÓN</u></strong></p>
                                <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                    <tbody>
                                        <tr>
                                            <td style='width:15%;'><p style='text-align:right'><strong>DNI</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['dniDateGStart'] . "<br>" . $data['dniDateGEnd'] . "</p></td>
                                            <td style='width:15%;'><p style='text-align:right'><strong>Libro de familia</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['familyBookDateGStart'] . "<br>" . $data['familyBookDateGEnd'] . "</p></td>
                                            <td style='width:15%;'><p style='text-align:right'><strong>Literal nacimiento</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['literalBirthdayDateGStart'] . "<br>" . $data['literalBirthdayDateGEnd'] . "</p></td>
                                        </tr>
                                        <tr>
                                            <td style='width:15%;'><p style='text-align:right'><strong>Empadronamiento</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['registrationDateGStart'] . "<br>" . $data['registrationDateGEnd'] . "</p></td>
                                            <td style='width:15%;'><p style='text-align:right'><strong>Literal matrimonio</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['literalMarriageDateGStart'] . "<br>" . $data['literalMarriageDateGEnd'] . "</p></td>
                                            <td style='width:15%;'><p style='text-align:right'><strong>Varios</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['several'] . "</p></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <br><br>
                            <div>
                                <p><strong><u>DEVOLUCIÓN DE DOCUMENTACIÓN</u></strong></p>
                                <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                    <tbody>
                                        <tr>
                                            <td style='width:15%;'><p style='text-align:right'><strong>DNI</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['dniDateRStart'] . "<br>" . $data['dniDateREnd'] . "</p></td>
                                            <td style='width:15%;'><p style='text-align:right'><strong>Libro de familia</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['familyBookDateRStart'] . "<br>" . $data['familyBookDateREnd'] . "</p></td>
                                            <td style='width:15%;'><p style='text-align:right'><strong>Literal nacimiento</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['literalBirthdayDateRStart'] . "<br>" . $data['literalBirthdayDateREnd'] . "</p></td>
                                        </tr>
                                        <tr>
                                            <td style='width:15%;'><p style='text-align:right'><strong>Empadronamiento</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['registrationDateRStart'] . "<br>" . $data['registrationDateREnd'] . "</p></td>
                                            <td style='width:15%;'><p style='text-align:right'><strong>Literal matrimonio</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['literalMarriageDateRStart'] . "<br>" . $data['literalMarriageDateREnd'] . "</p></td>
                                            <td style='width:15%;'><p style='text-align:right'><strong>Varios</strong></p></td>
                                            <td style='width:15%;'><p>" . $data['several'] . "</p></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <br><br>
                            <div>
                                <p><strong><u>OTROS</u></strong></p>
                                <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                    <tbody>
                                        <tr>
                                            <td style='width:20%;'><p style='text-align:right'><strong>Sucesiones</strong></p></td>
                                            <td><p>" . $data['successions'] . "</p></td>
                                        </tr>
                                        <tr>
                                            <td style='width:20%;'><p style='text-align:right'><strong>Informe defunción</strong></p></td>
                                            <td><p>" . $data['deathReport'] . "</p></td>
                                        </tr>
                                        <tr>
                                            <td style='width:20%;'><p style='text-align:right'><strong>Producción</strong></p></td>
                                            <td><p>" . $data['production'] . "</p></td>
                                        </tr>
                                        <tr>
                                            <td style='width:20%;'><p style='text-align:right'><strong>Notas</strong></p></td>
                                            <td><p>" . $data['notes'] . "</p></td>
                                        </tr>
                                        <tr>
                                            <td style='width:20%;'><p style='text-align:right'><strong>Km</strong></p></td>
                                            <td><p>" . $data['km'] . "</p></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <pagebreak>
                <div class='fondo'>
                    <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                        <div style='right: 520px; position: absolute; text-align: right; padding-top: 50px;'>
                            <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                        </div>
                        <div class='contenidoPompas' style='padding-top: -5px'>
                            <div style='text-align:center' class='text-center'>
                                <p><strong><u>CUESTIONARIO DE SATISFACCIÓN</u></strong></p>
                            </div>
                            <div>
                                <div style='text-align:center' class='text-center'>
                                    <p><strong>---------------------------------------------------------------------------------------</strong></p>
                                </div>
                            </div>
                            <div>
                                <p><strong><u>ENCUESTADO</u></strong></p>
                                <br>
                                <p style='text-align:justify'><strong>NOMBRE DEL ENTREVISTADO:</strong> " . $data['name'] . " - <strong>PARENTESCO:</strong> " . $data['relationship'] . "</p>
                                <p style='text-align:justify'><strong>FECHA:</strong> " . $data['date'] . "</p>
                            </div>
                            <br>
                            <div>
                                <p><strong><u>ENCUESTA</u></strong></p>
                                <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                    <tbody>
                                        <tr>
                                            <td style='width:20%;'><p style='text-align:center'><strong>SERVICIO</strong></p></td>
                                            <td style='width:20%;'><p style='text-align:center'><strong>VALORACIÓN</strong></p></td>
                                            <td><p style='text-align:center'><strong>OBSERVACIONES</strong></p></td>
                                        </tr>";

                foreach($survey as $elem){
                    $text .= "          <tr>
                                            <td style='width:20%;'>
                                                <p style='text-align:right'><strong>" . $elem['service'] . "</strong></p>
                                            </td>
                                            <td style='width:20%;'>
                                                <p style='text-align:center'>" . $elem['value'] . "</p>
                                            </td>
                                            <td>
                                                <p style='text-align:center'>" . $elem['notes'] . "</p>
                                            </td>
                                        </tr>";
                }
                $text .= "          </tbody>
                                </table>
                            </div>
                            <br>
                            <div>
                                <p><strong><u>ASPECTOS A MEJORAR</u></strong></p>
                                <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                    <tbody>
                                        <tr>
                                            <td><p style='text-align:justify'>" . $data['aspects'] . "</p></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>";

                return $text;
            break;

            case "autoCremacion":

                $utils = new Utils();
                $background = $utils->getBackgroundDocuments();
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/autoCremacion.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{

                    $staticInfo = $documentsInfo->getByDocument('autoCremacion');
                    if($staticInfo != null){
                        foreach($staticInfo as $elem){
                            switch($elem['name']){
                                case 'companyDoc2':
                                    $company = $elem['value'];
                                break;

                                case 'addressDoc2':
                                    $address = $elem['value'];
                                break;
                                case 'locationDoc2':
                                    $location = $elem['value'];
                                break;
                                case 'provinceDoc2':
                                    $province = $elem['value'];
                                break;
                                case 'rgpdDoc2':
                                    $rgpd = $elem['value'];
                                break;
                            }
                        }
                    }else{
                        $company = '';
                        $address = '';
                        $location = '';
                        $province = '';
                        $rgpd = '';
                    }

                    $data = getAutoCremacion($expedient);
                    
                    if($data['deceasedGender'] == "Mujer"){
                        $gender = "Dña.";
                    }else{
                        $gender = "D.";
                    }

                    $crematoriumIntroductionDate = $data['start'] == null ? '' : date('d/m/Y', strtotime($data['start']));
                    $crematoriumIntroductionTime = $data['start'] == null ? '' : date('H:i', strtotime($data['start']));
                    if($data['crematoriumIntroduction'] != 0){
                        $crematoriumIntroductionA = "X";
                        $crematoriumIntroductionB = "";
                    }else{
                        $crematoriumIntroductionA = "";
                        $crematoriumIntroductionB = "X";
                    }
                    if($data['crematoriumWaitOnRoom'] != 0){
                        $crematoriumWaitOnRoomA = "X";
                        $crematoriumWaitOnRoomB = "";
                    }else{
                        $crematoriumWaitOnRoomA = "";
                        $crematoriumWaitOnRoomB = "X";
                    }
                    if($data['crematoriumVaseBio'] == 1){
                        $crematoriumVaseBioA = "X";
                        $crematoriumVaseBioB = "";
                    }else{
                        $crematoriumVaseBioA = "";
                        $crematoriumVaseBioB = "X";
                    }
                    if($data['crematoriumPacemaker'] == 1){
                        $crematoriumPacemakerA = "X";
                        $crematoriumPacemakerB = "";
                    }else{
                        $crematoriumPacemakerA = "";
                        $crematoriumPacemakerB = "X";
                    }
                    $deceasedRoom = $data['deceasedRoom'] == null ? '' : $data['deceasedRoom'];
                    if($data['authDate'] != null){
                        $endDate = date('d/m/Y', $data['authDate']);
                        $endTime = date('H:i', $data['authTime']);
                    }else{
                        $endDate = "______________";
                        $endTime = "______________";
                    }
                    if($data['deceasedDate'] != null){
                        $data['deceasedDate'] = date("j-n-Y", strtotime($data['deceasedDate']));
                    }else{
                        $data['deceasedDate'] = "N/A";
                    }

                    return "
                        <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas' style='padding-top: -5px'>
                                <div style='text-align: right; padding-top: 35px; line-height: 0.5'>
                                    <p>$company</p>
                                    <p>$address</p>
                                    <p>$location</p>
                                    <p>$province</p>
                                </div>
                                <div class='titulo' style='text-align:center;margin-top:30px'>
                                    <span>
                                        <u><strong>AUTORIZACI&Oacute;N PARA CREMACI&Oacute;N Y ENTREGA DE CENIZAS</strong></u>
                                    </span>
                                </div>
                                <br>
                                <div style='text-align:justify'>
                                    <span style='font-size:12px'>
                                        Por medio del presente documento, el abajo firmante, se declara representante <strong>autorizado por la familia</strong> para dar autorizaci&oacute;n 
                                        a <em><strong>$company</strong></em> a realizar el servicio de cremaci&oacute;n solicitado, eximiendo a &eacute;sta de toda responsabilidad frente a 
                                        cualquier reclamaci&oacute;n que se pudiese presentar contra la misma, por carecer de autorizaci&oacute;n suficiente para la realizaci&oacute;n 
                                        del servicio de <strong>CREMACI&Oacute;N</strong>. Se libera por tanto a <em><strong>$company</strong></em> de la total responsabilidad, 
                                        asumi&eacute;ndola el abajo firmante en este <strong>documento de Autorizaci&oacute;n</strong>:
                                        <br><br>
                                        " . $gender . ": <strong>" . $data['familyContactName'] . " " . $data['familyContactSurname'] . "</strong>, con DNI: 
                                        <strong>" . $data['familyContactNIF'] . "</strong> en calidad de ". $data['familyContactRelationship'] .", con domicilio en 
                                        " . $data['familyContactAddress'] . " de " . $data['familyContactLocality'] . ", solicito de $company la cremaci&oacute;n de los restos mortales 
                                        de tipo:
                                    </span>
                                </div>
                                <br>
                                <div style='text-align:justify'><span style='font-size:12px'>
                                    <table class='tablePdf$tablePdfColor' style='width: 100%; font-size:10px' >
                                        <tbody>
                                            <tr>
                                                <td style='width: 60%;'>
                                                    <table width='100%' style='font-size:10px; color:$colorStyle'>
                                                        <tbody>
                                                            <tr style='font-size:10px;'>
                                                                <td style='font-size:10px;'>CAD&Aacute;VER:</td>
                                                                <td style='font-size:10px; text-align:center; width:7%;'>X</td>
                                                            </tr>
                                                            <tr>
                                                                <td>RESTOS CADAV&Eacute;RICOS:</td>
                                                                <td style='font-size:10px; text-align:center; width:7%;'></td>
                                                            </tr>
                                                            <tr>
                                                                <td>CENIZAS:</td>
                                                                <td style='font-size:10px; text-align:center; width:7%;'></td>
                                                            </tr>
                                                            <tr>
                                                                <td colspan='5'>
                                                                    <p style='font-size:10px; text-align:left;'>
                                                                        De " . $gender . " <strong><span style='border: solid 1px blue; width: 40px;'>
                                                                        " . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</span></strong> (Q.E.P.D.)<br>con D.N.I. 
                                                                        N&ordm;: <strong><span style='border: solid 1px blue;'>" . $data['deceasedNIF'] . " </span></strong>
                                                                        Fallecido el: <strong>" . $data['deceasedDate'] . "</strong> a las <strong>" . substr($data['deceasedTime'], 0, -3) . "</strong>
                                                                    </p>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td style='width: 30%; border: solid 1px blue; text-align:left; vertical-align:top'>
                                                <br><br><br><br><br><br><p>Fdo: <strong>". $data['familyContactName'] . " " . $data['familyContactSurname'] ."</strong></p><p>DNI: <strong>" . $data['familyContactNIF'] . "</strong></p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <br><br>
                                <table class='tablePdfNoBorder' cellspacing='0' cellpadding='4'>
                                    <tr> 
                                        <td style='width=100px;'><span style='font-size: 12px;color:$colorStyle'>Portador marcapasos: </span></td>
                                        <td style='margin-left: 20px'><span style='font-size: 12px;color:$colorStyle'>&nbsp;SI&nbsp;</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span>$crematoriumPacemakerA</span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;NO&nbsp;</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td>$crematoriumPacemakerB</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;Otros</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;Especificar:</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td style='width:100px'></td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                    <tr> 
                                        <td style='width=100px'><span style='font-size: 12px;color:$colorStyle'>Asistencia a la introducción: </span></td>
                                        <td style='margin-left: 20px;'><span style='font-size: 12px;color:$colorStyle'>&nbsp;SI</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td>$crematoriumIntroductionA</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;NO</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td>$crematoriumIntroductionB</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;Día:</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td style='width:80px; text-align: center;vertical-align: middle;'>$crematoriumIntroductionDate</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;Hora:</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td style='width:80px'>$crematoriumIntroductionTime</td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                    <tr> 
                                        <td style='width=100px'><span style='font-size: 12px;color:$colorStyle'>Esperan en Sala 7 hasta la entrega de Cenizas: </span></td>
                                        <td style='margin-left: 20px'><span style='font-size: 12px;color:$colorStyle'>&nbsp;SI</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td>$crematoriumWaitOnRoomA</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;NO</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td>$crematoriumWaitOnRoomB</td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                    <tr> 
                                        <td style='width=100px'><span style='font-size: 12px;color:$colorStyle'>Urna Biodegradable: </span></td>
                                        <td style='margin-left: 20px'><span style='font-size: 12px;color:$colorStyle'>&nbsp;SI</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td>$crematoriumVaseBioA</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;NO</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td>$crematoriumVaseBioB</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;Modelo:</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td style='width:100px'></td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                                <br><br>
                                <div style='text-align:center; clear:left'>
                                    <span>
                                        <u><strong>ENTREGA DE CENIZAS</strong></u>
                                    </span>
                                </div>
                                <br>
                                <div>
                                    <span style='font-size:12px'>
                                        Fecha de Entrega de Cenizas:<strong> " . $endDate . "</strong> a las <strong>" . $endTime . "</strong><br> Lugar: <strong>" . $data['authPlace'] . "</strong>
                                    </span>
                                </div>
                                <br>
                                <table class='tablePdf$tablePdfColor' border='1' cellpadding='5' cellspacing='0' style='width:100%;color:$colorStyle'>
                                    <tbody>
                                        <tr>
                                            <td>                 
                                                <p><span style='font-size:12px'>Persona autorizada a recoger las cenizas de NO ser el declarante:</span></p>                        
                                                <br>                    
                                                <p><span style='font-size:12px'>$gender: _______________________________________ con DNI: __________________</span></p>
                                            </td>
                                            <td>
                                                <p><span style='font-size:12px'>Receptor cenizas:</span></p>
                                                <br><br>
                                                <p><span style='font-size:12px'>Fdo.:</span></p> 
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <br><br>
                                <p style='text-align:center'>
                                    <u><strong><span>Consentimiento Reglamento General de Protección de Datos</span></strong></u>
                                </p>                
                                <table class='tablePdf$tablePdfColor' border='1' cellpadding='1' cellspacing='0' style='width:100%;color:$colorStyle'>
                                    <tbody>
                                        <tr>
                                            <td style='text-align:justify'><span style='font-size:8px'>$rgpd</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                                <br>
                                <table class='tablePdf$tablePdfColor' border='1' cellpadding='0' cellspacing='0' style='width:100%;color:$colorStyle'>
                                    <tbody>
                                        <tr>
                                            <td style='width:50%'>                
                                                <p><span style='font-size:12px'>Por $company</span></p>                    
                                                <br>                     
                                                <p><span style='font-size:12px'>Fdo: </span></p>                    
                                                <p><span style='font-size:12px'>DNI.: </span></p>
                                            </td>
                                            <td style='width:50%'>                            
                                                <p><span style='font-size:12px'>Aceptaci&oacute;n RGPD:</span></p>                    
                                                <br>                     
                                                <p><span style='font-size:12px'>Fdo.: <strong>" . $data['familyContactName'] . " " . $data['familyContactSurname'] . "</strong></span></p>                    
                                                <p><span style='font-size:12px'>DNI.: <strong>" . $data['familyContactNIF'] . "</strong></span></p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <br>
                                <table class='tablePdfNoBorder' style='width:100%;color:$colorStyle font-size:12px'>
                                    <tbody>
                                        <tr>
                                            <td style='width:50%'><strong>Exp: " . $data['number'] . "</strong></td>
                                            <td style='width:50%; text-align: right;' align='right'>                            
                                                <p style='font-size:12px; text-align: right;'>En " . $data['cremationLocality'] . ", a ".$utils->fechaCastellano2(date('Y'))."</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <br>
                            </div>
                        </div>
                    </div>";
                }
            break;

            case "autoCremacionTanatorioMSanchez":
                $utils = new Utils();
                $background = $utils->getBackgroundDocuments();
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/autoCremacionTanatorioMSanchez.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }

                $data = getAutoCremacion($expedient);
                
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                }

                if($data['familyContactName'] == null || $data['familyContactName'] == ''){
                    $data['familyContactName'] = '__________';
                }

                if($data['familyContactSurname'] == null || $data['familyContactSurname'] == ''){
                    $data['familyContactSurname'] = '_________________';
                }

                if($data['familyContactNIF'] == null || $data['familyContactNIF'] == ''){
                    $data['familyContactNIF'] = '__________';
                }

                if($data['familyContactRelationship'] == null || $data['familyContactRelationship'] == ''){
                    $data['familyContactRelationship'] = '_______';
                }

                if($data['familyContactAddress'] == null || $data['familyContactAddress'] == ''){
                    $data['familyContactAddress'] = '_______________________';
                }

                if($data['familyContactLocality'] == null || $data['familyContactLocality'] == ''){
                    $data['familyContactLocality'] = '_________________';
                }

                if($data['deceasedName'] == null || $data['deceasedName'] == ''){
                    $data['deceasedName'] = '__________';
                }
                if($data['deceasedSurname'] == null || $data['deceasedSurname'] == ''){
                    $data['deceasedSurname'] = '_________________';
                }
                if($data['deceasedNIF'] == null || $data['deceasedNIF'] == ''){
                    $data['deceasedNIF'] = '__________';
                }

                $crematoriumIntroductionDate = "";
                $crematoriumIntroductionTime = "";
                if($data['crematoriumIntroduction'] != 0){
                    $crematoriumIntroductionA = "X";
                    $crematoriumIntroductionB = "";
                    $crematoriumIntroductionDate = $data['start'] == null ? '' : date('d/m/Y', strtotime($data['start']));
                    $crematoriumIntroductionTime = $data['crematoriumArriveTime'] == null ? '' : date('H:i', strtotime($data['crematoriumArriveTime']));
                }else{
                    $crematoriumIntroductionA = "";
                    $crematoriumIntroductionB = "X";
                }
                if($data['crematoriumVaseBio'] == 1){
                    $crematoriumVaseBioA = "X";
                    $crematoriumVaseBioB = "";
                }else{
                    $crematoriumVaseBioA = "";
                    $crematoriumVaseBioB = "X";
                }
                if($data['authDate'] != null){
                    $endDate = date('d/m/Y', $data['authDate']);
                    $endTime = date('H:i', $data['authTime']);
                }else{
                    $endDate = "______________";
                    $endTime = "______________";
                }
                
                if($data['deceasedDate'] != null){
                    $data['deceasedDate'] = date("j-n-Y", strtotime($data['deceasedDate']));
                }else{
                    $data['deceasedDate'] = "N/A";
                }

                $deceasedLocationAddress = '__________________________';
                if($data['deceasedInName'] != null && $data['deceasedInName'] != ''){
                    $deceasedLocationAddress = $data['deceasedInName'];
                    if($data['deceasedLocation'] != null && $data['deceasedLocation'] != ''){
                        $deceasedLocationAddress .= ', ' .$data['deceasedLocation'];
                    }
                    if($data['deceasedProvince'] != null && $data['deceasedProvince'] != ''){
                        $deceasedLocationAddress .= ', ' .$data['deceasedProvince'];
                    }
                }

                $text ="
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas' style='padding-top: 15px'>
                                <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2'>
                                    <tr>
                                        <td style='width:45%; font-size: 18px!important; line-height: 10px; color:$colorStyle!important' valign='bottom'>
                                            <p>
                                                <img src='" . $utils->getRoute() . "resources/files/" . $_SESSION['company'] . "/obituaries/basic/tanatorioMSanchez.jpg'>
                                            </p>
                                        </td>
                                        <td style='width:45%; font-size: 18px!important; line-height: 10px; color:$colorStyle!important' valign='bottom'>
                                            <p>
                                                <span style='color:#4b0002!important'>
                                                    <br>Lugar O Vento nº12, Cea
                                                    <br>36617 Vilagarcía de Arousa (Pontevedra)
                                                    <br>Delegación Rianxo Telf.: 981 862 089
                                                    <br>Telf.: 986 502 292 Fax.: 986 509 289
                                                </span>
                                            </p>
                                        </td>
                                    </tr>
                                </table>
                                <div class='titulo' style='text-align:center;margin-top:30px'><span>
                                    <u><strong>AUTORIZACI&Oacute;N PARA CREMACI&Oacute;N Y ENTREGA DE CENIZAS</strong></u>
                                </span></div>
                                <br>
                                <div style='text-align:justify'>
                                    <span style='font-size:12px'>
                                        Por medio del presente documento se declara autorizado por la familia para dar autorización a <strong>Tanatorio M. Sánchez S.L.</strong>, a realizar el servicio de cremación
                                        solicitado, eximiendo a ésta de cualquier reclamación que se pueda presentar contra la misma. Asumiendo toda responsabilidad el autorizado, eximiendo a 
                                        <strong>Tanatorio M. Sánchez S.L.</strong> de cualquier responsabilidad.
                                        <br><br>
                                        D/Dña : <strong>" . $data['familyContactName'] . " " . $data['familyContactSurname'] . "</strong>, con DNI: <strong>" . $data['familyContactNIF'] . "</strong> 
                                        en calidad de ". $data['familyContactRelationship'] .", con domicilio en " . $data['familyContactAddress'] . ", " . $data['familyContactLocality'] . ", 
                                        solicito a Tanatorio M. Sánchez S.L. la cremaci&oacute;n de los restos mortales de " . $gender ." <strong>" . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</strong>
                                        con <strong>DNI: " . $data['deceasedNIF'] . "</strong>, fallecido el día ". $data['deceasedDate'] . " en $deceasedLocationAddress.
                                    </span>
                                </div>
                                <br><br>
                                <strong>INFORMACIÓN DE INTERÉS</strong>
                                <br>
                                <table class='tablePdfNoBorder' cellspacing='0' cellpadding='4'>
                                    <tr> 
                                        <td><span style='font-size: 12px;color:$colorStyle'>Restos mortales de tipo: </span></td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Cadáver&nbsp;</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span>&nbsp;</span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Restos cadavéricos</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td>&nbsp;</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></td>
                                    </tr>
                                </table>
                                <table class='tablePdfNoBorder' cellspacing='0' cellpadding='4' style='margin-top:3px'>
                                    <tr> 
                                        <td style='width=100px'><span style='font-size: 12px;color:$colorStyle'>Portador de marcapasos: </span></td>
                                        <td style='margin-left: 20px'><span style='font-size: 12px;color:$colorStyle'>&nbsp;SI</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td>&nbsp;</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;NO</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td>&nbsp;</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;Especificar:&nbsp;&nbsp;</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td style='width:150px'></td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                    <tr> 
                                        <td style='width=100px'><span style='font-size: 12px;color:$colorStyle'>Asistencia a la introducción: </span></td>
                                        <td style='margin-left: 20px;'><span style='font-size: 12px;color:$colorStyle'>&nbsp;SI&nbsp;&nbsp;</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td>$crematoriumIntroductionA</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;NO&nbsp;&nbsp;</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td>$crematoriumIntroductionB</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;Día:&nbsp;&nbsp;</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td style='width:80px; text-align: center;vertical-align: middle;'>$crematoriumIntroductionDate</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;Hora:&nbsp;&nbsp;</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td style='width:80px'>$crematoriumIntroductionTime</td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                    <tr> 
                                        <td style='width=100px'><span style='font-size: 12px;color:$colorStyle'>Urna Biodegradable: </span></td>
                                        <td style='margin-left: 20px'><span style='font-size: 12px;color:$colorStyle'>&nbsp;SI&nbsp;&nbsp;</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td>$crematoriumVaseBioA</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;NO&nbsp;&nbsp;</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td>$crematoriumVaseBioB</td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;Modelo:&nbsp;&nbsp;</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td style='width:100px'></td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                                <br><br>
                                <p>En _________________, a " . $utils->fechaCastellano2(date('Y')) . ".</p>
                                <div style='font-size: 14px; text-align: right;'><p>Firmado,</p></div>
                                <br><br><br><br>
                                <div style='text-align:center; clear:left'><span>
                                    <u><strong>RECEPCIÓN DE CENIZAS</strong></u>
                                </span></div>
                                <br>
                                <div><span style='font-size:12px'>
                                    Hora y fecha:<strong> " . $endDate . "</strong> a las <strong>" . $endTime . "</strong>en: <strong>" . $data['authPlace'] . "</strong>
                                </span></div>
                                <br>
                                <table class='tablePdf$tablePdfColor' border='1' cellpadding='5' cellspacing='0' style='width:100%;color:$colorStyle'>
                                    <tbody>
                                        <tr>
                                            <td>                 
                                                <p><span style='font-size:12px'>Persona autorizada a recoger las cenizas:</span></p>                        
                                                <br>                    
                                                <p><span style='font-size:12px'>D/Dña: _______________________________________ con DNI: __________________</span></p>
                                            </td>
                                            <td with='100px!important'>
                                                <p><span style='font-size:12px'>Fdo.: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></p>
                                                <br><br>
                                                <p><span style='font-size:12px'></span></p> 
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <br><br>
                                <div>
                                    <span style='font-size:10px;color:#4b0002'>
                                        TANATORIO M. SÁNCHEZ S.L., con dirección postal Lugar O Vento nº 12,Cea-36617 Vilagarcía de Arousa (Pontevedra) y Correo electrónico direccion@pompasfunebres-europeas.es, le informa
                                        que tratamos los datos personales que nos facilita con el fin de prestarles el servicio solicitado, así como para atender sus solicitudes de información y fidelizarle como cliente. Los datos
                                        proporcionados se conservarán mientras se mantenga la relación o durante los años necesarios para cumplir con las obligaciones legales. Los datos no se cederán a terceros salvo en los casos en
                                        que existe una obligación legal o para la correcta prestación de servicios. Usted tiene derecho a acceder a sus datos personales, rectificar los datos inexactos o solicitar su supresión cuando los
                                        datos ya no sean necesarios, limitar y oponerse a su tratamiento y a solicitar la portabilidad de sus datos. Estos derechos puede ejercerlos mediante solicitud, adjuntando copia de su DNI, dirigida
                                        a nuestra dirección de contacto o por correo electrónico.
                                        <br>También tiene derecho a presentar una reclamación ante la Agencia Española de Protección de Datos. Puede ampliar esta información consultando la Política de Privacidad en la Web
                                        www.pompasfunebres-europeas.es
                                        <br>Tanatorio M. Sánchez S.L., inscrita en el Registro Mercantil de Pontevedra, folio 57 del libro 834 de Sociedades, inscripción 1º de la hoja PO-99 B36118073
                                    </span>
                                </div>
                                <br>
                            </div>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "autoIncineracion":
                $file = file_get_contents($_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/autoIncineracion.html');
                if($file){
                    return $file;
                }

                $utils = new Utils();
                $data = getAutoCremacion($expedient);
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                }
                if($data['deceasedDate'] != null){
                    $data['deceasedDate'] = date("j-n-Y", strtotime($data['deceasedDate']));
                }else{
                    $data['deceasedDate'] = "N/A";
                }

                return "
                    <div class='container $fuente'>
                        <div class='row' style='text-align:center'><span>
                            <u><strong>AUTORIZACI&Oacute;N PARA CREMACI&Oacute;N Y ENTREGA DE CENIZAS</strong></u>
                        </span></div>
                        <br>
                        <div class='row' style='text-align:justify'><span style='font-size:12px'>
                            Por medio del presente documento, el abajo firmante, se declara representante <strong>autorizado por la familia</strong> para dar autorizaci&oacute;n a <em><strong>Pompas F&uacute;nebres de Arosa, S.L.</strong></em> a realizar el servicio de cremaci&oacute;n solicitado, eximiendo a &eacute;sta de toda responsabilidad frente a cualquier reclamaci&oacute;n que se pudiese presentar contra la misma, por carecer de autorizaci&oacute;n suficiente para la realizaci&oacute;n del servicio de <strong>CREMACI&Oacute;N</strong>. Se libera por tanto a <em><strong>Pompas F&uacute;nebres de Arosa, S.L.</strong></em> de la total responsabilidad, asumi&eacute;ndola el abajo firmante en este <strong>documento de Autorizaci&oacute;n</strong>:
                            <br><br>
                            $gender: <strong>" . $data['applicantName'] . " " . $data['applicantSurname'] . "</strong>, con DNI: <strong>" . $data['applicantNIF'] . "</strong> en calidad de (<em>parentesco</em>), con domicilio en " . $data['applicantAddress'] . " solicito de Pompas F&uacute;nebres de Arosa, S.L. la cremaci&oacute;n de los restos mortales de tipo:</span>
                        </div>
                        <br>
                        <div class='row' style='text-align:justify'><span style='font-size:12px' class='$fuente'>
                            CAD&Aacute;VER&nbsp;<input name='cadaver' type='checkbox' />&nbsp; &nbsp; RESTOS <input name='restos' type='checkbox' />&nbsp; &nbsp;CADAV&Eacute;RICOS CENIZAS&nbsp;<input name='cenizas' type='checkbox' />
                            <br>
                            De $gender: <strong>" . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</strong> (Q.E.P.D.)
                            <br>
                            con D.N.I. N&ordm;: <strong>" . $data['deceasedNIF'] . " </strong>Fallecido el: <strong>" . $data['deceasedDate'] . "</strong>
                            <br><br>
                            Portador Marcapasos: SI&nbsp;<input name='si' type='checkbox' />&nbsp; &nbsp;NO&nbsp;<input name='no' type='checkbox' />&nbsp; &nbsp;otros especificar: __________________________
                            <br>
                            Asistencia a la introducci&oacute;n: SI <input name='si2' type='checkbox' />&nbsp;&nbsp;&nbsp;NO&nbsp;<input name='no2' type='checkbox' />&nbsp;&nbsp; D&iacute;a: <input name='date' type='text' /> Hora: <input name='time' type='text' />
                            <br>
                            Esperan en Sala 7 hasta la entrega de Cenizas: SI <input name='si3' type='checkbox' />&nbsp; &nbsp;NO <input name='no3' type='checkbox' />&nbsp; &nbsp;
                            <br>
                            Urna Biodegradable: SI <input name='si4' type='checkbox' />&nbsp; &nbsp;NO <input name='no4' type='checkbox' />&nbsp; &nbsp; modelo: Barro
                        </span></div>
                        <div class='row' style='text-align:center'><span>
                            <u><strong>ENTREGA DE CENIZAS</strong></u>
                        </span></div>
                        <br>
                        <div><span style='font-size:12px'>
                            Fechas de Entrega de Cenizas:&nbsp;<input name='date2' type='text' />&nbsp; &nbsp;Hora:&nbsp;<input name='date2' type='text' />&nbsp; &nbsp;Lugar: Tanatorio
                        </span></div>
                        <br>
                        <table class='tablePdf$tablePdfColor' border='1' cellpadding='5' cellspacing='0' style='width:100%;color:$colorStyle'>
                            <tbody>
                                <tr>
                                    <td>                 
                                        <p><span style='font-size:12px'>Persona autorizada a recoger las cenizas de NO ser el declarante:</span></p>                        
                                        <br>                    
                                        <p><span style='font-size:12px'>$gender: _______________________________________ con DNI: __________________</span></p>
                                    </td>
                                    <td>
                                        <p><span style='font-size:12px'>Firma receptor cenizas:</span></p>                    
                                        <br><br> 
                                    </td>
                                </tr>
                            </tbody>
                        </table>                
                        <p style='text-align:center'><u><strong><span>Consentimiento Ley Org&aacute;nica de Protecci&oacute;n de Datos</span></strong></u></p>                
                        <table class='tablePdf$tablePdfColor' border='1' cellpadding='1' cellspacing='0' style='width:100%;color:$colorStyle'>
                            <tbody>
                                <tr>
                                    <td style='text-align:justify'><span style='font-size:8px'>
                                    Autorizo la publicaci&oacute;n de los datos expuestos en la esquela solicitada as&iacute; como en cualquier otro medio que solicite, conforme a la legislaci&oacute;n vigente Española de protecci&oacute;n de datos 15/1999 del 13 de Diciembre y el REGLAMENTO (UE) 2016/679 DEL PARLAMENTO EUROPEO Y DEL CONSEJO de 27 de abril de 2016 relativo a la protecci&oacute;n de las personas f&iacute;sicas en lo que respecta al tratamiento de datos personales y a la libre circulaci&oacute;n de estos datos, tanto murales, digitales, radio, prensa y cualquier otro medio de publicaci&oacute;n que la familia solicite, debido a que en la misma se incluyen nombres propios, parentescos y dem&aacute;s datos que se puedan deducir, asumiendo la responsabilidad y teniendo autorizaci&oacute;n expresa de cada uno de los familiares nombrados, as&iacute; como autorizaci&oacute;n de ambos padres o tutor legal en caso de publicaci&oacute;n de datos de menores de edad.
                                    </span></td>
                                </tr>
                            </tbody>
                        </table>
                        <br>
                        <table class='tablePdf$tablePdfColor' border='1' cellpadding='0' cellspacing='0' style='width:100%;color:$colorStyle'>
                            <tbody>
                                <tr>
                                    <td style='width:50%'>                
                                        <p><span style='font-size:12px'>Por Pompas F&uacute;nebres de Arosa, S.L. Fdo.:</span></p>                    
                                        <br>                     
                                        <p><span style='font-size:12px'>Jos&eacute; Luis Campa&ntilde;a</span></p>                    
                                        <p><span style='font-size:12px'>DNI.: 35451437L</span></p>
                                    </td>
                                    <td style='width:50%'>                            
                                        <p><span style='font-size:12px'>Aceptaci&oacute;n LOPD:</span></p>                    
                                        <br>                     
                                        <p><span style='font-size:12px'>Fdo.: " . $data['applicantName'] . " " . $data['applicantSurname'] . "</span></p>                    
                                        <p><span style='font-size:12px'>DNI.: " . $data['applicantNIF'] . "</span></p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                        <br><br>                                    
                        <p style='text-align:right'><span style='font-size:12px'>En Vilagarc&iacute;a de Arousa, a ". $utils->fechaCastellano2(date('Y')) ."</span></p>
                    </div>";
            break;

            case "autoPubliEsquela":
                $utils = new Utils();
                $background = $utils->getBackgroundDocuments();
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/autoPubliEsquela.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }
                $staticInfo = $documentsInfo->getByDocument('autoPubliEsquela');
                if($staticInfo != null){
                    foreach($staticInfo as $elem){
                        switch($elem['name']){
                            case 'companyDoc3':
                                $company = $elem['value'];
                            break;
                            case 'addressDoc3':
                                $address = $elem['value'];
                            break;
                            case 'locationDoc3':
                                $location = $elem['value'];
                            break;
                            case 'provinceDoc3':
                                $province = $elem['value'];
                            break;
                            case 'rgpdNameDoc3':
                                $rgpdName = $elem['value'];
                            break;
                            case 'rgpdDoc3':
                                $rgpd = $elem['value'];
                            break;
                        }
                    }
                }else{
                    $company = '';
                    $address = '';
                    $location = '';
                    $province = '';
                    $rgpdName = '';
                    $rgpd = '';
                }

                $data = getAutoPubliEsquela($expedient);
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                }
                $familyContactName = $data['familyContactName'];
                $familyContactSurname = $data['familyContactSurname'];
                $familyContactNIF = $data['familyContactNIF'];
                $deceasedName = $data['deceasedName'];
                $deceasedSurname = $data['deceasedSurname'];
                $deceasedMortuary = $data['deceasedMortuary'];
                $deceasedRoom = $data['deceasedRoom'];
                $client = $data['clientName'];
                $userName = $data['userName'];
                $day = date('d');
                $month = date('m');
                $year = date('Y');

                return "
                    <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                        <div style='margin-right:50px;right:480px;text-align: right; padding-top: 35px; line-height: 0.5'>
                            <p>$company</p>
                            <p>$address</p>
                            <p>$location</p>
                            <p>$province</p>
                        </div>
                        <br>
                        <div class='contenidoPompas' style='padding-top: 5px'>
                            <div style='text-align:center'>
                                <span style='font-size:12px'><u><strong>AUTORIZACI&Oacute;N PARA PUBLICAR ESQUELA EN PRENSA Y/O MEDIOS DIGITALES</strong></u>
                                <br><br>           
                                <div style='text-align:justify; line-height: 25px;'>
                                    <p style='font-size:12px'>
                                        Por la presente D./Dña.: $familyContactName $familyContactSurname representante de la familia del fallecido $gender: $deceasedName $deceasedSurname Q.E.P. que se encuentra
                                        velándose en nuestras instalaciones del $deceasedMortuary, en la Sala Nº $deceasedRoom a día $day de $month de $year, autoriza a $client a la publicación de los datos
                                        expuestos en la esquela solicitada conforme a la legislación vigente del $rgpdName, tanto murales, digitales y prensa, debido a que en la misma se incluyen nombres propios, 
                                        parentescos y otros datos que puedan deducir la identidad de los familiares, asumiendo el firmante toda responsabilidad sobre los mismos y demostrar en caso de denuncia o 
                                        reclamación, que los interesados han consentido el tratamiento de sus datos. Así mismo, se hace constar que para la publicación de la esquela, donde se encuentren datos de 
                                        menores de 16 años, se debe expedir una autorización específica por los titulares de la patria potestad o tutela sobre el/los menores, para ello, el contratante debe informar a la empresa 
                                        en el caso de que exista algún menor nombrado. Para poder hacer constar a dichos menores, debe formalizarse escrito por parte de sus padres o tutores legales.
                                    </p>
                                </div>            
                                <br><br>       
                                <div style='text-align:justify'>
                                    <table border='0' cellpadding='0' cellspacing='0' style='width:100%; color:$colorStyle''>
                                        <tbody>
                                            <tr>
                                                <td style='width:50%'>Por $company:</td>
                                                <td style='width:50%'>Por la Familia:</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <br><br><br><br>            
                                    <table border='0' cellpadding='0' cellspacing='0' style='width:100%; color:$colorStyle''>
                                        <tbody>
                                            <tr>
                                                <td style='width:50%'>
                                                    <p>Fdo: </p>                
                                                    <p> $userName </p>                
                                                    <br><br>
                                                </td>
                                                <td style='width:50%'>
                                                    <p>Fdo.: $familyContactName $familyContactSurname </p>            
                                                    <p>DNI.: $familyContactNIF </p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <br><br><br>         
                                    <span style='font-size:10px'>$rgpd</span>
                                    <p style='text-align:center'><br />
                                        <strong><em>Autorizaci&oacute;n Esquela On-Line</em></strong><br />
                                        &nbsp;
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                ";
            break;

            case "enterradores":
                $utils = new Utils();
                $background = $utils->getBackgroundDocuments();
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/enterradores.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }
                    $data = getEnterradores($expedient);
                    $text = "
                        <div class='fondo'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: -5px'>
                            </div>
                        </div>
                    ";
                return $text;
            break;

            case "cartaFlores":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/cartaFlores.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $utils = new Utils();
                    $data = getCartaFlores($expedient);
                    $staticInfo = $documentsInfo->getByDocument('cartaFlores');
                    if($staticInfo != null){
                        foreach($staticInfo as $elem){
                            switch($elem['name']){
                                case 'companyDoc5':
                                    $company = $elem['value'];
                                    break;
                            }
                        }
                    }else{
                        $company = '';
                    }

                    $attention = '';
                    $date = '';
                    $deceased = '';
                    if(isset($data['moreTexts'])){
                        foreach($data['moreTexts'] as $key => $value){
                            switch($value['category']){
                                case 'attention':
                                    $attention = $value['value'];
                                break;
                                case 'date':
                                    $date = $value['value'];
                                break;
                                case 'deceased':
                                    $deceased = $value['value'];
                                break;
                            }
                        }
                    }

                    if($data['deceasedGender'] == "Mujer"){
                        $gender = "Dña.";
                    }else{
                        $gender = "D.";
                    } 
                    if($data['funeralDate'] != NULL){
                        $funeralDate = date("j-n-Y", strtotime($data['funeralDate']));
                    }else{
                        $funeralDate = "N/A";
                    } 

                    $existsCoronas = false;
                    if(isset($data['texts'])){
                        foreach ($data['texts'] as $key => $value) {
                            if($value['serviceBelow'] == 5){
                                $existsCoronas = true;
                            }
                        }
                    }
                    if(isset($data['moreTexts'])){
                        foreach ($data['moreTexts'] as $key => $value) {
                            if($value['category'] == 'coronas'){
                                $existsCoronas = true;
                            }
                        }
                    }

                    $existsCentros = false;
                    if(isset($data['texts'])){
                        foreach ($data['texts'] as $key => $value) {
                            if($value['serviceBelow'] == 6){
                                $existsCentros = true;
                            }
                        }
                    }
                    if(isset($data['moreTexts'])){
                        foreach ($data['moreTexts'] as $key => $value) {
                            if($value['category'] == 'centros'){
                                $existsCentros = true;
                            }
                        }
                    }

                    $otherCompositions = false;
                    if(isset($data['texts'])){
                        foreach ($data['texts'] as $key => $value) {
                            if($value['serviceBelow'] == 7){
                                $otherCompositions = true;
                            }
                        }
                    }
                    if(isset($data['moreTexts'])){
                        foreach ($data['moreTexts'] as $key => $value) {
                            if($value['category'] == 'ramos'){
                                $otherCompositions = true;
                            }
                        }
                    }

                    $amount = 1;

                    $background = $utils->getBackgroundDocuments();
                    $text = "
                        <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div style='right: 520px; position: absolute; text-align: right; padding-top: 50px;margin-right:40px!important'>
                                <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                            </div>
                            <div class='contenidoPompas' style='right: 520px; padding-top: -10px!important;'>
                                <div style='text-align:right'>
                                    A la atenci&oacute;n de:
                                </div>            
                                <div style='text-align:right'><span style='font-family:Comic Sans MS,cursive'>
                                    <em>$attention</em></span>
                                </div>            
                                <br>            
                                <div style='text-align:center'>Fecha: <strong>$date</strong></div>            
                                <br>            
                                <div>
                                    La empresa <strong>$company</strong>, pone en su conocimiento que las composiciones florales que adornaron el sepelio de su $deceased, <strong>" . $gender . " " . $data['deceasedName'] . " " . $data['deceasedSurname'] . " (Q.E.P.D.)</strong> portaban las siguientes inscripciones:
                                </div>
                    ";

                    if($existsCoronas){
                        $text .= "
                            <br><div>
                                <p><strong>Coronas:</strong></p>
                            </div>
                            <table border='0' cellpadding='0' cellspacing='0' style='margin-left:50px;color:$colorStyle'>
                                <tbody>
                        ";

                        if(isset($data['texts'])){
                            foreach ($data['texts'] as $key => $value) {
                                if($value['serviceBelow'] == 5){
                                    if($amount % 30 == 0){
                                        $text .= "
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <pagebreak>
                                            <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                                <div style='right: 520px; position: absolute; text-align: right; padding-top: 50px;margin-right:40px!important'>
                                                    <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                                                </div>
                                                <div class='contenidoPompas' style='padding-top: -1px!important;'>
                                                    <table border='0' cellpadding='0' cellspacing='0' style='margin-left:50px;color:$colorStyle'>
                                                        <tbody>
                                        ";
                                    }
                                    $text .= "<tr><td style='height: 20px;'>" . $value['value'] . "</td></tr>";
                                    $amount++;
                                }
                            }
                        }

                        if(isset($data['moreTexts'])){
                            foreach ($data['moreTexts'] as $key => $value) {
                                if($value['category'] == 'coronas'){
                                    if($amount % 30 == 0){
                                        $text .= "                  </tbody>
                                                                </table>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <pagebreak>
                                                    <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                                        <div style='right: 520px; position: absolute; text-align: right; padding-top: 50px;margin-right:40px!important'>
                                                            <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                                                        </div>
                                                        <div class='contenidoPompas' style='padding-top: -1px!important;'>
                                                            <table border='0' cellpadding='0' cellspacing='0' style='margin-left:50px;color:$colorStyle'>
                                                                <tbody>";
                                    }
                                    $text .= "<tr><td style='height: 20px;'>" . $value['value'] . "</td></tr>";
                                    $amount++;
                                }
                            }
                        }

                        $text .= "</tbody></table>";      
                    }

                    if($existsCentros){
                        $text .= "
                            <br><div>
                                <p><strong>Centros:</strong></p>
                            </div>
                            <table border='0' cellpadding='0' cellspacing='0' style='margin-left:50px;color:$colorStyle'>
                                <tbody>
                        ";

                        if(isset($data['texts'])){
                            foreach ($data['texts'] as $key => $value) {
                                if($value['serviceBelow'] == 6){
                                    if($amount % 30 == 0){
                                        $text .= "
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <pagebreak>
                                            <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                                <div style='right: 520px; position: absolute; text-align: right; padding-top: 50px;margin-right:40px!important'>
                                                    <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                                                </div>
                                                <div class='contenidoPompas' style='padding-top: -1px!important;'>
                                                    <table border='0' cellpadding='0' cellspacing='0' style='margin-left:50px;color:$colorStyle'>
                                                        <tbody>
                                        ";
                                    }
                                    $text .= "<tr><td style='height: 20px;'>" . $value['value'] . "</td></tr>";
                                    $amount++;
                                }
                            }
                        }

                        if(isset($data['moreTexts'])){
                            foreach ($data['moreTexts'] as $key => $value) {
                                if($value['category'] == 'centros'){
                                    if($amount % 30 == 0){
                                        $text .= "
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <pagebreak>
                                            <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                                <div style='right: 520px; position: absolute; text-align: right; padding-top: 50px;margin-right:40px!important'>
                                                    <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                                                </div>
                                                <div class='contenidoPompas' style='padding-top: -1px!important;'>
                                                    <table border='0' cellpadding='0' cellspacing='0' style='margin-left:50px;color:$colorStyle'>
                                                        <tbody>
                                        ";
                                    }
                                    $text .= "<tr><td style='height: 20px;'>" . $value['value'] . "</td></tr>";
                                    $amount++;
                                }
                            }
                        }

                        $text .= "</tbody></table>";
                    }

                    if($otherCompositions){
                        $text .= "
                            <br><div>
                                <p><strong>Otras composiciones:</strong></p>
                            </div>
                            <table border='0' cellpadding='0' cellspacing='0' style='margin-left:50px;color:$colorStyle'>
                                <tbody>
                        ";

                        if(isset($data['texts'])){
                            foreach ($data['texts'] as $key => $value) {
                                if($value['serviceBelow'] == 7){
                                    if($amount % 30 == 0){
                                        $text .= "
                                                            </tbody>
                                                            </table>
                                                        </div>
                                                    </div>
                                                </div>
                                                <pagebreak>
                                                <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                                    <div style='right: 520px; position: absolute; text-align: right; padding-top: 50px;margin-right:40px!important'>
                                                        <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                                                    </div>
                                                    <div class='contenidoPompas' style='padding-top: -1px!important;'>
                                                        <table border='0' cellpadding='0' cellspacing='0' style='margin-left:50px;color:$colorStyle'>
                                                            <tbody>
                                        ";
                                    }
                                    $text .= "<tr><td style='height: 20px;'>" . $value['value'] . "</td></tr>";
                                    $amount++;
                                }
                            }
                        }

                        if(isset($data['moreTexts'])){
                            foreach ($data['moreTexts'] as $key => $value) {
                                if($value['category'] == 'ramos'){
                                    if($amount % 30 == 0){
                                        $text .= "
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>
                                            <pagebreak>
                                            <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                                <div style='right: 520px; position: absolute; text-align: right; padding-top: 50px;margin-right:40px!important'>
                                                    <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                                                </div>
                                                <div class='contenidoPompas' style='padding-top: -1px!important;'>
                                                    <table border='0' cellpadding='0' cellspacing='0' style='margin-left:50px;color:$colorStyle'>
                                                        <tbody>
                                        ";
                                    }
                                    $text .= "<tr><td style='height: 20px;'>" . $value['value'] . "</td></tr>";
                                    $amount++;
                                }
                            }
                        }
                        $text .= "</tbody></table>";
                    }

                    $text .= "
                            <br>           
                        </div></div></div>
                    ";

                    return $text;
                }
            break;
            
            case "cartaFloresRegistro":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/cartaFloresRegistro.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }
                $utils = new Utils();
                $data = getCartaFloresRegistro($expedient);
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                } 
                $background = $utils->getBackgroundDocuments();

                $deceasedMortuaryAddress ="";
                if($data['deceasedMortuary'] == 'Otro' || $data['deceasedMortuary'] == 'Casa Particular'){
                    $deceasedMortuaryAddress = $data['deceasedMortuaryAddress'];
                }else{
                    $deceasedMortuaryAddress = $data['deceasedMortuary'];
                }

                $lastTr = '';
                if($_SESSION['company'] != '23'){
                    $lastTr = ' 
                        <tr>
                            <td> </td><td> </td><td> </td><td> </td><td> </td>
                        </tr>'
                    ;
                }

                $text = "
                    <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                        <div style='margin-right:50px;right:480px; position: absolute; text-align: right; padding-top: 50px;'>
                            <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                        </div>
                        <div class='contenidoPompas' style='padding-top:-1px'>       
                            <table border='0' class='$fuente' cellpadding='0' cellspacing='0' style='width:100%'>
                                <tbody>
                                <tr>
                                    <td></td>
                                    <td></td>
                                    </tr>
                                    <tr>
                                        <br>
                                        <td colspan='2'><p>DEF. DE <strong>" . $gender . " " . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</strong> (Q.E.P.D.)</p></td>
                                    </tr>
                                    <tr>
                                    <td></td>
                                    <td></td>
                                    </tr>
                                    <tr>
                                        <td><p>" . $deceasedMortuaryAddress . "</p></td>
                                        <td style='text-align:right'><p>SALA N&ordm; <strong>" . $data['deceasedRoom'] . "</strong></p></td>
                                    </tr>
                                </tbody>
                            </table>
                            <p>&nbsp;</p>
                        </div>
                        <div class='tableFloresRegistroPompas' style='padding-top: -1px;margin-right:50px;right:480px;'>                 
                            <table class='tableFloresRegistro$tableFloresRegistroColor'>
                                <thead>
                                    <tr style='height:20px'>
                                        <td style='width:350px;text-align:center'><strong>CORONAS</strong></td>
                                        <td style='width:150px;text-align:center'><strong>FLORISTER&Iacute;A</strong></td>
                                        <td style='width:50px;text-align:center'><strong>D&Iacute;A</strong></td>
                                        <td style='width:50px;text-align:center'><strong>HORA</strong></td>
                                        <td style='width:100px;text-align:center'><strong>FIRMADO</strong></td>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                </tbody>
                            </table>
                            <table class='tableFloresRegistro$tableFloresRegistroColor'>
                                <thead>
                                    <tr style='height:20px'>
                                        <td style='width:350px;text-align:center'><strong>CENTROS</strong></td>
                                        <td style='width:150px;text-align:center'><strong>FLORISTER&Iacute;A</strong></td>
                                        <td style='width:50px;text-align:center'><strong>D&Iacute;A</strong></td>
                                        <td style='width:50px;text-align:center'><strong>HORA</strong></td>
                                        <td style='width:100px;text-align:center'><strong>FIRMADO</strong></td>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                    <tr>
                                        <td> </td><td> </td><td> </td><td> </td><td> </td>
                                    </tr>
                                </tbody>
                            </table> 
                        </div>
                    </div>
                    <pagebreak>
                    <div style='background-image: url(" . $background . ")' class='container $fuente folioPompas'><div class='contenidoPompas'> 
                        <p>&nbsp;</p>
                    </div>
                    <div class='tableFloresRegistroPompas' style='padding-top: -1px;margin-right:50px;right:480px;'>                 
                        <table class='tableFloresRegistro$tableFloresRegistroColor'>
                            <thead>
                                <tr style='height:20px'>
                                    <td style='width:350px;text-align:center'><strong>CENTROS</strong></td>
                                    <td style='width:150px;text-align:center'><strong>FLORISTER&Iacute;A</strong></td>
                                    <td style='width:50px;text-align:center'><strong>D&Iacute;A</strong></td>
                                    <td style='width:50px;text-align:center'><strong>HORA</strong></td>
                                    <td style='width:100px;text-align:center'><strong>FIRMADO</strong></td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                <tr>
                                    <td> </td><td> </td><td> </td><td> </td><td> </td>
                                </tr>
                                $lastTr
                            </tbody>
                        </table> 
                    </div>
                ";

                return $text;
            break;

            case "cash-flow":
                require_once($_SESSION['basePath'] . "core/invoices/functions.php");
                require_once($_SESSION['basePath'] . "core/mortuaries/functions.php");
                $utils = new Utils();
                $ivaLabel = $utils->getIvaLabel();
                $ownedCostCenter = getOwnMortuaries();
                $dates = $_POST['dates'];
                $text = "
                    <div class='container $fuente'>
                        <div class='row'>
                            <p><strong>Informe Cash/Flow:</strong></p>
                            <p style='padding-left:10%'>" . $utils->fechaCastellano2(date('Y-m-d', $dates[0])) . "</p>
                            <p style='padding-left:10%'>" . $utils->fechaCastellano2(date('Y-m-d', $dates[1])) . "</p>
                        </div>
                        <div class='row'>
                            <table class='tablePdf$tablePdfColor'>
                                <tbody>
                                    <tr>
                                        <td style='text-align:center'><strong>CENTRO</strong></td>
                                        <td style='text-align:center'><strong>FACTURADO</strong></td>
                                        <td style='text-align:center'><strong>$ivaLabel</strong></td>
                                        <td style='text-align:center'><strong>COBRADO</strong></td>
                                        <td style='text-align:center'><strong>GASTOS (neto)</strong></td>
                                        <td style='text-align:center'><strong>INTERESES</strong></td>
                                        <td style='text-align:center'><strong>AMORTIZACIÓN</strong></td>
                                        <td style='text-align:center'><strong>SUELDOS</strong></td>
                                        <td style='text-align:center'><strong>IMPUESTOS</strong></td>
                                        <td style='text-align:center'><strong>PAGADO</strong></td>
                                        <td style='text-align:center'><strong>TOTAL (cobrado - pagado)</strong></td>
                                    </tr>
                ";

                foreach ($ownedCostCenter as $key => $value) {
                    $mortuaryPerformance = getMortuaryPerformance($value['mortuaryID'], $dates[0], $dates[1]);
                    $payedPerformance = getPayedPerformance($value['mortuaryID'], $dates[0], time());
                    $costs = $mortuaryPerformance['cost']['costs'] + $mortuaryPerformance['salary']['salaries'] + $mortuaryPerformance['financing']['financing'];
                    $pay = $payedPerformance['cost']['costs'] + $payedPerformance['financing']['financing'] + $payedPerformance['taxe']['taxes'] + $payedPerformance['salary']['salaries'];
                    $text .= "
                        <tr>
                            <td style='text-align:center'>" . $value['name'] . "</td>
                            <td style='text-align:center'>" . round($mortuaryPerformance['invoiced']['total'], 2) . " €</td>
                            <td style='text-align:center'>" . round($mortuaryPerformance['invoiced']['IVA'], 2) . " €</td>
                            <td style='text-align:center'>" . round($mortuaryPerformance['invoiced']['payed'], 2) . " €</td>
                            <td style='text-align:center'>" . round($costs, 2) . " €</td>
                            <td style='text-align:center'>" . round($mortuaryPerformance['financing']['interest'], 2) . " €</td>
                            <td style='text-align:center'>" . round($mortuaryPerformance['amortization']['amortizedCapital'], 2) . " €</td>
                            <td style='text-align:center'>" . $mortuaryPerformance['salary']['salaries'] . " €</td>
                            <td style='text-align:center'>" . $mortuaryPerformance['taxe']['taxes'] . " €</td>
                            <td style='text-align:center'>" . round($pay, 2) . " €</td>
                            <td style='text-align:center'>" . round($mortuaryPerformance['invoiced']['payed'] - $pay, 2) . " €</td>
                        </tr>
                    ";
                }
                $text .= "</tbody></table></div></div>";

                return $text;
            break;

            case "cerradoDefuncion":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/cerradoDefuncion.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }

                $img = str_replace('png', 'jpg', $utils->getLogo());
                $img = explode(URL, $img);
                $img = $_SESSION['basePath'] . $img[1];

                $utils = new Utils();
                $fondo = $utils->getRoute() . "core/libraries/pdfs/images/fondoCerrado.jpg";
                return "
                    <div class='fondo'><div style='background-image: url(" . $fondo . ")' class='$fuente folioPompas'><div class='contenidoPompas'>
                        <div class='' style='text-align:center; color:$colorStyle'>
                            <strong><span style='text-align:center; font-size:60px;'>CERRADO POR <br> DEFUNCIÓN</span></strong>
                        </div>
                        <br><br><br><br><br><br><br><br><br><br>
                        <div>
                            <img src='" . $img . "' width='30%'>
                        </div>
                    </div>
                ";
                
            break;

            case "conservEmbalsamiento":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/conservEmbalsamiento.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }

                $utils = new Utils();
                $data = getConservEmbalsamiento($expedient);
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                }
                if($data['deceasedSurname'] != ""){
                    $data['deceasedName'] = $data['deceasedName'] . " " . $data['deceasedSurname'];
                }
                if($data['deceasedDate'] != NULL){
                    $date = $utils->fechaCastellano2(date('Y-m-d', strtotime($data['deceasedDate'])));
                }else{
                    $date = "N/A";

                }
                if($data['deceasedTime'] != NULL){
                    $time = date('G:i', strtotime($data['deceasedTime']));
                }else{
                    $time = "N/A";

                }
                $background = $utils->getBackgroundDocuments();
                
                $heightImg = '70%';
                if($_SESSION['company'] == '23'){
                    $heightImg = '65%';
                }

                return "
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas'>
                                <p style='text-align: center;'><strong>EMBALSAMAMIENTO</strong></p>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 100%; height: 30px;'><strong>Nombre:</strong> </td>
                                    </tr>
                                </table>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 50%; height: 30px;'><strong>Nº de referencia:</strong> </td>
                                        <td style='width: 25%; height: 30px;'><strong>Día:</strong> </td>
                                        <td style='width: 25%; height: 30px;'><strong>Tiempo:</strong> </td>
                                    </tr>
                                </table>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 55%; height: 30px;'><strong>Causa de fallecimiento:</strong> </td>
                                        <td style='width: 20%; height: 30px;'><strong>Años:</strong> </td>
                                        <td style='width: 25%; height: 30px;'><strong>Sexo:</strong> </td>
                                    </tr>
                                </table>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 65%; height: 30px;'><strong>Causa inicial: </td>
                                        <td style='width: 35%; height: 30px;'><strong>Fecha fallecimiento: </td>
                                    </tr>
                                </table>
                                <br>
                                <p><strong>Pre Embalsamamiento consideraciones</strong></p>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 75%; height: 30px;'><strong>Cuerpo:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Temperatura: Caliente / Frío / Refrigerado / Congelado / Descongelado</td>
                                        <td style='width: 25%; height: 30px;'><strong>Purgar:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Si/No</td>
                                    </tr>
                                    <tr>
                                        <td style='width: 75%; height: 30px;'><strong>Rigidez:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Media / Moderada / Severa / Reducida</td>
                                        <td style='width: 25%; height: 30px;'><strong>Gas de tejido:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Si/No</td>
                                    </tr>
                                    <tr>
                                        <td style='width: 75%; height: 30px;'><strong>Ictericia:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Media / Moderada / Severa / Conjuntiva / Piel</td>
                                        <td style='width: 25%; height: 30px;'><strong>Gangrena:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Si/No</td>
                                    </tr>
                                </table>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 100%; height: 30px;'><strong>Edema Generalizado:</strong>&nbsp;&nbsp;&nbsp;&nbsp;Localidado   Cabeza /    Brazo izq.   Brazo dch   Tronco   Pierna izq   Pierna dch</td>
                                    </tr>
                                </table>
                                <br>
                                <p><strong>Heridas y laceraciones</strong></p>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 100%; height: 30px;'><strong>Piel coloración, úlceras o llagas, heridas quirúrgicas, describir brevemente</strong></td>
                                    </tr>
                                    <tr>
                                        <td valign='top' style='width: 100%; height: 60px;'></td>
                                    </tr>
                                </table>
                                <br>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 100%; height: 30px;'><strong>Otras condiciones</strong></td>
                                    </tr>
                                    <tr>
                                        <td valign='top' style='width: 100%; height: 60px;'></td>
                                    </tr>
                                </table>
                                <br>
                                <p><strong>Embalsamamiento</strong></p>
                                <table class='tablePdf$tablePdfColor' style='width: 60%;'>
                                    <tr>
                                        <td style='width: 80%; height: 30px;'></td>
                                        <td style='width: 20%; height: 30px;'>Cantidad</td>
                                    </tr>
                                    <tr>
                                        <td style='width: 80%; height: 30px;'><strong>Arterial y pre-inyección fluidos usados</strong></td>
                                        <td style='width: 20%; height: 30px;'> ml</td>
                                    </tr>
                                    <tr>
                                        <td style='width: 80%; height: 30px;'><strong>Índice final y fluídos arteriales</strong></td>
                                        <td style='width: 20%; height: 30px;'> %</td>
                                    </tr>
                                </table>
                                <br>
                                <p><strong>Arterias inyección</strong></p>
                                <p><strong>Inyección inicial:</strong></p>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td><strong>Carótida dch</strong></td>
                                        <td><strong>Carótica izq</strong></td>
                                        <td><strong>Braco axilar dch</strong></td>
                                        <td><strong>Braco axilar izq</strong></td>
                                        <td><strong>Femoral dcha</strong></td>
                                        <td><strong>Femoral izq</strong></td>
                                    </tr>
                                    <tr>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                    </tr>
                                </table>
                                <br>
                                <pagebreak>
                            </div>
                        </div>
                    </div>
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas'>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 100%; height: 30px;'>Segunda inyección sitio</td>
                                    </tr>
                                    <tr>
                                        <td style='width: 100%; height: 30px;'></td>
                                    </tr>
                                </table>
                                <br>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 40%; height: 30px;'>Inyección hipodérmica: Si/No</td>
                                        <td style='width: 60%; height: 30px;'>Sitio y cantidad: </td>
                                    </tr>
                                </table>
                                <br>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 100%; height: 30px;'>Drenaje venoso, vena seleccionada: </td>
                                    </tr>
                                </table>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 50%; height: 30px;'>Cantidad drenada venosa: </td>
                                        <td style='width: 50%; height: 30px;'>Cantidad drenada arterial: </td>
                                    </tr>
                                </table>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 25%; height: 30px;'>Cavidades aspiradas</td>
                                        <td style='width: 25%; height: 30px;'>Tórax</td>
                                        <td style='width: 25%; height: 30px;'>Abdominal</td>
                                        <td style='width: 25%; height: 30px;'>Pelvis</td>
                                    </tr>
                                    <tr>
                                        <td style='width: 25%; height: 30px;'></td>
                                        <td style='width: 25%; height: 30px;'></td>
                                        <td style='width: 25%; height: 30px;'></td>
                                        <td style='width: 25%; height: 30px;'></td>
                                    </tr>
                                </table>
                                <br>
                                <p><strong>Post Mortem</strong></p>
                                <p>Tratamiento de:</p>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 25%; height: 30px;'>Esternón</td>
                                        <td style='width: 25%; height: 30px;'>Vísceras</td>
                                        <td style='width: 25%; height: 30px;'>Cráneo</td>
                                    </tr>
                                    <tr>
                                        <td style='width: 25%; height: 30px;'></td>
                                        <td style='width: 25%; height: 30px;'></td>
                                        <td style='width: 25%; height: 30px;'></td>
                                    </tr>
                                </table>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 25%; height: 30px;'>Tronco</td>
                                        <td style='width: 25%; height: 30px;'>Cavidad pelvis y nalgas</td>
                                    </tr>
                                    <tr>
                                        <td style='width: 25%; height: 30px;'></td>
                                        <td style='width: 25%; height: 30px;'></td>
                                    </tr>
                                </table>
                                <br>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;'>
                                    <tr>
                                        <td style='height: 30px;'>
                                            <p><strong>Tratamiento adicional</strong></p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style='height: 30px;'>
                                            <p>Herida quirúrgica:</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style='height: 30px;'>
                                            <p>Úlceras por presión:</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style='height: 30px;'>
                                            <p>Cosméticos aplicados:</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style='height: 30px;'>
                                            <p>Otros:</p>
                                        </td>
                                    </tr>
                                </table>
                                <br>
                                <br>
                                <br>
                                <table class='tablePdf$tablePdfColor' style='width: 35%;'>
                                    <tr>
                                        <td>
                                            <p></p>
                                            <p></p>
                                            <p></p>
                                            <p>Fdo.:</p>
                                            <p>Día:" . date('d/m/Y') . "</p>
                                        </td>
                                    </tr>
                                </table>
                                <pagebreak>
                            </div>
                        </div>
                    </div>
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas'>
                                <div style='text-align:center'>
                                    <img src='" . $utils->getRoute() . "core/libraries/pdfs/images/man.jpg' height='$heightImg'>
                                </div>
                                <div style='text-align:center;margin-left:80px'>
                                    <img src='" . $utils->getRoute() . "core/libraries/pdfs/images/woman.jpg' height='$heightImg'>
                                </div>
                            </div>
                        </div>
                    </div>
                ";
            break;

            case "conservTemporal":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/conservTemporal.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }
                $utils = new Utils();
                $data = getConservEmbalsamiento($expedient);
                $staticInfo = $documentsInfo->getByDocument('conservTemporal');
                if($staticInfo != null){
                    foreach($staticInfo as $elem){
                        switch($elem['name']){
                            case 'companyDoc6':
                                $company = $elem['value'];
                            break;
                            case 'addressDoc6':
                                $address = $elem['value'];
                            break;
                            case 'locationDoc6':
                                $location = $elem['value'];
                            break;
                            case 'provinceDoc6':
                                $province = $elem['value'];
                            break;
                            case 'locationSignDoc6':
                                $locationSign = $elem['value'];
                            break;
                            case 'nameDoc6':
                                $name = $elem['value'];
                            break;
                            case 'dniDoc6':
                                $dni = $elem['value'];
                            break;
                        }
                    }
                }else{
                    $company = '';
                    $address = '';
                    $location = '';
                    $province = '';
                    $locationSign = '';
                }
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                }
                if($data['deceasedSurname'] != ""){
                    $data['deceasedName'] = $data['deceasedName'] . " " . $data['deceasedSurname'];
                }
                if($data['deceasedDate'] != NULL){
                    $date = $utils->fechaCastellano2(date('Y-m-d', strtotime($data['deceasedDate'])));
                }else{
                    $date = "N/A";

                }
                if($data['deceasedTime'] != NULL){
                    $time = date('G:i', strtotime($data['deceasedTime']));
                }else{
                    $time = "N/A";

                }
                $background = $utils->getBackgroundDocuments();

                return "
                    <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'><div class='contenidoPompas'>
                        <div>
                            <div>
                                <p style='text-align:right'><strong>$company</strong><br>
                                $address<br>
                                $location<br>
                                $province</p>
                            </div>
                        </div>
                        <br><br>
                        <div class='text-center'>
                            <p style='text-align:center'><strong><u>CONSERVACI&Oacute;N TEMPORAL</u></strong></p>
                        </div>
                        <br><br>
                        <div>
                            <p>D.: <strong>$name</strong> con DNI: <strong>$dni</strong>, en posesión del <strong>Certificado de Profesionalidad de Tanatopraxia (SANP0108)</strong> certifica que:</p>
                        </div>
                        <br><br>
                        <div>
                            <p>Al cadáver de <strong>" . $gender . " ". $data['deceasedName'] . "</strong> (Q.E.P.D.) fallecido/a el día <strong>$date</strong> a las <strong>$time h.</strong>, ha sido embalsamado, siguiendo el siguiente procedimiento:</p>
                        </div>
                        <br><br><br>
                        <div>
                            <ul>
                                <li><p style='text-align:justify'>Inyectar, 4 litros vía arterial, la solución de formaldehido al 1,5% y en cavidades torácicas y abdominales 0,5 litros de solución de formol al 20%.</p></li>
                                <li><p style='text-align:justify'>Una vez terminada la preparación del cadáver, ha sido desinfectado con alcohol etílico (95%), taponando los orificios naturales con algodón hidrófilo. Introduciéndolo posteriormente en un sudario biodegradable y procediendo al enferetramiento en arca de madera y practicando las técnicas de estética solicitadas por la familia (maquillaje, peinado, afeitado, etc.).</p></li>
                            </ul>
                        </div>
                        <br><br><br><br>
                        <div>
                            <p>Lo que se hace constar para que surta los efectos oportunos.</p>
                        </div>
                        <br><br><br><br>
                        <div class='text-right'>
                            <p>$locationSign, " . $utils->fechaCastellano2(date('Y')) . "</p>
                        </div>
                        <br><br>
                        <div class='text-right'>
                                <p>Fdo.: __________________________</p>
                        </div>
                    </div>
                ";
            break;

            case "contratoServiciosCompania":
                $utils = new Utils();
                $ivaLabel = $utils->getIvaLabel();
                $ivaLabel = $utils->getIvaLabel();
                $staticInfo = $documentsInfo->getByDocument('contratoServiciosCompania');
                if($staticInfo != null){
                    foreach($staticInfo as $elem){
                        switch($elem['name']){
                            case 'insuranceCompanyDoc7':
                                $insuranceCompany = $elem['value'];
                            break;
                            case 'companyDoc7':
                                $company = $elem['value'];
                            break;
                        }
                    }
                }else{
                    $insuranceCompany = '';
                    $company = '';
                }
                $data = getFactura($expedient);
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                }
                if($data['mortuary'] == null){
                    $mortuary = '';
                }else{
                    $mortuary = $data['mortuary'];
                }
                $background = $utils->getBackgroundDocuments();

                $data['familyContactName'] = '_______________________';
                $data['familyContactSurname'] = '_______________________';
                $data['familyContactNIF'] = '_______________________';

                $text = "
                    <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                        <div style='margin-right:50px;right:480px; position: absolute; text-align: right; padding-top: 50px;'>
                            <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                        </div>
                        <br><br><br>
                        <div class='contenidoPompas' style='padding-top: -1px;'>     
                            <div style='text-align:center' class='titulo'>
                                <span><u><strong>SOLICITUD DE SERVICIOS COMPAÑÍAS</strong></u></span>
                            </div>
                            <br>
                            <div>
                                <p>D./Dña. <strong>". $data['familyContactName']. " " . $data['familyContactSurname']. "</strong>, con DNI  <strong>". $data['familyContactNIF']. "</strong>, asistente de la Cía. de Seguros _____________________________ y a éstos efectos, su representante autorizado.</p>
                            </div>
                            <br>
                            <div>
                                <p>SOLICITA la contratación de los siguientes productos y servicios de la entidad $company concernientes a la realización y organización del sepelio de " . $gender . " <strong>" . $data['deceasedName'] ." " . $data['deceasedSurname'] ."</strong> (Q.E.P.D.) y con Nº de Expediente " . $data['number'] . ".</p>
                            </div>
                            <br>
                            <div>
                                <p>RELACIÓN DE SERVICIOS Y PRODUCTOS SOLICITADOS:</p>
                            </div>
                            <div>
                                <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center'>
                                    <thead style='text-align:center'>
                                        <tr>
                                            <td>
                                                <strong>DESCRIPCIÓN</strong>
                                            </td>
                                            <td>
                                                <strong>CANT</strong>
                                            </td>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                ";

                $lines=0;
                $firstPage = true;
                $totalLines = 0;

                if(isset($data['factura'])){
                    $previousProductID = 0;
                    $previousModelID = 0;
                    $contTexts = 0;
                    for($i = 0; $i < count($data['factura']); $i++) {
                        if($totalLines > 0 && $totalLines % 34 == 0){
                            $text .= "          </tbody>
                                            </table>
                                        </div>
                                        <pagebreak>
                                        </div></div></div>
                                        <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'><div class='contenidoPompas'>
                                            <div><table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center'>";
                            $totalLines = 0;
                            if($firstPage){
                                $firstPage = false;
                            }
                        }
                        $productID = $data['factura'][$i]['productID'];
                        $modelID = $data['factura'][$i]['modelID'];
                        $productName = $data['factura'][$i]['productName'];
                        $modelName = "";
                        $priceNoIVA = $data['factura'][$i]['priceNoIVA']; //tarifa asociada al cliente
                        $particularPrice = $data['factura'][$i]['particularPrice']; //tarifa de particulares
                        $percentage = $data['factura'][$i]['percentage'];
                        $texts = $data['factura'][$i]['texts'];
                        
                        if($data['factura'][$i]['editPrice'] == 1){
                            if(is_array($texts)){
                                if(
                                    $previousProductID != $productID ||
                                    !isset($texts[$contTexts])
                                ){
                                    $contTexts = 0;
                                }

                                if(count($texts) == 1){
                                    if(intval($_SESSION['company']) == 6 || intval($_SESSION['company']) == 4 || intval($_SESSION['company']) == 19){
                                        if($texts[0]['value'] != ''){
                                            $modelName = $data['factura'][$i]['modelName'] . ' - ' . $texts[$contTexts]['value'];
                                        }else{
                                            $modelName = $data['factura'][$i]['modelName'];
                                        }
                                    }else{
                                        if($texts[0]['value'] != ''){
                                            $modelName = $texts[0]['value'];
                                        }else{
                                            $modelName = $data['factura'][$i]['modelName'];
                                        }
                                    }
                                }else{
                                    if(intval($_SESSION['company']) == 6 || intval($_SESSION['company']) == 4 || intval($_SESSION['company']) == 19){
                                        if($texts[$contTexts]['value'] != ''){
                                            $modelName = $data['factura'][$i]['modelName'] . ' - ' . $texts[$contTexts]['value'];
                                        }else{
                                            $modelName = $data['factura'][$i]['modelName'];
                                        }
                                    }else{
                                        $modelName = $texts[$contTexts]['value'];
                                    }
                                    $contTexts++;
                                }
                            }else{
                                $modelName = $data['factura'][$i]['modelName'];
                                $contTexts = 0;
                            }
                        }else{
                            $modelName = $data['factura'][$i]['modelName'];
                        }
                        
                        if($data['factura'][$i]['multipleDiscount'] == null){
                            $amount = $data['factura'][$i]['amount'];                                            
                        }else{
                            $amount = 1;
                        }
                        
                        if($previousProductID == $data['factura'][$i]['productID']){
                            $text .= 
                                "<tr class='align-items-center'>
                                    <td style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$modelName."</td>
                                    <td>$amount</td>
                                </tr>
                            ";

                            $lines++;
                            $totalLines++;
                        }else{
                            $text .= 
                                "<tr class='align-items-center'>
                                    <td style='text-align:left'><strong>$productName</strong> - $modelName</td>
                                    <td>$amount</td>
                                </tr>
                            ";
                        }

                        $previousProductID = $data['factura'][$i]['productID'];
                        $previousModelID = $modelID;
                        $lines++;
                        $totalLines++;
                    }
                }

                if(isset($data['suplidos']) && is_array($data['suplidos']) && count($data['suplidos']) > 0){
                    $text .= "<tr><td><strong>***** SUPLIDOS *****</strong></td><td></td></tr>";
                    $previousProductID = 0;
                    $previousModelID = 0;
                    $contTextsSuplidos = 0;
                    foreach($data['suplidos'] AS $producto){
                        if($totalLines > 0 && ($totalLines % 34 == 0 || $totalLines % 44 == 0)){
                            $text .= "          </tbody>
                                            </table>
                                        </div>
                                        <pagebreak>
                                        </div></div></div>
                                        <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'><div class='contenidoPompas'>
                                            <div><table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center'>";
                            $totalLines = 0;
                            if($firstPage){
                                $firstPage = false;
                            }
                        }
                        $productID = $producto['productID'];
                        $modelID = $producto['modelID'];
                        $description = "";
                        $price = $producto['cost'];
                        $texts = $producto['texts'];

                        if($producto['editPrice'] == 1){
                            if(is_array($texts)){
                                if(isset($texts[$contTextsSuplidos]['value'])){
                                    $description = $producto['productName'] . ' - ' . $texts[$contTextsSuplidos]['value'];
                                }else{
                                    $description = '';
                                }
                                $contTextsSuplidos++;
                                if($contTextsSuplidos == count($texts)){
                                    $contTextsSuplidos = 0;
                                }
                            }else{
                                $description = $producto['productName'] . ' - ' . $producto['modelName'];
                                $contTextsSuplidos = 0;
                            }
                        }else{
                            $description = $producto['productName'] . ' - ' . $producto['modelName'];
                        }

                        if($producto['multipleDiscount'] == null){
                            $amount = $producto['amount'];
                        }else{
                            $amount = 1;
                        }

                        $productID = $producto['productID'];
                        $modelID = $producto['modelID'];
                        $text .= 
                            "<tr class='align-items-center'>
                                <td style='text-align:left'>$description</td>
                                <td>$amount</td>
                            </tr>
                        ";
                        $previousProductID = $productID;
                        $previousModelID = $modelID;
                        $lines++;
                        $totalLines++;
                    }
                }

                $text .= "
                                </tbody>
                            </table>
                        </div>
                        <br><br>
                        <table class='tablePdf$tablePdfColor' style='width: 30%;'>
                            <tr>
                                <td>
                                    <p></p>
                                    <p>Fdo.:</p>
                                </td>
                            </tr>
                        </table>
                    </div>
                ";

                return $text;
            break;

            case "contratoServiciosFuner":
                $utils = new Utils();
                $ivaLabel = $utils->getIvaLabel();
                $staticInfo = $documentsInfo->getByDocument('contratoServiciosFuner');
                if($staticInfo != null){
                    foreach($staticInfo as $elem){
                        switch($elem['name']){
                            case 'companyDoc8':
                                $company = $elem['value'];
                            break;
                            case 'rgpdDoc8':
                                $rgpd = $elem['value'];
                            break;
                        }
                    }
                }else{
                    $company = '';
                    $rgpd = '';
                }
                $data = getFactura($expedient);
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                }
                if($data['mortuary'] == null){
                    $mortuary = '';
                }else{
                    $mortuary = $data['mortuary'];
                }
                $familiarDirecto = $data['familyContactRelationship'] = '' ? '(' . $data['familyContactRelationship'] . ')' : '';
                $background = $utils->getBackgroundDocuments();
                $text = "
                    <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                        <div style='margin-right:50px;right:480px; position: absolute; text-align: right; padding-top: 10px;'>
                            <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                        </div>
                        <br>
                        <div class='contenidoPompas' style='padding-top: -1px;'>       
                            <div style='text-align:center' class='titulo'>
                                <span><u><strong>CONTRATO DE SERVICIOS FUNERARIOS</strong></u></span>
                            </div>
                            <br>
                            <div>
                                <p>D./Dña. " . $data['familyContactName'] . " " . $data['familyContactSurname'] . ", con DNI " . $data['familyContactNIF'] . ", familiar directo $familiarDirecto y a éstos efectos, representante autorizado de los familiares de " . $gender . " " . $data['deceasedName'] ." " . $data['deceasedSurname'] ." (Q.E.P.D.).</p>
                            </div>
                            <br>
                            <div>
                                <p>SOLICITA la contratación de los siguientes servicios y productos de la entidad $company concernientes a la realización y organización del sepelio de " . $gender . " " . $data['deceasedName'] ." " . $data['deceasedSurname'] ." (Q.E.P.D.)</p>
                            </div>
                            <br>
                            <div>
                                <p>RELACIÓN DE SERVICIOS Y PRODUCTOS SOLICITADOS:</p>
                            </div>
                            <div>
                                <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center'>
                                    <thead>
                                        <tr>
                                            <td>
                                                <strong>DESCRIPCIÓN</strong>
                                            </td>
                                            <td>
                                                <strong>CANT</strong>
                                            </td>
                                            <td>
                                                <strong>PRECIO</strong>
                                            </td>
                                            <td>
                                                <strong>DT</strong>
                                            </td>
                                            <td>
                                                <strong>$ivaLabel</strong>
                                            </td>
                                            <td>
                                                <strong>IMPORTE</strong>
                                            </td>
                                        </tr>
                                    </thead>
                                    <tbody>
                ";

                $bruto = 0;
                $totalBases = 0;
                $totalIva = 0;
                $listIvas = [];
                $supplied = 0;
                $totalDiscount = 0;
                $subTotalDiscount = 0;
                $total = 0;
                $lines = 0;
                $firstPage = true;
                $discountpercent = 0;
                $discountAmount  = 0;
                $discountValue = 0;
                $totalLines = 0;

                if(isset($data['factura'])){
                    $previousProductID = 0;
                    $previousModelID = 0;
                    $contTexts = 0;
                    for($i = 0; $i < count($data['factura']); $i++) {
                        if($totalLines > 0 && $totalLines % 34 == 0){
                            $text .= "          </tbody>
                                            </table>
                                        </div>
                                        <pagebreak>
                                        </div></div></div>
                                        <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'><div class='contenidoPompas'>
                                            <div><table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center'>";
                            $totalLines = 0;
                            if($firstPage){
                                $firstPage = false;
                            }
                        }
                        $productID = $data['factura'][$i]['productID'];
                        $modelID = $data['factura'][$i]['modelID'];
                        $productName = $data['factura'][$i]['productName'];
                        $modelName = "";
                        $priceNoIVA = $data['factura'][$i]['priceNoIVA']; //tarifa asociada al cliente
                        $particularPrice = $data['factura'][$i]['particularPrice']; //tarifa de particulares
                        $percentage = $data['factura'][$i]['percentage'];
                        $texts = $data['factura'][$i]['texts'];

                        if($data['factura'][$i]['editPrice'] == 1){
                            if(is_array($texts)){
                                if(
                                    $previousProductID != $productID ||
                                    !isset($texts[$contTexts])
                                ){
                                    $contTexts = 0;
                                }

                                if(count($texts) == 1){
                                    if(intval($_SESSION['company']) == 6 || intval($_SESSION['company']) == 4 || intval($_SESSION['company']) == 19){
                                        if($texts[0]['value'] != ''){
                                            $modelName = $data['factura'][$i]['modelName'] . ' - ' . $texts[$contTexts]['value'];
                                        }else{
                                            $modelName = $data['factura'][$i]['modelName'];
                                        }
                                    }else{
                                        if($texts[0]['value'] != ''){
                                            $modelName = $texts[0]['value'];
                                        }else{
                                            $modelName = $data['factura'][$i]['modelName'];
                                        }
                                    }
                                }else{
                                    if(intval($_SESSION['company']) == 6 || intval($_SESSION['company']) == 4 || intval($_SESSION['company']) == 19){
                                        if($texts[$contTexts]['value'] != ''){
                                            $modelName = $data['factura'][$i]['modelName'] . ' - ' . $texts[$contTexts]['value'];
                                        }else{
                                            $modelName = $data['factura'][$i]['modelName'];
                                        }
                                    }else{
                                        $modelName = $texts[$contTexts]['value'];
                                    }
                                    $contTexts++;
                                }
                            }else{
                                $modelName = $data['factura'][$i]['modelName'];
                                $contTexts = 0;
                            }
                        }else{
                            $modelName = $data['factura'][$i]['modelName'];
                        }
                        
                        if($data['factura'][$i]['multipleDiscount'] == null){
                            $amount = $data['factura'][$i]['amount'];                                            
                        }else{
                            $amount = 1;
                        }

                        if($data['factura'][$i]['editPrice'] == '1'){
                            $priceNoIVA = $data['factura'][$i]['totalEditPrice'];
                        }

                        $discountAmountToShow = '-';
                        if($data['factura'][$i]['texts'] == 0){
                            $discount = $data['factura'][$i]['discount'];  
                            $subTotalDiscount = floatval($priceNoIVA) * floatval($discount) / 100;                                             
                            $subtotalPrice = floatval($priceNoIVA) - floatval($subTotalDiscount);
                            if($data['factura'][$i]['editPrice'] == '1'){
                                $discountAmount = floatval($priceNoIVA) - floatval($subtotalPrice);
                            }else{
                                $discountAmount = floatval($particularPrice) - floatval($subtotalPrice);
                            }
                            if($discountAmount < 0){
                                $discountAmount = 0;
                                if($discount > 0){
                                    $discountAmountToShow = "$discount %";
                                }
                            }                                          
                            $subtotalPrice = floatval($subtotalPrice) * floatval($amount);
                            if($data['factura'][$i]['editPrice'] == '1'){
                                if(floatval($priceNoIVA) != 0.00){
                                    $discountpercent = floatval($discountAmount) * 100 / (floatval($priceNoIVA));                                           
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($priceNoIVA) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;                                           
                                }                                      
                            }else{
                                if(floatval($particularPrice) != 0.00){
                                    $discountpercent = floatval($discountAmount) * 100 / (floatval($particularPrice));                                           
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($particularPrice) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;                                           
                                }                                      
                            }
                        }else{
                            $discount = $data['factura'][$i]['multipleDiscount']; 
                            $subTotalDiscount = floatval($priceNoIVA) * floatval($discount) / 100 ;                                            
                            $subtotalPrice = floatval($priceNoIVA) - floatval($subTotalDiscount);
                            if($data['factura'][$i]['editPrice'] == '1'){
                                $discountAmount = floatval($priceNoIVA) - floatval($subtotalPrice);     
                            }else{
                                $discountAmount = floatval($particularPrice) - floatval($subtotalPrice);     
                            }
                            if($discountAmount < 0){
                                $discountAmount = 0;
                                if($discount > 0){
                                    $discountAmountToShow = "$discount %";
                                }
                            }
                            if($data['factura'][$i]['editPrice'] == '1'){
                                if(floatval($priceNoIVA) != 0.00){                                      
                                    $discountpercent = floatval($discountAmount) * 100 / floatval($priceNoIVA);    
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($priceNoIVA) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;                                           
                                }
                            }else{
                                if(floatval($particularPrice) != 0.00){                                      
                                    $discountpercent = floatval($discountAmount) * 100 / floatval($particularPrice);    
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($particularPrice) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;                                           
                                }
                            }
                        }
                        $totalDiscount = floatval($totalDiscount) + (floatval($discountAmount)*floatval($amount));

                        // Obtener índice usando array_search()
                        $keys = array_column($listIvas, 'type_iva');
                        $indexAux = array_search($percentage, $keys);

                        $subTotal = floatval($subtotalPrice);
                        $ivaAmount = ($subTotal * floatval($percentage)) / 100;

                        if($indexAux === false) {
                            $listIvas[] = [
                                'type_iva' => $percentage,
                                'base' => $subTotal,
                                'iva' => $ivaAmount
                            ];
                        }else{
                            $listIvas[$indexAux]['base'] += $subTotal;
                            $listIvas[$indexAux]['iva'] += $ivaAmount;
                        }

                        $totalBases += $subTotal;
                        $totalIva += $ivaAmount;

                        if($discountpercent == 0 || $discountpercent < 0){
                            $discountValue = $discountAmountToShow;
                        }else{
                            $discountValue = number_format($discountpercent,2) . ' %';
                        }

                        // New version -> Coreo Vicente 13/12
                        if($priceNoIVA > $particularPrice){
                            $priceToShow = $priceNoIVA;
                        }else{
                            if($data['factura'][$i]['editPrice'] == '0'){
                                $priceToShow = $particularPrice; 
                            }else{
                                $priceToShow = $priceNoIVA;
                            }
                        }

                        if($previousProductID == $data['factura'][$i]['productID']){
                                $text .= "<tr class='align-items-center'>
                                            <td style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$modelName."</td>
                                            <td>$amount</td>
                                            <td style='text-align:right'>".number_format($priceToShow,2)." €</td>
                                            <td>$discountValue</td>
                                            <td>".number_format($percentage,2)." %</td>
                                            <td style='text-align:right; background-color: #e5ebff important!;'>".number_format($subtotalPrice,2)." €</td>
                                        </tr>";
                                        $lines++;
                                        $totalLines++;
                        }else{
                            $text .= "<tr class='align-items-center'>
                                        <td style='text-align:left'><strong>$productName</strong> - $modelName</td>
                                        <td>$amount</td>
                                        <td style='text-align:right'>".number_format($priceToShow,2)." €</td>
                                        <td>$discountValue</td>
                                        <td>".number_format($percentage,2)." %</td>
                                        <td style='text-align:right; background-color: #e5ebff important!;'>".number_format($subtotalPrice,2)." €</td>
                                    </tr>";
                        }

                        $previousProductID = $data['factura'][$i]['productID'];
                        $previousModelID = $modelID;
                        $lines++;
                        $totalLines++;
                    }
                }

                if(isset($data['suplidos']) && is_array($data['suplidos']) && count($data['suplidos']) > 0){
                    $text .= "<tr><td><strong>***** SUPLIDOS *****</strong></td><td></td><td></td><td></td><td></td><td></td></tr>";
                    $previousProductID = 0;
                    $previousModelID = 0;
                    $contTextsSuplidos = 0;
                    foreach($data['suplidos'] AS $producto){
                        if($totalLines > 0 && ($totalLines % 34 == 0 || $totalLines % 44 == 0)){
                            $text .= "          </tbody>
                                            </table>
                                        </div>
                                        <pagebreak>
                                        </div></div></div>
                                        <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'><div class='contenidoPompas'>
                                            <div><table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center'>";
                            $totalLines = 0;
                            if($firstPage){
                                $firstPage = false;
                            }
                        }
                        $productID = $producto['productID'];
                        $modelID = $producto['modelID'];
                        $description = "";
                        $price = $producto['cost'];
                        $texts = $producto['texts'];

                        if($producto['editPrice'] == 1){
                            if(is_array($texts)){
                                if(isset($texts[$contTextsSuplidos]['value'])){
                                    $description = $producto['productName'] . ' - ' . $texts[$contTextsSuplidos]['value'];
                                }else{
                                    $description = '';
                                }
                                $contTextsSuplidos++;
                                if($contTextsSuplidos == count($texts)){
                                    $contTextsSuplidos = 0;
                                }
                            }else{
                                $modelName = isset($data['factura'][$i]['modelName']) ? $data['factura'][$i]['modelName'] : '';
                                $description = $producto['productName'] . ' - ' . $producto['modelName'];
                                $contTextsSuplidos = 0;
                            }
                        }else{
                            $description = $producto['productName'] . ' - ' . $producto['modelName'];
                        }

                        if($producto['multipleDiscount'] == null){
                            $amount = $producto['amount'];
                        }else{
                            $amount = 1;
                        }

                        if($producto['texts'] == 0){                                       
                            $discount = $producto['discount'];                                       
                            $priceDiscount = floatval($price) * floatval($discount) / 100 ;
                            $subTotal = floatval($price) - floatval($priceDiscount) ;
                            $subTotal = floatval($subTotal) * floatval($amount);
                        }else{
                            $discount = $producto['multipleDiscount'];                                       
                            $priceDiscount = floatval($price) * floatval($discount) / 100;
                            $subTotal = floatval($price) - floatval($priceDiscount);
                        }                                    
                                                    
                        $totalDiscount = floatval($totalDiscount) + (floatval($priceDiscount)* floatval($amount)); 
                        $supplied = floatval($supplied) + floatval($subTotal);
                        
                        if($discount == 0 || $discount == 0.00){
                            $discount = '-';
                        }else{
                            $discount = number_format($discount, 2) . ' %';
                        }

                        $productID = $producto['productID'];
                        $modelID = $producto['modelID'];
                        $text .= "<tr class='align-items-center'>
                                    <td style='text-align:left'>$description</td>
                                    <td>$amount</td>
                                    <td style='text-align:right'>". number_format($price, 2) ." €</td>
                                    <td>".$discount."</td>
                                    <td>-</td>
                                    <td style='text-align:right; background-color: #e5ebff important!;'>".number_format($subTotal,2)." €</td>
                                </tr>";
                        $previousProductID = $productID;
                        $previousModelID = $modelID;
                        $lines++;
                        $totalLines++;
                    }
                }

                $bruto = $totalBases + $supplied;
                $total = $bruto + $totalIva;

                // Fix IVA footer
                $brutoAux = floatval($utils->roundLikePHP2($bruto, 2));
                $totalAux = floatval($utils->roundLikePHP2($total, 2));

                if(floatval($totalAux) != (floatval($totalIva) + floatval($bruto))){
                    $bruto = floatval($totalAux) - floatval($totalIva);
                }

                $bruto = number_format($bruto, 2);
                $total = number_format($total, 2);
                $supplied = number_format($supplied, 2);
                $totalBases = number_format($totalBases, 2);
                $totalIva = number_format($totalIva, 2);

                $text .= "
                        </table>
                        <br>
                        <div>
                            <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center'>
                                <thead>
                                    <tr>
                                        <td>
                                            <strong>BRUTO</strong>
                                        </td>
                                        <td>
                                            <strong>SUPLIDOS</strong>
                                        </td>
                                        <td>
                                            <strong>BASE IMPONIBLE</strong>
                                        </td>
                                        <td>
                                            <strong>TIPO $ivaLabel</strong>
                                        </td>
                                        <td>
                                            <strong>$ivaLabel</strong>
                                        </td>
                                        <td>
                                            <strong>TOTAL</strong>
                                        </td>
                                    </tr>
                                </thead>
                                <tbody>
                ";

                if(count($listIvas) > 0){
                    foreach($listIvas as $index=>$item){
                        $text .= "<tr>";

                        if($index == 0){
                            $text .= "
                                <td rowspan='".count($listIvas)."'>" . $bruto . " €</td>
                                <td rowspan='".count($listIvas)."'>" . $supplied . " €</td>
                            ";
                        }

                        $text .= "
                            <td>" . number_format(floatval($item['base']), 2) . " €</td>
                            <td>" . number_format(floatval($item['type_iva']), 2) . " %</td>
                            <td>" . number_format(floatval($item['iva']), 2) . " €</td>
                        ";

                        if($index == 0){
                            $text .= "<td style='background-color: #e5ebff important!;' rowspan='".count($listIvas)."'><strong>" . $total . " €</strong></td>";
                        }

                        $text .= "</tr>";
                    }
                }else{
                    $text .= "
                        <tr>
                            <td>" . $bruto . " €</td>
                            <td>" . $supplied . " €</td>
                            <td>0.00 €</td>
                            <td> - </td>
                            <td>0.00 €</td>
                            <td style='background-color: #e5ebff important!;'><strong>" . $total . " €</strong></td>
                        </tr>
                    ";
                }

                $text .= "
                                </tbody>
                            </table>
                        </div>
                        <br>
                        <table class='tablePdf$tablePdfColor' style='width: 30%;'>
                            <tr>
                                <td>
                                    <p></p>
                                    <p>Fdo.:</p>
                                </td>
                            </tr>
                        </table>
                    </div>
                    <br>
                ";

                if(
                    ($_SESSION['company'] == '1' || $_SESSION['company'] == '3' || $_SESSION['company'] == '8') 
                    && $rgpd != ''
                ){
                    // Seteamos el máximo de líneas por página (por compañia)
                    if(!$firstPage){
                        $maxLines = 28;
                    }else{
                        $maxLines = 25;
                    }

                    // Rellenamos la página con líneas en blanco
                    if($lines >= $maxLines){
                        $text .= "
                            </tbody></table></div></div></div></div>
                            <pagebreak>
                            <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div class='contenidoPompas'><div>
                        ";
                    }
                }

                $text .= "
                        <div style='font-size: 10px; margin-top:25px'>
                            <p style='text-align: justify;'>$rgpd</p>
                            <p style='text-align: justify;'>
                                El abajo firmante se compromete de forma solidaria, junto con quién legalmente corresponda, al pago de todos los gastos y servicios contratados
                                para el caso de que los mismos, no sean satisfechos en el plazo máximo de un mes.
                            </p>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "cuestionarioCliente":
                $utils = new Utils();
                $data = getCuestionarioCliente($expedient);
                $info = $data[0];
                $survey = $data[1];
                $background = $utils->getBackgroundDocuments();
                $text = "
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas' style='padding-top: 100px'>
                                <div style='text-align:center' class='text-center'>
                                    <p><strong><u>CUESTIONARIO DE SATISFACCIÓN</u></strong></p>
                                </div>
                                <div>
                                    <p><strong><u>ENCUESTADO</u></strong></p>
                                    <br>
                                    <p style='text-align:justify'><strong>CLIENTE:</strong> " . $info['name'] . " " . $info['surname'] . "<strong></p>
                                    <p style='text-align:justify'><strong>AÑO:</strong> " . $info['year'] . "</p>
                                </div>
                                <br>
                                <div>
                                    <p><strong><u>ENCUESTA</u></strong></p>
                                        <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                            <tbody>
                                                <tr>
                                                    <td style='width:20%;'><p style='text-align:center'><strong>SERVICIO</strong></p></td>
                                                    <td style='width:20%;'><p style='text-align:center'><strong>VALORACIÓN</strong></p></td>
                                                    <td><p style='text-align:center'><strong>OBSERVACIONES</strong></p></td>
                                                </tr>
                ";

                $cont = 0;
                $score = 0;
                foreach($survey as $elem){
                    $text .= "          
                        <tr>
                            <td style='width:20%;'>
                                <p style='text-align:right'><strong>" . $elem['service'] . "</strong></p>
                            </td>
                            <td style='width:20%;'>
                                <p style='text-align:center'>" . $elem['value'] . "</p>
                            </td>
                            <td>
                                <p style='text-align:center'>" . $elem['notes'] . "</p>
                            </td>
                        </tr>
                    ";

                    if($elem['value'] != null){
                        $cont++;
                        $score += $elem['value'];
                    }
                }

                if($cont > 0){
                    $totalScore = round($score / $cont, 2);
                }else{
                    $totalScore = '-';
                }

                $text .= "
                                        </tbody>
                                    </table>
                                    <br>
                                    <p><strong>Puntuación</strong>: $totalScore</p>
                                </div>
                                <br>
                                <div>
                                    <p><strong><u>ASPECTOS A MEJORAR</u></strong></p>
                                    <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                        <tbody>
                                            <tr>
                                                <td><p style='text-align:justify'>" . $info['notes'] . "</p></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "cuestionarioSatisfaccion":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/cuestionarioSatisfaccion.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }

                $utils = new Utils();
                $data = getCuestionarioSatisfaccion($expedient);

                $info = $data != null && $data[0] != null ? $data[0] : null;
                $survey = $data != null && $data[1] != null ? $data[1] : null;
                $background = $utils->getBackgroundDocuments();

                if($info != null){
                    if($info['deceasedGender'] == 'Hombre'){
                        $pre = 'D. ';
                    }else{
                        $pre = 'Dña. ';
                    }
                }else{
                    $pre = '';
                }

                $text = "
                    <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                        <div style='margin-right:50px;right:480px; position: absolute; text-align: right; padding-top: 50px;'>
                            <p>EXP.: <strong>" . ($info != null ? $info['number'] : '-') . "</strong></p>
                        </div>
                        <br><br>
                        <div class='contenidoPompas' style='padding-top: -1px;'>
                            <div width='50%'></div>
                                <table width='50%' class='tablePdf$tablePdfColor text-center pull-right' style='right:0px;'>
                                    <tbody>
                                        <tr>
                                            <td style='text-align:center'>
                                                <strong>CUESTIONARIO DE SATISFACCIÓN</strong>
                                            </td>
                                            <td>";
                                                if(intval($_SESSION['company']) == 1){
                                                    $text .= "<p style='text-align:center'>C&oacute;digo:RE-7502</p>";
                                                }
                                                $text .= "<p style='text-align:center'>Revisi&oacute;n: 01</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <br><br>
                                <div>
                                    <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center; width: 5%'>                                    
                                                </td>
                                                <td style='text-align:center; width: 26%'>
                                                    <p><strong>VALORACIÓN DE SERVICIOS</strong></p>
                                                </td>
                                                <td style='text-align:center; width: 10%'>
                                                    <p><strong>EXCELENTE (5)</strong></p>
                                                </td>
                                                <td style='text-align:center; width: 6%'>
                                                    <p><strong>BUENA (4)</strong></p>
                                                </td>
                                                <td style='text-align:center; width: 8%'>
                                                    <p><strong>REGULAR (3)</strong></p>
                                                </td>
                                                <td style='text-align:center; width: 5%'>
                                                    <p><strong>MALA (2)</strong></p>
                                                </td>                        
                                                <td style='text-align:center; width: 10%'>
                                                    <p><strong>MUY MALA (1)</strong></p>
                                                </td>                        
                                                <td style='text-align:center; width: 10%'>
                                                    <p><strong>NO APLICA</strong></p>
                                                </td>                        
                                                <td style='text-align:center; width: 26%'>
                                                    <p><strong>OBSERVACIONES</strong></p>
                                                </td>                        
                                            </tr>
                ";

                if($survey != null){
                    foreach($survey as $index => $elem){
                        $text .= "  
                            <tr>
                                <td style='text-align:center'>
                                    <strong><p>" . ($index + 1) . ".</p></strong>
                                </td>
                                <td style='text-align:left'>
                                    <p>" . $elem['service'] . "</p>
                                </td>
                                <td style='text-align:center'>
                        ";

                        if($elem['value'] == '5'){
                            $text .= "      <p><strong>X</strong></p>";   
                        }
                        $text .= "      </td>
                                        <td style='text-align:center'>";
                        if($elem['value'] == '4'){
                            $text .= "      <p><strong>X</strong></p>";   
                        }
                        $text .= "      </td>
                                        <td style='text-align:center'>";
                        if($elem['value'] == '3'){
                            $text .= "      <p><strong>X</strong></p>";   
                        }
                        $text .= "      </td>
                                        <td style='text-align:center'>";
                        if($elem['value'] == '2'){
                            $text .= "      <p><strong>X</strong></p>";   
                        }
                        $text .= "      </td>
                                        <td style='text-align:center'>";
                        if($elem['value'] == '1'){
                            $text .= "      <p><strong>X</strong></p>";   
                        }
                        $text .= "      </td>
                                        <td style='text-align:center'>";
                        if($elem['value'] == ''){
                            $text .= "      <p><strong>X</strong></p>";   
                        }
                        $text .= "      
                                </td>
                                <td>
                                    <p style='font-size:8px'>" . $elem['notes'] . "</p>
                                </td>
                            </tr>
                        ";
                    }
                }

                $text .= "
                                        </tbody>
                                    </table>
                                </div>
                                <br>
                                <div>
                                    <p><strong>ASPECTOS A MEJORAR:</strong> En caso de que la valoración sea regular, mala o muy mala, solicitar explicación de que aspectos deberíamos mejorar.</p>
                                    <p>En cualquier caso y aún valorando bien nuestro servicio, si consideran que existen aspectos que deberíamos mejorar, relacionarlos a continuación.</p>
                                </div>
                                <br>
                                <div>
                                    <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center'>
                                                    <p>ASPECTOS A MEJORAR</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    " . ($info != null ? $info['aspects'] : '-') . "<br><br>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <br>
                                <div>
                                    <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                        <tbody>
                                            <tr>
                                                <td style='width:10%'>
                                                    <p style='text-align:right'>FECHA</p>
                                                </td>
                                                <td style='width:40%'>
                                                    <p><strong>". ($info != null ? $utils->fechaCastellano2(date('Y'), $info['date']) : '-') ."</strong></p>
                                                </td>
                                                <td style='width:10%'>
                                                    <p style='text-align:right'>DEFUNCIÓN</p>
                                                </td>
                                                <td style='width:40%'>
                                                    <p><strong>Nº Exp.: " . ($info != null ? $info['number'] : '-') ." <br> $pre " . ($info != null ? $info['deceasedName'] : '-') ." " . ($info != null ? $info['deceasedSurname'] : '-') ."</strong> (Q.E.P.D.)</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width:10%'>
                                                    <p style='text-align:right'>PARENTESCO</p>
                                                </td>
                                                <td style='width:40%'>
                                                    <p><strong>" . ($info != null ? $info['relationship'] : '-') ."</strong></p>
                                                </td>
                                                <td style='width:10%'>
                                                    <p style='text-align:right'>NOMBRE ESTREVISTADO</p>
                                                </td>
                                                <td style='width:40%'>
                                                    <p><strong>" . ($info != null ? $info['name'] : '-') ."</strong></p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                ";
                
                return $text;
            break;

            case "datosIglesia":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/datosIglesia.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $utils = new Utils();
                    $staticInfo = $documentsInfo->getByDocument('datosIglesia');
                    if($staticInfo != null){
                        foreach($staticInfo as $elem){
                            switch($elem['name']){
                                case 'locationDoc9':
                                    $locationDown = $elem['value'];
                                break;
                            }
                        }
                    }else{
                        $locationDown = '';
                    }
                    $background = $utils->getBackgroundDocuments();
                    $data = getDatosIglesia($expedient);

                    $church = $data['church'];
                    $churchLabel = $data['churchLabel'];
                    // $churchLabel = ($data['churchLabel'] == 'Otro' ? '' : $data['churchLabel'] == 'Iglesia Parroquial' ? $data['churchLabel'] . ' de': $data['churchLabel']);

                    $funeralDate = $data['funeralDate'] == null ? '' : date("j-n-Y", strtotime($data['funeralDate']));
                    switch($data['deceasedGender']){
                        case 'Hombre':
                            $gender = 'O';
                        break;
                        case 'Mujer':
                            $gender = 'A';
                        break;
                        default:
                            $gender = 'O';
                        break;
                    }
                    $deceasedIn = $data['deceasedIn'] == null ? '' : $data['deceasedIn'];
                    if($data['locationName'] != null && $data['locationName'] != ''){
                        $deceasedIn .= ", " . $data['locationName'];
                    }
                    if($data['locationProvince'] != null && $data['locationProvince'] != ''){
                        $deceasedIn .= ", " . $data['locationProvince'];
                    }
                    $deceasedDate = $data['deceasedDate'] == null ? '' : $utils->fechaCastellano2(date('d-m-Y', strtotime($data['deceasedDate'])));
                    $funeralDate2 = $data['funeralDate'] == null ? '' : $utils->fechaCastellano2(date('d-m-Y', strtotime($data['funeralDate'])));
                    $cemetery = $data['cemetery'] == null ? '' : $data['cemetery'];

                    if($data['mortuary'] == null){
                        $mortuary = '';
                    }else{
                        if($data['mortuary'] == 'Otro'){
                            $mortuary = $data['deceasedMortuaryAddress'] . ", sala " . $data['deceasedRoom'];
                        }else{
                            $mortuary = $data['mortuary'] . ", sala " . $data['deceasedRoom'];
                        }
                    }

                    $name = $data['deceasedName'];
                    $surname = $data['deceasedSurname'];
                    $childOfFather = $data['deceasedChildOfFather'];
                    $childOfMother = $data['deceasedChildOfMother'];
                    $status = $data['deceasedMaritalStatus'];
                    switch($status){
                        case 'Soltero':
                            $status = 'Soltero/a';
                        break;
                        case 'Casado':
                            $status = 'Casado/a';
                        break;
                        case 'Divorciado':
                            $status = 'Divorciado/a';
                        break;
                        case 'Viudo':
                            $status = 'Viudo/a';
                        break;
                    }
                    $nuptials = $data['deceasedFirstNuptials'];
                    // $age = $data['deceasedBirthday'] != null && $data['deceasedDate'] != null ? intval((strtotime($data['deceasedDate']) - strtotime($data['deceasedBirthday'])) / (60 * 60 * 24 * 365)) : '';
                    if($data['deceasedBirthday'] != null && $data['deceasedDate'] != null){
                        $date1 = new DateTime($data['deceasedBirthday']);
                        $date2 = new DateTime($data['deceasedDate']);
                        $interval = $date1->diff($date2);
                        $age = $interval->y;
                    }else{
                        $age = '';
                    }
                    $province = $data['deceasedBirthdayProvince'] == null ? '' : $data['deceasedBirthdayProvince'];
                    $location = $data['birthdayLocation'] == null ? '' : $data['birthdayLocation'];
                    $usualAddress = $data['deceasedUsualAddress'];
                    if($data['usualLocation'] != '' && $data['usualLocation'] != null){
                        $usualAddress .= ", " .  $data['usualLocation'];
                    }
                    if($data['usualProvince'] != '' && $data['usualProvince'] != null){
                        $usualAddress .= ", " .  $data['usualProvince'];
                    }
                    $nicheSection = '';
                    $heightSection = 40;
                    $heightSectionDown = 62;

                    if($data['funeralNicheNumber'] != '' || $data['nicheHeight'] != '0' || $data['exhumation'] != '' || $data['regime'] != '0'){
                        if($data['regime'] != '0'){
                            switch($data['regime']){
                                case '1':
                                    $data['regime'] = 'Propiedad';
                                break;
                                case '2':
                                    $data['regime'] = 'Alquiler';
                                break;
                                case '3':
                                    $data['regime'] = 'Concesión';
                                break;
                                case '4':
                                    $data['regime'] = 'Cesión Temporal';
                                break;
                            }
                        }
                        $heightSection = 36;
                        $heightSectionDown = 52;
                        $nicheSection = "
                            <tr>
                                <td style='height: {$heightSection}px;'><span style='color:$colorStyle'>RÉGIMEN NICHO: <strong>{$data['regime']}</strong> - TITULAR NICHO: <strong>{$data['exhumation']}</strong></span></td>
                            <tr>
                                <td style='height: {$heightSection}px;'><span style='color:$colorStyle'>ALTURA NICHO: <strong>{$data['nicheHeight']}º</strong> - NÚMERO NICHO: <strong>{$data['funeralNicheNumber']}</strong></span></td>
                            </tr>
                        ";
                    }

                    $text = "
                        <div class='fondo' style='line-height: 4'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            
                                <div class='contenidoPompas' style='padding-top: 20px;'>
                                    <div style='text-align: right;margin-top: 150px'>
                                        <span style='font-size:16px;'>". $churchLabel . "<strong><i> " . $church . "</i></strong></span>
                                    </div>
                                    <div style='text-align: right;margin-top:-14px'>
                                        <span>Ref.: <strong>" . $data['number'] . "</strong></span>
                                        <span>&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp</span>
                                        <span style='font-size:12px;'>Fecha: <strong>" .$funeralDate. "</strong></span>
                                    </div>
                                    
                                    <table style='width: 100%; color: #00305c; margin-top:15px'>
                                        <tr>
                                            <td style='height: {$heightSection}px;'><span style='color:$colorStyle'>FALLECIDO EN: <strong>$deceasedIn</strong></span></td>
                                        </tr>
                                        <tr>
                                            <td style='height: {$heightSection}px;'><span style='color:$colorStyle'>FECHA FALLECIMIENTO: <strong>$deceasedDate</strong></span></td>
                                        </tr>
                                        <tr>
                                            <td style='height: {$heightSection}px;'><span style='color:$colorStyle'>FECHA INHUMACIÓN: <strong>$funeralDate2</strong></span></td>
                                        </tr>
                                        <tr>
                                            <td style='height: {$heightSection}px;'><span style='color:$colorStyle'>CEMENTERIO: <strong>$cemetery</strong></span></td>
                                        </tr>
                                        <tr>
                                            <td style='height: {$heightSection}px;'><span style='color:$colorStyle'>TANATORIO: <strong>$mortuary</strong></span></td>
                                        </tr>
                                        $nicheSection
                                    </table>
                                    <br>
                                    <p style='text-align: center;'><strong>DATOS PERSONALES</strong></p>
                                    <table style='width: 100%; color: #00305c;'>
                                        <tr>
                                            <td style='height: {$heightSectionDown}px;width:50%'><span style='color:$colorStyle'>NOMBRE: <strong>$name</strong></span></td>
                                            <td style='height: {$heightSectionDown}px;width:50%'><span style='color:$colorStyle'>APELLIDOS: <strong>$surname</strong></span></td>
                                        </tr>
                                        <tr>
                                            <td style='height: {$heightSectionDown}px;width:50%'><span style='color:$colorStyle'>HIJ$gender DE: <strong> $childOfFather</strong></span></td>
                                            <td style='height: {$heightSectionDown}px;width:50%'><span style='color:$colorStyle'>Y DE: <strong> $childOfMother</strong></span></td>
                                        </tr>
                                        <tr>
                                            <td style='height: {$heightSectionDown}px;width:50%'><span style='color:$colorStyle'>ESTADO: <strong>$status</strong></span></td>
                                            <td style='height: {$heightSectionDown}px;width:50%'><span style='color:$colorStyle'>1º NUPCIAS CON: <strong>$nuptials</strong></span></td>
                                        </tr>
                                        <tr>
                                            <td style='height: {$heightSectionDown}px;width:50%'><span style='color:$colorStyle'>EDAD: <strong>$age años</strong></span></td>
                                            <td style='height: {$heightSectionDown}px;width:50%'><span style='color:$colorStyle'></span></td>
                                        </tr>
                                        <tr>
                                            <td style='height: {$heightSectionDown}px;width:50%'><span style='color:$colorStyle'>NATURAL DE: <strong>$location, $province</strong></span></td>
                                            <td style='height: {$heightSectionDown}px;width:50%'><span style='color:$colorStyle'></span></td>
                                        </tr>
                                    </table>
                                    <table style='width: 100%; color: #00305c;'>
                                        <tr>
                                            <td style='height: 12px; width='90%'><span style='color:$colorStyle'>DOMICILIO HABITUAL: <strong>$usualAddress</strong></span></td>
                                        </tr>
                                    </table>
                                    <br>
                                    <p style='text-align: right;'>$locationDown, {$utils->fechaCastellano2(date('Y'))}</p>
                                </div>
                            </div>
                        </div>
                    ";

                    return $text;
                }
            break;

            case "depositarCenizas":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/depositarCenizas.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }
                $data = getDepositarCenizas($expedient);

                $staticInfo = $documentsInfo->getByDocument('depositarCenizas');
                if($staticInfo != null){
                    foreach($staticInfo as $elem){
                        switch($elem['name']){
                            case 'companyDoc21':
                                $company = $elem['value'];
                            break;
                            case 'companyAddressDoc21':
                                $address = $elem['value'];
                            break;
                            case 'companyLocationDoc21':
                                $location = $elem['value'];
                            break;
                            case 'provinceDoc21':
                                $province = $elem['value'];
                            break;
                        }
                    }
                }else{
                    $company = '';
                    $address = '';
                    $location = '';
                    $province = '';
                }
                
                $utils = new Utils();
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                }
                
                $background = $utils->getBackgroundDocuments();

                $deceasedName = $data['deceasedName'];
                $deceasedSurname = $data['deceasedSurname'];

                $dayA = $data['deceasedDate'] == null ? '' : date("d", strtotime($data['deceasedDate']));
                $monthA = $data['deceasedDate'] == null ? '' : date("m", strtotime($data['deceasedDate']));
                $monthA = getMonth($monthA);
                $yearA = $data['deceasedDate'] == null ? '' : date("Y", strtotime($data['deceasedDate']));

                $cemetery = $data['cemetery'] == null || $data['cemeteryLabel'] != 'Cementerio' ? '_______________________________________________ ' : $data['cemetery'];
                if($cemetery != '_______________________________________________ '){
                    $cemeteryLocation = $data['cemeteryLocation'] == null ? '___________________________' : $data['cemeteryLocation'];
                    $cemeteryLocation .= $data['cemeteryProvince'] == null ? '' : ' de ' . $data['cemeteryProvince'];
                }else{
                    $cemeteryLocation = '___________________________';
                }

                $nicheSelected = '';
                $panteonSelected = '';
                $fosaSelected = '';
                $otherSelected = '';
                switch($data['niche']){
                    case '2':
                        $nicheSelected = 'X';
                    break;
                    case '3':
                        $panteonSelected = 'X';
                    break;
                    case '4':
                        $fosaSelected = 'X';
                    break;
                    case '5':
                        $otherSelected = 'X';
                    break;
                }

                $numNiche = $data['funeralNicheNumber'] == null || $data['funeralNicheNumber'] == '' ? '_________ ' : $data['funeralNicheNumber'];
                $nicheHeight = $data['nicheHeight'] == null || $data['nicheHeight'] == '' || $data['nicheHeight'] == '0' ? '__________ ' : $data['nicheHeight'] .'º';

                $applicantLocation = $data['applicantLocation'] == null || $data['applicantLocation'] == '' ? '__________________' : $data['applicantLocation'];

                $familyContactAddress = '';
                if($data['familyContactLocality'] != null && $data['familyContactLocality'] != ''){
                    $familyContactAddress .=  $data['familyContactLocality'];
                }
                if($data['familyContactProvince'] != null && $data['familyContactProvince'] != ''){
                    $familyContactAddress .= ', ' . $data['familyContactProvince'];
                }

                $deceasedInName = $data['deceasedIn'];
                if($data['deceasedInName'] != null && $data['deceasedInName'] != ''){
                    $deceasedInName .= ', ' . $data['deceasedInName'];
                }

                return "
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas' style='padding-top: -5px'>
                                <div style='text-align: right; padding-top: 35px; line-height: 0.5'>
                                    <p><strong>$company</strong></p>
                                    <p>$address</p>
                                    <p>$location</p>
                                    <p>$province</p>
                                </div>
                                <div class='titulo' style='text-align:center;margin-top:30px'>
                                    <span>
                                        <strong>AUTORIZACI&Oacute;N PARA TRASLADO DE CENIZAS</strong>
                                        <br><br>
                                        <strong>DEP&Oacute;SITO DE CENIZAS</strong>
                                    </span>
                                </div>
                                <br>
                                <div style='text-align:justify'>
                                    <span style='font-size:12px'>
                                        Por medio del presente documento, el abajo firmante, se declara representante acreditado por la familia y/o propietarios, 
                                        para dar autorizaci&oacute;n a <strong>$company</strong> a realizar la apertura del nicho indicado a continuaci&oacute;n, 
                                        eximiendo a ésta de toda responsabilidad frente a cualquier reclamaci&oacute;n que se pudiese presentar contra la misma, por carecer 
                                        de autorizaci&oacute;n suficiente para la apertura de la unidad de enterramiento. 
                                        Se libera por tanto a $company de la total responsabilidad, asumi&eacute;ndola el abajo firmante en este 
                                        documento de Autorizaci&oacute;n:
                                        <br><br>
                                        " . $gender . ": <strong><u>" . $data['familyContactName'] . " " . $data['familyContactSurname'] . "</u></strong>, 
                                        con DNI: <strong><u>" . $data['familyContactNIF'] . "</u></strong>, con domicilio en <strong><u>" . $data['familyContactAddress'] . 
                                        ", " . $familyContactAddress . "</u></strong>:
                                        <br>
                                        <p>
                                            <br>
                                            Como representante de la familia de $gender $deceasedName $deceasedSurname, fallecido el 
                                            $dayA de $monthA del $yearA en " . $deceasedInName . ".
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                                <tr> 
                                                    <td style='width:3%'>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='width:5%;height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Judicial
                                                        </span>
                                                    </td>
                                                    <td style='width:92%;height: 25px'>
                                                    </td>
                                                </tr>
                                            </table>
                                        </p>
                                    </span>
                                </div>
                                <div class='titulo' style='text-align:center;margin-top:15px'>
                                    <span>
                                        <strong><u>SOLICITO</u></strong>
                                    </span>
                                </div>
                                <div style='text-align:justify'>
                                    <span style='font-size:12px'>
                                        <p>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'>
                                                <tr>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            La apertura de la unidad de enterramiento
                                                        </span>
                                                    </td>
                                                    <td>
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span>$nicheSelected</span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Nicho&nbsp;
                                                        </span>
                                                    </td>
                                                    <td style=''>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span>$panteonSelected</span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Panteón&nbsp;
                                                        </span>
                                                    </td>
                                                    <td style=''>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span>$fosaSelected</span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Fosa&nbsp;
                                                        </span>
                                                    </td>
                                                    <td style=''>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span>$otherSelected</span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Otro: &nbsp;_____________
                                                        </span>
                                                    </td>
                                                </tr>
                                            </table>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'>
                                                <tr style='line-height:2'>
                                                    Nº $numNiche  &nbsp;Altura: $nicheHeight  &nbsp;Calle: __________   &nbsp;Bloque: _________   &nbsp;Fila: _________   &nbsp;Otro: ____________
                                                    del cementerio $cemetery de $cemeteryLocation y de la que soy:
                                                </tr>
                                                <tr>
                                                    <td style=''>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            Propietario
                                                        </span>
                                                    </td>
                                                    <td style=''>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            Heredero
                                                        </span>
                                                    </td>
                                                    <td style=''>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            Usufructario
                                                        </span>
                                                    </td>
                                                    <td style=''>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                        &nbsp;Otro: &nbsp;__________________
                                                        </span>
                                                    </td>
                                                </tr>
                                            </table>
                                            para que procedan a <strong>DEPOSITAR</strong> las cenizas del cadáver antes mencionado.
                                            <br><br>
                                            A su vez, con la firma del presente, se exonera a <strong>$company</strong> de cualquier tipo de responsabilidad derivada 
                                            del depósito de los restos mortales del fallecido en el nicho indicado, asumiendo el firmante cualquier responsabilidad derivada 
                                            de este encargo, en especial, cualquier responsabilidad exigible en lo concerniente a la posesión o propiedad de este.
                                            <br><br><br>
                                            <i>
                                                <strong>Nota: </strong> La empresa no se hace responsable de los daños que puedan sufrir tanto la lápida como los demás 
                                                ornamentos que se encuentran en la misma. La empresa se compromete a realizar las tareas con la mayor cautela, tratando en 
                                                todo momento de evitar cualquier daño. La familia puede solicitar la retirada de los ornamentos a su empresa marmolista de 
                                                confianza, asumiendo ésta la responsabilidad de los posibles daños que puedan surgir. En el caso de que el operario sea ajeno 
                                                a esta empresa (subcontratado, autónomo, empleado del cementerio o funcionario), éste será el encargado de realizar las tareas 
                                                de apertura y/o cierre, bajo su entera responsabilidad o la de su empresa. 
                                            </i>
                                            <br><br><br>
                                            <div style='font-size: 14px; text-align: right;'>
                                                <p>Para que así conste, firmo la presente en $applicantLocation, a ".date('d')." de " .getMonth(date('m')) ." de " .date('Y')."</p>
                                            </div>
                                            <br><br>
                                            <div style='font-size: 14px; text-align: right;'>
                                                <p>
                                                    <i>
                                                        Fdo.: ".$data['familyContactName'] . " " . $data['familyContactSurname']."
                                                        <br>
                                                        DNI: ".$data['familyContactNIF'] ."
                                                    </i>
                                                </p>
                                            </div>
                                        </p>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                ";
                return $text;
            break;

            case "distribution":
                $utils = new Utils();
                $data = getDistribution($expedient);

                if($data['deceasedGender'] == 'Hombre'){
                    $pre = 'D. ';
                }else{
                    $pre = 'Dña. ';
                }

                $background = $utils->getBackgroundDocuments();

                return "
                        <div class='fondo'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div class='contenidoPompas'>
                                    <br><br><br><br><br><br><br><br><br>
                                    <div>
                                        <p>ESQUELA DE: $pre<strong>" . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</strong> (Q.E.P.D.)</p>
                                    </div>
                                    <br><br>
                                    <div>
                                        <p>REPARTO EN: <strong>repartoEn</strong></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";
            break;

            case "exhumacionJudicial":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/exhumacionJudicial.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }

                $utils = new Utils();
                $data = getExhumacionJudicial($expedient);
                $staticInfo = $documentsInfo->getByDocument('exhumacionJudicial');
                if($staticInfo != null){
                    foreach($staticInfo as $elem){
                        switch($elem['name']){
                            case 'companyDoc10':
                                $company = $elem['value'];
                            break;
                            case 'addressDoc10':
                                $companyAddress = $elem['value'];
                            break;
                            case 'locationDoc10':
                                $address = $elem['value'];
                            break;
                        }
                    }
                }else{
                    $company = '';
                    $companyAddress = '';
                    $address = '';
                }

                $applicantName = $data['applicantName'];
                $applicantDni = $data['applicantNif'];
                $applicantLocation = $data['applicantLocation'];
                
                $deceasedName = $data['deceasedName'];
                $deceasedSurname = $data['deceasedSurname'];
                $deceasedGender = $data['deceasedGender'];
                $cemetery = $data['cemetery'];
                $cemeteryLocation = $data['cemeteryLocation'];
                $cemeteryProvince = $data['cemeteryProvince'];
                if($data['expedientDL'] == '0'){
                    $deceasedLocation = $data['otherDeceasedLocation'];
                }else{
                    $deceasedLocation = $data['deceasedLocation'];
                }

                $background = $utils->getBackgroundDocuments();
                $text = "   
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas' style='font-size: 14px'>
                                <p style='text-align: right;'><strong>Att. Juzgado _____________</strong></p>
                                <p style='text-align: right;'><strong>Diligencias:</strong> ______________ del Juzgado de Instrucción ___________</p>
                                <p style='text-align: right;'><strong>Fecha:</strong> " . $utils->fechaCastellano2(date('Y')) . "</p>
                                <br><br>
                                <p style='text-align: justify;'>
                                    D/Dña. $applicantName, mayor de edad, con DNI Nº: $applicantDni y domicilio en $applicantLocation, en mi propio nombre y derecho, ante el Juzgado ___________, comparezco y como mejor proceda,
                                </p>
                                <br><br>
                                <p>DIGO:</p>
                                <br>
                                <p style='text-align: justify;'>
                                    Que con fecha __/__/____, este juzgado instruyó las Diligencias identificadas con el Nº _________, referentes al fallecimiento en ___________ de mi _________, en la localidad de $deceasedLocation. Los
                                    restos mortales de mi padre están enterrados en el Cementerio de $cemetery ($cemeteryLocation - $cemeteryProvince) y quisiéramos proceder a la incineración de sus restos, para lo cual
                                </p>
                                <br>
                                <p>SOLICITO:</p>
                                <br>
                                <p style='text-align: justify;'>
                                    Tengan a bien proceder a emitir un escritor/autorización para que la empresa funeraria _____________, con domicilio en ________________, pueda proceder a la incineración de
                                    dichos restos en su Crematorio. Para lo cual adjunto
                                </p>
                                <p>
                                    <ul>
                                        <li>Certificación Literal de Defunción del Registro Civil de _______________</li>
                                        <li>Copia Libro de Familia</li>
                                        <li>Copia DNI</li>
                                    </ul>
                                </p>
                                <br>
                                <p>Por lo expuesto,</p>
                                <br>
                                <p style='text-align: justify;'>SUPLICO A ESTE JUZGADO que teniendo por presentado este escrito, lo admita, dicte el correspondiente escrito de autorización.</p>
                                <br>
                                <p style='text-align: right;'>_________ a " . $utils->fechaCastellano2(date('Y')) . "</p>
                                <br><br><br>
                                <p style='text-align: right;'>Fdo.: &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; $applicantName</p>
                            </div>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "factura-logo":
                $utils = new Utils;
                $ivaLabel = $utils->getIvaLabel();

                if($logo == 1){
                    if($isProformaParam != null){
                        $background = $utils->getBackgroundDocumentsProforma();
                    }else{
                        if($backgroundMode == 1){
                            $background = $utils->getBackgroundDocumentsInvoicesRectified();
                        }else if($backgroundMode == 2){
                            $background = $utils->getBackgroundDocumentsInvoicesAnuled();
                        }else{
                            $background = $utils->getBackgroundDocumentsInvoices();     
                        }
                    }
                }else{
                    if($isProformaParam != null){
                        $background = $utils->getBackgroundDocumentsProformaNoLogo();
                    }else{
                        if($backgroundMode == 1){
                            $background = $utils->getBackgroundDocumentsInvoicesRectifiedNoLogo();
                        }else if($backgroundMode == 2){
                            $background = $utils->getBackgroundDocumentsInvoicesAnuledNoLogo();
                        }else{
                            $background = $utils->getBackgroundDocumentsInvoicesNoLogo();
                        }
                    }
                }

                $background = explode(URL, $background);
                $background = $_SESSION['basePath'] . $background[1];

                $companySelected = $_SESSION['company'];

                if($isProformaParam != null){
                    $data = getFacturaProforma($expedient);
                }else{
                    $data = getFactura($expedient, $numHiring);
                }

                $extraSeguroLines = 0;
                $text = "<div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>";
            
                if($data['deceasedGender'] == 'Hombre'){
                    $gender = 'D.';
                }else{
                    $gender = 'Dña.';
                }
                
                $mortuaryLabel = '<br>';
                if($data['deceasedDate'] != null && ($data['clientType'] == '2' || $data['clientType'] == '3')){
                    $deceasedDate = date('d/m/y', strtotime($data['deceasedDate']));
                    $mortuaryLabel .= "(✝ $deceasedDate) ";
                }
                if($data['isYourOwn'] == '1'){
                    $mortuaryLabel .= $data['mortuary'];
                }else if($data['isYourOwn'] == '0'){
                    $mortuaryLabel .= 'Otro';
                }

                $depMsg = " Def. de $gender " . $data['deceasedName'] . " " . $data['deceasedSurname'] . " (Q.E.P.D.) $mortuaryLabel";

                $segurosLabel = '';
                if(isset($data['clientType'])){
                    if($data['clientType'] == 2 || $data['clientType'] == 3){
                        if(($data['policy'] != '' && $data['policy'] != null) || ($data['lossNumber'] != '' && $data['lossNumber'] != null)){
                            // $depMsg .= "<br>";

                            if($data['policy'] != '' && $data['policy'] != null){
                                $segurosLabel .= "<strong> Póliza Nº: </strong> " . $data['policy'];
                                $extraSeguroLines++;
                            }

                            if($data['lossNumber'] != '' && $data['lossNumber'] != null){
                                if($segurosLabel != ''){
                                    $segurosLabel .= '<br>';
                                }
                                $segurosLabel .= "<strong> Siniestro: </strong> " . $data['lossNumber'];
                                $extraSeguroLines++;
                            }
                        }
                    }
                }

                if($isProformaParam == null){
                    if(intval($data['billingSerie']) == 5){
                        if($segurosLabel != ''){
                            $segurosLabel .= '<br>';
                        }
                        $segurosLabel .= "Factura simplificada";
                        $extraSeguroLines++;
                    }
                }

                if($segurosLabel != ''){
                    $segurosLabel = "<div style='margin-top: 8px;margin-bottom: 5px;'>".$segurosLabel."</div>";
                }

                $rectificatedLabel = '<br>';
                if($isProformaParam == null){
                    if($data['original_invoice_rectified'] != null && $data['original_invoice_rectified'] != ''){
    
                        $rectificatedLabel = $data['description'];
                        $extraSeguroLines++;
                    }
    
                    if($rectificatedLabel != '<br>'){
                        $rectificatedLabel = "<div style='margin-bottom: 4px;'>".$rectificatedLabel."</div>";
                    }
                }

                // VERIFACTU QR
                $qrVerifactuSection = '';
                $limitInfoClient = '';
                if(
                    $isProformaParam == null &&
                    ($data['verifactu_error'] == null ||  $data['verifactu_error'] == '') && 
                    $data['verifactu_hash'] != null && $data['verifactu_hash'] != '' &&
                    is_file($_SESSION['basePath'] . "resources/files/$companySelected/expedients/$expedient/docs/invoices/".$data['facturaID']."/qr_verifactu.png")
                ){
                    if($companySelected == 10){
                        $qrTopImg = 90;
                        $qrTopContent = -60;
                        $qrTopContent2 = 40;
                    }else if($companySelected == 13){
                        $qrTopImg = 90;
                        $qrTopContent = -60;
                        $qrTopContent2 = 40;
                    }else if($companySelected == 14){
                        $qrTopImg = 90;
                        $qrTopContent = -60;
                        $qrTopContent2 = 40;
                    }else if($companySelected == 17){
                        $qrTopImg = 57;
                        $qrTopContent = -80;
                        $qrTopContent2 = 40;
                    }else if($companySelected == 20){
                        $qrTopImg = 90;
                        $qrTopContent = -60;
                        $qrTopContent2 = 40;
                    }else if($companySelected == 24){
                        $qrTopImg = 90;
                        $qrTopContent = -60;
                        $qrTopContent2 = 40;
                    }else if($companySelected == 26){
                        $qrTopImg = 90;
                        $qrTopContent = -60;
                        $qrTopContent2 = 40;
                    }else if($companySelected == 27){
                        $qrTopImg = 90;
                        $qrTopContent = -60;
                        $qrTopContent2 = 40;
                    }else if($companySelected == 28){
                        $qrTopImg = 90;
                        $qrTopContent = -60;
                        $qrTopContent2 = 40;
                    }else if($companySelected == 29){
                        $qrTopImg = 90;
                        $qrTopContent = -60;
                        $qrTopContent2 = 40;
                    }else{
                        $qrTopImg = 90;
                        $qrTopContent = -70;
                        $qrTopContent2 = 40;
                    }

                    $qrverifactu = $_SESSION['basePath'] . "resources/files/$companySelected/expedients/$expedient/docs/invoices/".$data['facturaID']."/qr_verifactu.png";

                    $qrVerifactuSection =
                        "   <div style='margin-left:275px;margin-top:-".$qrTopImg."px;'>
                                <span>&nbsp;&nbsp;&nbsp;<strong>QR TRIBUTARIO</strong></span>
                                <br>
                                <img src='".$qrverifactu."' style='max-width: 30mm;max-height: 30mm;border: 1px solid #ccc;display: inline-block;'>
                                <br>
                                <span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>VERI*FACTU</strong></span>
                            </div>
                        ";

                    $limitInfoClient = 'max-width:250px!important;width:250px!important;white-space: normal;';

                    $extraSeguroLines++;
                }else{

                    if($companySelected == 5){
                        if($logo == 1){
                            $qrTopContent = -10;
                            $qrTopContent2 = 50;
                        }else{
                            $qrTopContent = 50;
                            $qrTopContent2 = 50;
                        }
                    }else if($companySelected == 10){
                        $qrTopContent = -5;
                        $qrTopContent2 = 50;
                    }else if($companySelected == 11){
                        $qrTopContent = -5;
                        $qrTopContent2 = 50;
                    }else if($companySelected == 12){
                        $qrTopContent = -5;
                        $qrTopContent2 = 50;
                    }else if($companySelected == 13){
                        $qrTopContent = -0;
                        $qrTopContent2 = 60;
                    }else if($companySelected == 14){
                        $qrTopContent = -0;
                        $qrTopContent2 = 60;
                    }else if($companySelected == 15){
                        $qrTopContent = -10;
                        $qrTopContent2 = 60;
                    }else if($companySelected == 16){
                        $qrTopContent = -10;
                        $qrTopContent2 = 60;
                    }else if($companySelected == 17){
                        $qrTopContent = -10;
                        $qrTopContent2 = 35;
                    }else if($companySelected == 20){
                        $qrTopContent = -5;
                        $qrTopContent2 = 60;
                    }else if($companySelected == 21){
                        $qrTopContent = -5;
                        $qrTopContent2 = 60;
                    }else if($companySelected == 22){
                        $qrTopContent = -5;
                        $qrTopContent2 = 60;
                    }else if($companySelected == 24){
                        $qrTopContent = -0;
                        $qrTopContent2 = 60;
                    }else if($companySelected == 25){
                        $qrTopContent = -10;
                        $qrTopContent2 = 60;
                    }else if($companySelected == 26){
                        $qrTopContent = -0;
                        $qrTopContent2 = 60;
                    }else if($companySelected == 27){
                        $qrTopContent = -5;
                        $qrTopContent2 = 60;
                    }else if($companySelected == 28){
                        $qrTopContent = -0;
                        $qrTopContent2 = 60;
                    }else if($companySelected == 29){
                        $qrTopContent = -5;
                        $qrTopContent2 = 60;
                    }else{
                        $qrTopContent = -21;
                        $qrTopContent2 = 60;
                    }

                    $limitInfoClient = 'max-width:350px!important;width:350px!important;white-space: normal;';
                }

                $data['creationDate'] = date('d/m/Y', $data['creationDate']);

                $titleNumInvoice = 'Nº FACTURA';
                if($isProformaParam != null){
                    $titleNumInvoice = 'PROFORMA';
                }
                $text .= "
                    <div class='contenidoPompas'>
                        $qrVerifactuSection
                        <div class='pull-left' style='width:40%; margin-top: ".$qrTopContent."px'>
                            <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                <tbody>
                                    <tr>
                                        <td style='text-align:center'>
                                            <p><strong>$titleNumInvoice</strong></p>
                                        </td>
                                        <td style='text-align:center'>
                                            <p><strong>FECHA</strong></p>
                                        </td>
                                        <td style='text-align:center'>
                                            <p><strong>EXPEDIENTE</strong></p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style='text-align:center; background-color: #e5ebff important!;'>
                                            <p>" . $data['generatedInvoiceNumber'] . "</p>
                                        </td>
                                        <td style='text-align:center; background-color: #e5ebff important!;'>
                                            <p>" . $data['creationDate'] . "</p>
                                        </td>
                                        <td style='text-align:center; background-color: #e5ebff important!;'>
                                            <p>" . $data['number'] . "</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            ".$segurosLabel."
                        </div>
                ";

                $text .= " <div style='margin-top: -".$qrTopContent2."px;'>";

                $companyAddress = $data['address'];
                $companyPostalCode = $data['postalCode'];
                $provinceLabel = $data['province'] == null || $data['province'] == '' ? '' : ' (' . $data['province'] . ')';
                $companyLocation = $data['locationName'] . $provinceLabel;
                $companyNIF = $data['nif'];
                if($companyAddress == '' || $companyAddress == null){
                    $companyAddress = '&nbsp;';
                }
                if($companyNIF == '' || $companyNIF == null){
                    $companyNIF = '&nbsp;';
                }

                $extraMargin = '';
                if(intval($companySelected) == 17){
                    $extraMargin = 'margin-top:8px!important;';
                }

                $text .= "<div class='pull-right' style='width:80%; text-align:right; margin-right: 5px!important;$extraMargin $limitInfoClient'>";
                $guion =  "";
                if(strlen($companyLocation) > 0 || $companyLocation != null){
                    $guion =  " - ";
                }
                $text .="
                    <p>" . $data['clientName'] . " " . $data['clientSurname'] . "<br>
                    $companyAddress<br>
                    $companyPostalCode$guion$companyLocation<br>
                    $companyNIF</p><br>
                    <p style='margin-top:-10px;'>" . $depMsg ."</p>
                ";
                
                $text .= " 
                        </div>
                    </div>
                    <div style='clear:both'>
                        $rectificatedLabel
                        <table class='tableContratos$tableContratosColor' style='font-size:10px; margin-top:-18px; text-align:center'>
                            <thead style='text-align:center'>
                                <tr>
                                    <td style='width: 52%'>
                                        <strong>DESCRIPCIÓN</strong>
                                    </td>
                                    <td style='width: 8%'>
                                        <strong>CANT</strong>
                                    </td>
                                    <td style='width: 10%'>
                                        <strong>PRECIO</strong>
                                    </td>
                                    <td style='width: 10%'>
                                        <strong>DT</strong>
                                    </td>
                                    <td style='width: 10%'>
                                        <strong>$ivaLabel</strong>
                                    </td>
                                    <td style='width: 10%'>
                                        <strong>IMPORTE</strong>
                                    </td>                        
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                ";

                // Store new page html
                $newPage = "
                    </tbody></table></div></div></div></div>
                    <pagebreak>
                    <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                        <div class='contenidoPompas'><div>
                            <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center'>
                                <thead style='text-align:center'>
                                    <tr>
                                        <td style='width: 52%'>
                                            <strong>DESCRIPCIÓN</strong>
                                        </td>
                                        <td style='width: 8%'>
                                            <strong>CANT</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>PRECIO</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>DT</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>$ivaLabel</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>IMPORTE</strong>
                                        </td>                        
                                    </tr>
                                </thead>
                                <tbody>
                ";

                // Draw new items for rectified types
                if($data['rectified_type'] != null && $data['rectified_type'] == '2'){
                    
                    // Contratacion
                    $facturaItems = array();

                    foreach($data['factura'] as $original){

                        // Checks if the product is checked in rectified hiring
                        $isTotalRectificated = searchInArray($data['facturaRectificada'], 'hiringID', $original['old_hiring']);
                        if($isTotalRectificated){

                            $filterBy = $original['old_hiring'];
                            $findElem = array_filter($data['facturaRectificada'], function ($var) use ($filterBy){
                                return ($var['hiringID'] == $filterBy);
                            });

                            $findElem = array_values($findElem);
                            if(count($findElem) > 0){
                                if($findElem[0]['texts'] == ''){
                                    if(
                                        $original['amount'] != $findElem[0]['amount'] ||
                                        $original['discount'] != $findElem[0]['discount'] ||
                                        $original['priceNoIVA'] != $findElem[0]['priceNoIVA']
                                    ){
                                        
                                        $originalAmountDif = ($original['amount'] - $findElem[0]['amount']) > 0 ? true : false;
                                        if($original['amount'] != $findElem[0]['amount']){
                                            $amount = abs($original['amount'] - $findElem[0]['amount']);
                                        }else{
                                            $amount = $original['amount'];
                                        }
                                        if($original['discount'] != $findElem[0]['discount']){
                                            $discount = $original['discount'] - $findElem[0]['discount'];
                                        }else{
                                            $discount = $original['discount'];
                                        }
                                        if($original['priceNoIVA'] != $findElem[0]['priceNoIVA']){
                                            $priceNoIVA = $original['priceNoIVA'] - $findElem[0]['priceNoIVA'];
                                        }else{
                                            $priceNoIVA = $original['priceNoIVA'];
                                        }

                                        $original['originalAmountDif'] = $originalAmountDif;
                                        $original['amount'] = $amount;
                                        $original['discount'] = $discount;
                                        $original['priceNoIVA'] = $priceNoIVA;
                                        array_push($facturaItems, $original);
                                    }
                                }else{

                                    $findElemOriginal = array_filter($data['factura'], function ($var) use ($filterBy){
                                        return ($var['old_hiring'] == $filterBy);
                                    });
                                    
                                    $findElemRectified = array_filter($facturaItems, function ($var) use ($filterBy){
                                        return ($var['old_hiring'] == $filterBy);
                                    });

                                    if(count($findElemRectified) == 0 ||
                                        (count($findElemRectified) != (count($findElemOriginal) - count($findElem[0]['texts'])))
                                    ){
                                        if(
                                            $original['amount'] != $findElem[0]['amount'] ||
                                            $original['discount'] != $findElem[0]['discount'] ||
                                            $original['priceNoIVA'] != $findElem[0]['priceNoIVA']
                                        ){
                                        
                                            $originalAmountDif = ($original['amount'] - $findElem[0]['amount']) > 0 ? true : false;
                                            if($original['amount'] != $findElem[0]['amount']){
                                                $amount = abs($original['amount'] - $findElem[0]['amount']);
                                            }else{
                                                $amount = $original['amount'];
                                            }
                                            if($original['discount'] != $findElem[0]['discount']){
                                                $discount = $original['discount'] - $findElem[0]['discount'];
                                            }else{
                                                $discount = $original['discount'];
                                            }
                                            if($original['priceNoIVA'] != $findElem[0]['priceNoIVA']){
                                                $priceNoIVA = $original['priceNoIVA'] - $findElem[0]['priceNoIVA'];
                                            }else{
                                                $priceNoIVA = $original['priceNoIVA'];
                                            }

                                            $original['originalAmountDif'] = $originalAmountDif;
                                            $original['amount'] = $amount;
                                            $original['discount'] = $discount;
                                            $original['priceNoIVA'] = $priceNoIVA;
                                            array_push($facturaItems, $original);
                                        }
                                    }
                                }
                            }
                        }else{
                            // If the product isnt checked in rectified hiring -> DRAW
                            array_push($facturaItems, $original);
                        }
                    }
                    $data['factura'] = $facturaItems;

                    // Suplidos
                    $suplidosItems = array();
                    foreach($data['suplidos'] as $original){

                        // Checks if the product is checked in rectified hiring
                        $isTotalRectificated = searchInArray($data['suplidosRectificada'], 'hiringID', $original['old_hiring']);

                        if($isTotalRectificated){

                            $filterBy = $original['old_hiring'];
                            $findElem = array_filter($data['suplidosRectificada'], function ($var) use ($filterBy){
                                return ($var['hiringID'] == $filterBy);
                            });

                            $findElem = array_values($findElem);
                            if(count($findElem) > 0){ // If the product hasnt texts, calculate diff amounts (original - rectified)
                                if($findElem[0]['texts'] == ''){
                                    if(
                                        $original['amount'] != $findElem[0]['amount'] ||
                                        $original['percentage'] != $findElem[0]['percentage'] ||
                                        $original['cost'] != $findElem[0]['cost']
                                    ){
                                        
                                        $originalAmountDif = ($original['amount'] - $findElem[0]['amount']) > 0 ? true : false;
                                        if($original['amount'] != $findElem[0]['amount']){
                                            $amount = abs($original['amount'] - $findElem[0]['amount']);
                                        }else{
                                            $amount = $original['amount'];
                                        }
                                        if($original['percentage'] != $findElem[0]['percentage']){
                                            $percentage = $original['percentage'] - $findElem[0]['percentage'];
                                        }else{
                                            $percentage = $original['percentage'];
                                        }
                                        if($original['cost'] != $findElem[0]['cost']){
                                            $cost = $original['cost'] - $findElem[0]['cost'];
                                        }else{
                                            $cost = $original['cost'];
                                        }

                                        $original['originalAmountDif'] = $originalAmountDif;
                                        $original['amount'] = $amount;
                                        $original['percentage'] = $percentage;
                                        $original['cost'] = $cost;
                                        array_push($suplidosItems, $original);
                                    }

                                }else{
                                    $findElemOriginal = array_filter($data['suplidos'], function ($var) use ($filterBy){
                                        return ($var['old_hiring'] == $filterBy);
                                    });
                                    
                                    $findElemRectified = array_filter($suplidosItems, function ($var) use ($filterBy){
                                        return ($var['old_hiring'] == $filterBy);
                                    });

                                   
                                    if(count($findElemRectified) == 0 ||
                                        (count($findElemRectified) != (count($findElemOriginal) - count($findElem[0]['texts'])))
                                    ) {

                                        if(
                                            $original['amount'] != $findElem[0]['amount'] ||
                                            $original['percentage'] != $findElem[0]['percentage'] ||
                                            $original['cost'] != $findElem[0]['cost']
                                        ){
                                            $originalAmountDif = ($original['amount'] - $findElem[0]['amount']) > 0 ? true : false;
                                            if($original['amount'] != $findElem[0]['amount']){
                                                $amount = abs($original['amount'] - $findElem[0]['amount']);
                                            }else{
                                                $amount = $original['amount'];
                                            }
                                            if($original['percentage'] != $findElem[0]['percentage']){
                                                $percentage = $original['percentage'] - $findElem[0]['percentage'];
                                            }else{
                                                $percentage = $original['percentage'];
                                            }
                                            if($original['cost'] != $findElem[0]['cost']){
                                                $cost = $original['cost'] - $findElem[0]['cost'];
                                            }else{
                                                $cost = $original['cost'];
                                            }

                                            $original['originalAmountDif'] = $originalAmountDif;
                                            $original['amount'] = $amount;
                                            $original['percentage'] = $percentage;
                                            $original['cost'] = $cost;
                                            array_push($suplidosItems, $original);
                                        }
                                    }
                                }
                            }
                        }else{
                            // If the product isnt checked in rectified hiring -> DRAW
                            array_push($suplidosItems, $original);
                        }
                    }
                    $data['suplidos'] = $suplidosItems;
                }

                $bruto = 0;
                $supplied = 0;
                $totalDiscount = 0;
                $subTotalDiscount = 0;
                $total = 0;
                $firstPage = true;
                $discountpercent = 0;
                $discountAmount  = 0;
                $discountValue = 0;
                $lines = $extraSeguroLines;
                $totalLines = $extraSeguroLines;
                $overflowTextLines = 0;

                if(isset($data['factura'])){
                    $previousProductID = 0;
                    $previousModelID = 0;
                    $contTexts = 0;
                    for($i = 0; $i < count($data['factura']); $i++) {
                        $productID = $data['factura'][$i]['productID'];
                        $modelID = $data['factura'][$i]['modelID'];
                        $productName = $data['factura'][$i]['productName'];
                        $modelName = "";
                        $priceNoIVA = $data['factura'][$i]['priceNoIVA']; //tarifa asociada al cliente
                        $particularPrice = $data['factura'][$i]['particularPrice']; //tarifa de particulares
                        $percentage = $data['factura'][$i]['percentage'];
                        $texts = $data['factura'][$i]['texts'];
                        
                        if($data['factura'][$i]['editPrice'] == 1){
                            if(is_array($texts)){
                                if(
                                    $previousProductID != $productID ||
                                    !isset($texts[$contTexts])
                                ){
                                    $contTexts = 0;
                                }

                                if(count($texts) == 1){
                                    if(intval($companySelected) == 6 || intval($companySelected) == 4 || intval($companySelected) == 19){
                                        if($texts[0]['value'] != ''){
                                            $modelName = $data['factura'][$i]['modelName'] . ' - ' . $texts[$contTexts]['value'];
                                        }else{
                                            $modelName = $data['factura'][$i]['modelName'];
                                        }
                                    }else{
                                        if($texts[0]['value'] != ''){
                                            $modelName = $texts[0]['value'];
                                        }else{
                                            $modelName = $data['factura'][$i]['modelName'];
                                        }
                                    }
                                }else{
                                    if(intval($companySelected) == 6 || intval($companySelected) == 4 || intval($companySelected) == 19){
                                        if($texts[$contTexts]['value'] != ''){
                                            $modelName = $data['factura'][$i]['modelName'] . ' - ' . $texts[$contTexts]['value'];
                                        }else{
                                            $modelName = $data['factura'][$i]['modelName'];
                                        }
                                    }else{
                                        $modelName = $texts[$contTexts]['value'];
                                    }
                                    $contTexts++;
                                }
                            }else{
                                $modelName = $data['factura'][$i]['modelName'];
                                $contTexts = 0;
                            }
                        }else{
                            $modelName = $data['factura'][$i]['modelName'];
                        }
                        
                        if($data['factura'][$i]['multipleDiscount'] == null){
                            $amount = $data['factura'][$i]['amount'];                                            
                        }else{
                            $amount = 1;
                        }

                        if($data['factura'][$i]['editPrice'] == '1'){
                            $priceNoIVA = $data['factura'][$i]['totalEditPrice'];
                        }

                        $discountAmountToShow = '-';
                        if($data['factura'][$i]['texts'] == 0){
                            $discount = $data['factura'][$i]['discount'];  
                            $subTotalDiscount = floatval($priceNoIVA) * floatval($discount) / 100;

                            $subtotalPrice = floatval($priceNoIVA) - floatval($subTotalDiscount);
                            if($data['rectified_type'] == '2'){
                                if($subtotalPrice < $priceNoIVA){
                                    $subtotalPrice = $subtotalPrice - floatval($priceNoIVA);
                                }else if($subtotalPrice > $priceNoIVA){
                                    $subtotalPrice = floatval($priceNoIVA) - $subtotalPrice;
                                }else if($subtotalPrice > 0 && isset($data['factura'][$i]['originalAmountDif']) && !$data['factura'][$i]['originalAmountDif']){
                                    $subtotalPrice *= -1; 
                                }
                            }
                            
                            if($data['factura'][$i]['editPrice'] == '1' || $data['rectified_type'] == '2'){
                                if($data['rectified_type'] == '2'){
                                    $discountAmount = floatval($priceNoIVA) - (floatval($priceNoIVA) - floatval($subTotalDiscount));
                                }else{
                                    $discountAmount = floatval($priceNoIVA) - floatval($subtotalPrice);
                                }
                            }else{
                                $discountAmount = floatval($particularPrice) - floatval($subtotalPrice);
                            }
                            if($discountAmount < 0){
                                $discountAmount = 0;
                                if($discount > 0){
                                    $discountAmountToShow = "$discount %";
                                }
                            }
                           
                            $subtotalPrice = floatval($subtotalPrice) * floatval($amount);                                        

                            if($data['factura'][$i]['editPrice'] == '1' || $data['rectified_type'] == '2'){
                                if(floatval($priceNoIVA) != 0.00){
                                    $discountpercent = floatval($discountAmount) * 100 / (floatval($priceNoIVA));                                           
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($priceNoIVA) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;                                           
                                }                             
                            }else{
                                if(floatval($particularPrice) != 0.00){
                                    $discountpercent = floatval($discountAmount) * 100 / (floatval($particularPrice));                                           
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($particularPrice) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;                                           
                                }                             
                            }
                        }else{
                            $discount = $data['factura'][$i]['multipleDiscount']; 
                            $subTotalDiscount = floatval($priceNoIVA) * floatval($discount) / 100 ;                                        
                            $subtotalPrice = floatval($priceNoIVA) - floatval($subTotalDiscount);
                            if($data['factura'][$i]['editPrice'] == '1' || $data['rectified_type'] == '2'){
                                $discountAmount = floatval($priceNoIVA) - floatval($subtotalPrice);     
                            }else{
                                $discountAmount = floatval($particularPrice) - floatval($subtotalPrice);     
                            }
                            if($discountAmount < 0){
                                $discountAmount = 0;
                                if($discount > 0){
                                    $discountAmountToShow = "$discount %";
                                }
                            }
                            
                            if($data['factura'][$i]['editPrice'] == '1' || $data['rectified_type'] == '2'){
                                if(floatval($priceNoIVA) != 0.00){                                      
                                    $discountpercent = floatval($discountAmount) * 100 / floatval($priceNoIVA);    
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($priceNoIVA) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;                                           
                                }
                            }else{
                                if(floatval($particularPrice) != 0.00){                                      
                                    $discountpercent = floatval($discountAmount) * 100 / floatval($particularPrice);    
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($particularPrice) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;                                           
                                }
                            }
                        }

                        if($data['rectified_type'] != '2'){
                            if($subtotalPrice < 0){
                                $totalDiscount += abs($subtotalPrice);
                            }else{
                                $totalDiscount = floatval($totalDiscount) + (floatval($discountAmount) * floatval($amount));
                            }
                        }
                        
                        if($discountpercent == 0 || $discountpercent < 0){
                            $discountValue = $discountAmountToShow;
                        }else{
                            $discountValue = number_format($discountpercent,2) . ' %';
                        }

                        if($priceNoIVA > $particularPrice){
                            $priceToShow = $priceNoIVA;
                        }else{
                            if($data['factura'][$i]['editPrice'] == '0'){
                                $priceToShow = $particularPrice; 
                            }else{
                                $priceToShow = $priceNoIVA;
                            }
                        }

                        if($previousProductID == $data['factura'][$i]['productID']){
                            $text .= "
                                <tr class='align-items-center'>
                                    <td style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$modelName."</td>
                                    <td>$amount</td>
                                    <td style='text-align:right'>".number_format($priceToShow,2)." €</td>
                                    <td>$discountValue</td>
                                    <td>".number_format($percentage,2)." %</td>
                                    <td style='text-align:right; background-color: #e5ebff important!;'>".number_format($subtotalPrice,2)." €</td>
                                </tr>
                            ";

                            if(strlen($modelName) > 60){
                                $overflowTextLines++;
                            }
                        }else{
                            $text .= "
                                <tr class='align-items-center'>
                                    <td style='text-align:left'><strong>$productName</strong> - $modelName</td>
                                    <td>$amount</td>
                                    <td style='text-align:right'>".number_format($priceToShow,2)." €</td>
                                    <td>$discountValue</td>
                                    <td>".number_format($percentage,2)." %</td>
                                    <td style='text-align:right; background-color: #e5ebff important!;'>".number_format($subtotalPrice,2)." €</td>
                                </tr>
                            ";

                            if(strlen("$productName - $modelName") > 60){
                                $overflowTextLines++;
                            }
                        }

                        $previousProductID = $data['factura'][$i]['productID'];
                        $previousModelID = $modelID;
                        $lines++;
                        $totalLines++;

                        // Comprobamos si es necesario añadir una página nueva tras introducir cada producto
                        if($firstPage){
                            if($companySelected == 17){
                                if($lines % 40 == 0 && $lines != 0){
                                    $text .= $newPage;
                                
                                    $firstPage = false;
                                    $lines = 0;
                                }
                            }else{
                                if(($lines % 42 == 0 || $lines % 43 == 0) && $lines != 0){
                                    $text .= $newPage;
                                
                                    $firstPage = false;
                                    $lines = 0;
                                }
                            }
                        }else{
                            $corte1 = 47;
                            $corte2 = 48;
                            $corte3 = 50;
                            $corte4 = 51;
                        
                            if(($lines == $corte1 || $lines == $corte2 || $lines == $corte3 || $lines == $corte4) && $lines != 0){
                                $text .= $newPage;

                                $lines = 0;
                            }
                        }
                    }
                }
                
                if(isset($data['suplidos']) && is_array($data['suplidos']) && count($data['suplidos']) > 0){
                    $text .= "<tr><td><strong>***** SUPLIDOS *****</strong></td><td></td><td></td><td></td><td></td><td style='background-color: #e5ebff important!;'></td></tr>";
                    $lines++;
                    $totalLines++;

                    $previousProductID = 0;
                    $previousModelID = 0;
                    $contTextsSuplidos = 0;
                    foreach($data['suplidos'] AS $index => $producto){
                        $productID = $producto['productID'];
                        $modelID = $producto['modelID'];
                        $description = "";
                        $price = $producto['cost'];
                        $texts = $producto['texts'];

                        if($producto['editPrice'] == 1){
                            if(is_array($texts)){
                                if(isset($texts[$contTextsSuplidos]['value'])){
                                    $description = $producto['productName'] . ' - ' . $texts[$contTextsSuplidos]['value'];
                                }else{
                                    $description = '';
                                }
                                $contTextsSuplidos++;
                                if($contTextsSuplidos == count($texts)){
                                    $contTextsSuplidos = 0;
                                }
                            }else{
                                $description = $producto['productName'] . ' - ' . $producto['modelName'];
                                $contTextsSuplidos = 0;
                            }
                        }else{
                            $description = $producto['productName'] . ' - ' . $producto['modelName'];
                        }

                        if($producto['multipleDiscount'] == null){
                            $amount = $producto['amount'];
                        }else{
                            $amount = 1;
                        }
                       
                        if($producto['texts'] == ''){
                            $discount = $producto['discount'];
                            $priceDiscount = floatval($price) * floatval($discount) / 100;
                            $subTotal = floatval($price) - floatval($priceDiscount);

                            if($data['rectified_type'] == '2'){
                                if($subTotal < $price){
                                    $subTotal = $subTotal - floatval($price);
                                }else if($subTotal > $price){
                                    $subTotal = floatval($price) - $subTotal;
                                }else if($subTotal > 0 && isset($producto['originalAmountDif']) && !$producto['originalAmountDif']){
                                    $subTotal *= -1;
                                }
                            }else{
                                $subTotal = floatval($subTotal) * floatval($amount);
                            }
                        }else{
                            $discount = $producto['multipleDiscount'];                                       
                            $priceDiscount = floatval($price) * floatval($discount) / 100;
                            $subTotal = floatval($price) - floatval($priceDiscount);

                            if($data['rectified_type'] == '2'){
                                if($subTotal < $price){
                                    $subTotal = $subTotal - floatval($price);
                                }else if($subTotal > $price){
                                    $subTotal = floatval($price) - $subTotal;
                                }else if($subTotal > 0 && isset($producto['originalAmountDif']) && !$producto['originalAmountDif']){
                                    $subTotal *= -1;
                                }
                            }else{
                                $subTotal = floatval($price) - floatval($priceDiscount);
                            }
                        }

                        if($data['rectified_type'] != '2'){
                            $totalDiscount = floatval($totalDiscount) + (floatval($priceDiscount)* floatval($amount));
                            if($subTotal < 0){
                                $totalDiscount += abs($subTotal);
                            }
                        }
                        
                        if($discount == 0 || $discount == 0.00){
                            $discount = '-';
                        }else{
                            $discount = number_format($discount, 2) . ' %';
                        }

                        $productID = $producto['productID'];
                        $modelID = $producto['modelID'];
                        $text .= "
                            <tr class='align-items-center'>
                                <td style='text-align:left'>$description</td>
                                <td>$amount</td>
                                <td style='text-align:right'>". number_format($price, 2) ." €</td>
                                <td>".$discount."</td>
                                <td>-</td>
                                <td style='text-align:right; background-color: #e5ebff important!;'>".number_format($subTotal,2)." €</td>
                            </tr>
                        ";
                        $previousProductID = $productID;
                        $previousModelID = $modelID;

                        if(strlen($description) > 60){
                            $overflowTextLines++;
                        }

                        $lines++;
                        $totalLines++;

                        // Comprobamos si es necesario añadir una página nueva tras introducir cada suplido
                        if($firstPage){
                            if(($lines % 42 == 0 || $lines % 43 == 0) && $lines != 0){
                                $text .= $newPage;
                            
                                $firstPage = false;
                                $lines = 0;
                            }
                        }else{
                            $corte1 = 47;
                            $corte2 = 48;
                            $corte3 = 50;
                            $corte4 = 51;
                        
                            if(($lines == $corte1 || $lines == $corte2 || $lines == $corte3 || $lines == $corte4) && $lines != 0){
                                $text .= $newPage;

                                $lines = 0;
                            }
                        }
                    }
                }

                // Seteamos el máximo de líneas por página (por compañia)
                if(!$firstPage){
                    $maxLines = 42;
                    if($companySelected == '1' || $companySelected == '3' || $companySelected == '4' || $companySelected == '15' || $companySelected == '23' || $companySelected == '29'){
                        $maxLines = 37;
                    }else if($companySelected == '5'){
                        if($logo == 1){
                            $maxLines = 37;
                        }else{
                            $maxLines = 33;
                        }
                    }elseif($companySelected == '2' || $companySelected == '7' || $companySelected == '17' || $companySelected == '25'){
                        $maxLines = 38;
                    }elseif($companySelected == '6' || $companySelected == '10' || $companySelected == '27' || $companySelected == '28'){
                        $maxLines = 46;
                    }elseif($companySelected == '23'){
                        $maxLines = 34;
                    }
                }else{
                    $maxLines = 41;
                    if($companySelected == '1' || $companySelected == '3' || $companySelected == '15' || $companySelected == '29'){
                        $maxLines = 38;
                    }else if($companySelected == '5'){
                        if($logo == 1){
                            $maxLines = 38;
                        }else{
                            $maxLines = 34;
                        }
                    }elseif($companySelected == '11' || $companySelected == '18' || $companySelected == '24' || $companySelected == '27' || $companySelected == '28'){
                        $maxLines = 39;
                    }elseif($companySelected == '17' || $companySelected == '25' ){
                        $maxLines = 36;
                    }elseif($companySelected == '23'){
                        $maxLines = 33;
                    }
                }

                $overflowTextLines = intval($overflowTextLines * 0.75);
                $lines += $overflowTextLines;
                $totalLines += $overflowTextLines;

                // Rellenamos la página con líneas en blanco
                if($lines > $maxLines){

                    if($companySelected == '2' || $companySelected == '7' || $companySelected == '11'){
                        $total = 46 - $totalLines;
                    }else if($companySelected == '5'){
                        if($logo == 1){
                            $total = 46 - $totalLines;
                        }else{
                            $total = 42 - $totalLines;
                        }
                    }else if($companySelected == '23' || $companySelected == '25' || $companySelected == '29'){
                        $total = 38 - $totalLines;
                    }else{
                        $total = 44 - $totalLines;
                    }
                   
                    for($i = 0; $i<$total; $i++){
                        $text .= "
                            <tr class='align-items-center'>
                                <td style='text-align:left'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right;background-color: #e5ebff important!;'>&nbsp;</td>
                            </tr>
                        ";
                    }
                    $text .= "
                        </tbody></table></div></div></div></div>
                        <pagebreak>
                        <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas'><div>
                                <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center;margin-top:5px;'>
                                    <thead style='text-align:center'>
                                        <tr>
                                            <td style='width: 52%'>
                                                <strong>DESCRIPCIÓN</strong>
                                            </td>
                                            <td style='width: 8%'>
                                                <strong>CANT</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>PRECIO</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>DT</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>$ivaLabel</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>IMPORTE</strong>
                                            </td>                        
                                        </tr>
                                    </thead>
                                    <tbody>
                    ";
                
                    if($companySelected == '2'){
                        $totalLines = 50;
                    }else if($companySelected == '7'){
                        $totalLines = 48;
                    } else if($companySelected == '5'){
                        if($logo == 1){
                            $totalLines = 48;
                        }else{
                            $totalLines = 44;
                        }
                    }else if($companySelected == '23' || $companySelected == '29'){
                        $totalLines = 42;
                    }else{
                        $totalLines = 46;
                    }
                    
                    $i = 8;
                    for($i; $i<=$totalLines; $i++){
                        $text .= "
                            <tr class='align-items-center'>
                                <td style='text-align:left'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right;background-color: #e5ebff important!;'>&nbsp;</td>
                            </tr>
                        ";
                    }
                }else{
                    $total = $maxLines - $lines;
                    for($i = 0; $i<$total; $i++){
                        $text .= "
                            <tr class='align-items-center'>
                                <td style='text-align:left'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right;background-color: #e5ebff important!;'>&nbsp;</td>
                            </tr>
                        ";
                    }
                }

                $text .= "
                            </tbody>
                        </table>
                    </div>
                ";

                $expAssociate = "";
                if(isset($data['associates']) && $data['associates'] != null && count($data['associates']) > 0){
                    foreach($data['associates'] as $exp){
                        $expAssociate .= "EXP: " . $exp['number'] . ", ";
                    }
                    $expAssociate = substr($expAssociate, 0, -2);
                }

                $text .= " 
                    <div style='margin-top:5px;margin-bottom:5px;'>
                        <div style='right: 520px; position: absolute; text-align: right;'>
                            Total descuento: ". number_format($totalDiscount,2) ." €
                        </div>
                        <div style='left: 20px; position: absolute; text-align: left; margin-top:-17px'>
                            $expAssociate
                        </div>
                    </div>
                ";

                // Invoice info
                $total = $data['invoiceInfo']['total'];
                $bruto = $data['invoiceInfo']['bruto'];
                $totalBases = $data['invoiceInfo']['totalBases'];
                $totalIva = $data['invoiceInfo']['totalIva'];
                $supplied = $data['invoiceInfo']['suplidos'];
                $listIvas = $data['invoiceInfo']['listIvas'];

                $text .= "
                        <div>
                            <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center; margin-top:15px;'>
                                <thead>
                                    <tr>
                                        <td>
                                            <strong>BRUTO</strong>
                                        </td>
                                        <td>
                                            <strong>SUPLIDOS</strong>
                                        </td>
                                        <td>
                                            <strong>BASE IMPONIBLE</strong>
                                        </td>
                                        <td>
                                            <strong>TIPO $ivaLabel</strong>
                                        </td>
                                        <td>
                                            <strong>$ivaLabel</strong>
                                        </td>
                                        <td>
                                            <strong>TOTAL</strong>
                                        </td>
                                    </tr>
                                </thead>
                                <tbody>
                ";

                if(count($listIvas) > 0){
                    foreach($listIvas as $index=>$item){
                        $text .= "<tr>";

                        if($index == 0){
                            $text .= "
                                <td rowspan='".count($listIvas)."'>" . $bruto . " €</td>
                                <td rowspan='".count($listIvas)."'>" . $supplied . " €</td>
                            ";
                        }

                        $text .= "
                            <td>" . $item['base'] . " €</td>
                            <td>" . number_format(floatval($item['type_iva']), 2) . " %</td>
                            <td>" . $item['iva']. " €</td>
                        ";

                        if($index == 0){
                            $text .= "<td style='background-color: #e5ebff important!;' rowspan='".count($listIvas)."'><strong>" . $total . " €</strong></td>";
                        }

                        $text .= "</tr>";
                    }
                }else{
                    $text .= "
                        <tr>
                            <td>" . $bruto . " €</td>
                            <td>" . $supplied . " €</td>
                            <td>0.00 €</td>
                            <td> - </td>
                            <td>0.00 €</td>
                            <td style='background-color: #e5ebff important!;'><strong>" . $total . " €</strong></td>
                        </tr>
                    ";
                }

                $text .= "
                                </tbody>
                            </table>
                        </div>
                ";

                if($isProformaParam == null){
                     $text .= "
                        <div style='margin-top:10px;'>
                            <table class='tablePdf$tablePdfColor text-center' style='font-size:10px'>
                                <tbody>
                                    <tr>
                                        <td>
                                            <p><strong>CONDICIONES DE PAGO</strong></p>
                                        </td>
                                        <td>
                                        <p><strong>NÚMERO DE CUENTA</strong></p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p><strong>" . $data['paymentMethod'] . "</strong></p>
                                        </td>
                                        <td>
                                            <p><strong>" . $data['accountNumber'] . "</strong></p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    ";

                    // Add comments
                    if($data['comments'] != null && $data['comments'] != ''){
                        $text .= "
                            <div style='margin-top:5px'>
                                Comentarios: " . $data['comments'] . "
                            </div>
                        ";
                    }
                }

                $text .= "
                    </div></div></div>
                ";

                return $text;
            break;

            case "facturado":
                $utils = new Utils();
                $ivaLabel = $utils->getIvaLabel();
                $data = $_POST['data'];
                $dataGeneral = $_POST['dataGeneral'];
                $n = 0;
                $baseImponible = 0;
                $facturacion = 0;
                $iva = 0;
                $cobrado = 0;
                $pendiente = 0;
                $margenBruto = 0;
                $dates = $_POST['dates'];
                $mortuaries = $_POST['mortuaries'];
                $text =  "
                    <div class='container $fuente'>
                        <div>
                            <p style='font-size:20px'><strong>Periodo de facturación:</strong></p>
                            <p style='padding-left:10%;font-size:15px'>" . $utils->fechaCastellano2(date('Y-m-d', $dates[0])) . "</p>
                            <p style='padding-left:10%;font-size:15px'>" . $utils->fechaCastellano2(date('Y-m-d', $dates[1])) . "</p>
                        </div>
                        <div>
                            <p style='font-size:20px'><strong>Facturación general</strong></p>
                        </div>
                        <div>
                            <table class='tablePdf$tablePdfColor'>
                                <tbody>
                                    <tr>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>DEFUNCIONES</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>Nº</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>BASE IMPONIBLE</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>FACTURACIÓN</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>$ivaLabel</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>COBRADO MES c/$ivaLabel</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>PDTE. COBRO</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>MARGEN BRUTO</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>% MEDIO MARGEN</strong></p></td>
                                    </tr>
                ";

                foreach ($dataGeneral as $key2 => $value) {
                    if($value[3] != null){
                        $n = $n + $value[2];
                        $baseImponible = $baseImponible + $value[3];
                        $facturacion = $facturacion + $value[4];
                        $iva = $iva + $value[5];
                        $cobrado = $cobrado + $value[6];
                        $pendiente = $pendiente + $value[7];
                        $margenBruto = $margenBruto + $value[8];
                        $text .="
                            <tr>
                                <td><p style='font-size:10px'>" . $value[1]. "</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . $value[2]. "</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . round(floatval($value[3]), 2) . " €</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . round($value[4], 2) . " €</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . round($value[5], 2) . " €</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . round($value[6], 2) . " €</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . round($value[7], 2) . " €</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . round($value[8], 2) . " €</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . round(($value[8] / $value[3]) * 100, 2) . " %</p></td>
                            </tr>
                        ";
                    }
                }
                $text .= "
                                <tr>
                                    <td style='text-align:center'><p style='font-size:10px'><strong>TOTAL</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:10px'><strong>" . round($n, 2) . "</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:10px'><strong>" . round($baseImponible, 2) . " €</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:10px'><strong>" . round($facturacion, 2) . " €</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:10px'><strong>" . round($iva, 2) . " €</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:10px'><strong>" . round($cobrado, 2) . " €</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:10px'><strong>" . round($pendiente, 2) . " €</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:10px'><strong>" . round($margenBruto, 2) . " €</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:10px'><strong></strong></p></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                ";

                foreach ($mortuaries as $key1 => $mortuary) {
                    $n = 0;
                    $baseImponible = 0;
                    $facturacion = 0;
                    $iva = 0;
                    $cobrado = 0;
                    $pendiente = 0;
                    $margenBruto = 0;
                    $text .="
                        <div>
                            <p style='font-size:20px'><strong>" . $mortuary['name'] . "</strong></p>
                        </div>
                        <div>
                            <table class='tablePdf$tablePdfColor'>
                                <tbody>
                                    <tr>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>DEFUNCIONES</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>Nº</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>BASE IMPONIBLE</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>FACTURACIÓN</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>$ivaLabel</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>COBRADO MES c/$ivaLabel</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>PDTE. COBRO</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>MARGEN BRUTO</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>% MEDIO MARGEN</strong></p></td>
                                    </tr>
                    ";

                    foreach ($data[$key1] as $key2 => $value) {
                        if($value[3] != null){
                            $n = $n + $value[2];
                            $baseImponible = $baseImponible + $value[3];
                            $facturacion = $facturacion + $value[4];
                            $iva = $iva + $value[5];
                            $cobrado = $cobrado + $value[6];
                            $pendiente = $pendiente + $value[7];
                            $margenBruto = $margenBruto + $value[8];
                            $text .="
                                <tr>
                                    <td><p style='font-size:10px'>" . $value[1]. "</p></td>
                                    <td style='text-align:center'><p style='font-size:10px'>" . $value[2]. "</p></td>
                                    <td style='text-align:center'><p style='font-size:10px'>" . round(floatval($value[3]), 2) . " €</p></td>
                                    <td style='text-align:center'><p style='font-size:10px'>" . round($value[4], 2) . " €</p></td>
                                    <td style='text-align:center'><p style='font-size:10px'>" . round($value[5], 2) . " €</p></td>
                                    <td style='text-align:center'><p style='font-size:10px'>" . round($value[6], 2) . " €</p></td>
                                    <td style='text-align:center'><p style='font-size:10px'>" . round($value[7], 2) . " €</p></td>
                                    <td style='text-align:center'><p style='font-size:10px'>" . round($value[8], 2) . " €</p></td>
                                    <td style='text-align:center'><p style='font-size:10px'>" . round(($value[8] / $value[3]) * 100, 2) . " %</p></td>
                                </tr>
                            ";
                        }
                    }
                    $text .= "
                                    <tr>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>TOTAL</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>" . round($n, 2) . "</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>" . round($baseImponible, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>" . round($facturacion, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>" . round($iva, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>" . round($cobrado, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>" . round($pendiente, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>" . round($margenBruto, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong></strong></p></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    ";
                }
                $text .="</div>";  

                return $text;
            break;
            
            case "facturadoCremaciones":
                $utils = new Utils();
                $ivaLabel = $utils->getIvaLabel();
                $data = $_POST['data'];
                $n = 0;
                $baseImponible = 0;
                $facturacion = 0;
                $iva = 0;
                $cobrado = 0;
                $pendiente = 0;
                $margenBruto = 0;
                $dates = $_POST['dates'];
                $text =  "
                    <div class='container $fuente'>
                        <div class='row'>
                            <p style='font-size:20px'><strong>Periodo de facturación de cremaciones:</strong></p>
                            <p style='padding-left:10%;font-size:15px'>" . $utils->fechaCastellano2(date('Y-m-d', $dates[0])) . "</p>
                            <p style='padding-left:10%;font-size:15px'>" . $utils->fechaCastellano2(date('Y-m-d', $dates[1])) . "</p>
                        </div>
                        <div class='row'>
                            <p style='font-size:20px'><strong>Facturación de cremaciones</strong></p>
                        </div>
                        <div class='row'>
                            <table class='tablePdf$tablePdfColor'>
                                <tbody>
                                    <tr>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>DEFUNCIONES</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>Nº</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>BASE IMPONIBLE</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>FACTURACIÓN</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>$ivaLabel</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>COBRADO MES c/$ivaLabel</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>PDTE. COBRO</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>MARGEN BRUTO</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>% MEDIO MARGEN</strong></p></td>
                                    </tr>
                ";

                foreach ($data as $key2 => $value) {
                    if($value[3] != null){
                        $n = $n + $value[2];
                        $baseImponible = $baseImponible + $value[3];
                        $facturacion = $facturacion + $value[4];
                        $iva = $iva + $value[5];
                        $cobrado = $cobrado + $value[6];
                        $pendiente = $pendiente + $value[7];
                        if($value[8] == 0){
                            $mediaMargen = 0;
                        }else{
                            $mediaMargen = ($value[8] / $value[3]) * 100;
                        }
                        
                        $text .="
                            <tr>
                                <td><p style='font-size:10px'>" . $value[1]. "</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . $value[2]. "</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . round(floatval($value[3]), 2) . " €</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . round($value[4], 2) . " €</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . round($value[5], 2) . " €</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . round($value[6], 2) . " €</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . round($value[7], 2) . " €</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . round($value[8], 2) . " €</p></td>
                                <td style='text-align:center'><p style='font-size:10px'>" . round($mediaMargen, 2) . " %</p></td>
                            </tr>
                        ";
                    }
                }
                $text .= "
                                    <tr>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>TOTAL</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>" . round($n, 2) . "</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>" . round($baseImponible, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>" . round($facturacion, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>" . round($iva, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>" . round($cobrado, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>" . round($pendiente, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong>" . round($margenBruto, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:10px'><strong></strong></p></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "facturadoComp":
                $utils = new Utils();
                $data1 = $_POST['data1'];
                $data2 = $_POST['data2'];
                $dataGeneral1 = $_POST['dataGeneral1'];
                $dataGeneral2 = $_POST['dataGeneral2'];
                $n1 = 0;
                $baseImponible1 = 0;
                $facturacion1 = 0;
                $iva1 = 0;
                $n2 = 0;
                $baseImponible2 = 0;
                $facturacion2 = 0;
                $iva2 = 0;
                $margen1 = 0;
                $margen2 = 0;
                $dates1 = $_POST['dates1'];
                $dates2 = $_POST['dates2'];
                $mortuaries = $_POST['mortuaries'];
                $text =  "
                    <div class='container $fuente'>
                        <div class='row'>
                            <p style='font-size:20px'><strong>1º Periodo de facturación:</strong></p>
                            <p style='padding-left:10%;font-size:15px'>" . $utils->fechaCastellano2(date('Y-m-d', $dates1[0])) . "</p>
                            <p style='padding-left:10%;font-size:15px'>" . $utils->fechaCastellano2(date('Y-m-d', $dates1[1])) . "</p>

                            <p style='font-size:20px'><strong>2º Periodo de facturación:</strong></p>
                            <p style='padding-left:10%;font-size:15px'>" . $utils->fechaCastellano2(date('Y-m-d', $dates2[0])) . "</p>
                            <p style='padding-left:10%;font-size:15px'>" . $utils->fechaCastellano2(date('Y-m-d', $dates2[1])) . "</p>
                        </div>
                        <div class='row'>
                            <p style='font-size:20px'><strong>Facturación general</strong></p>
                        </div>
                        <div class='row'>
                            <table class='tablePdf$tablePdfColor'>
                                <tbody>
                                    <tr>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>DEF.</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>1º Nº</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>2º Nº</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>%</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>1º BASE IMP.</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>2º BASE IMP.</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>%</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>1º MARGEN BRUTO.</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>2º MARGEN BRUTO.</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>%</strong></p></td>
                                    </tr>
                ";

                foreach ($dataGeneral1 as $key2 => $value) {
                    $n1 = $n1 + $value[2];
                    $baseImponible1 = $baseImponible1 + $value[3];

                    $n2 = $n2 + $dataGeneral2[$key2][2];
                    $baseImponible2 = $baseImponible2 + $dataGeneral2[$key2][3];
                    $margen1 = $margen1 + $value[8];
                    $margen2 = $margen2 + $dataGeneral2[$key2][8];
                    $text .="
                        <tr>
                            <td><p style='font-size:12px'>" . $value[1]. "</p></td>
                            <td style='text-align:center'><p style='font-size:12px'>" . $value[2]. "</p></td>
                            <td style='text-align:center'><p style='font-size:12px'>" . round($dataGeneral2[$key2][2], 2). "</p></td>
                            <td style='text-align:center'><p style='font-size:12px'>" . ($dataGeneral2[$key2][2] - $value[2])/ $value[2]. " %</p></td>
                            <td style='text-align:center'><p style='font-size:12px'>" . round($value[3], 2) . " €</p></td>
                            <td style='text-align:center'><p style='font-size:12px'>" . round($dataGeneral2[$key2][3], 2). " €</p></td>
                            <td style='text-align:center'><p style='font-size:12px'>" . ($dataGeneral2[$key2][3] - $value[3])/ $value[3]. " %</p></td>
                            <td style='text-align:center'><p style='font-size:12px'>" . round($value[8], 2). " €</p></td>
                            <td style='text-align:center'><p style='font-size:12px'>" . round($dataGeneral2[$key2][8], 2). " €</p></td>
                            <td style='text-align:center'><p style='font-size:12px'>" . round(($dataGeneral2[$key2][8] - $value[8])/$value[8], 2) . " %</p></td>
                        </tr>
                    ";
                }
                $text .= "
                                <tr>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>TOTAL</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>" . round($n1, 2) . "</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>" . round($n2, 2) . "</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong></strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>" . round($baseImponible1, 2) . " €</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>" . round($baseImponible2, 2) . " €</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong></strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>" . round($margen1, 2) . " €</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>" . round($margen2, 2) . " €</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong></strong></p></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                ";

                $n1 = 0;
                $baseImponible1 = 0;
                $facturacion1 = 0;
                $iva1 = 0;
                $n2 = 0;
                $baseImponible2 = 0;
                $facturacion2 = 0;
                $iva2 = 0;
                $margen1 = 0;
                $margen2 = 0;

                foreach ($mortuaries as $key1 => $mortuary) {
                    $text .= "
                        <div class='row'>
                            <p style='font-size:20px'><strong>" . $mortuary['name'] . "</strong></p>
                        </div>
                        <div class='row'>
                            <table class='tablePdf$tablePdfColor'>
                                <tbody>
                                    <tr>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>DEF.</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>1º Nº</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>2º Nº</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>%</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>1º BASE IMP.</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>2º BASE IMP.</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>%</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>1º MARGEN BRUTO.</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>2º MARGEN BRUTO.</strong></p></td>
                                    <td style='text-align:center'><p style='font-size:12px'><strong>%</strong></p></td>
                                    </tr>
                    ";

                    foreach ($data1[$key1] as $key2 => $value) {
                        $n1 = $n1 + $value[2];
                        $baseImponible1 = $baseImponible1 + $value[3];

                        $n2 = $n2 + $data1[$key1][$key2][2];
                        $baseImponible2 = $baseImponible2 + $data1[$key1][$key2][3];
                        $margen1 = $margen1 + $value[8];
                        $margen2 = $margen2 + $data1[$key1][$key2][8];

                        $text .="
                            <tr>
                                <td><p style='font-size:12px'>" . $value[1]. "</p></td>
                                <td style='text-align:center'><p style='font-size:12px'>" . $value[2]. "</p></td>
                                <td style='text-align:center'><p style='font-size:12px'>" . $data1[$key1][$key2][2]. "</p></td>
                                <td style='text-align:center'><p style='font-size:12px'>" . ($data1[$key1][$key2][2] - $value[2]) / $value[2]. " %</p></td>
                                <td style='text-align:center'><p style='font-size:12px'>" . round($value[3], 2) . " €</p></td>
                                <td style='text-align:center'><p style='font-size:12px'>" . round($data1[$key1][$key2][3], 2) . " €</p></td>
                                <td style='text-align:center'><p style='font-size:12px'>" . ($data1[$key1][$key2][3] - $value[3]) / $value[3]. " %</p></td>
                                <td style='text-align:center'><p style='font-size:12px'>" . round($value[8], 2). "</p></td>
                                <td style='text-align:center'><p style='font-size:12px'>" . round($data1[$key1][$key2][8], 2). "</p></td>
                                <td style='text-align:center'><p style='font-size:12px'>" . ($data1[$key1][$key2][8] - $value[8]) / $value[8]. " %</p></td>
                                </tr>
                        ";
                    }
                    $text .= "
                                    <tr>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>TOTAL</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>" . $n1 . "</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>" . $n2 . "</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong></strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>" . round($baseImponible1, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>" . round($baseImponible2, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong></strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>" . round($margen1, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong>" . round($margen2, 2) . " €</strong></p></td>
                                        <td style='text-align:center'><p style='font-size:12px'><strong></strong></p></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    ";
                }
                $text .="</div>";  

                return $text;
            break;
                
            case "facturaRecibida":
                $utils = new Utils();
                $ivaLabel = $utils->getIvaLabel();
                $invoice = getFacturaRecivida($expedient);
                $invoicesIvas = getReceivedInvoiceIvas($expedient);
                
                require_once($_SESSION['basePath'] . "model/expenses.php");
                $expenses = new Expenses();
                $deliveryMode =  $expenses->receivedInvoiceWasDelivery($expedient);

                if($invoice['date'] != null){
                    $invoice['date'] = date("j/n/Y", $invoice['date']);
                }else{
                    $invoice['date'] = "N/A";
                }
                if($invoice['paymentDate'] != null){
                    $invoice['paymentDate'] = date("j/n/Y", $invoice['paymentDate']);
                }else{
                    $invoice['paymentDate'] = "N/A";
                }
                if($invoice['dueDate'] != null){
                    $invoice['dueDate'] = date("j/n/Y", $invoice['dueDate']);
                }else{
                    $invoice['dueDate'] = "-";
                }
                if($invoice['paymentDueDate'] == null || floatval($invoice['paymentDueDate']) == 0){
                    $invoice['paymentDueDate'] = "-";
                }else{
                    $invoice['paymentDueDate'] = $invoice['paymentDueDate'] . ' €';
                }
                if($invoice['dueDate2'] != null){
                    $invoice['dueDate2'] = date("j/n/Y", $invoice['dueDate2']);
                }else{
                    $invoice['dueDate2'] = "-";
                }
                if($invoice['paymentDueDate2'] == null || floatval($invoice['paymentDueDate2']) == 0){
                    $invoice['paymentDueDate2'] = "-";
                }else{
                    $invoice['paymentDueDate2'] = $invoice['paymentDueDate2'] . ' €';
                }
                if($invoice['dueDate3'] != null){
                    $invoice['dueDate3'] = date("j/n/Y", $invoice['dueDate3']);
                }else{
                    $invoice['dueDate3'] = "-";
                }
                if($invoice['paymentDueDate3'] == null || floatval($invoice['paymentDueDate3']) == 0){
                    $invoice['paymentDueDate3'] = "-";
                }else{
                    $invoice['paymentDueDate3'] = $invoice['paymentDueDate3'] . ' €';
                }
                
                switch($invoice['paymentMethod']){
                    case "1":
                        $invoice['paymentMethod'] = "Contado";
                        $paymentMethod = "N/A";
                    break;
                    case "2":
                        $invoice['paymentMethod'] = "Transferencia bancaria";
                        $paymentMethod = "N/A";
                    break;
                    case "3":
                        $invoice['paymentMethod'] = "Cargo en cuenta";
                        $paymentMethod = $invoice['bankAccountOwner'];
                    break;
                    case "4":
                        $invoice['paymentMethod'] = "Tarjeta de crédito";
                        $paymentMethod = $invoice['creditCardOwner'];
                    break;
                    default:
                        $invoice['paymentMethod'] = "N/A";
                        $paymentMethod = "N/A";
                    break;
                }
                switch($invoice['cashOut']){
                    case "0":
                        $invoice['cashOut'] = "N/A";
                        $cashOut = "N/A";
                        $expense = "N/A";
                    break;
                    case "1":
                        $invoice['cashOut'] = "Gasto";
                        switch($invoice['expenseType']){
                            case "0":
                                $cashOut = "N/A";
                                $expense = "N/A";
                            break;
                            case "1":
                                $cashOut = "Fijo";
                                if($invoice['expenseFixedName'] == null){
                                    $expense = "N/A";
                                }else{
                                    $expense = $invoice['expenseFixedName'];
                                }
                            break;
                            case "2":
                                $cashOut = "Variable";
                                if($invoice['expenseVariableName'] == null){
                                    $expense = "N/A";
                                }else{
                                    $expense = $invoice['expenseVariableName'];
                                }
                            break;
                        }
                        
                    break;
                    case "2":
                        $invoice['cashOut'] = "Inversión";
                        $cashOut = "N/A";
                        $expense = "N/A";
                    break;
                    default:
                        $invoice['cashOut'] = "N/A";
                        $cashOut = "N/A";
                        $expense = "N/A";
                    break;
                }
                switch($invoice['expenseType']){
                    case "1":
                        $invoice['expenseType'] = "N/A";
                    break;
                    case "2":
                        $invoice['expenseType'] = "Fijo";
                    break;
                    case "3":
                        $invoice['expenseType'] = "Variable";
                    break;
                    default:
                        $invoice['expenseType'] = "N/A";
                    break;
                }

                if($deliveryMode == 1){
                    $items = $expenses->getItems($expedient);
                    $background = $utils->getBackgroundDocuments();

                    $text = "
                        <div class='fondo'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div class='contenidoPompas'>
                                    <div style='text-align:center'>
                                        <p><strong><u>FACTURA RECIBIDA</u></strong></p>
                                    </div>
                                    <br><br>
                                    <div>
                                        <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                            <tbody>
                                                <tr>
                                                    <td style='width:49%; text-align: center'><p><strong>FECHA</strong></p></td>
                                                    <td style='width:33%; text-align: center'><p><strong>FECHA PAGO</strong></p></td>
                                                    <td style='width:33%; text-align: center'><p><strong>FECHA VENCIMIENTO</strong></p></td>
                                                </tr>
                                                <tr>
                                                    <td style='text-align: center'><p>" . $invoice['date'] . "</p></td>
                                                    <td style='text-align: center'><p>" . $invoice['paymentDate'] . "</p></td>
                                                    <td style='text-align: center'><p>" . $invoice['dueDate'] . "</p></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <br><br>
                                    <div>
                                        <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                            <tbody>
                                                <tr>
                                                    <td style='width:80%; text-align: center'><p><strong>Expedidor</strong></p></td>
                                                    <td style='width:20%; text-align: center'><p><strong>NIF</strong></p></td>
                                                </tr>
                                                <tr>
                                                    <td style='text-align: center'><p>" . $invoice['supplierName'] . "</p></td>
                                                    <td style='text-align: center'><p>" . $invoice['supplierNif'] . "</p></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <br><br>
                                    <div>
                                        <strong>RESUMEN</strong>
                                            <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                            <tbody>
                                                <tr>
                                                    <td style='width:20%; text-align: center'><p><strong>PRODUCTO</strong></p></td>
                                                    <td style='width:20%; text-align: center'><p><strong>MODELO</strong></p></td>
                                                    <td style='width:10%; text-align: center'><p><strong>CANTIDAD</strong></p></td>
                                                    <td style='width:10%; text-align: center'><p><strong>PRECIO</strong></p></td>
                                                    <td style='width:20%; text-align: center'><p><strong>BASE IMPONIBLE</strong></p></td>
                                                    <td style='width:10%; text-align: center'><p><strong>DESCUENTO</strong></p></td>
                                                    <td style='width:10%; text-align: center'><p><strong>$ivaLabel</strong></p></td>
                                                    <td style='width:20%; text-align: center'><p><strong>SUBTOTAL</strong></p></td>
                                                </tr>
                    ";

                    $total = 0;
                    $baseImponible = 0;
                    $cantidad = 0;
                    foreach($items as $item){
                        $baseImponibleProducto = (floatval($item["price"]) * (100 - floatval($item["discount"]))/100) * intval($item['amount']);
                        $baseImponible += $baseImponibleProducto;
                        $cantidad += intval($item['amount']);
                        $totalProducto = $baseImponibleProducto + ($baseImponibleProducto  * floatval($item["iva"])/100);
                        $total += $totalProducto;

                        if($item['discount'] == '0.000'){
                            $item['discount'] = '-';
                        }else{
                            $item['discount'] = $item['discount'] . ' %';
                        }

                        $text .= "
                            <tr>
                                <td style='text-align: center'><p>" . $item['productName'] . "</p></td>
                                <td style='text-align: center'><p>" . $item['modelName'] . "</p></td>
                                <td style='text-align: center'><p>" . $item['amount'] . " </p></td>
                                <td style='text-align: center'><p>" . $item['price'] . " €</p></td>
                                <td style='text-align: center'><p>" . round($baseImponibleProducto,2) . " €</p></td>
                                <td style='text-align: center'><p>" . $item['discount'] . "</p></td>
                                <td style='text-align: center'><p>" . $item['iva'] . " %</p></td>
                                <td style='text-align: center'><p>" . round($totalProducto, 2) . " €</p></td>
                            </tr> 
                        ";
                    }
                    $text .= "
                                </tbody>
                            </table> 
                        </div>
                        <div>
                            <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                <tbody>
                                    <tr>
                                        <td style='width:100%; text-align: right'><p><strong>TOTAL</strong></p></td>
                                        <td style='width:19.5%; text-align: center'><p>" . round($total, 2) . " €</p></td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    ";
                                
                    $text .= "
                                    <br><br>
                                    <div>
                                        <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                            <tbody>
                                                <tr> ";
                                                if($invoice['bankAccountOwner'] !== null){
                                                    $text .= "<td style='width:25%; text-align: center'><p><strong>FORMA DE PAGO</strong></p></td>
                                                                <td style='width:25%; text-align: center'><p><strong>CUENTA BANCARIA</strong></p></td>
                                                            <td style='width:25%; text-align: center'><p><strong>CENTRO DE COSTE</strong></p></td>
                                                        </tr>
                                                        <tr>
                                                            <td style='text-align: center'><p>" . $invoice['paymentMethod'] . "</p></td>
                                                            <td style='text-align: center'><p>" . $invoice['bankAccountOwner'] . "</p></td>";
                                                } else if($invoice['creditCardOwner'] !== null){
                                                    $text .= "  <td style='width:25%; text-align: center'><p><strong>FORMA DE PAGO</strong></p></td>
                                                                <td style='width:25%; text-align: center'><p><strong>TARJETA DE CRÉDITO</strong></p></td>
                                                            <td style='width:25%; text-align: center'><p><strong>CENTRO DE COSTE</strong></p></td>
                                                        </tr>
                                                        <tr>
                                                            <td style='text-align: center'><p>" . $invoice['paymentMethod'] . "</p></td>
                                                            <td style='text-align: center'><p>" . $invoice['creditCardOwner'] . "</p></td>";
                                                }else{
                                                        $text .= "<td style='width:25%; text-align: center'><p><strong>FORMA DE PAGO</strong></p></td>
                                                                    <td style='width:25%; text-align: center'><p><strong>CENTRO DE COSTE</strong></p></td>
                                                                </tr>
                                                                <tr>
                                                                <td style='text-align: center'><p>" . $invoice['paymentMethod'] . "</p></td>";
                                                }
                                                        $text .= "<td style='text-align: center'><p>" . $invoice['costCenterName'] . "</p></td>
                                                    </tr>    
                                            </tbody>
                                        </table>
                                    </div>
                                    <br><br>
                                    <div>
                                        <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                            <tbody>
                                                <tr>
                                                    <td style='width:20%; text-align: center'><p><strong>COMENTARIOS </strong></p></td>
                                                    <td style='width:80%; text-align: left'><p> " . $invoice['comments'] . "</p></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";

                    return $text;
                }else if($deliveryMode == 2){
                    $items = $expenses->getItemsGasoil($expedient);
                    $background = $utils->getBackgroundDocuments();
                    $items =  $items[0];
                    $text = "
                        <div class='fondo'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div class='contenidoPompas'>
                                    <div style='text-align:center'>
                                        <p><strong><u>FACTURA RECIBIDA</u></strong></p>
                                    </div>
                                    <br><br>
                                    <div>
                                        <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                            <tbody>
                                                <tr>
                                                    <td style='width:33%; text-align: center'><p><strong>FECHA</strong></p></td>
                                                    <td style='width:33%; text-align: center'><p><strong>FECHA PAGO</strong></p></td>
                                                    <td style='width:33%; text-align: center'><p><strong>FECHA VENCIMIENTO</strong></p></td>
                                                </tr>
                                                <tr>
                                                    <td style='text-align: center'><p>" . $invoice['date'] . "</p></td>
                                                    <td style='text-align: center'><p>" . $invoice['paymentDate'] . "</p></td>
                                                    <td style='text-align: center'><p>" . $invoice['dueDate'] . "</p></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <br><br>
                                    <div>
                                        <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                            <tbody>
                                                <tr>
                                                    <td style='width:80%; text-align: center'><p><strong>Expedidor</strong></p></td>
                                                    <td style='width:20%; text-align: center'><p><strong>NIF</strong></p></td>
                                                </tr>
                                                <tr>
                                                    <td style='text-align: center'><p>" . $invoice['supplierName'] . "</p></td>
                                                    <td style='text-align: center'><p>" . $invoice['supplierNif'] . "</p></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <br><br>
                                    <div>
                                        <strong>RESUMEN GASOIL</strong>
                                        <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                            <tbody>
                                                <tr>
                                                    <td style='width:20%; text-align: center'><p><strong>LITROS</strong></p></td>
                                                    <td style='width:20%; text-align: center'><p><strong>PRECIO/LITRO</strong></p></td>
                                                    <td style='width:20%; text-align: center'><p><strong>BASE IMPONIBLE</strong></p></td>
                                                    <td style='width:20%; text-align: center'><p><strong>$ivaLabel</strong></p></td>
                                                    <td style='width:20%; text-align: center'><p><strong>TOTAL</strong></p></td>
                                                </tr>
                                                <tr>
                                                    <td style='text-align: center'><p>" . $items['litresReceived'] . " l</p></td>
                                                    <td style='text-align: center'><p>" . $items['priceLiter'] . " €</p></td>
                                                    <td style='text-align: center'><p>" . $items['net'] . " €</p></td>
                                                    <td style='text-align: center'><p>" . $items['ivaName'] . "</p></td>
                                                    <td style='text-align: center'><p>" . $items['total'] . " €</p></td>
                                                </tr> 
                                            </tbody>
                                        </table> 
                                    </div>
                                    <br><br>
                                    <div>
                                        <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                        <tbody>
                                            <tr>
                    ";

                    if($invoice['bankAccountOwner'] !== null){
                        $text .= "
                                <td style='width:25%; text-align: center'><p><strong>FORMA DE PAGO</strong></p></td>
                                <td style='width:25%; text-align: center'><p><strong>CUENTA BANCARIA</strong></p></td>
                                <td style='width:25%; text-align: center'><p><strong>CENTRO DE COSTE</strong></p></td>
                            </tr>
                            <tr>
                                <td style='text-align: center'><p>" . $invoice['paymentMethod'] . "</p></td>
                                <td style='text-align: center'><p>" . $invoice['bankAccountOwner'] . "</p></td>
                        ";
                    } else if($invoice['creditCardOwner'] !== null){
                        $text .= "  
                                <td style='width:25%; text-align: center'><p><strong>FORMA DE PAGO</strong></p></td>
                                <td style='width:25%; text-align: center'><p><strong>TARJETA DE CRÉDITO</strong></p></td>
                                <td style='width:25%; text-align: center'><p><strong>CENTRO DE COSTE</strong></p></td>
                            </tr>
                            <tr>
                                <td style='text-align: center'><p>" . $invoice['paymentMethod'] . "</p></td>
                                <td style='text-align: center'><p>" . $invoice['creditCardOwner'] . "</p></td>
                        ";
                    }else{
                            $text .= "
                                    <td style='width:25%; text-align: center'><p><strong>FORMA DE PAGO</strong></p></td>
                                    <td style='width:25%; text-align: center'><p><strong>CENTRO DE COSTE</strong></p></td>
                                </tr>
                                <tr>
                                    <td style='text-align: center'><p>" . $invoice['paymentMethod'] . "</p></td>
                            ";
                    }
                        $text .= "
                                                            <td style='text-align: center'><p>" . $invoice['costCenterName'] . "</p></td>
                                                        </tr>    
                                                </tbody>
                                            </table>
                                        </div>
                                        <br><br>
                                        <div>
                                            <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                                <tbody>
                                                    <tr>
                                                        <td style='width:20%; text-align: center'><p><strong>COMENTARIOS </strong></p></td>
                                                        <td style='width:80%; text-align: left'><p> " . $invoice['comments'] . "</p></td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>s
                            </div>
                        ";

                    return $text;
                }else{
                
                    $background = $utils->getBackgroundDocuments();
                    $text = "
                        <div class='fondo'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div class='contenidoPompas'>
                                    <div style='text-align:center'>
                                        <p><strong><u>FACTURA RECIBIDA</u></strong></p>
                                    </div>
                                    <br><br>
                                    <div>
                                        <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                            <tbody>
                                                <tr>
                                                    <td style='width:20%; text-align: center'><p><strong>FECHA</strong></p></td>
                                                    <td style='width:20%; text-align: center'><p><strong>FECHA PAGO</strong></p></td>
                                                    <td style='width:20%; text-align: center'><p><strong>FECHA VENCIMIENTO 30 DÍAS</strong></p></td>
                                                    <td style='width:20%; text-align: center'><p><strong>FECHA VENCIMIENTO 60 DÍAS</strong></p></td>
                                                    <td style='width:20%; text-align: center'><p><strong>FECHA VENCIMIENTO 90 DÍAS</strong></p></td>
                                                </tr>
                                                <tr>
                                                    <td style='text-align: center'><p>" . $invoice['date'] . "</p></td>
                                                    <td style='text-align: center'><p>" . $invoice['paymentDate'] . "</p></td>
                                                    <td style='text-align: center'><p>" . $invoice['dueDate'] . "</p></td>
                                                    <td style='text-align: center'><p>" . $invoice['dueDate2'] . "</p></td>
                                                    <td style='text-align: center'><p>" . $invoice['dueDate3'] . "</p></td>
                                                </tr>
                                                <tr>
                                                    <td style='text-align: center'></td>
                                                    <td style='text-align: center'></td>
                                                    <td style='text-align: center'><p>" . $invoice['paymentDueDate'] . " </p></td>
                                                    <td style='text-align: center'><p>" . $invoice['paymentDueDate2'] . " </p></td>
                                                    <td style='text-align: center'><p>" . $invoice['paymentDueDate3'] . " </p></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <br><br>
                                    <div>
                                        <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                            <tbody>
                                                <tr>
                                                    <td style='width:80%; text-align: center'><p><strong>Expedidor</strong></p></td>
                                                    <td style='width:20%; text-align: center'><p><strong>NIF</strong></p></td>
                                                </tr>
                                                <tr>
                                                    <td style='text-align: center'><p>" . $invoice['supplierName'] . "</p></td>
                                                    <td style='text-align: center'><p>" . $invoice['supplierNif'] . "</p></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <br><br>
                                    <div>
                                        <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                            <tbody>
                    ";

                    if(count($invoicesIvas) > 0){
                        $text .= " 
                            <tr>
                                <td style='width:20%; text-align: center'><p><strong>BASE IMPONIBLE</strong></p></td>
                                <td style='width:20%; text-align: center'><p><strong>CUOTA DE $ivaLabel</strong></p></td>
                                <td style='width:20%; text-align: center'><p><strong>TOTAL $ivaLabel</strong></p></td>
                            </tr>
                        ";
                        foreach($invoicesIvas as $itIv){
                            $text .= "
                                <tr>
                                    <td style='text-align: center'><p>".number_format($itIv['base'], 2)." €</p></td>
                                    <td style='text-align: center'><p>".number_format($itIv['typeIva'], 2)." %</p></td>
                                    <td style='text-align: center'><p>".number_format($itIv['iva'], 2)." €</p></td>
                                </tr>
                            ";
                        }
                    }else{
                        $text .= " 
                            <tr>
                                <td style='width:20%; text-align: center'><p><strong>BASE IMPONIBLE</strong></p></td>
                                <td style='width:20%; text-align: center'><p><strong>CUOTA DE $ivaLabel</strong></p></td>
                                <td style='width:20%; text-align: center'><p><strong>TOTAL $ivaLabel</strong></p></td>
                            </tr>
                            <tr>
                                <td style='text-align: center'><p>0.00 €</p></td>
                                <td style='text-align: center'><p>0.00 %</p></td>
                                <td style='text-align: center'><p>0.00 €</p></td>
                            </tr>
                        ";
                    }

                    $text .= "          
                                        </tbody>
                                    </table>
                                </div>
                                <br><br>
                                <div>
                                    <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                        <tbody>
                                            <tr>
                                                <td style='width:20%; text-align: center'><p><strong>RETENCIÓN</strong></p></td>
                                                <td style='width:20%; text-align: center'><p><strong>SUPLIDO</strong></p></td>
                                                <td style='width:20%; text-align: center'><p><strong>TOTAL</strong></p></td>
                                            </tr>
                                            <tr>
                                                <td style='text-align: center'><p>" . $invoice['withholding'] . " %</p></td>
                                                <td style='text-align: center'><p>" . $invoice['supplied'] . " €</p></td>
                                                <td style='text-align: center'><p><strong>" . $invoice['total'] . " €</strong></p></td>
                                            </tr>
                    
                                        </tbody>
                                    </table>
                                </div>
                                <br><br>
                                <div>
                                    <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                        <tbody>
                                            <tr>
                                                <td style='width:25%; text-align: center'><p><strong>FORMA DE PAGO</strong></p></td>
                                                <td style='width:25%; text-align: center'><p><strong>TIPO DE SALIDA</strong></p></td>
                                                <td style='width:25%; text-align: center'><p><strong>TIPO DE GASTO</strong></p></td>
                                                <td style='width:25%; text-align: center'><p><strong>CENTRO DE COSTE</strong></p></td>
                                            </tr>
                    ";
                    if(isset($cashOut) && $cashOut != null){
                        $text .= " 
                            <tr>
                                <td style='text-align: center'><p>" . $invoice['paymentMethod'] . "</p></td>
                                <td style='text-align: center'><p>" . $invoice['cashOut'] . "</p></td>
                                <td style='text-align: center'><p>" . $cashOut . "</p></td>
                                <td style='text-align: center'><p>" . $invoice['costCenterName'] . "</p></td>
                            </tr>
                        ";
                    }else{
                        $text .= " 
                            <tr>
                                <td style='text-align: center'><p>" . $invoice['paymentMethod'] . "</p></td>
                                <td style='text-align: center'><p>" . $invoice['cashOut'] . "</p></td>
                                <td style='text-align: center'><p></p></td>
                                <td style='text-align: center'><p>" . $invoice['costCenterName'] . "</p></td>
                            </tr>
                        ";
                    }
                    $text .= "   
                                            </tbody>
                                        </table>
                                    </div>
                                    <br><br>
                                    <div>
                                        <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                            <tbody>
                                                <tr>
                                                    <td style='width:20%; text-align: center'><p><strong>CONCEPTO </strong></p></td>
                                                    <td style='width:80%; text-align: left'><p> " . $invoice['concept'] . "</p></td>
                                                </tr>
                                                <tr>
                                                    <td style='width:20%; text-align: center'><p><strong>COMENTARIOS </strong></p></td>
                                                    <td style='width:80%; text-align: left'><p> " . $invoice['comments'] . "</p></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";

                    return $text;
                }

            break;

            case "financiacion":
                $utils = new Utils();
                $background = $utils->getBackgroundDocuments();
                $data = getFinanciacion($expedient);
                $financing = $data[0];
                $cuotes = $data[1];
                $text = "
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas'>
                                <div class='titulo text-center' style='text-align: center;'>
                                    <p><u><strong>FINANCIACIÓN - " . $financing['name'] . "</strong></u></p>
                                </div>
                                <br><br>
                                <div>
                                    <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align: center;'><p><strong>DESTINO</strong></p></td>
                                                <td style='text-align: center;'><p><strong>ENTIDAD PRESTADORA</strong></p></td>
                                                <td style='text-align: center;'><p><strong>CAPITAL AMORTIZADO</strong></p></td>
                                                <td style='text-align: center;'><p><strong>TIPO</strong></p></td>
                                                <td style='text-align: center;'><p><strong>CAPITAL INICIAL</strong></p></td>
                                                <td style='text-align: center;'><p><strong>CAPITAL PENDIENTE</strong></p></td>
                                            </tr>
                                            <tr>
                                                <td style='text-align: center;'><p>" . $financing['fdName'] . "</p></td>
                                                <td style='text-align: center;'><p>" . $financing['providerEntity'] . "</p></td>
                                                <td style='text-align: center;'><p>" . $financing['amortizedCapital'] . "</p></td>
                                                <td style='text-align: center;'><p>" . $financing['type'] . "</p></td>
                                                <td style='text-align: center;'><p>" . $financing['initialCapital'] . "</p></td>
                                                <td style='text-align: center;'><p>" . $financing['pendingCapital'] . "</p></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <br><br>
                                <div class='titulo text-center' style='text-align: center;'>
                                    <p><u><strong>CUOTAS</strong></u></p>
                                </div>
                                <br><br>
                                <div>
                                    <table style='font-size:10px' class='tablePdf$tablePdfColor' width='100%'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align: center;'><p><strong>CUOTA</strong></p></td>
                                                <td style='text-align: center;'><p><strong>INICIO</strong></p></td>
                                                <td style='text-align: center;'><p><strong>FIN</strong></p></td>
                                                <td style='text-align: center;'><p><strong>PAGO</strong></p></td>
                                                <td style='text-align: center;'><p><strong>INTERÉS</strong></p></td>
                                                <td style='text-align: center;'><p><strong>AMORTIZACIÓN</strong></p></td>
                                                <td style='text-align: center;'><p><strong>PENDIENTE</strong></p></td>
                                                <td style='text-align: center;'><p><strong>FECHA DE PAGO</strong></p></td>
                                            </tr>
                ";

                foreach($cuotes AS $key => $cuote){
                    $cuote['startDate'] = date("j/n/Y", $cuote['startDate']);
                    $cuote['endDate'] = date("j/n/Y", $cuote['endDate']);
                    if($cuote['payDate'] != null){
                        $cuote['payDate'] = date("j/n/Y", $cuote['payDate']);
                    }
                    $text .= "
                        <tr>
                            <td style='text-align: center;'><p>" . $key . "</p></td>
                            <td style='text-align: center;'><p>" . $cuote['startDate'] . "</p></td>
                            <td style='text-align: center;'><p>" . $cuote['endDate'] . "</p></td>
                            <td style='text-align: center;'><p>" . round($cuote['cuote'], 2) . " €</p></td>
                            <td style='text-align: center;'><p>" . round($cuote['interest'], 2) . " €</p></td>
                            <td style='text-align: center;'><p>" . round($cuote['amortization'], 2) . " €</p></td>
                            <td style='text-align: center;'><p>" . round($cuote['pendingCapital'], 2) . " €</p></td>
                            <td style='text-align: center;'><p>" . $cuote['payDate'] . "</p></td>
                        </tr>
                    ";
                }
                $text .= "          
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "incTanatorioBoisaca":
                $utils = new Utils();
                $data = getIncTanatorioBoisaca($expedient);
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                }
                $background = $utils->getBackgroundDocuments();

                if($data["expedientDL"] == '0'){
                    $deceasedLocation = $data["otherDeceasedLocation"];
                }else{
                    $deceasedLocation = $data["deceasedLocation"];
                }
                return "
                    <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'><div class='contenidoPompas'>
                        &nbsp; 
                        <div>
                            <p><strong>D/D&ntilde;a. (nombre completo)</strong>,</p>
                        </div>
                        &nbsp; 
                        <div>
                            <p>con D.N.I. n&ordm; <strong>(dni)</strong>,</p>
                        </div>
                        &nbsp; 
                        <div>
                            <p>en calidad de <strong>D/D&ntilde;a. (nombre completo)</strong>,</p>
                        </div>
                        &nbsp; 
                        <div>
                            <p>con D.N.I. n&ordm; <strong>(dni)</strong></p>
                        </div>                                            
                        &nbsp;&nbsp;
                        <div style='text-align:center'><strong>SOLICITA DE TANATORIO BOISACA:</strong></div>                
                        &nbsp;                
                        <div>La incineraci&oacute;n de los restos mortales de:</div>                
                        &nbsp;                
                        <div><strong>" . $gender . " " . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</strong> (Q.E.P.D.)</div>                
                        &nbsp;                
                        <div>Fallecido el " . $utils->fechaCastellano2(date('Y-m-d', strtotime($data['deceasedDate']))) . "</div>                
                        &nbsp;                
                        <div>en " . $deceasedLocation . ".</div>                
                        &nbsp;                
                        <div>Y para que conste a los efectos oportunos, firmo la presente en</div>                
                        &nbsp;             
                        <div>Vilagarc&iacute;a, a " . $utils->fechaCastellano2(date('Y')) . ".</div>
                        <br><br><br><br>
                        <div style='font-size: 14px; text-align: right;'><p>Fdo.: ______________________</p></div>
                        <br><br><br><br><br>
                    </div>";
            break;
            
            case "incVigoMemorial":
                $utils = new Utils();
                $data = getIncVigoMemorial($expedient);

                $background = $utils->getBackgroundDocuments();
                $img = $utils->getRoute() . "core/libraries/pdfs/images/vigomemorial.jpg";
                $marcaPasosSI = "";
                $marcaPasosNO = "X";
                if($data['crematoriumIntroduction'] == '1'){
                    $marcaPasosSI = "X";
                    $marcaPasosNO = "";
                }

                $assistSI = "";
                $assistNO = "X";
                $date = "";
                $time = "";
                if($data['start'] != ''){
                    $assistSI = "X";
                    $assistNO = "";
                    $date = date("j/n/Y", strtotime($data['start']));
                    $time = date("H:i", strtotime($data['crematoriumArriveTime']));
                }

                $dateEnd = "";
                $timeEnd = "";
                if($data['end'] != ''){
                    $dateEnd = date("j/n/Y", strtotime($data['end']));
                    $timeEnd = date("H:i", strtotime($data['end']));
                }

                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                    
                }else{
                    $gender = "D.";
                }
                $deceased = $gender . " " . $data['deceasedName'] . " " . $data['deceasedSurname'];

                return  "
                    <div class='fondo'>
                        <div class='$fuente folioPompas'>
                            <div class='contenidoPompas' style='font-size: 14px; border: solid 1px black; text-align: justify; line-height: 25px;'>
                                <p><strogn>D./Dña.</strong> _______________________________________________________________________________ vecino/a de
                                _______________________, con domicilio en ______________________________________________, y provisto
                                de N.I.F nº ___________________________, por medio de la presente.</p>
                                <br>
                                <p style='text-align: center;'><strong>SOLICITO:</strong></p>
                                <p>La incineración del cadáver de " . $deceased . " (Q.E.P.D.) en</p>
                            </div>
                        </div>
                    </div>
                ";
            break;
            
            case "justificanteSepelio":
                $settings = new Settings;
                $company = $settings->getCompanyName();
                $companyAddress = $settings->getCompanyAddress();
                $companyNIF = $settings->getCompanyNIF();
                $companyPostalCode = $settings->getCompanyPostalCode();

                $companyLocation = $settings->getCompanyLocation();
                $substringLocation = str_replace(")","",$companyLocation);
                $substringLocation = str_replace(" ("," - ",$substringLocation);
                $substringLocation = explode(" - ",$substringLocation);

                $substringLocationP1 = '';
                if(isset($substringLocation[0])){
                    $substringLocationP1 = $companyPostalCode . " - ".$substringLocation[0];
                }else{
                    $substringLocationP1 = $companyPostalCode;
                }

                $substringLocationP2 = '';
                if(isset($substringLocation[1])){
                    $substringLocationP2 = $substringLocation[1];
                }

                $utils = new Utils();
                $data = getJustificanteSepelio($expedient);
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                }

                if($data['deceasedName'] != ""){
                    $deceased = $data['deceasedName'] . " " . $data['deceasedSurname'];
                }else{
                    $deceased = "__________________";
                }
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                }

                if($data['mortuary'] != ""){
                    $mortuaryName = $data['mortuary'];
                }else{
                    $mortuaryName = "__________________";
                }
                if($data['mortuaryLocation'] != ""){
                    $mortuaryLocation = $data['mortuaryLocation'];
                }else{
                    $mortuaryLocation = "__________________";
                }
                if($data['funeralHomeEntryDate'] != ""){
                    $startDate = date('d/m/Y', strtotime($data['funeralHomeEntryDate']));
                }else{
                    $startDate = "__________________";
                }
                if($data['funeralDate'] != ""){
                    $endDate = date('d/m/Y', strtotime($data['funeralDate']));
                }else{
                    $endDate = "__________________";
                }
                if($data['funeralTime'] != ""){
                    $endTime = date('H:i', strtotime($data['funeralTime']));
                }else{
                    $endTime = "__________________";
                }

                $background = $utils->getBackgroundDocuments();

                require_once($_SESSION['basePath'] . "model/users.php");
                $users = new Users;
                $userInfo = $users->getDataUserSession();

                if($userInfo[0]['userData'] != null && $userInfo[0]['userData'] != ''){
                    $userName = trim($userInfo[0]['userData']);
                }else{
                    $userName = "__________________";
                }

                if($userInfo[0]['post'] != null && $userInfo[0]['post'] != ''){
                    $userPost = trim($userInfo[0]['post']);
                }else{
                    $userPost = "__________________";
                }

                return "
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div style='margin-right:50px;right:480px; position: absolute; text-align: right; padding-top: 50px; line-height: 0.5'>
                                <p><strong>" . $company . "</strong></p>
                                <p><strong>" . $companyAddress . "</strong></p>
                                <p><strong>" . $substringLocationP1 ."</strong></p>
                                <p><strong>" . $substringLocationP2 . "</strong></p>
                            </div>
                            <div class='contenidoPompas'>
                                <br>
                                <p style='text-align:right'>A la atención de ___________________________</p>
                                <br><br><br>
                                <div style='line-height: 2;'>
                                    <p style='text-align: justify'>
                                        Por el presente documento la empresa <strong>$company</strong> con C.I.F. <strong>$companyNIF</strong> se <strong>CERTIFICA</strong> a la parte interesada:
                                    </p>
                                    <p style='text-align: justify'>
                                        Que se ha realizado la velación de los restos mortales de $gender $deceased, en las instalaciones del $mortuaryName, de $mortuaryLocation, desde el día $startDate hasta el día $endDate a las $endTime.
                                    </p>
                                    <p style='text-align: justify'>
                                        Para que conste a los efectos oportunos y a petición de (__________________________, con DNI:______________), expedimos el presente certificado.
                                    </p>
                                </div>
                                <br><br><br><br><br>
                                <div class='col-xs-12' style='margin-top:20px'>
                                    <div style='width:70%; float:right' class='pull-right'>
                                        <p style='text-align:right'>Fdo.: $userName, $userPost.</p>
                                        <br><br>
                                        <p style='text-align:right'><span style='font-size:13px'>En $mortuaryLocation, a ".$utils->fechaCastellano2(date('Y')).".</span></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                ";
            break;

            case "libroCrematorio":
                $utils = new Utils();
                $data = getLibroCrematorio(array("start" => $_POST['start'], "end" => $_POST['end'], "crematorium" => $_POST['crematorium']));
                
                $j = !isset($data['page']) ? 1 : $data['page'];
                $crematoriumName = !isset($data['crematoriumName']) ? '' : $data['crematoriumName'];
                $rest = "
                    <div class='container $fuente'>
                        <div>
                            <div style='text-align:center' class='centered'>
                                <p style='font-size:16px'><strong><i>Libro Rexistro de Crematorios - ".$crematoriumName."</i></strong></p>
                            </div>
                ";
                $i = !isset($data['position']) ? 0 : $data['position'] - 1;
                if($data !== null){
                    $rest .= "
                        <div style='text-align:right' class='pull-right'>
                                <p style='font-size:16px'><strong><i>Folla Nº </i></strong>" . $j . "</p>
                            </div>
                        </div>
                    ";
                    foreach ($data as $key => $value) {
                        
                        if(gettype($key) == "integer"){
                            $coffin = "Féretro común";
                            if($value['coffin'] == "1"){
                                $coffin = "Féretro de Traslado";
                            }
                            if($value['coffin'] == "2"){
                                $coffin = "Féretro Incinerar Ecológico";
                            }
                            if($value['coffin'] == "3"){
                                $coffin = "Otro";
                            }
                            if($value['coffin'] == "4"){
                                $coffin = "Camilla de Recogida";
                            }
                            if($value['coffin'] == "5"){
                                $coffin = "Caja de Restos";
                            }
                            if($value['coffin'] == "6"){
                                $coffin = "Arca de Traslado";
                            }
                            if($value['deceasedSurname'] == null){
                                $value['deceasedSurname'] = "-";
                            }
                            if($value['deceasedName'] == null){
                                $value['deceasedName'] = "-";
                            }
                            if($value['birthdayLocation'] == null){
                                $value['birthdayLocation'] = "-";
                            }
                            if($value['deceasedDate'] == ""){
                                $value['deceasedDate'] = "-";
                            }else{
                                $value['deceasedDate'] = date("j/n/Y", strtotime($value['deceasedDate']));
                            }
                            if($value['start'] == ""){
                                $value['start'] = "-";
                            }else{
                                $value['start'] = date("j/n/Y", strtotime($value['start']));
                            }
                            if($value["transport"] == ""){
                                $value["transport"] = "-";
                            }
                        
                            if($i % 4 == 0 && $i != 0){
                                $j++;
                                $rest .= "
                                    <pagebreak>
                                    <div>
                                        <div style='text-align:center' class='centered'>
                                            <p style='font-size:16px'><strong><i>Libro Rexistro de Crematorios - ".$crematoriumName."</i></strong></p>
                                        </div>
                                        <div style='text-align:right' class='pull-right'>
                                            <p style='font-size:16px'><strong><i>Folla Nº </i></strong>" . $j . "</p>
                                        </div>
                                    </div>
                                ";
                            }
                            $rest .= "
                                <div>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <p style='font-size:8px'><strong>Nº do servizo: </strong></p><p style='font-size:12px;'>" . $value["number"] . "</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <p style='font-size:8px'><strong>Apelidos: </strong></p><p style='font-size:12px;'>" . $value["deceasedSurname"] . "</p>
                                                </td>
                                                <td>
                                                    <p style='font-size:8px'><strong>Nome: </strong></p><p style='font-size:12px;'>" . $value["deceasedName"] . "</p>
                                                </td>
                                                <td style='width: 25%'>
                                                    <p style='font-size:8px'><strong>Data da morte: </strong></p><p style='font-size:12px;'>" . $value["deceasedDate"] . "</p>
                                                </td>
                                                <td style='width: 25%'>
                                                    <p style='font-size:8px'><strong>Data de incineración: </strong></p><p style='font-size:12px;'>" . $value["start"] . "</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <p style='font-size:8px'><strong>Localidad de orixe:</strong></p><p style='font-size:12px;'> " . $value["birthdayLocation"] . "</p>
                                                </td>
                                                <td>
                                                    <p style='font-size:8px'><strong>Clase féretro: </strong></p><p style='font-size:12px;'>$coffin</p>
                                                </td>
                                                <td>
                                                    <p style='font-size:8px'><strong>Empresa que realizou o transporte: </strong></p><p style='font-size:12px;'>" . $value["transport"] . "</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <br>
                            ";
                            $i++;
                        }
                    }
                }else{
                    $rest .= "
                            <br>
                            <div>
                                <div style='text-align:center' class='centered'>
                                    <p style='font-size:16px'><strong><i>No existen registros para las fechas señaladas</i></strong></p>
                                </div>
                            </div>
                        </div>
                    ";
                }
                $rest .= "</div>";
            
                return $rest;
            break;
            
            case "libroFuneraria":
                $utils = new Utils();
                $data = getLibroFuneraria(array("start" => $_POST['start'], "end" => $_POST['end']));

                // Get company data from settings
                require_once($_SESSION['basePath'] . "model/settings.php");
                $settings = new Settings;
                $companyName = $settings->getCompanyName();

                $pag = !isset($data['page']) ? 1 : $data['page'];
                $rest =     "<div class='container $fuente'>
                                <table class='tablePdfNoBorder' style='color: #00305c;'>
                                    <tr> 
                                        <td><span style='font-size:16px'><strong>Libro Rexistro de Funerarias - $companyName</strong></span></td>
                                        <td style='text-align:right'><span style='font-size:16px;'><strong>Hoja número </strong>" . $pag . "</span></td>
                                    </tr>
                                </table>
                                <br>

                ";
                if($data != null){
                    $i = $data['position'] - 1;
                    foreach ($data as $key => $val) {
                        if(gettype($key) == "integer"){
                            switch($val['coffin']){
                                case '0':
                                    $coffin = "Féretro común";
                                break;
                                case '1':
                                    $coffin = "Féretro de Traslado";
                                break;
                                case '2':
                                    $coffin = "Féretro Incinerar Ecológico";
                                break;
                                case '3':
                                    $coffin = $val['otherCoffin'];
                                break;
                                case '4':
                                    $coffin = "Camilla de Recogida";
                                break;
                                case '5':
                                    $coffin = "Caja de Restos";
                                break;
                                case '6':
                                    $coffin = "Arca de Traslado";
                                break;
                                default:
                                    $coffin = "Féretro común";
                                break;
                            }
                            if($val['deceasedSurname'] == null){
                                $val['deceasedSurname'] = "-";
                            }
                            if($val['deceasedName'] == null){
                                $val['deceasedName'] = "-";
                            }
                            if($val['deceasedSourceName'] == null){
                                $val['deceasedSourceName'] = "-";
                            }
                            if($val['expedientDL'] == "0"){
                                $val['deceasedLocationName'] = $val['otherDeceasedLocation'];
                            }else{
                                if($val['deceasedLocationName'] == null){
                                    $val['deceasedLocationName'] = "-";
                                }
                            }

                            $dateOrigin = '-';
                            if($val['deceasedDate'] != null && $val['deceasedDate'] != '' && $val['deceasedDate'] != 'null'){
                                $dateOrigin = date("j/n/Y", strtotime($val['deceasedDate']));
                            }

                            $carOrigin = '-';
                            if($val['carCollection'] !== null){
                                if(intval($val['carCollection']) === 0){
                                    $carOrigin = $val['carCollection1Brand'] . ' ' . $val['carCollection1Model'] . ' ' . $val['carCollection1LicensePlate'];
                                }else{
                                    $carOrigin = $val['brand'] . ' ' . $val['carModel'] . ' ' . $val['licensePlate'];
                                }
                            }

                            $dateMiddle = '-';
                            if($val['funeralHomeEntryDate'] != null && $val['funeralHomeEntryDate'] != '' && $val['funeralHomeEntryDate'] != 'null'){
                                $dateMiddle = date("j/n/Y", strtotime($val['funeralHomeEntryDate']));
                            }

                            $carMiddle = '-';
                            if($val['hearse'] !== null){
                                if(intval($val['hearse']) === 0){
                                    $carMiddle = $val['hearseBrandOther'] . ' ' . $val['hearseModelOther'] . ' ' . $val['hearseLicensePlateOther'];
                                }else{
                                    $carMiddle = $val['brandHearse'] . ' ' . $val['carModelHearse'] . ' ' . $val['licensePlateHearse'];
                                }
                            }

                            $dateFinal = '-';
                            if($val['funeralDate'] != null && $val['funeralDate'] != '' && $val['funeralDate'] != 'null'){
                                $dateFinal = date("j/n/Y", strtotime($val['funeralDate']));
                            }

                            $finalDestinationName = '-';
                            $finalDestinationLocation = '-';
                            if($val['placeDestinationFinal'] != null){
                                $finalDestinationName = $val['placeDestinationFinalName'];
                                $finalDestinationLocation = $val['placeDestinationFinalLocation'];
                            }
                            if($val['placeDestinationFinalCemetery'] != null){
                                $finalDestinationName = $val['placeDestinationFinalCemeteryName'];
                                $finalDestinationLocation = $val['placeDestinationFinalCemeteryLocation'];
                            }

                            $mortuaryRegNotes = ($val['mortuaryRegNotes'] == null || $val['mortuaryRegNotes'] == 'null' ? '&nbsp;' : $val['mortuaryRegNotes']);
                            
                            if($i != 0 && $i % 3 == 0){
                                $rest .= "</div><pagebreak>";
                                $pag++;
                                $rest .=  "
                                    <div class='container $fuente'>
                                        <table class='tablePdfNoBorder' style='color: #00305c;'>
                                            <tr> 
                                                <td><span style='font-size:16px'><strong>Libro Rexistro de Funerarias - $companyName</strong></span></td>
                                                <td style='text-align:right'><span style='font-size:16px;'><strong>Hoja número </strong>" . $pag . "</span></td>
                                            </tr>
                                        </table>
                                        <br>
                                ";
                            }

                            $rest .= "
                                <div>
                                    <table class='tablePdf$tablePdfColor tableLibros'>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <p style='font-size:8px;'><strong>Nº de servicio</strong></p>
                                                    <p style='font-size:10px;'>" . $val['number'] . "</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td width='35%'>
                                                    <p style='font-size:8px'><strong>Apellidos</strong></p><p style='font-size:10px'> " . $val['deceasedSurname'] . "</p>
                                                </td>
                                                <td width='35%'>
                                                    <p style='font-size:8px'><strong>Nombre</strong></p>
                                                    <p style='font-size:10px'> " . $val['deceasedName'] . "</p>
                                                </td>
                                                <td colspan='2'>
                                                    <p style='font-size:8px'><strong>Clase de féretro</strong></p>
                                                    <p style='font-size:10px'>" . $coffin . "</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <p style='font-size:8px'><strong>Lugar de origen del servicio (hospital/domicilio particular/lugar do óbito)</strong></p>
                                                    <p style='font-size:10px'> " . $val['deceasedSourceName'] . "</p>
                                                </td>
                                                <td>
                                                    <p style='font-size:8px'><strong>Localidad de origen del servicio</strong></p>
                                                    <p style='font-size:10px'> " . $val['deceasedLocationName'] . "</p>
                                                </td>
                                                <td>
                                                    <p style='font-size:8px'><strong>Vehículo</strong></p>
                                                    <p style='font-size:10px'>" . $carOrigin ."</p>
                                                </td>
                                                <td>
                                                    <p style='font-size:8px'><strong>Fecha</strong></p>
                                                    <p style='font-size:10px'>" . $dateOrigin ."</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <p style='font-size:8px'><strong>Lugar de destino intermedio (tanatorio/velatorio/domicilio particular)</strong></p>
                                                    <p style='font-size:10px'> " . $val['placeDestinationMiddleName'] . "</p>
                                                </td>
                                                <td>
                                                    <p style='font-size:8px'><strong> Localidad destino intermedio do servicio</strong></p>
                                                    <p style='font-size:10px'> " . $val['placeDestinationMiddleLocation'] . "</p>
                                                </td>
                                                <td>
                                                    <p style='font-size:8px'><strong>Vehículo</strong></p>
                                                    <p style='font-size:10px'>" . $carMiddle ."</p>
                                                </td>
                                                <td>
                                                    <p style='font-size:8px'><strong>Fecha</strong></p>
                                                    <p style='font-size:10px'>" . $dateMiddle . "</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td><p style='font-size:8px'><strong>Lugar de destino final del servicio (crematorio/cementerio)</strong></p><p style='font-size:10px'> " . $finalDestinationName . "</p></td>
                                                <td colspan='2'><p style='font-size:8px'><strong> Localidad del destino final del servicio</strong></p><p style='font-size:10px'> " . $finalDestinationLocation . "</p></td>
                                                <td><p style='font-size:8px'><strong>Fecha</strong></p><p style='font-size:10px'>" . $dateFinal . "</p></td>
                                            </tr>
                                            <tr>
                                                <td colspan='4'>
                                                    <p style='font-size:8px'><strong>Observaciones</strong></p>
                                                    <p style='font-size:10px'>" . $mortuaryRegNotes . "</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div><br>
                            ";
                            $i++;
                        }
                    }
                }else{
                    $rest .= "
                            <br>
                            <div>
                                <div style='text-align:center' class='centered'>
                                    <p style='font-size:16px'><strong><i>No existen registros para las fechas señaladas</i></strong></p>
                                </div>
                            </div>
                    ";
                }
                $rest .= "</div>";

                return $rest;
            break;
                
            case "libroPersonal":
                $utils = new Utils();
                $data = getLibroPersonal(array("start" => $_POST['start'], "end" => $_POST['end']));
                $pag = 1;
                $rest =  "
                    <div class='container $fuente'>
                        <div>
                            <div style='text-align:center' class='centered'>
                                <p style='font-size:16px'><strong><i>Libro Rexistro de Personal</i></strong></p>
                            </div>
                            <div style='text-align:right' class='pull-right'>
                                <p style='font-size:16px'><strong><i>Folla Nº </i></strong>" . $pag . "</p>
                            </div>
                        </div>
                ";
                if($data != null){
                    $exp = $data['position'] - 1;
                    $pag = $data['page'];
                    foreach ($data as $key => $expedient) {
                        if(gettype($key) == "integer"){
                            if(count($expedient['vehicles']) > 0){
                                $driverName = $expedient['vehicles']["driverName"];
                                $driverSurname = $expedient['vehicles']["driverSurname"];
                                $driverNIF = $expedient['vehicles']["driverNIF"];
                                $expedient['vehicles'] = $expedient['vehicles']["carBrand"] . " " . $expedient['vehicles']["carModel"] . " " . $expedient['vehicles']["carLicensePlate"];
                            }else{
                                $expedient['vehicles'] = "-";
                                $driverName = "-";
                                $driverSurname = "-";
                                $driverNIF = "-";
                            }
                            $expedient['requestDate'] = date("j/n/Y", strtotime($expedient['requestDate']));
                            $expedient['requestTime'] = date("H:i", strtotime($expedient['requestTime']));
                            if($expedient['deceasedSurname'] == null){
                                $expedient['deceasedSurname'] = "-";
                            }
                            if($expedient['deceasedName'] == null){
                                $expedient['deceasedName'] = "-";
                            }
                            if($expedient['mortuaryName'] == null){
                                $expedient['mortuaryName'] = "-";
                            }
                            if($expedient['deceasedBirthdayLocation'] == ""){
                                $expedient['deceasedBirthdayLocation'] = "-";
                            }
                            if($expedient['funeralHome'] == null){
                                $expedient['funeralHome'] = "-";
                            }
                            if($expedient['brandCollection'] == ""){
                                $expedient['brandCollection'] = "-";
                            }
                            if($expedient['modelCollection'] == ""){
                                $expedient['modelCollection'] = "-";
                            }
                            if($expedient['licenseCollection'] == ""){
                                $expedient['licenseCollection'] = "-";
                            }
                            if($exp != 0 && $exp % 2 == 0){
                                $pag++;
                                $rest .= "
                                    </div></div>
                                    <pagebreak>
                                    <div class='container $fuente'>
                                        <div>
                                            <div style='text-align:center' class='centered'>
                                                <p style='font-size:16px'><strong><i>Libro Rexistro de Personal</i></strong></p>
                                            </div>
                                            <div style='text-align:right' class='pull-right'>
                                                <p style='font-size:16px'><strong><i>Folla Nº </i></strong>" . $pag . "</p>
                                            </div>
                                        </div>
                                ";
                            }
                            $rest .= "
                                <table class='tablePdf$tablePdfColor'>
                                    <tbody>
                                        <tr>
                                            <td>
                                                <p style='font-size:8px'><strong>Nº do servizo</strong></p><p style='font-size:12px'>" . $expedient['number'] . "</p>
                                            </td>
                                            <td>
                                                <p style='font-size:8px'><strong>Hora e data de solicitude</strong></p><p style='font-size:12px'>" . $expedient['requestTime'] . " - " . $expedient['requestDate'] . "</p>
                                            </td>
                                            <td>
                                                <p style='font-size:8px'><strong>Apelidos</strong></p><p style='font-size:12px'>" . $expedient['deceasedSurname'] . "</p>
                                            </td>
                                            <td>
                                                <p style='font-size:8px'><strong>Nome</strong></p><p style='font-size:12px'>" . $expedient['deceasedName'] . "</p>
                                            </td>
                                            <td>
                                                <p style='font-size:8px'><strong>Domicilio mortuorio</strong></p><p style='font-size:12px'>" . $expedient['mortuaryName'] . "</p>
                                            </td>
                                            <td width='15%'>
                                                <p style='font-size:8px'><strong>Localidade de orixe</strong></p><p style='font-size:12px'>" . $expedient['deceasedBirthdayLocation'] . "</p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan='2'>
                                                <p style='font-size:8px'><strong>FUNERARIA</strong></p><p style='font-size:12px'>" . $expedient['funeralHome'] . "</p>
                                            </td>
                                            <td colspan='2'>
                                                <p style='font-size:8px'><strong>VEHICULO DE RECOLLIDA</strong></p><p style='font-size:12px'>" . $expedient['brandCollection'] . " " . $expedient['modelCollection'] . " " . $expedient['licenseCollection'] . "</p>
                                            </td>
                                            <td colspan='2'>
                                                <p style='font-size:8px'><strong>VEHICULO DE CONDUCCIÓN</strong></p><p style='font-size:12px'>" . $expedient['vehicles'] . "</p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                                <p style='font-size:10px'><strong>PERSOAL QUE INTERVÉN</strong></p>
                                            </td>
                                            <td>
                                                <p style='font-size:10px'><strong>NOME E APELIDOS</strong></p>
                                            </td>
                                            <td>
                                                <p style='font-size:10px'><strong>D.N.I.</strong></p>
                                            </td>
                                            <td>
                                                <p style='font-size:10px'><strong>NOME E APELIDOS</strong></p>
                                            </td>
                                            <td colspan='2'>
                                                <p style='font-size:10px'><strong>D.N.I.</strong></p>
                                            </td>
                                        </tr>
                            ";
                            $i=0;

                            foreach ($expedient['familyAssistance'] as $key => $family) {
                                if($family['name'] == ""){$family['name'] = "-";}
                                if($family['nif'] == ""){$family['nif'] = "-";}
                                if($i == 0){
                                $rest .= "
                                    <tr>
                                        <td>
                                            <p style='font-size:10px'><strong>ATENCIÓN A LA FAMILIA:</strong></p>
                                        </td>
                                        <td>
                                            <p style='font-size:10px'>" . $family['name'] . " " . $family['surname'] . "</p>
                                        </td>
                                        <td>
                                            <p style='font-size:10px'>" . $family['nif'] . "</p>
                                        </td>
                                ";
                                $i++;
                                }else{
                                    $rest .= "
                                            <td>
                                                <p style='font-size:10px'>" . $family['name'] . " " . $family['surname'] . "</p>
                                            </td>
                                            <td colspan='2'>
                                                <p style='font-size:10px'>" . $family['NIF'] . "</p>
                                            </td>
                                        </tr>
                                    ";
                                    $i = 0;
                                }
                            }
                            if($i==1){
                                $rest .= "<td>-</td><td colspan='2'>-</td></tr>";
                            }
                            $i=0;
                                foreach ($expedient['corpseCollection'] as $key => $corpse) {
                                    if($corpse['name'] == ""){$corpse['name'] = "-";}
                                    if($corpse['nif'] == ""){$corpse['nif'] = "-";}
                                    if($i == 0){
                                    $rest .= "
                                        <tr>
                                            <td>
                                                <p style='font-size:10px'><strong>RECOLLIDA CADAVER:</strong></p>
                                            </td>
                                            <td>
                                                <p style='font-size:10px'>" . $corpse['name'] . " " . $corpse['surname'] . "</p>
                                            </td>
                                            <td>
                                                <p style='font-size:10px'>" . $corpse['nif'] . "</p>
                                            </td>
                                    ";
                                    $i++;
                                    }else{
                                        $rest .= "
                                                <td>
                                                    <p style='font-size:10px'>" . $corpse['name'] . " " . $corpse['surname'] . "</p>
                                                </td>
                                                <td colspan='2'>
                                                    <p style='font-size:10px'>" . $corpse['nif'] . "</p>
                                                </td>
                                            </tr>
                                        ";
                                        $i=0;
                                    }
                                }
                                if($i==1){
                                    $rest .= "<td>-</td><td colspan='2'>-</td></tr>";
                                }
        
                                if($expedient['responsibleUser'] != null){
                                    $rest .= "
                                        <tr>
                                            <td>
                                                <p style='font-size:10px'><strong>PREPARACIÓN CADÁVER:</strong></p>
                                            </td>
                                            <td>
                                                <p style='font-size:10px'>" . $expedient['responsibleName'] . " " . $expedient['responsibleSurname'] . "</p>
                                            </td>
                                            <td>
                                                <p style='font-size:10px'>" . $expedient['responsibleNIF'] . "</p>
                                            </td>
                                            <td>-</td><td colspan='2'>-</td>
                                        </tr>
                                    ";
                                }
        
                                $rest .= "
                                    <tr>
                                        <td>
                                            <p style='font-size:10px'><strong>SAÍDA E CONDUCCIÓN:</strong></p>
                                        </td>
                                        <td>
                                            <p style='font-size:10px'>" . $driverName . " " . $driverSurname . "</p>
                                        </td>
                                        <td>
                                            <p style='font-size:10px'>" . $driverNIF . "</p>
                                        </td>
                                        <td>-</td><td colspan='2'>-</td>
                                    </tr>
                                ";
        
                                $i=0;
                                foreach ($expedient['carriers'] as $key => $carrier) {
                                    if($carrier['name'] == ""){$carrier['name'] = "-";}
                                    if($carrier['NIF'] == ""){$carrier['NIF'] = "-";}
                                    if($i == 0){
                                        $rest .= "
                                            <tr>
                                                <td>
                                                    <p style='font-size:10px'><strong>PORTEADORES:</strong></p>
                                                </td>
                                                <td>
                                                    <p style='font-size:10px'>" . $carrier['name'] . " " . $carrier['surname'] . "</p>
                                                </td>
                                                <td>
                                                    <p style='font-size:10px'>" . $carrier['NIF'] . "</p>
                                                </td>
                                        ";
                                        $i++;
                                    }else{
                                        $rest .= "
                                                <td>
                                                    <p style='font-size:10px'>" . $carrier['name'] . " " . $carrier['surname'] . "</p>
                                                </td>
                                                <td colspan='2'>
                                                    <p style='font-size:10px'>" . $carrier['NIF'] . "</p>
                                                </td>
                                            </tr>
                                        ";
                                        $i = 0;
                                    }
                                }
                                if($i==1){
                                    $rest .= "<td>-</td><td colspan='2'>-</td></tr>";
                                }
                                $rest .= "
                                        </tbody>
                                    </table>
                                    <div class='text-center' style='margin-top:10px'>
                                        <p>                   --------------------------------------------------------------------                </p>
                                    </div>
                                    <!-- CHUNKING -->
                                ";
                            $exp++;
                        }
                    }
                }else{
                    $rest .= "
                            <br>
                            <div>
                                <div style='text-align:center' class='centered'>
                                    <p style='font-size:16px'><strong><i>No existen registros para las fechas señaladas</i></strong></p>
                                </div>
                            </div>
                    ";
                }
                $rest .= "</div></div>";

                return $rest;
            break;

            case "libroTanatorio":
                $utils = new Utils();
                $data = getLibroTanatorio(array("start" => $_POST['start'], "end" => $_POST['end'], "mortuary" => $_POST['mortuary']));
                
                $j = !isset($data['page']) ? 1 : $data['page'];
                $mortuaryName = !isset($data['page']) ? '' : $data['mortuaryName'];
                $rest =  "
                    <div class='container $fuente'>
                        <div>
                            <div style='text-align:center' class='centered'>
                                <p style='font-size:16px'><strong><i>Libro Rexistro de Tanatorios - ".$mortuaryName."</i></strong></p>
                            </div>
                            <div style='text-align:right' class='pull-right'>
                                <p style='font-size:16px'><strong><i>Folla Nº </i></strong>" . $j . "</p>
                            </div>
                        </div>
                ";
                            
                $i = !isset($data['position']) ? 0 : $data['position'] - 1;
                if($data != null){
                    foreach ($data as $key => $value) {
                        if(gettype($key) == "integer"){
                            if($value["deceasedSurname"] == ""){
                                $value["deceasedSurname"] = "-";
                            }
                            if($value["deceasedName"] == ""){
                                $value["deceasedName"] = "-";
                            }
                            if($value["entryDate"] == null){
                                $value["entryDate"] = "-";
                            }else{
                                $value["entryDate"] = date("H:i - j/n/Y", strtotime($value["entryDate"]));
                            }
                            if($value["funeralHomeEntryDate"] == null){
                                $value["funeralHomeEntryDate"] = "-";
                            }else{
                                $value["funeralHomeEntryDate"] = date("j/n/Y", strtotime($value["funeralHomeEntryDate"]));
                            }
                            if($value["funeralHomeEntryTime"] == null){
                                $value["funeralHomeEntryTime"] = "-";
                            }else{
                                $value["funeralHomeEntryTime"] = date("H:i", strtotime($value["funeralHomeEntryTime"]));
                            }
                            if($value["funeralDate"] == null){
                                $value["funeralDate"] = "-";
                            }else{
                                $value["funeralDate"] = date("j/n/Y", strtotime($value["funeralDate"]));
                            }
                            if($value["funeralTime"] == null){
                                $value["funeralTime"] = "-";
                            }else{
                                $value["funeralTime"] = date("H:i", strtotime($value["funeralTime"]));
                            }
                            if($value["transport"] == ""){
                                $value["transport"] = "-";
                            }
                            if($value["crematorium"] == null){
                                $value["crematorium"] = "-";
                            }
                            if($value["tanatologicalPractice"] == 0){
                                $value["tanatologicalPractice"] = "-";
                            }else{
                                if($value["tanatologicalPractice"] == 1){
                                    $value["tanatologicalPractice"] = "Tanatoestética";
                                }elseif($value["tanatologicalPractice"] == 2){
                                    $value["tanatologicalPractice"] = "Tanatopraxia";
                                }elseif($value["tanatologicalPractice"] == 3){
                                    $value["tanatologicalPractice"] = "Embalsamamiento";
                                }else{
                                    $value["tanatologicalPractice"] = "Conservación";
                                }
                            }
                            if($i % 5 == 0 && $i != 0){
                                $j++;
                                $rest .= "
                                    <pagebreak>
                                    <div>
                                        <div style='text-align:center' class='centered'>
                                            <p style='font-size:16px'><strong><i>Libro Rexistro de Tanatorios - ".$mortuaryName."</i></strong></p>
                                        </div>
                                        <div style='text-align:right' class='pull-right'>
                                            <p style='font-size:16px'><strong><i>Folla Nº </i></strong>" . $j . "</p>
                                        </div>
                                    </div>
                                ";
                            }
                            $rest .= "
                                <div>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <p style='font-size:8px'><strong>Nº de servicio: </strong></p><p style='font-size:12px'>" . $value["number"] . "</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <p style='font-size:8px'><strong>Apelidos: </strong></p><p style='font-size:12px'>" . $value["deceasedSurname"] . "</p>
                                                </td>
                                                <td>
                                                    <p style='font-size:8px'><strong>Nome: </strong></p><p style='font-size:12px'>" . $value["deceasedName"] . "</p>
                                                </td>
                                                <td style='width: 25%'>
                                                    <p style='font-size:8px'><strong>Hora e data da entrada: </strong></p><p style='font-size:12px'>" . $value["funeralHomeEntryTime"] . " - " . $value["funeralHomeEntryDate"] . "</p>
                                                </td>
                                                <td style='width: 25%'>
                                                    <p style='font-size:8px'><strong>Hora e data da saída: </strong></p><p style='font-size:12px'>" . $value["funeralTime"] . " - " . $value["funeralDate"] . "</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan='2'>
                                                    <p style='font-size:8px'><strong>Empresa que realiza o servizo de transporte:</strong></p><p style='font-size:12px'> " . $value["transport"] . "</p>
                                                </td>
                                                <td>
                                                    <p style='font-size:8px'><strong>Práctica tanatolóxica: </strong></p><p style='font-size:12px'>" . $value["tanatologicalPractice"] . "</p>
                                                </td>
                                                <td>
                                                    <p style='font-size:8px'><strong>Responsable técnico: </strong></p><p style='font-size:12px'>" . ($value["responsibleUser"] == null || $value["responsibleUser"] == '' ? $value["responsibleName"] : $value["responsibleUser"]) ." </p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <br>
                            ";
                            $i++;                     
                        }
                    }
                }else{
                    $rest .= "
                            <br><div>
                                <div style='text-align:center' class='centered'>
                                    <p style='font-size:16px'><strong><i>No existen registros para las fechas señaladas</i></strong></p>
                                </div>
                            </div>
                        </div>
                    ";
                }
                $rest .= "</div>";
            
                return $rest;
            break;

            case "libroVisitas":
                $utils = new Utils();
                $fondo = "";
                if(isset($_POST['model'])){
                    switch ($_POST['model']) {
                        case '0':
                            $fondo = $utils->getRoute() . "core/libraries/pdfs/images/libro_visitas3.jpg";
                        break;
                        case '1':
                            $fondo = $utils->getRoute() . "core/libraries/pdfs/images/libro_visitas2.jpg";
                        break;
                        case '2':
                            $fondo = $utils->getRoute() . "core/libraries/pdfs/images/libro_visitas1.jpg";
                        break;
                    }
                    $data = getLibroVisitas($expedient);
                }else{
                    $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/libroVisitas.html';
                    if(file_exists($route)){
                        return file_get_contents($route);
                    }
                    $data = getLibroVisitas($expedient);
                    if($data['deceasedGender'] == "Hombre"){
                        $fondo = $utils->getRoute() . "core/libraries/pdfs/images/libro_visitas2.jpg";
                    }else{
                        $fondo = $utils->getRoute() . "core/libraries/pdfs/images/libro_visitas1.jpg";
                    }
                }

                $funeralDate = $data['funeralDate'] == null ? '' : $utils->fechaCastellano2(date('Y-m-d', strtotime($data['funeralDate'])));
                $funeralTime = $data['funeralTime'] == null ? '' : (date('H:i', strtotime($data['funeralTime'])));

                return "
                    <div class='fondo'><div style='background-image: url(" . $fondo . ")' class='$fuente folioPompas'><div class='contenidoLibroVisitas'>
                        <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
                        <div>
                            <div class='text-center'>
                                <br>
                                <p><span style='font-size:24px'><strong><i>" . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</i></strong></span></p>
                                <p>(Q.E.P.D.)</p>
                                <br>
                                <p><span style='font-size:16px'>FALLECIÓ EL</strong></span></p>
                                <p><span style='font-size:13px'><strong>" . $utils->fechaCastellano2(date('Y-m-d', strtotime($data['deceasedDate']))) . "</strong></span></p>
                            
                                <p><span style='font-size:16px'>LA CEREMONIA TENDRÁ LUGAR EL</strong></span></p>
                                <p><span style='font-size:13px'><strong>" . $funeralDate ." a las " . $funeralTime ."</strong></span></strong></p>
                            
                                <p><span style='font-size:16px'>EN LA " . strtoupper($data['churchLabel']) . "</strong></span></p>
                                <p><span style='font-size:13px'><strong>" . $data['churchName'] . "</strong></span></strong></p>
                            
                                <p><span style='font-size:16px'>VELACIÓN</strong></span></p>
                                <p><span style='font-size:13px'><strong>" . $data['deceasedMortuary'] ."</strong></span></strong></p>
                                <p><span style='font-size:13px'><strong>Sala Nº " . $data['deceasedRoom'] ."</strong></span></strong></p>
                            </div>
                        </div>
                    </div>
                ";
            break;
                
            case "literalesPendientes":
                $utils = new Utils();
                $data = $_POST['data'];

                $text = "
                    <div class='container $fuente'>
                        <div class='row'>
                            <div style='font-size:12px' class='text-center'>
                                <p><strong>Literales Pendientes</strong></p> 
                            </div>
                        </div>   
                        <div class='row'>
                            <table class='tablePdf$tablePdfColor text-center'>
                                <tbody>
                                    <tr>
                                        <td style='text-align:center'>
                                            <span style='font-size:8px'><strong>Día/Mes</strong></span>
                                        </td>                                    
                                        <td style='text-align:center'>
                                            <span style='font-size:8px'><strong>Nombre y apellidos</strong></span>
                                        </td>                                    
                                        <td style='text-align:center'>
                                            <span style='font-size:8px'><strong>Empresa</strong></span>
                                        </td>                                    
                                        <td style='text-align:center'>
                                            <span style='font-size:8px'><strong>Registro Civil</strong></span>
                                        </td>                                    
                                        <td style='text-align:center'>
                                            <span style='font-size:8px'><strong>Tanatorio</strong></span>
                                        </td>                                    
                                        <td style='text-align:center'>
                                            <span style='font-size:8px'><strong>Cementerio</strong></span>
                                        </td>                                    
                                        <td style='text-align:center'>
                                            <span style='font-size:8px'><strong>Nº Def.</strong></span>
                                        </td>                                    
                                    </tr>
                ";

                if($data[0] == ''){
                    $text .= "   
                        <tr>
                            <td colspan='7' style='text-align: left'><span style='font-size:8px'>No se han encontrado resultados</span></td>
                        </tr>
                    ";
                }else{
                    foreach($data as $expedient){
                        $text .= "
                            <tr>
                                <td><span style='font-size:8px'>" . $expedient[0] . "</span></td>
                                <td><span style='font-size:8px'>" . $expedient[1] . "</span></td>
                                <td><span style='font-size:8px'>" . $expedient[2] . "</span></td>
                                <td><span style='font-size:8px'>" . $expedient[3] . "</span></td>
                                <td><span style='font-size:8px'>" . $expedient[4] . "</span></td>
                                <td><span style='font-size:8px'>" . $expedient[5] . "</span></td>
                                <td><span style='font-size:8px'><strong>" . $expedient[6] . "</strong></span></td>
                            </tr>
                        ";
                    }
                }
                $text .= "</tbody></table></div></div>";

                return $text;
            break;

            case "noDuelo":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/noDuelo.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }

                $img = str_replace('png', 'jpg', $utils->getLogo());
                $img = explode(URL, $img);
                $img = $_SESSION['basePath'] . $img[1];

                $utils = new Utils();
                $fondo = $utils->getRoute() . "core/libraries/pdfs/images/fondoCerrado.jpg";
                
                return "
                    <div class='fondo'><div style='background-image: url(" . $fondo . ")' class='$fuente folioPompas'><div class='contenidoPompas'>
                        <div class='' style='text-align:center; color:$colorStyle'>
                            <strong><span style='text-align:center; font-size:60px;'>NO SE RECIBE <br> DUELO</span></strong>
                        </div>
                        <br><br><br><br><br><br><br><br><br><br>
                        <div>
                            <img src='" . $img . "' width='30%'>
                        </div>
                    </div>
                ";
            break;

            case "pedido":
                $utils = new Utils();
                $background = $utils->getBackgroundDocuments();
                $data = getPedido($expedient);
                $order = $data[0];
                $ordersLines = $data[1];

                $orderNumber = $order['ID'];
                $supplierName = $order['supplierName'];
                $supplierPhones = $order['supplierPhones'];
                $supplierEmail = $order['supplierEmail'];
                $expedientNumber = $order['expedientNumber'];
                $deceased = $order['deceasedName'] . ' ' . $order['deceasedSurname'];
                $deceasedRoom = $order['deceasedRoom'];
                $notes = $order['notes'];
                $expedientID = $order['expedientID'];
                $nonApproval = $order['nonApproval'];
                $correctiveAction = $order['correctiveAction'];
                if($order["deliveryPlace"] == null){
                    $deliveryPlace = $order["otherDeliveryPlace"];
                }else{
                    $deliveryPlace = $order["mortuaryName"];
                }
                if($order["date"] != null){
                    $date = date("j/n/Y", $order["date"]);
                }
                if($order["deliveryDate"] != null){
                    $deliveryDate = date("j/n/Y", $order["deliveryDate"]);
                }

                $text = "   
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas'>
                                <div class='titulo text-center' style='text-align: center;'>
                                    <p><u><strong>PEDIDO - " . $order['ID'] . "</strong></u></p>
                                </div>
                                <br><br>
                                <div>
                                    <table style='font-size:14px;' width='100%' class='tableBorderTop$tableBorderTopColor'>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <p><strong>Nº de pedido:</strong> $orderNumber</p>
                                                </td>
                                                <td>
                                                    <p><strong>Fecha:</strong> $date</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <p><strong>Proveedor:</strong> $supplierName</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <p><strong>Correo:</strong> $supplierEmail</p>
                                                </td>
                                                <td>
                                                    <p><strong>Teléfono:</strong> $supplierPhones</p>
                                                </td>
                                            </tr>
                ";

                if($expedientID != null){
                    $text .= "                      
                        <tr>
                            <td>
                                <p><strong>Expediente:</strong> $expedientNumber</p>
                            </td>
                            <td>
                                <p><strong>Difunto:</strong> $deceased</p>
                            </td>
                        </tr>
                    ";
                }
                $text .= "                          
                    <tr>
                        <td>
                            <p><strong>Fecha de entrega:</strong> $deliveryDate</p>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <p><strong>Lugar de entrega:</strong> $deliveryPlace</p>
                        </td>
                ";
                if($expedientID != null){
                    $text .= "                          
                        <td>
                            <p><strong>Sala:</strong> $deceasedRoom</p>
                        </td>
                    ";
                }
                $text .= "
                            </tr>
                        </tbody>
                    </table>
                    <table style='font-size:14px;' width='100%' class='tableBorderMid$tableBorderMidColor'>
                        <tbody>
                            <tr>
                                <td>
                                    <p><strong>Notas:</strong></p>
                                    <br>
                                    <p>$notes</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                ";

                if($expedientID != null){
                    if($nonApproval != null || $nonApproval != ''){
                        $text .= "              
                            <table style='font-size:14px;' width='100%' class='tableBorderMid$tableBorderMidColor'>
                                <tbody>
                                    <tr>
                                        <td>
                                            <p><strong>No conformidad</strong></p>
                                            <br>
                                            <p>$nonApproval</p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p><strong>Acción correctiva</strong></p>
                                            <br>
                                            <p>$correctiveAction</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        ";
                    }
                }

                $text .= "                  
                    <table style='font-size:14px;' width='100%' class='tableBorderBottom$tableBorderBottomColor'>
                        <tbody>
                            <tr>
                                <td style='text-align: center'><p><strong>PRODUCTO</strong></p></td>
                                <td style='text-align: center'><p><strong>MODELO</strong></p></td>
                                <td style='text-align: center'><p><strong>REFERENCIA</strong></p></td>
                                <td style='text-align: center'><p><strong>CANTIDAD</strong></p></td>
                                <td style='text-align: center'><p><strong>TEXTO</strong></p></td>
                            </tr>
                ";

                $amount = 0;
                $total = 0.00;
                foreach($ordersLines AS $key => $orderLine){
                    if($orderLine["lastPurchaseDate"] != null){
                        $orderLine["lastPurchaseDate"] = date("j/n/Y", $orderLine["lastPurchaseDate"]);
                    }

                    $amount = $amount + $orderLine['amount'];
                    $total = $total + $orderLine['price'];
                    $text .= "
                        <tr>
                            <td style='text-align: center'><p>" . $orderLine['productName'] . "</p></td>
                            <td style='text-align: center'><p>" . $orderLine['modelName'] . "</p></td>
                            <td style='text-align: center'><p>" . $orderLine['supplierReference'] . "</p></td>
                            <td style='text-align: center'><p>" . $orderLine['amount'] . "</p></td>
                            <td style='text-align: center'><p>" . $orderLine['hiring_text'] . "</p></td>
                        </tr>
                        ";
                }
                $text .= "
                                        <tr>
                                            <td style='text-align: center'><p><strong>TOTAL</strong></p></td>
                                            <td><p></p></td>
                                            <td><p></p></td>
                                            <td style='text-align: center'><p><strong>$amount</strong></p></td>
                                        </tr>
                                    </tbody>
                                    </table>
                                </div>
                                <br><br>
                                <div style='float:right; font-size:10px; width:36%' class='firma$firmaColor'>
                                    <p style='text-align:center'>FIRMA Y SELLO:</p>
                                    <p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p>
                                </div>
                            </div>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "pesameWeb":
    
                $utils = new Utils();
                $data = getPesameWeb($expedient);
                $textTable = "";
                if(($data['phone'] == null || $data['phone'] == '') && ($data['address'] == null || $data['address'] == '') && ($data['city'] == null || $data['city'] == '')){ //000
                    $textTable .= "
                        <table width='100%'>
                            <tr>
                                <td style='width:50%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p></td>
                            </tr>
                        </table>
                    ";
                }else if(($data['phone'] == null || $data['phone'] == '') && ($data['address'] == null || $data['address'] == '') && ($data['city'] != null && $data['city'] != '')){ //001
                    $textTable .= "
                        <table width='100%'>
                            <tr>
                                <td style='width:50%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p></td>
                            </tr>
                        </table>
                        <div style='padding-top: 5px !important;'></div>
                        <table width='100%'>
                            <tr>
                                <td style='width:50%'><p style='font-size:14px;color:$colorStyle'>Localidad: <i>" . $data['city'] . "</i></p></td>
                            </tr>
                        </table>
                    ";
                }else if(($data['phone'] == null || $data['phone'] == '') && ($data['address'] != null && $data['address'] != '') && ($data['city'] == null || $data['city'] == '')){ //010
                    $textTable .= "
                        <table width='100%'>
                            <tr>
                                <td style='width:50%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p></td>
                            </tr>
                        </table>
                        <div style='padding-top: 5px !important;'></div>
                        <table width='100%'>
                            <tr>
                                <td style='width:50%'><p style='font-size:14px;color:$colorStyle'>Dirección: <i>" . $data['address'] . "</i></p></td>
                            </tr>
                        </table>
                    ";
                }else if(($data['phone'] == null || $data['phone'] == '') && ($data['address'] != null && $data['address'] != '') && ($data['city'] != null && $data['city'] != '')){ //011
                    $textTable .= "
                        <table width='100%'>
                            <tr>
                                <td style='width:45%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p></td>
                                <td style='width:10%'></td>
                                <td style='width:45%'><p style='font-size:14px;float:right;color:$colorStyle'>Localidad: <i>" . $data['city'] . "</i></p></td>
                            </tr>
                        </table>
                        <div style='padding-top: 5px !important;'></div>
                        <table width='100%'>
                            <tr>
                                <td style='width:50%'><p style='font-size:14px;color:$colorStyle'>Dirección: <i>" . $data['address'] . "</i></p></td>
                            </tr>
                        </table>
                    ";
                }else if(($data['phone'] != null && $data['phone'] != '') && ($data['address'] == null || $data['address'] == '') && ($data['city'] == null || $data['city'] == '')){ //100
                    $textTable .= "
                        <table width='100%'>
                            <tr>
                                <td style='width:50%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p></td>
                            </tr>
                        </table>
                        <div style='padding-top: 5px !important;'></div>
                        <table width='100%'>
                            <tr>
                                <td style='width:50%'><p style='font-size:14px;color:$colorStyle'>Telefono: <i>" . $data['phone'] . "</i></p></td>
                            </tr>
                        </table>
                    ";
                }else if(($data['phone'] != null && $data['phone'] != '') && ($data['address'] == null || $data['address'] == '') && ($data['city'] != null && $data['city'] != '')){ //101
                    $textTable .= "
                        <table width='100%'>
                            <tr>
                                <td style='width:45%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p></td>
                                <td style='width:10%'></td>
                                <td style='width:45%'><p style='font-size:14px;float:right;color:$colorStyle'>Teléfono: <i>" . $data['phone'] . "</i></p></td>
                            </tr>
                        </table>
                        <div style='padding-top: 5px !important;'></div>
                        <table width='100%'>
                            <tr>
                                <td style='width:50%'><p style='font-size:14px;color:$colorStyle'>Localidad: <i>" . $data['city'] . "</i></p></td>
                            </tr>
                        </table>
                    ";
                }else if(($data['phone'] != null && $data['phone'] != '') && ($data['address'] != null && $data['address'] != '') && ($data['city'] == null || $data['city'] == '')){ //110
                    $textTable .= "
                        <table width='100%'>
                            <tr>
                                <td style='width:45%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p></td>
                                <td style='width:10%'></td>
                                <td style='width:45%'><p style='font-size:14px;float:right;color:$colorStyle'>Teléfono: <i>" . $data['phone'] . "</i></p></td>
                            </tr>
                        </table>
                        <div style='padding-top: 5px !important;'></div>
                        <table width='100%'>
                            <tr>
                                <td style='width:50%'><p style='font-size:14px;color:$colorStyle'>Dirección: <i>" . $data['address'] . "</i></p></td>
                            </tr>
                        </table>
                    ";
                }else{ //111
                    $textTable .= "
                        <table width='100%'>
                            <tr>
                                <td style='width:45%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p></td>
                                <td style='width:10%'></td>
                                <td style='width:45%'><p style='font-size:14px;float:right;color:$colorStyle'>Teléfono: <i>" . $data['phone'] . "</i></p></td>
                            </tr>
                        </table>
                        <div style='padding-top: 5px !important;'></div>
                        <table width='100%'>
                            <tr>
                                <td style='width:45%'><p style='font-size:14px;color:$colorStyle'>Dirección: <i>" . $data['address'] . "</i></p></td>
                                <td style='width:10%'></td>
                                <td style='width:45%'><p style='font-size:14px;float:right;color:$colorStyle'>Localidad: <i>" . $data['city'] . "</i></p></td>
                            </tr>
                        </table>
                    ";
                }

                $imgWidth = '';
                switch($_SESSION['company']){
                    case '6':
                        $imgWidth = 8;
                    break;
                    case '11':
                        $imgWidth = 25;
                    break;
                    default:
                        $imgWidth = 30;
                    break;
                }

                $img = str_replace('png', 'jpg', $utils->getLogo());
                $img = explode(URL, $img);
                $img = $_SESSION['basePath'] . $img[1];

                $text = "
                    <br><div class='fondo'>
                        <div class='container $fuente folioTarjeta2'>
                            <div>
                                <div class='firma2'>
                                    <div style='font-size:16px; color:#8b8b8b'>
                                        <img style='margin-left: 1%;margin-top:1%' src='" .  $img  . "' width='$imgWidth%'>
                                    </div>
                                    <div style='font-size:16px; margin-left:2%' class='$fuente'>
                                        <div style='margin-bottom: 15px !important;'></div>                                                                                     
                                        <p><i style='font-size: 14px;'>" .$data['condolence']. "</i></p>
                ";
                $text .= $textTable;

                if($data['deceasedGender'] == 'Hombre'){
                    $pre = 'D.';
                }else{
                    $pre = 'Dña.';
                }

                $text .= "                      
                                    </div>
                                    <br>                                                                    
                                    <div style='font-size:14px; color:#8b8b8b; margin-left:2%'>                                                                 
                                        <p>Pésame recibido a través de la web para la familia de " . $pre . " <i>" . $data['deceasedName'] . " " . $data['deceasedSurname'] . " (Q.E.P.D.)</i></p>                                                                                      
                                    </div>
                                <div>
                            </div>              
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "pesamesWeb":
                require_once($_SESSION['basePath'] . "model/condolences.php");
                $condolences = new Condolences;

                // Get company data from settings
                require_once($_SESSION['basePath'] . "model/settings.php");
                $settings = new Settings;

                $companyName = $settings->getCompanyName();
                $companyAddress = $settings->getCompanyAddress();
                $companyLocation = $settings->getCompanyLocation();
                $companyPhone = '';

                $utils = new Utils();
                $text = "
                    <div class='fondo'>
                        <div class='container $fuente folioTarjeta2'>
                ";

                $text .= '<br><br>';

                $i = 0;

                if($_POST['all'] == '1'){
                    // Draws company condolence
                    foreach($_POST['ids'] as $id){
                        $data = getPesameWeb($id[0]);
                        $deceasedName = $data['deceasedName'];
                        $deceasedSurname = $data['deceasedSurname'];
                        $deceasedGender = $data['deceasedGender'];
                        break;
                    }
        
                    $textTable = "";
                    if(($companyPhone == null || $companyPhone == '') && ($companyAddress == null || $companyAddress == '') && ($companyLocation == null || $companyLocation == '')){ //000
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $companyName . "</i></p></td>
                                </tr>
                            </table>
                        ";
                    }else if(($companyPhone == null || $companyPhone == '') && ($companyAddress == null || $companyAddress == '') && ($companyLocation != null && $companyLocation != '')){ //001
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $companyName . "</i></p></td>
                                </tr>
                            </table>
                            <div style='padding-top: 5px !important;'></div>
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Localidad: <i>" . $companyLocation . "</i></p></td>
                                </tr>
                            </table>
                        ";
                    }else if(($companyPhone == null || $companyPhone == '') && ($companyAddress != null && $companyAddress != '') && ($companyLocation == null || $companyLocation == '')){ //010
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $companyName . "</i></p></td>
                                </tr>
                            </table>
                            <div style='padding-top: 5px !important;'></div>
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Dirección: <i>" . $companyAddress . "</i></p></td>
                                </tr>
                            </table>
                        ";
                    }else if(($companyPhone == null || $companyPhone == '') && ($companyAddress != null && $companyAddress != '') && ($companyLocation != null && $companyLocation != '')){ //011
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='45%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $companyName . "</i></p></td>
                                    <td width='8%'>&nbsp;</td>
                                    <td width='45%'><p style='font-size:14px;float:right;color:$colorStyle'>Localidad: <i>" . $companyLocation . "</i></p></td>
                                </tr>
                            </table>
                            <div style='padding-top: 5px !important;'></div>
                            <table width='100%'>
                                <tr>
                                    <td style='width:50%'><p style='font-size:14px;color:$colorStyle'>Dirección: <i>" . $companyAddress . "</i></p></td>
                                </tr>
                            </table>
                        ";
                    }else if(($companyPhone != null && $companyPhone != '') && ($companyAddress == null || $companyAddress == '') && ($companyLocation == null || $companyLocation == '')){ //100
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $companyName . "</i></p></td>
                                </tr>
                            </table>
                            <div style='padding-top: 5px !important;'></div>
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Telefono: <i>" . $companyPhone . "</i></p></td>
                                </tr>
                            </table>
                        ";
                    }else if(($companyPhone != null && $companyPhone != '') && ($companyAddress == null || $companyAddress == '') && ($companyLocation != null && $companyLocation != '')){ //101
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='45%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $companyName . "</i></p></td>
                                    <td width='8%'>&nbsp;</td>
                                    <td width='45%'><p style='font-size:14px;float:right;color:$colorStyle'>Teléfono: <i>" . $companyPhone . "</i></p></td>
                                </tr>
                            </table>
                            <div style='padding-top: 5px !important;'></div>
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Localidad: <i>" . $companyLocation . "</i></p></td>
                                </tr>
                            </table>
                        ";
                    }else if(($companyPhone != null && $companyPhone != '') && ($companyAddress != null && $companyAddress != '') && ($companyLocation == null || $companyLocation == '')){ //110
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='45%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $companyName . "</i></p></td>
                                    <td width='8%'>&nbsp;</td>
                                    <td width='45%'><p style='font-size:14px;float:right;color:$colorStyle'>Teléfono: <i>" . $companyPhone . "</i></p></td>
                                </tr>
                            </table>
                            <div style='padding-top: 5px !important;'></div>
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Dirección: <i>" . $companyAddress . "</i></p></td>
                                </tr>
                            </table>
                        ";
                    }else{ //111
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='45%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $companyName . "</i></p></td>
                                    <td width='8%'>&nbsp;</td>
                                    <td width='45%'><p style='font-size:14px;float:right;color:$colorStyle'>Teléfono: <i>" . $companyPhone . "</i></p></td>
                                </tr>
                            </table>
                            <div style='padding-top: 5px !important;'></div>
                            <table width='100%'>
                                <tr>
                                    <td width='45%'><p style='font-size:14px;color:$colorStyle'>Dirección: <i>" . $companyAddress . "</i></p></td>
                                    <td width='8%'>&nbsp;</td>
                                    <td width='45%'><p style='font-size:14px;float:right;color:$colorStyle'>Localidad: <i>" . $companyLocation . "</i></p></td>
                                </tr>
                            </table>
                        ";
                    }
        
                    $img = str_replace('png', 'jpg', $utils->getLogo());
                    $img = explode(URL, $img);
                    $img = $_SESSION['basePath'] . $img[1];
        
                    if($deceasedGender == 'Hombre'){
                        $pre = 'D.';
                    }else{
                        $pre = 'Dña.';
                    }
        
                    $text .= "
                        <div class='firma2'>
                            <div style='font-size:16px; color:#8b8b8b'>
                                <img src='" . $img . "' style='max-height:60px!important;max-width:200px!important;'>
                            </div>
                            <div style='font-size:16px; margin-left:2%' class='$fuente'>
                                <div style='margin-bottom: 16px !important;'></div>
                                <p><i style='font-size: 14px;'>La dirección y personal de $companyName les manifiesta sus condolencias por el fallecimiento de " . $pre . " " . $deceasedName . " " . $deceasedSurname . " (Q.E.P.D.), quedando a su disposición para lo que necesiten</i></p> 
                    ";
                    $text .= $textTable;
        
                    $text .= "</div>
                                <br>
                            </div>
                        <br><br>
                    "; 
                    $i+=13;
                }

                foreach($_POST['ids'] as $id){
                    $condolences->updateDelivered($id[0]);
                    if($i % 39 == 0 && $i != 0){
                        $text .= "<pagebreak>";
                    }
                    $data = getPesameWeb($id[0]);
                    $textTable = "";
                    if(($data['phone'] == null || $data['phone'] == '') && ($data['address'] == null || $data['address'] == '') && ($data['city'] == null || $data['city'] == '')){ //000
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p></td>
                                </tr>
                            </table>
                        ";
                    }else if(($data['phone'] == null || $data['phone'] == '') && ($data['address'] == null || $data['address'] == '') && ($data['city'] != null && $data['city'] != '')){ //001
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p></td>
                                </tr>
                            </table>
                            <div style='padding-top: 5px !important;'></div>
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Localidad: <i>" . $data['city'] . "</i></p></td>
                                </tr>
                            </table>
                        ";
                    }else if(($data['phone'] == null || $data['phone'] == '') && ($data['address'] != null && $data['address'] != '') && ($data['city'] == null || $data['city'] == '')){ //010
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p></td>
                                </tr>
                            </table>
                            <div style='padding-top: 5px !important;'></div>
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Dirección: <i>" . $data['address'] . "</i></p></td>
                                </tr>
                            </table>
                        ";
                    }else if(($data['phone'] == null || $data['phone'] == '') && ($data['address'] != null && $data['address'] != '') && ($data['city'] != null && $data['city'] != '')){ //011
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='45%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p></td>
                                    <td width='8%'>&nbsp;</td>
                                    <td width='45%'><p style='font-size:14px;float:right;color:$colorStyle'>Localidad: <i>" . $data['city'] . "</i></p></td>
                                </tr>
                            </table>
                            <div style='padding-top: 5px !important;'></div>
                            <table width='100%'>
                                <tr>
                                    <td style='width:50%'><p style='font-size:14px;color:$colorStyle'>Dirección: <i>" . $data['address'] . "</i></p></td>
                                </tr>
                            </table>
                        ";
                    }else if(($data['phone'] != null && $data['phone'] != '') && ($data['address'] == null || $data['address'] == '') && ($data['city'] == null || $data['city'] == '')){ //100
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p></td>
                                </tr>
                            </table>
                            <div style='padding-top: 5px !important;'></div>
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Telefono: <i>" . $data['phone'] . "</i></p></td>
                                </tr>
                            </table>
                        ";
                    }else if(($data['phone'] != null && $data['phone'] != '') && ($data['address'] == null || $data['address'] == '') && ($data['city'] != null && $data['city'] != '')){ //101
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='45%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p></td>
                                    <td width='8%'>&nbsp;</td>
                                    <td width='45%'><p style='font-size:14px;float:right;color:$colorStyle'>Teléfono: <i>" . $data['phone'] . "</i></p></td>
                                </tr>
                            </table>
                            <div style='padding-top: 5px !important;'></div>
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Localidad: <i>" . $data['city'] . "</i></p></td>
                                </tr>
                            </table>
                        ";
                    }else if(($data['phone'] != null && $data['phone'] != '') && ($data['address'] != null && $data['address'] != '') && ($data['city'] == null || $data['city'] == '')){ //110
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='45%'><p style='font-size:14px;color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p></td>
                                    <td width='8%'>&nbsp;</td>
                                    <td width='45%'><p style='font-size:14px;float:right;color:$colorStyle'>Teléfono: <i>" . $data['phone'] . "</i></p></td>
                                </tr>
                            </table>
                            <div style='padding-top: 5px !important;'></div>
                            <table width='100%'>
                                <tr>
                                    <td width='49%'><p style='font-size:14px;color:$colorStyle'>Dirección: <i>" . $data['address'] . "</i></p></td>
                                </tr>
                            </table>
                        ";
                    }else{ //111
                        $textTable .= "
                            <table width='100%'>
                                <tr>
                                    <td width='45%'>
                                        <p style='font-size:14px; color:$colorStyle'>Nombre: <i>" . $data['name'] . "</i></p>
                                    </td>
                                    <td width='8%'>&nbsp;</td>
                                    <td width='45%'>
                                        <p style='font-size:14px; float:right; color:$colorStyle'>Teléfono: <i>" . $data['phone'] . "</i></p>
                                    </td>
                                </tr>
                            </table>
                            <div style='padding-top: 5px !important;'></div>
                            <table width='100%'>
                                <tr>
                                    <td width='45%'>
                                        <p style='font-size:14px; color:$colorStyle'>Dirección: <i>" . $data['address'] . "</i></p>
                                    </td>
                                    <td width='8%'>&nbsp;</td>
                                    <td width='45%'>
                                        <p style='font-size:14px; float:right; color:$colorStyle'>Localidad: <i>" . $data['city'] . "</i></p>
                                    </td>
                                </tr>
                            </table>
                        ";
                    }

                    $img = str_replace('png', 'jpg', $utils->getLogo());
                    $img = explode(URL, $img);
                    $img = $_SESSION['basePath'] . $img[1];

                    $text .= '<br><br><br>';

                    $text .= "
                        <div class='firma2'>
                            <div style='font-size:16px; color:#8b8b8b'>
                                <img src='" . $img . "' style='max-height:60px!important;max-width:200px!important;'>
                            </div>
                            <div style='font-size:16px; margin-left:2%' class='$fuente'>
                                <div style='margin-bottom: 15px !important;'></div>
                                <p style='font-size: 14px;'><i>" .$data['condolence']. "</i></p> 
                    ";

                    $text .= $textTable;

                    if($data['deceasedGender'] == 'Hombre'){
                        $pre = 'D.';
                    }else{
                        $pre = 'Dña.';
                    }

                    $text .= "</div>
                                <br>
                                <div style='font-size: 12px; color:#8b8b8b; margin-left:2%'>                                                                 
                                    <p>Pésame recibido a través de la web para la familia de " . $pre ."  <i>" . $data['deceasedName'] . " " . $data['deceasedSurname'] . " (Q.E.P.D.)</i></p>                                                                                      
                                </div>
                            </div>
                        <br><br>
                    "; 
                    $i+=13;
                }
                $text .= "</div></div>";
                return $text;
            break;
            
            case 'plantillaTarifa':
                $data = getPlantillaTarifa($expedient);

                $notes = getNotesTarifa($expedient);
                $notesSection = '';
                if($notes != null){
                    $notesSection = 
                    '<br></br>
                    <label>Observaciones</label>
                    <p>' .  $notes . '</p>';
                }

                $priceName = $data == null ? '-' : $data[0]['priceName'];
                $priceYear = $data == null ? '-' : $data[0]['priceYear'];

                $utils = new Utils;

                $background = $utils->getBackgroundDocuments();
                $text = "               
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas'>
                                <p>
                                Tarifa: <strong>$priceName</strong> - Año: <strong>$priceYear</strong>
                                </p>
                                <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                    <tbody>
                                        <tr>
                                            <td style='text-align: center;'>
                                                <p><strong>Modelo</strong></p>
                                            </td>
                                            <td style='text-align:center'>
                                                <p><strong>Precio</strong></p>
                                            </td>
                                        </tr>
                ";

                if($data != null){
                    $i = 0;
                    $lastProduct = null;
                    foreach($data as $elem){
                        if(($i % 35 == 0 || $i % 36 == 0) && $i != 0){
                            $text .= "                 
                                    </tbody>
                                    </table>
                                </div>
                                <pagebreak>
                                <div class='contenidoPompas'>
                                    <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center'>
                                                    <p><strong>Modelo</strong></p>
                                                </td>
                                                <td style='text-align:center'>
                                                    <p><strong>Precio</strong></p>
                                                </td>
                                            </tr>
                            ";
                            $i = 0;
                        }
                        $product = $elem['productName'];
                        $model = $elem['modelName'];
                        $price = $elem['priceNoIVA'];
                        if($lastProduct != null){
                            if($lastProduct == $product){
                                $product = "";
                                $text .= "
                                    <tr>
                                        <td>
                                            <p>$model</p>
                                        </td>
                                        <td style='text-align:center'>
                                            <p>$price €</p>
                                        </td>
                                    </tr>";
                            }else{
                                $lastProduct = $product;
                                $text .= "                          
                                    <tr>
                                        <td class='text-center'>
                                            <p><strong>$product</strong></p>
                                        </td>
                                        <td></td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <p>$model</p>
                                        </td>
                                        <td style='text-align:center'>
                                            <p>$price €</p>
                                        </td>
                                    </tr>";
                                $i++;
                            }
                        }else{
                            $lastProduct = $product;
                            $text .= "                              
                                <tr>
                                    <td class='text-center'>
                                        <p><strong>$product</strong></p>
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td>
                                        <p>$model</p>
                                    </td>
                                    <td style='text-align:center'>
                                        <p>$price €</p>
                                    </td>
                                </tr>";
                            $i++;
                        }
                        $i++;
                    }
                }                 
                $text .= "                  
                                    </tbody>
                                </table>
                                $notesSection
                            </div>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "precintadoFeretro":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/precintadoFeretro.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }
                    $utils = new Utils();
                    $data = getPrecintadoFeretro($expedient);
                    if($data['deceasedGender'] == "Mujer"){
                        $gender = "Dña.";
                    }else{
                        $gender = "D.";
                    }
                    
                    $applicantName = $data['applicantName'];
                    $applicantSurame = $data['applicantSurname'];
                    $applicantDni = $data['applicantNif'];
                    $applicantLocation = $data['applicantLocation'];
                
                    $background = $utils->getBackgroundDocuments();

                    return "
                        <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div style='margin-right:50px;right:480px; position: absolute; text-align: right; padding-top: 50px;'>
                                <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                            </div>
                            <div class='contenidoPompas' style='padding-top: -1px;'>
                                <div>
                                    <div style='text-align: right;' class='pull-right'>
                                        <p>_______</p>
                                        <p>____________</p>
                                    </div>
                                </div>
                                <br><br><br><br>
                                <div style='line-height: 2; text-align: justify;'>
                                    <p>$applicantName  $applicantSurame con D.N.I. $applicantDni y con domicilio $applicantLocation en representación de _____________, declara:</p>
                                </div>
                                <br><br>
                                <div style='line-height: 2; text-align: justify;'>
                                    <p>
                                        Que previos los trámites legales sobre el traslado de cadáveres, se ha procedido a depositar el
                                        cuerpo de <strong>" . $gender . " " . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</strong> (Q.E.P.D.) en un vaso de Cinc, con filtro depurador,
                                        sellado hermético y a continuación, éste, en un ataúd de madera, para poder proceder al traslado
                                        hacia ____________, cumpliendo en todo momento con las normas sanitarias en vigor.
                                    </p>
                                </div>
                                <br><br><br>
                                <div>
                                    <p>En _________________, a " . $utils->fechaCastellano2(date('Y')) . ".</p>
                                    <br><br><br><br>
                                    <p>Fdo.: $applicantName</p>
                                </div>
                                <br><br>
                            </div>
                        </div>
                    ";
            break;

            case "presupuesto":
                $utils = new Utils;
                $ivaLabel = $utils->getIvaLabel();
                
                $data = getPresupuesto($expedient);

                $totalLines = 0;

                $logo = $_POST['logo'];
                if(intval($logo) == 0){
                    $background = $utils->getBackgroundDocumentsInvoicesNoLogo();
                    $text =  "<div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>";
                    $lines = -2;
                }else{
                    $background = $utils->getBackgroundDocumentsInvoices();
                    $background = explode(URL, $background);
                    $background = $_SESSION['basePath'] . $background[1];
                    $text = "<div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>";
                    $lines = 0;
                }

                if($data['deceasedGender'] == 'Hombre'){
                    $gender = 'D.';
                }else{
                    $gender = 'Dña.';
                }
                $mortuaryLabel = '';
                if($data['isYourOwn'] == '1'){
                    $mortuaryLabel = '<br>'.$data['mortuary'];
                }else if($data['isYourOwn'] == '0'){
                    $mortuaryLabel = '<br>Otro';
                }

                $depMsg = '';
                if(isset($withDEP)){
                    if($withDEP == 0){
                        $depMsg = " Def. de $gender " . $data['deceasedName'] . " " . $data['deceasedSurname'];
                        $depMsg .= " (Q.E.P.D.)";
                    }else{
                        $depMsg = '<br><br>';
                    }
                }else{
                    $depMsg = " Def. de $gender " . $data['deceasedName'] . " " . $data['deceasedSurname'];
                    $depMsg .= " (Q.E.P.D.)<br>";
                }
                $lines++;
                $totalLines++;
                $depMsg .= " $mortuaryLabel";

                $segurosLabel = '';
                if(isset($data['clientType'])){
                    if($data['clientType'] == 2 || $data['clientType'] == 3){
                        if(($data['policy'] != '' && $data['policy'] != null) || ($data['lossNumber'] != '' && $data['lossNumber'] != null)){

                            if($data['policy'] != '' && $data['policy'] != null){
                                $segurosLabel .= "<strong> Póliza Nº: </strong> " . $data['policy'];
                                $lines++;
                                $totalLines++;
                            }

                            if($data['lossNumber'] != '' && $data['lossNumber'] != null){
                                if($segurosLabel != ''){
                                    $segurosLabel .= '<br>';
                                }
                                $segurosLabel .= "<strong> Siniestro: </strong> " . $data['lossNumber'];
                                $lines++;
                                $totalLines++;
                            }
                        }
                    }
                }

                if($segurosLabel != ''){
                    $segurosLabel = "<div style='margin-top: 8px; margin-bottom: 25px;'>".$segurosLabel."</div>";
                }

                if($_SESSION['company'] == 28){
                    $qrTopContent = 0;
                }else{
                    $qrTopContent = -21;
                }

                $text .= "
                    <div class='contenidoPompas'>
                        <div class='pull-left' style='width:40%; margin-top: ".$qrTopContent."px'>
                            <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                <tbody>
                                    <tr>
                                        <td style='text-align:center'>
                                            <p><strong>Nº PRESUPUESTO</strong></p>
                                        </td>
                                        <td style='text-align:center'>
                                            <p><strong>FECHA</strong></p>
                                        </td>
                                        <td style='text-align:center'>
                                            <p><strong>EXPEDIENTE</strong></p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style='text-align:center; background-color: #e5ebff important!;'>
                                            <p>". $data['number'] . "</p>
                                        </td>
                                        <td style='text-align:center; background-color: #e5ebff important!;'>
                                            <p>" . date('j/n/Y') . "</p>
                                        </td>
                                        <td style='text-align:center; background-color: #e5ebff important!;'>
                                            <p>" . $data['number'] . "</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            ".$segurosLabel."
                        </div>
                ";

                $text .=  "<div style='margin-top:-60px;'>";

                $companyAddress = $data['address'];
                $companyPostalCode = $data['postalCode'];
                $provinceLabel = $data['province'] == null || $data['province'] == '' ? '' : ' (' . $data['province'] . ')';
                $companyLocation = $data['locationName'] . $provinceLabel;
                $companyNIF = $data['nif'];
                if($companyAddress == '' || $companyAddress == null){
                    $companyAddress = '&nbsp;';
                }
                if($companyNIF == '' || $companyNIF == null){
                    $companyNIF = '&nbsp;';
                }
                    
                $text .="<div class='pull-right' style='text-align:right; margin-right: 15px!important;max-width:350px!important;width:350px!important;white-space: normal;'>";
                $guion =  "";
                if( strlen($companyLocation) > 0 || $companyLocation != null){
                    $guion =  " - ";
                }
                $text .="
                    <p>" . $data['clientName'] . " " . $data['clientSurname'] . "<br>
                    $companyAddress<br>
                    $companyPostalCode$guion$companyLocation<br>
                    $companyNIF</p><br>
                    <p>" . $depMsg ."</p>
                ";

                $text .=
                    "       </div>
                        </div>
                        <br>
                        <div style='clear:both; margin-top:-15px'>
                            <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center;'>
                                <thead style='text-align:center'>
                                    <tr>
                                        <td style='width: 52%'>
                                            <strong>DESCRIPCIÓN</strong>
                                        </td>
                                        <td style='width: 8%'>
                                            <strong>CANT</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>PRECIO</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>DT</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>$ivaLabel</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>IMPORTE</strong>
                                        </td>                        
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                ";

                // Store new page html
                if(intval($logo) == 0){
                    $newPageBackground = "<pagebreak><div class='fondo'><div class='$fuente folioPompas'>";
                }else{
                    $newPageBackground = "<pagebreak><div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>";
                }
                $newPage = "</tbody></table></div></div></div></div>";
                $newPage .= $newPageBackground;    
                $newPage .= "<div class='contenidoPompas'><div>
                                <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center'>
                                    <thead style='text-align:center'>
                                        <tr>
                                            <td style='width: 52%'>
                                                <strong>DESCRIPCIÓN</strong>
                                            </td>
                                            <td style='width: 8%'>
                                                <strong>CANT</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>PRECIO</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>DT</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>$ivaLabel</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>IMPORTE</strong>
                                            </td>                        
                                        </tr>
                                    </thead>
                                    <tbody>
                ";

                $bruto = 0;
                $totalBases = 0;
                $totalIva = 0;
                $listIvas = [];
                $supplied = 0;
                $totalDiscount = 0;
                $total = 0;
                $firstPage = true;
                $discountpercent = 0;
                $discountAmount  = 0;
                $discountValue = 0;

                $overflowTextLines = 0;
                                
                if(isset($data['factura'])){
                    $previousProductID = 0;
                    $previousModelID = 0;
                    $contTexts = 0;
                    for($i = 0; $i < count($data['factura']); ++$i) {
                        $productID = $data['factura'][$i]['productID'];
                        $modelID = $data['factura'][$i]['modelID'];
                        $productName = $data['factura'][$i]['productName'];
                        $modelName = "";
                        $priceNoIVA = $data['factura'][$i]['priceNoIVA']; //tarifa asociada al cliente
                        $particularPrice = $data['factura'][$i]['particularPrice']; //tarifa de particulares
                        $percentage = $data['factura'][$i]['percentage'];
                        $texts = $data['factura'][$i]['texts'];

                        if($data['factura'][$i]['editPrice'] == 1){
                            if(is_array($texts)){
                                if(
                                    $previousProductID != $productID ||
                                    !isset($texts[$contTexts])
                                ){
                                    $contTexts = 0;
                                }

                                if(count($texts) == 1){
                                    if(intval($_SESSION['company']) == 6 || intval($_SESSION['company']) == 4 || intval($_SESSION['company']) == 19){
                                        if($texts[0]['value'] != ''){
                                            $modelName = $data['factura'][$i]['modelName'] . ' - ' . $texts[$contTexts]['value'];
                                        }else{
                                            $modelName = $data['factura'][$i]['modelName'];
                                        }
                                    }else{
                                        if($texts[0]['value'] != ''){
                                            $modelName = $texts[0]['value'];
                                        }else{
                                            $modelName = $data['factura'][$i]['modelName'];
                                        }
                                    }
                                }else{
                                    if(intval($_SESSION['company']) == 6 || intval($_SESSION['company']) == 4 || intval($_SESSION['company']) == 19){
                                        if($texts[$contTexts]['value'] != ''){
                                            $modelName = $data['factura'][$i]['modelName'] . ' - ' . $texts[$contTexts]['value'];
                                        }else{
                                            $modelName = $data['factura'][$i]['modelName'];
                                        }
                                    }else{
                                        $modelName = $texts[$contTexts]['value'];
                                    }
                                    $contTexts++;
                                }
                            }else{
                                $modelName = $data['factura'][$i]['modelName'];
                                $contTexts = 0;
                            }
                        }else{
                            $modelName = $data['factura'][$i]['modelName'];
                        }

                        if($data['factura'][$i]['multipleDiscount'] == null){
                            $amount = $data['factura'][$i]['amount'];                                            
                        }else{
                            $amount = 1;
                        }

                        if($data['factura'][$i]['editPrice'] == '1'){
                            $priceNoIVA = $data['factura'][$i]['totalEditPrice'];
                        }
                        $discountAmountToShow = '-';
                        if($data['factura'][$i]['texts'] == 0){
                            $discount = $data['factura'][$i]['discount'];  
                            $subTotalDiscount = floatval($priceNoIVA) * floatval($discount) / 100;
                            $subtotalPrice = floatval($priceNoIVA) - floatval($subTotalDiscount);
                            if($data['factura'][$i]['editPrice'] == '1'){
                                $discountAmount = floatval($priceNoIVA) - floatval($subtotalPrice);
                            }else{
                                $discountAmount = floatval($particularPrice) - floatval($subtotalPrice);
                            }
                            
                            if($discountAmount < 0){
                                $discountAmount = 0;
                                if($discount > 0){
                                    $discountAmountToShow = "$discount %";
                                }
                            }                                          
                            $subtotalPrice = floatval($subtotalPrice) * floatval($amount);
                            if($data['factura'][$i]['editPrice'] == '1'){
                                if(floatval($priceNoIVA) != 0.00){
                                    $discountpercent = floatval($discountAmount) * 100 / (floatval($priceNoIVA));
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($priceNoIVA) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;
                                }                                      
                            }else{
                                if(floatval($particularPrice) != 0.00){
                                    $discountpercent = floatval($discountAmount) * 100 / (floatval($particularPrice));
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($particularPrice) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;
                                }                                      
                            }
                        }else{
                            $discount = $data['factura'][$i]['multipleDiscount']; 
                            $subTotalDiscount = floatval($priceNoIVA) * floatval($discount) / 100;                                            
                            $subtotalPrice = floatval($priceNoIVA) - floatval($subTotalDiscount);
                            if($data['factura'][$i]['editPrice'] == '1'){
                                $discountAmount = floatval($priceNoIVA) - floatval($subtotalPrice);     
                            }else{
                                $discountAmount = floatval($particularPrice) - floatval($subtotalPrice);     
                            }
                            
                            if($discountAmount < 0){
                                $discountAmount = 0;
                                if($discount > 0){
                                    $discountAmountToShow = "$discount %";
                                }
                            }        
                            if($data['factura'][$i]['editPrice'] == '1'){
                                if(floatval($priceNoIVA) != 0.00){                                      
                                    $discountpercent = floatval($discountAmount) * 100 / floatval($priceNoIVA);    
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($priceNoIVA) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;                                           
                                }
                            }else{
                                if(floatval($particularPrice) != 0.00){                                      
                                    $discountpercent = floatval($discountAmount) * 100 / floatval($particularPrice);    
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($particularPrice) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;                                           
                                }
                            }
                        }
                    
                        if($subtotalPrice < 0){
                            $totalDiscount += abs($subtotalPrice);
                        }else{
                            $totalDiscount = floatval($totalDiscount) + (floatval($discountAmount)*floatval($amount));
                        }

                        // Obtener índice usando array_search()
                        $keys = array_column($listIvas, 'type_iva');
                        $indexAux = array_search($percentage, $keys);

                        $subTotal = floatval($subtotalPrice);
                        $ivaAmount = ($subTotal * floatval($percentage)) / 100;

                        if($indexAux === false) {
                            $listIvas[] = [
                                'type_iva' => $percentage,
                                'base' => $subTotal,
                                'iva' => $ivaAmount
                            ];
                        }else{
                            $listIvas[$indexAux]['base'] += $subTotal;
                            $listIvas[$indexAux]['iva'] += $ivaAmount;
                        }

                        $totalBases += $subTotal;
                        $totalIva += $ivaAmount;

                        if($discountpercent == 0 || $discountpercent < 0){
                            $discountValue = $discountAmountToShow;
                        }else{
                            $discountValue = number_format($discountpercent,2) . ' %';
                        }
                            
                        // New version -> Coreo Vicente 13/12
                        if($priceNoIVA > $particularPrice){
                            $priceToShow = $priceNoIVA;
                        }else{
                            if($data['factura'][$i]['editPrice'] == '0'){
                                $priceToShow = $particularPrice; 
                            }else{
                                $priceToShow = $priceNoIVA;
                            }
                        }

                        if($previousProductID == $data['factura'][$i]['productID']){
                            $text .= "
                                <tr class='align-items-center'>
                                    <td style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$modelName."</td>
                                    <td>$amount</td>
                                    <td style='text-align:right'>".number_format($priceToShow,2)." €</td>
                                    <td>$discountValue</td>
                                    <td>".number_format($percentage,2)." %</td>
                                    <td style='text-align:right; background-color: #e5ebff important!;'>".number_format($subtotalPrice,2)." €</td>
                                </tr>
                            ";

                            if(strlen($modelName) > 60){
                                $overflowTextLines++;
                            }
                        }else{
                            $text .= "
                                <tr class='align-items-center'>
                                    <td style='text-align:left'><strong>$productName</strong> - $modelName</td>
                                    <td>$amount</td>
                                    <td style='text-align:right'>".number_format($priceToShow,2)." €</td>
                                    <td>$discountValue</td>
                                    <td>".number_format($percentage,2)." %</td>
                                    <td style='text-align:right; background-color: #e5ebff important!;'>".number_format($subtotalPrice,2)." €</td>
                                </tr>
                            ";

                            if(strlen("$productName - $modelName") > 60){
                                $overflowTextLines++;
                            }
                        }
                        $lines++;
                        $totalLines++;
                        
                        $previousProductID = $data['factura'][$i]['productID'];
                        $previousModelID = $modelID;

                        // Comprobamos si es necesario añadir una página nueva tras introducir cada producto
                        if($firstPage){
                            if(($lines == 42 || $lines == 43) && $lines != 0){

                                $text .= $newPage;
                            
                                $firstPage = false;
                                $lines = 0;
                            }
                        }else{

                            if(intval($logo) == 0){
                                $corte1 = 47;
                                $corte2 = 48;
                                $corte3 = 50;
                                $corte4 = 51;
                            }else{
                                $corte1 = 42;
                                $corte2 = 43;
                                $corte3 = 42;
                                $corte4 = 43;
                            }
                        
                            if(($lines == $corte1 || $lines == $corte2 || $lines == $corte3 || $lines == $corte4) && $lines != 0){
                                $text .= $newPage;

                                $lines = 0;
                            }
                        }
                    }
                }

                if(isset($data['suplidos'])){
                    $text .= "<tr><td><strong>***** SUPLIDOS *****</strong></td><td></td><td></td><td></td><td></td><td style='background-color: #e5ebff important!;'></td></tr>";
                    $lines++;
                    $totalLines++;

                    $previousProductID = 0;
                    $previousModelID = 0;
                    $contTextsSuplidos = 0;
                    foreach($data['suplidos'] as $index => $producto){
                        $productID = $producto['productID'];
                        $modelID = $producto['modelID'];
                        $description = "";
                        $price = $producto['cost'];
                        $texts = $producto['texts'];

                        if($producto['editPrice'] == 1){
                            if(is_array($texts)){
                                if(isset($texts[$contTextsSuplidos]['value'])){
                                    $description = $producto['productName'] . ' - ' . $texts[$contTextsSuplidos]['value'];
                                }else{
                                    $description = '';
                                }
                                $contTextsSuplidos++;
                                if($contTextsSuplidos == count($texts)){
                                    $contTextsSuplidos = 0;
                                }
                            }else{
                                $description = $producto['productName'] . ' - ' . $producto['modelName'];
                                $contTextsSuplidos = 0;
                            }
                        }else{
                            $description = $producto['productName'] . ' - ' . $producto['modelName'];
                        }

                        if($producto['multipleDiscount'] == null){
                            $amount = $producto['amount'];
                        }else{
                            $amount = 1;
                        }

                        if($producto['texts'] == 0){                                       
                            $discount = $producto['discount'];                                       
                            $priceDiscount = floatval($price) * floatval($discount) / 100;
                            $subTotal = floatval($price) - floatval($priceDiscount) ;
                            $subTotal = floatval($subTotal) * floatval($amount);
                        }else{
                            $discount = $producto['multipleDiscount'];                                       
                            $priceDiscount = floatval($price) * floatval($discount) / 100;
                            $subTotal = floatval($price) - floatval($priceDiscount);
                        }                                    
                                                        
                        $totalDiscount = floatval($totalDiscount) + (floatval($priceDiscount)* floatval($amount));
                        $supplied = floatval($supplied) + floatval($subTotal);

                        if($subTotal < 0){
                            $totalDiscount += abs($subTotal);
                        }                                  
                        
                        if($discount == 0 || $discount == 0.00){
                            $discount = '-';
                        }else{
                            $discount = number_format($discount, 2) . ' %';
                        }

                        $productID = $producto['productID'];
                        $modelID = $producto['modelID'];
                        $text .= "
                            <tr class='align-items-center'>
                                <td style='text-align:left'>$description</td>
                                <td>$amount</td>
                                <td style='text-align:right'>". number_format($price, 2) ." €</td>
                                <td>".$discount."</td>
                                <td>-</td>
                                <td style='text-align:right; background-color: #e5ebff important!;'>".number_format($subTotal,2)." €</td>
                            </tr>
                        ";

                        if(strlen($description) > 60){
                            $overflowTextLines++;
                        }

                        $lines++;
                        $totalLines++;

                        $previousProductID = $productID;
                        $previousModelID = $modelID;
                        
                        // Comprobamos si es necesario añadir una página nueva tras introducir cada producto
                        if($firstPage){
                            if(($lines == 42 || $lines == 43) && $lines != 0){

                                $text .= $newPage;
                            
                                $firstPage = false;
                                $lines = 0;
                            }
                        }else{

                            if(intval($logo) == 0){
                                $corte1 = 47;
                                $corte2 = 48;
                                $corte3 = 50;
                                $corte4 = 51;
                            }else{
                                $corte1 = 42;
                                $corte2 = 43;
                                $corte3 = 42;
                                $corte4 = 43;
                            }
                        
                            if(($lines == $corte1 || $lines == $corte2 || $lines == $corte3 || $lines == $corte4) && $lines != 0){
                                $text .= $newPage;

                                $lines = 0;
                            }
                        }
                    }
                }
            
                // Seteamos el máximo de líneas por página (por compañia)
                if(!$firstPage){
                    if(intval($logo) == 0){
                        $maxLines = 45;
                    }else{
                        $maxLines = 42;
                        if($_SESSION['company'] == '1' || $_SESSION['company'] == '4' || $_SESSION['company'] == '5' || $_SESSION['company'] == '15' || $_SESSION['company'] == '23'){
                            $maxLines = 36;
                        }elseif($_SESSION['company'] == '2' || $_SESSION['company'] == '7' || $_SESSION['company'] == '17'){
                            $maxLines = 38;
                        }elseif($_SESSION['company'] == '6' || $_SESSION['company'] == '10' || $_SESSION['company'] == '27' || $_SESSION['company'] == '28'){
                            $maxLines = 40;
                        }
                    }

                }else{
                    if(intval($logo) == 0){
                        $maxLines = 41;
                    }else{
                        $maxLines = 38;
                        if($_SESSION['company'] == '1' || $_SESSION['company'] == '4' || $_SESSION['company'] == '5' || $_SESSION['company'] == '15'){
                            $maxLines = 36;
                        }elseif($_SESSION['company'] == '2' || $_SESSION['company'] == '7'){
                            $maxLines = 34;
                        }elseif($_SESSION['company'] == '6' || $_SESSION['company'] == '10' || $_SESSION['company'] == '27' || $_SESSION['company'] == '28'){
                            $maxLines = 36;
                        }elseif($_SESSION['company'] == '23'){
                            $maxLines = 33;
                        }
                    }
                }

                $overflowTextLines = intval($overflowTextLines * 0.75);
                $lines += $overflowTextLines;
                $totalLines += $overflowTextLines;

                // Rellenamos la página con líneas en blanco
                if($lines >= $maxLines){

                    if($_SESSION['company'] == '23'){
                        $total = 40 - $totalLines;
                    }else{
                        $total = 48 - $totalLines;
                    }
                   
                    for($i = 0; $i<$total; $i++){
                        $text .= "
                            <tr class='align-items-center'>
                                <td style='text-align:left'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right;background-color: #e5ebff important!;'>&nbsp;</td>
                            </tr>
                        ";
                    }
                    $text .= "
                        </tbody></table></div></div></div></div>
                        <pagebreak>
                        <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas'><div>
                                <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center;'>
                                    <thead style='text-align:center'>
                                        <tr>
                                            <td style='width: 52%'>
                                                <strong>DESCRIPCIÓN</strong>
                                            </td>
                                            <td style='width: 8%'>
                                                <strong>CANT</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>PRECIO</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>DT</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>$ivaLabel</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>IMPORTE</strong>
                                            </td>                        
                                        </tr>
                                    </thead>
                                    <tbody>
                    ";
                
                    if($_SESSION['company'] == '23'){
                        $totalLines = 47;
                    }else{
                        $totalLines = 50;
                    }
                    $i = 8;
                    for($i; $i<=$totalLines; $i++){
                        $text .= "
                            <tr class='align-items-center'>
                                <td style='text-align:left'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right; background-color: #e5ebff important!;'>&nbsp;</td>
                            </tr>
                        ";
                    }
                }else{
                    $total = $maxLines - $lines;
                    for($i = 0; $i<$total; $i++){
                        $text .= "
                            <tr class='align-items-center'>
                                <td style='text-align:left'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right; background-color: #e5ebff important!;'>&nbsp;</td>
                            </tr>
                        ";
                    }
                }
        
                $text .= "
                            </tbody>
                        </table>
                    </div>
                ";

                $expAssociate = "";
                if(isset($data['associates']) && $data['associates'] != null && count($data['associates']) > 0){
                    foreach($data['associates'] as $exp){
                        $expAssociate .= "EXP: " . $exp['number'] . ", ";
                    }
                    $expAssociate = substr($expAssociate, 0, -2);
                }

                $text .= " 
                    <div style='margin-top:5px;margin-bottom:5px;'>
                        <div style='right: 520px; position: absolute; text-align: right;'>
                            Total descuento: ". number_format($totalDiscount,2) ." €
                        </div>
                        <div style='left: 20px; position: absolute; text-align: left; margin-top:-17px'>
                            $expAssociate
                        </div>
                    </div>
                ";

                $bruto = $totalBases + $supplied;
                $total = $bruto + $totalIva;

                // Fix IVA footer
                $brutoAux = floatval($utils->roundLikePHP2($bruto, 2));
                $totalAux = floatval($utils->roundLikePHP2($total, 2));

                if(floatval($totalAux) != (floatval($totalIva) + floatval($bruto))){
                    $bruto = floatval($totalAux) - floatval($totalIva);
                }

                $bruto = number_format($bruto, 2);
                $total = number_format($total, 2);
                $supplied = number_format($supplied, 2);
                $totalBases = number_format($totalBases, 2);
                $totalIva = number_format($totalIva, 2);

                foreach($listIvas as $index=>$item){
                    $listIvas[$index]['base'] = number_format(floatval($item['base']), 2);
                    $listIvas[$index]['iva'] = number_format(floatval($item['iva']), 2);
                }

                $text .= "
                        <br>
                        <div>
                            <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center'>
                                <thead>
                                    <tr>
                                        <td>
                                            <strong>BRUTO</strong>
                                        </td>
                                        <td>
                                            <strong>SUPLIDOS</strong>
                                        </td>
                                        <td>
                                            <strong>BASE IMPONIBLE</strong>
                                        </td>
                                        <td>
                                            <strong>TIPO $ivaLabel</strong>
                                        </td>
                                        <td>
                                            <strong>$ivaLabel</strong>
                                        </td>
                                        <td>
                                            <strong>TOTAL</strong>
                                        </td>
                                    </tr>
                                </thead>
                                <tbody>
                ";

                if(count($listIvas) > 0){
                    foreach($listIvas as $index=>$item){
                        $text .= "<tr>";

                        if($index == 0){
                            $text .= "
                                <td rowspan='".count($listIvas)."'>" . $bruto . " €</td>
                                <td rowspan='".count($listIvas)."'>" . $supplied . " €</td>
                            ";
                        }

                        $text .= "
                            <td>" . $item['base'] . " €</td>
                            <td>" . number_format(floatval($item['type_iva']), 2) . " %</td>
                            <td>" . $item['iva'] . " €</td>
                        ";

                        if($index == 0){
                            $text .= "<td style='background-color: #e5ebff important!;' rowspan='".count($listIvas)."'><strong>" . $total . " €</strong></td>";
                        }

                        $text .= "</tr>";
                    }
                }else{
                    $text .= "
                        <tr>
                            <td>" . $bruto . " €</td>
                            <td>" . $supplied . " €</td>
                            <td>0.00 €</td>
                            <td> - </td>
                            <td>0.00 €</td>
                            <td style='background-color: #e5ebff important!;'><strong>" . $total . " €</strong></td>
                        </tr>
                    ";
                }

                $text .= "
                                        </tbody>
                                    </table>
                                </div>
                                <br><br>               
                            </div>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "templateHirings":
                $utils = new Utils;
                $ivaLabel = $utils->getIvaLabel();

                $data = getTemplatePDF($expedient);
                $background = $utils->getBackgroundDocumentsInvoices();
                $background = explode(URL, $background);
                $background = $_SESSION['basePath'] . $background[1];

                $lines = 0;
                $totalLines = 0;
                $textConfondo = "<div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>";
                $text = $textConfondo;
                $text .= "          
                    <div class='contenidoPompas'>
                        <div class='pull-left' style='width:40%; margin-top: 21px'>
                            <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                <tbody>
                                    <tr>
                                        <td style='text-align:center'>
                                            <p><strong>PLANTILLA</strong></p>
                                        </td>
                                        <td style='text-align:center'>
                                            <p><strong>TIPO CLIENTE</strong></p>
                                        </td>
                                        <td style='text-align:center'>
                                            <p><strong>TARIFA</strong></p>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td style='text-align:center; background-color: #e5ebff important!;'>
                                            <p>". $data['name'] . "</p>
                                        </td>
                                        <td style='text-align:center; background-color: #e5ebff important!;'>
                                            <p>" . $data['clientName']. "</p>
                                        </td>
                                        <td style='text-align:center; background-color: #e5ebff important!;'>
                                            <p>" . $data['priceName'] . "</p>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div style='clear:both; margin-top:15px'>
                            <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center;'>
                                <thead style='text-align:center'>
                                    <tr>
                                        <td style='width: 52%'>
                                            <strong>DESCRIPCIÓN</strong>
                                        </td>
                                        <td style='width: 8%'>
                                            <strong>CANT</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>PRECIO</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>DT</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>$ivaLabel</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>IMPORTE</strong>
                                        </td>                        
                                    </tr>
                                </thead>
                                    <tbody>
                                        <tr>
                ";

                // Store new page html
                $newPage = "
                    </tbody></table></div></div></div></div>
                    <pagebreak>
                    <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                        <div class='contenidoPompas'><div>
                            <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center'>
                                <thead style='text-align:center'>
                                    <tr>
                                        <td style='width: 52%'>
                                            <strong>DESCRIPCIÓN</strong>
                                        </td>
                                        <td style='width: 8%'>
                                            <strong>CANT</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>PRECIO</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>DT</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>$ivaLabel</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>IMPORTE</strong>
                                        </td>                        
                                    </tr>
                                </thead>
                                <tbody>
                ";

                $bruto = 0;
                $totalBases = 0;
                $totalIva = 0;
                $listIvas = [];
                $supplied = 0;
                $totalDiscount = 0;
                $subTotalDiscount = 0;
                $total = 0;
                $firstPage = true;
                $discountpercent = 0;
                $discountAmount  = 0;
                $discountValue = 0;
                $lines = 0;
                $totalLines = 0;
                $overflowTextLines = 0;

                if(isset($data['factura'])){
                    $previousProductID = 0;
                    $previousModelID = 0;
                    $contTexts = 0;
                    for($i = 0; $i < count($data['factura']); $i++) {
                        $productID = $data['factura'][$i]['productID'];
                        $modelID = $data['factura'][$i]['modelID'];
                        $productName = $data['factura'][$i]['productName'];
                        $modelName = "";
                        $priceNoIVA = $data['factura'][$i]['priceNoIVA']; //tarifa asociada al cliente
                        $particularPrice = $data['factura'][$i]['particularPrice']; //tarifa de particulares
                        $percentage = $data['factura'][$i]['percentage'];
                        $texts = $data['factura'][$i]['texts'];
                        
                        if($data['factura'][$i]['editPrice'] == 1){
                            if(is_array($texts)){
                                if(
                                    $previousProductID != $productID ||
                                    !isset($texts[$contTexts])
                                ){
                                    $contTexts = 0;
                                }

                                if(count($texts) == 1){
                                    if(intval($_SESSION['company']) == 6 || intval($_SESSION['company']) == 4 || intval($_SESSION['company']) == 19){
                                        if($texts[0]['value'] != ''){
                                            $modelName = $data['factura'][$i]['modelName'] . ' - ' . $texts[$contTexts]['value'];
                                        }else{
                                            $modelName = $data['factura'][$i]['modelName'];
                                        }
                                    }else{
                                        if($texts[0]['value'] != ''){
                                            $modelName = $texts[0]['value'];
                                        }else{
                                            $modelName = $data['factura'][$i]['modelName'];
                                        }
                                    }
                                }else{
                                    if(intval($_SESSION['company']) == 6 || intval($_SESSION['company']) == 4 || intval($_SESSION['company']) == 19){
                                        if($texts[$contTexts]['value'] != ''){
                                            $modelName = $data['factura'][$i]['modelName'] . ' - ' . $texts[$contTexts]['value'];
                                        }else{
                                            $modelName = $data['factura'][$i]['modelName'];
                                        }
                                    }else{
                                        $modelName = $texts[$contTexts]['value'];
                                    }
                                    $contTexts++;
                                }
                            }else{
                                $modelName = $data['factura'][$i]['modelName'];
                                $contTexts = 0;
                            }
                        }else{
                            $modelName = $data['factura'][$i]['modelName'];
                        }
                        
                        if($data['factura'][$i]['multipleDiscount'] == null){
                            $amount = $data['factura'][$i]['amount'];                                            
                        }else{
                            $amount = 1;
                        }

                        if($data['factura'][$i]['editPrice'] == '1'){
                            $priceNoIVA = $data['factura'][$i]['totalEditPrice'];
                        }

                        $discountAmountToShow = '-';
                        if($data['factura'][$i]['texts'] == 0){
                            $discount = $data['factura'][$i]['discount'];  
                            $subTotalDiscount = floatval($priceNoIVA) * floatval($discount) / 100;
                            $subtotalPrice = floatval($priceNoIVA) - floatval($subTotalDiscount);
                            if($data['factura'][$i]['editPrice'] == '1'){
                                $discountAmount = floatval($priceNoIVA) - floatval($subtotalPrice);
                            }else{
                                $discountAmount = floatval($particularPrice) - floatval($subtotalPrice);
                            }
                            if($discountAmount < 0){
                                $discountAmount = 0;
                                if($discount > 0){
                                    $discountAmountToShow = "$discount %";
                                }
                            }

                            $subtotalPrice = floatval($subtotalPrice) * floatval($amount);                                        

                            if($data['factura'][$i]['editPrice'] == '1'){
                                if(floatval($priceNoIVA) != 0.00){
                                    $discountpercent = floatval($discountAmount) * 100 / (floatval($priceNoIVA));                                           
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($priceNoIVA) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;                                           
                                }                             
                            }else{
                                if(floatval($particularPrice) != 0.00){
                                    $discountpercent = floatval($discountAmount) * 100 / (floatval($particularPrice));                                           
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($particularPrice) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;                                           
                                }                             
                            }
                        }else{
                            $discount = $data['factura'][$i]['multipleDiscount']; 
                            $subTotalDiscount = floatval($priceNoIVA) * floatval($discount) / 100;
                            $subtotalPrice = floatval($priceNoIVA) - floatval($subTotalDiscount);
                            if($data['factura'][$i]['editPrice'] == '1'){
                                $discountAmount = floatval($priceNoIVA) - floatval($subtotalPrice);     
                            }else{
                                $discountAmount = floatval($particularPrice) - floatval($subtotalPrice);     
                            }
                            if($discountAmount < 0){
                                $discountAmount = 0;
                                if($discount > 0){
                                    $discountAmountToShow = "$discount %";
                                }
                            }
                            
                            if($data['factura'][$i]['editPrice'] == '1'){
                                if(floatval($priceNoIVA) != 0.00){                                      
                                    $discountpercent = floatval($discountAmount) * 100 / floatval($priceNoIVA);    
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($priceNoIVA) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;                                           
                                }
                            }else{
                                if(floatval($particularPrice) != 0.00){                                      
                                    $discountpercent = floatval($discountAmount) * 100 / floatval($particularPrice);    
                                }else{
                                    $discountAmount = $priceNoIVA * $amount - abs(floatval($particularPrice) * $amount - floatval($subtotalPrice));
                                    $discountpercent = $discount;                                           
                                }
                            }
                        }
                        if($subtotalPrice < 0){
                            $totalDiscount += abs($subtotalPrice);
                        }else{
                            $totalDiscount = floatval($totalDiscount) + (floatval($discountAmount) * floatval($amount));
                        }

                        // Obtener índice usando array_search()
                        $keys = array_column($listIvas, 'type_iva');
                        $indexAux = array_search($percentage, $keys);

                        $subTotal = floatval($subtotalPrice);
                        $ivaAmount = ($subTotal * floatval($percentage)) / 100;

                        if($indexAux === false) {
                            $listIvas[] = [
                                'type_iva' => $percentage,
                                'base' => $subTotal,
                                'iva' => $ivaAmount
                            ];
                        }else{
                            $listIvas[$indexAux]['base'] += $subTotal;
                            $listIvas[$indexAux]['iva'] += $ivaAmount;
                        }                                 
                        $totalBases += $subTotal;
                        $totalIva += $ivaAmount;

                        if($discountpercent == 0 || $discountpercent < 0){
                            $discountValue = $discountAmountToShow;
                        }else{
                            $discountValue = number_format($discountpercent, 2) . ' %';
                        }

                        if($priceNoIVA > $particularPrice){
                            $priceToShow = $priceNoIVA;
                        }else{
                            if($data['factura'][$i]['editPrice'] == '0'){
                                $priceToShow = $particularPrice; 
                            }else{
                                $priceToShow = $priceNoIVA;
                            }
                        }

                        if($previousProductID == $data['factura'][$i]['productID']){
                            $text .= "
                                <tr class='align-items-center'>
                                    <td style='text-align:left'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$modelName."</td>
                                    <td>$amount</td>
                                    <td style='text-align:right'>".number_format($priceToShow,2)." €</td>
                                    <td>$discountValue</td>
                                    <td>".number_format($percentage,2)." %</td>
                                    <td style='text-align:right; background-color: #e5ebff important!;'>".number_format($subtotalPrice,2)." €</td>
                                </tr>
                            ";

                            if(strlen($modelName) > 60){
                                $overflowTextLines++;
                            }
                        }else{
                            $text .= "
                                <tr class='align-items-center'>
                                    <td style='text-align:left'><strong>$productName</strong> - $modelName</td>
                                    <td>$amount</td>
                                    <td style='text-align:right'>".number_format($priceToShow,2)." €</td>
                                    <td>$discountValue</td>
                                    <td>".number_format($percentage,2)." %</td>
                                    <td style='text-align:right; background-color: #e5ebff important!;'>".number_format($subtotalPrice,2)." €</td>
                                </tr>
                            ";

                            if(strlen("$productName - $modelName") > 60){
                                $overflowTextLines++;
                            }
                        }

                        $previousProductID = $data['factura'][$i]['productID'];
                        $previousModelID = $modelID;
                        $lines++;
                        $totalLines++;

                        // Comprobamos si es necesario añadir una página nueva tras introducir cada producto
                        if($firstPage){
                            if(($lines % 42 == 0 || $lines % 43 == 0) && $lines != 0){

                                $text .= $newPage;
                            
                                $firstPage = false;
                                $lines = 0;
                            }
                        }else{
                            $corte1 = 47;
                            $corte2 = 48;
                            $corte3 = 50;
                            $corte4 = 51;
                        
                            if(($lines == $corte1 || $lines == $corte2 || $lines == $corte3 || $lines == $corte4) && $lines != 0){
                                $text .= $newPage;

                                $lines = 0;
                            }
                        }
                    }
                }
                
                if(isset($data['suplidos'])){
                    $text .= "<tr><td><strong>***** SUPLIDOS *****</strong></td><td></td><td></td><td></td><td></td><td style='background-color: #e5ebff important!;'></td></tr>";
                    $lines++;
                    $totalLines++;

                    $previousProductID = 0;
                    $previousModelID = 0;
                    $contTextsSuplidos = 0;
                    foreach($data['suplidos'] AS $index => $producto){
                        $productID = $producto['productID'];
                        $modelID = $producto['modelID'];
                        $description = "";
                        $price = $producto['cost'];
                        $texts = $producto['texts'];

                        if($producto['editPrice'] == 1){
                            if(is_array($texts)){
                                if(isset($texts[$contTextsSuplidos]['value'])){
                                    $description = $producto['productName'] . ' - ' . $texts[$contTextsSuplidos]['value'];
                                }else{
                                    $description = '';
                                }
                                $contTextsSuplidos++;
                                if($contTextsSuplidos == count($texts)){
                                    $contTextsSuplidos = 0;
                                }
                            }else{
                                $description = $producto['productName'] . ' - ' . $producto['modelName'];
                                $contTextsSuplidos = 0;
                            }
                        }else{
                            $description = $producto['productName'] . ' - ' . $producto['modelName'];
                        }

                        if($producto['multipleDiscount'] == null){
                            $amount = $producto['amount'];
                        }else{
                            $amount = 1;
                        }

                        if($producto['texts'] == 0){                                       
                            $discount = $producto['discount'];                                       
                            $priceDiscount = floatval($price) * floatval($discount) / 100 ;
                            $subTotal = floatval($price) - floatval($priceDiscount) ;
                            
                            $subTotal = floatval($subTotal) * floatval($amount);
                        }else{
                            $discount = $producto['multipleDiscount'];                                       
                            $priceDiscount = floatval($price) * floatval($discount) / 100;

                            $subTotal = floatval($price) - floatval($priceDiscount);
                        }                                    
                                    
                        $totalDiscount = floatval($totalDiscount) + (floatval($priceDiscount)* floatval($amount));
                        if($subTotal < 0){
                            $totalDiscount += abs($subTotal);
                        }
                        $supplied = floatval($supplied) + floatval($subTotal);
                        
                        if($discount == 0 || $discount == 0.00){
                            $discount = '-';
                        }else{
                            $discount = number_format($discount, 2) . ' %';
                        }

                        $productID = $producto['productID'];
                        $modelID = $producto['modelID'];
                        $text .= "
                            <tr class='align-items-center'>
                                <td style='text-align:left'>$description</td>
                                <td>$amount</td>
                                <td style='text-align:right'>". number_format($price, 2) ." €</td>
                                <td>".$discount."</td>
                                <td>-</td>
                                <td style='text-align:right; background-color: #e5ebff important!;'>".number_format($subTotal,2)." €</td>
                            </tr>
                        ";
                        $previousProductID = $productID;
                        $previousModelID = $modelID;

                        if(strlen($description) > 60){
                            $overflowTextLines++;
                        }

                        $lines++;
                        $totalLines++;

                        // Comprobamos si es necesario añadir una página nueva tras introducir cada suplido
                        if($firstPage){
                            if(($lines % 42 == 0 || $lines % 43 == 0) && $lines != 0){
                                $text .= $newPage;
                            
                                $firstPage = false;
                                $lines = 0;
                            }
                        }else{
                            $corte1 = 47;
                            $corte2 = 48;
                            $corte3 = 50;
                            $corte4 = 51;
                        
                            if(($lines == $corte1 || $lines == $corte2 || $lines == $corte3 || $lines == $corte4) && $lines != 0){
                                $text .= $newPage;

                                $lines = 0;
                            }
                        }
                    }
                }

                // Seteamos el máximo de líneas por página (por compañia)
                if(!$firstPage){
                    $maxLines = 42;
                    if($_SESSION['company'] == '1' || $_SESSION['company'] == '4' || $_SESSION['company'] == '5' || $_SESSION['company'] == '15' || $_SESSION['company'] == '23'){
                        $maxLines = 36;
                    }elseif($_SESSION['company'] == '2' || $_SESSION['company'] == '7' || $_SESSION['company'] == '17'){
                        $maxLines = 38;
                    }elseif($_SESSION['company'] == '6' || $_SESSION['company'] == '10' || $_SESSION['company'] == '27' || $_SESSION['company'] == '28'){
                        $maxLines = 40;
                    }
                }else{
                    $maxLines = 36;
                    if($_SESSION['company'] == '1' || $_SESSION['company'] == '4' || $_SESSION['company'] == '5' || $_SESSION['company'] == '15'){
                        $maxLines = 32;
                    }elseif($_SESSION['company'] == '2' || $_SESSION['company'] == '7'){
                        $maxLines = 34;
                    }elseif($_SESSION['company'] == '6' || $_SESSION['company'] == '10' || $_SESSION['company'] == '27' || $_SESSION['company'] == '28'){
                        $maxLines = 36;
                    }elseif($_SESSION['company'] == '23'){
                        $maxLines = 33;
                    }
                }

                $overflowTextLines = intval($overflowTextLines * 0.75);
                $lines += $overflowTextLines;
                $totalLines += $overflowTextLines;

                // Rellenamos la página con líneas en blanco
                if($lines >= $maxLines){
                    if($_SESSION['company'] == '23'){
                        $total = 40 - $totalLines;
                    }else{
                        $total = 48 - $totalLines;
                    }
                    for($i = 0; $i<$total; $i++){
                        $text .= "
                            <tr class='align-items-center'>
                                <td style='text-align:left'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right;'>&nbsp;</td>
                            </tr>
                        ";
                    }
                    $text .= "
                        </tbody></table></div></div></div></div>
                        <pagebreak>
                        <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas'><div>
                                <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center;'>
                                    <thead style='text-align:center'>
                                        <tr>
                                            <td style='width: 52%'>
                                                <strong>DESCRIPCIÓN</strong>
                                            </td>
                                            <td style='width: 8%'>
                                                <strong>CANT</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>PRECIO</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>DT</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>$ivaLabel</strong>
                                            </td>
                                            <td style='width: 10%'>
                                                <strong>IMPORTE</strong>
                                            </td>                        
                                        </tr>
                                    </thead>
                                    <tbody>
                    ";
                    
                    if($_SESSION['company'] == '23'){
                        $totalLines = 47;
                    }else{
                        $totalLines = 50;
                    }
                    $i = 8;
                    for($i; $i<=$totalLines; $i++){
                        $text .= "
                            <tr class='align-items-center'>
                                <td style='text-align:left'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right;'>&nbsp;</td>
                            </tr>
                        ";
                    }
                }else{
                    $total = $maxLines - $lines;
                    for($i = 0; $i<$total; $i++){
                        $text .= "
                            <tr class='align-items-center'>
                                <td style='text-align:left'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right'>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td style='text-align:right;'>&nbsp;</td>
                            </tr>
                        ";
                    }
                }

                $text .= "
                            </tbody>
                        </table>
                    </div>
                    <br>
                ";

                $expAssociate = "";
                if(isset($data['associates']) && $data['associates'] != null && count($data['associates']) > 0){
                    foreach($data['associates'] as $exp){
                        $expAssociate .= "EXP: " . $exp['number'] . ", ";
                    }
                    $expAssociate = substr($expAssociate, 0, -2);
                }

                $text .= " <div>
                                <div style='right: 520px; position: absolute; text-align: right;'>
                                    Total descuento: ". number_format($totalDiscount,2) ." €
                                </div>
                                <div style='left: 20px; position: absolute; text-align: left; margin-top:-17px'>
                                    $expAssociate
                                </div>
                            </div>
                ";

                $bruto = $totalBases + $supplied;
                $total = $bruto + $totalIva;

                // Fix IVA footer
                $brutoAux = floatval($utils->roundLikePHP2($bruto, 2));
                $totalAux = floatval($utils->roundLikePHP2($total, 2));

                if(floatval($totalAux) != (floatval($totalIva) + floatval($bruto))){
                    $bruto = floatval($totalAux) - floatval($totalIva);
                }
                
                $bruto = number_format($bruto, 2);
                $total = number_format($total, 2);
                $supplied = number_format($supplied, 2);
                $totalBases = number_format($totalBases, 2);
                $totalIva = number_format($totalIva, 2);

                $text .= "
                        <br>
                        <div>
                            <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center'>
                                <thead>
                                    <tr>
                                        <td>
                                            <strong>BRUTO</strong>
                                        </td>
                                        <td>
                                            <strong>SUPLIDOS</strong>
                                        </td>
                                        <td>
                                            <strong>BASE IMPONIBLE</strong>
                                        </td>
                                        <td>
                                            <strong>TIPO $ivaLabel</strong>
                                        </td>
                                        <td>
                                            <strong>$ivaLabel</strong>
                                        </td>
                                        <td>
                                            <strong>TOTAL</strong>
                                        </td>
                                    </tr>
                                </thead>
                                <tbody>
                ";

               if(count($listIvas) > 0){
                    foreach($listIvas as $index=>$item){
                        $text .= "<tr>";

                        if($index == 0){
                            $text .= "
                                <td rowspan='".count($listIvas)."'>" . $bruto . " €</td>
                                <td rowspan='".count($listIvas)."'>" . $supplied . " €</td>
                            ";
                        }

                        $text .= "
                            <td>" . number_format(floatval($item['base']), 2) . " €</td>
                            <td>" . number_format(floatval($item['type_iva']), 2) . " %</td>
                            <td>" . number_format(floatval($item['iva']), 2) . " €</td>
                        ";

                        if($index == 0){
                            $text .= "<td style='background-color: #e5ebff important!;' rowspan='".count($listIvas)."'><strong>" . $total . " €</strong></td>";
                        }

                        $text .= "</tr>";
                    }
                }else{
                    $text .= "
                        <tr>
                            <td>" . $bruto . " €</td>
                            <td>" . $supplied . " €</td>
                            <td>0.00 €</td>
                            <td> - </td>
                            <td>0.00 €</td>
                            <td style='background-color: #e5ebff important!;'><strong>" . $total . " €</strong></td>
                        </tr>
                    ";
                }

                $text .= "
                                        </tbody>
                                    </table>
                                </div>
                                <br><br>               
                            </div>
                        </div>
                    </div>
                ";

                return $text;
            break;
            
            case "ficha":
                $utils = new Utils;
                $background = $utils->getBackgroundDocuments();

                require_once($_SESSION['basePath'] . "model/cars.php");
                $car = new Cars;
                $data = $car->readCar($expedient);
                $lastEvents = $car->getLastEventAccomplished($expedient);
                $nextEvents = $car->getNextEvent($expedient);

                $textConfondo = "<div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>";
                $textSinfondo = "<div class='fondo'><div class='$fuente folioPompas'>";
                $text = $textConfondo;
                $text .= "<div class='contenidoPompas'>
                            <div class='titulo text-center' style='text-align: center;'>
                                <p><u><strong>FICHA VEHÍCULO " .$data['licensePlate'] . "</strong></u></p>
                            </div>
                            <div style='text-align:center'>
                                <div class='pull-right' style='width:50%'>
                                    <table class='tablePdf$tablePdfColor' style='font-size:10px'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center'>
                                                    <p><strong>Matrícula</strong></p>
                                                </td>
                                                <td style='text-align:center'>
                                                    <p><strong>Marca</strong></p>
                                                </td>
                                                <td style='text-align:center'>
                                                    <p><strong>Modelo</strong></p>
                                                </td>
                                                <td style='text-align:center'>
                                                    <p><strong>Kms</strong></p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='text-align:center; background-color: #e5ebff important!;'>
                                                    <p>" . $data['licensePlate'] . "</p>
                                                </td>
                                                <td style='text-align:center; background-color: #e5ebff important!;'>
                                                    <p>" . $data['brand'] . "</p>
                                                </td>
                                                <td style='text-align:center; background-color: #e5ebff important!;'>
                                                    <p>" . $data['model'] . "</p>
                                                </td>
                                                <td style='text-align:center; background-color: #e5ebff important!;'>
                                                    <p>" . $data['kms'] . "</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <br>

                            <div>
                                <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center'>
                                    <thead style='text-align:center'>
                                        <tr>
                                            <td>
                                                <strong>Último/s eventos realizados</strong>
                                            </td>
                                            <td style='width: 14%'>
                                                <strong>Fecha</strong>
                                            </td>
                                        </tr>
                                    </thead>
                                    <tbody> ";
                                    if(count($lastEvents) < 1){
                                        $text .= "<tr>
                                                    <td>No hay eventos pasados</td>
                                                    <td class='centered' style='width:14%'></td>
                                                </tr>";
                                    }else{
                                        foreach($lastEvents as $event){
                                            $timestamp = strtotime($event['start']);
                                            $dmy = date("d-m-Y", $timestamp);

                                            $text .= "<tr>
                                                        <td>". $event['name'] ."</td>
                                                        <td>".  $dmy . "</td>
                                                    </tr>";
                                        }
                                    }
                                    $text .= "</tbody>
                                </table>
                                <br>
                                <table class='tableContratos$tableContratosColor' style='font-size:10px; text-align:center'>
                                    <thead style='text-align:center'>
                                        <tr>
                                            <td>
                                                <strong>Próximos/s eventos pendientes</strong>
                                            </td>
                                            <td style='width: 14%'>
                                                <strong>Fecha</strong>
                                            </td>
                                        </tr>
                                    </thead>
                                    <tbody> ";

                                    if(count($nextEvents) < 1){
                                        $text .= "<tr>
                                                    <td>No hay eventos futuros</td>
                                                    <td class='centered' style='width:14%'></td>
                                                </tr>";
                                    }else{
                                        foreach($nextEvents as $event){
                                            $timestamp = strtotime($event['start']);
                                            $dmy = date("d-m-Y", $timestamp);

                                            $text .= "<tr>
                                                        <td>". $event['name'] ."</td>
                                                        <td>".  $dmy . "</td>
                                                    </tr>";
                                        }
                                    }
                                        
                                    $text .= "</tbody>
                                </table>
                            </div>
                            <br><br>                                              
                        </div>";
                return $text;
            break;
            
            case "recibis":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/recibis.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $utils = new Utils();
                    $data = getRecibis($expedient);
                    $staticInfo = $documentsInfo->getByDocument('recibis');
                    if($staticInfo != null){
                        foreach($staticInfo as $elem){
                            switch($elem['name']){
                                case 'companyDoc13':
                                    $company = $elem['value'];
                                    break;
                            }
                        }
                    }else{
                        $company = '';
                    }
                    if($data['deceasedGender'] == "Mujer"){
                        $gender = "Dña.";
                    }else{
                        $gender = "D.";
                    }
                    $background = $utils->getBackgroundDocuments();
                    $text =  "<div class='fondo'><div class='$fuente folioPompas'><div class='contenidoPompas'>";
                    $i = 0;
                    if(count($data['products']) > 0 ){
                        foreach ($data['products'] as $key => $product) {
                            if($i % 3 == 0 && $i != 0){
                                $text .=  "</div></div></div> <pagebreak> <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'><div class='contenidoPompas'>";
                            }
                            $text .= "<div class='firma$firmaColor'>
                                <p>&nbsp;</p>
                                <div class='text-center' style='font-size:16px'><p><i><u>Recibí de $company</u></i></p></div>
                                <p>&nbsp;</p>
                                <div style='margin-left:40px; font-size:12px; margin-right:40px;'><p><i>la cantidad de ___________ € por</i></p></div>
                                <div style='margin-left:40px; font-size:12px; margin-right:40px; line-height: 3;'><p><i>Servicio de <strong>" . $product['name'] . "</strong> de " . $gender . " <strong>" . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</strong> (Q.E.P.D.), control nº " . $data['number'] . "</i></p></div>
                                <p>&nbsp;</p>
                                <div class='text-right' style='margin-right:80px; font-size:12px'><p><i>Nombre y apellidos: _______________________________________________</i></p></div>
                                <div class='text-right' style='margin-right:80px; font-size:12px'><p><i>DNI: _______________________________</i></p></div>
                                <br>
                                <div class='text-right' style='margin-right:80px; font-size:12px'><p><i>Fdo.: _______________________________</i></p></div>
                                <p>&nbsp;</p>
                                <div style='margin-left:40px; margin-right:80px; font-size:12px'>
                                    <span>
                                        <i># __________ #
                                        &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
                                    </span>
                                </div>
                                <p>&nbsp;</p>            
                            </div>";
                            $i++;
                        }
                    }else{
                        $text .= "<div class='firma$firmaColor'>
                                    <p>&nbsp;</p>
                                    <div class='text-center' style='font-size:16px'><p><i><u>Recibí de $company</u></i></p></div>
                                    <p>&nbsp;</p>
                                    <div style='margin-left:40px; font-size:12px; margin-right:40px;'><p><i>la cantidad de ___________ € por</i></p></div>
                                    <div style='margin-left:40px; font-size:12px; margin-right:40px; line-height: 3;'><p><i>Servicio de _____________________________________________  " . $gender . "<strong>" . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</strong> (Q.E.P.D.), control nº " . $data['number'] . "</i></p></div>
                                    <p>&nbsp;</p>
                                    <div class='text-right' style='margin-right:80px; font-size:12px'><p><i>Nombre y apellidos: _______________________________________________</i></p></div>
                                    <div class='text-right' style='margin-right:80px; font-size:12px'><p><i>DNI: _______________________________</i></p></div>
                                    <br>
                                    <div class='text-right' style='margin-right:80px; font-size:12px'><p><i>Fdo.: _______________________________</i></p></div>
                                    <p>&nbsp;</p>
                                    <div style='margin-left:40px; margin-right:80px; font-size:12px'>
                                        <span>
                                            <i># __________ #
                                            &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
                                        </span>
                                    </div>
                                    <p>&nbsp;</p>            
                                </div>";
                    }
                    $text .= "</div></div></div>";
                }

                return $text;

            break; 

            case "recibisIglesia":
                $utils = new Utils();
                $data = getRecibisIglesia($expedient);
                $staticInfo = $documentsInfo->getByDocument('recibisIglesia');
                if($staticInfo != null){
                    foreach($staticInfo as $elem){
                        switch($elem['name']){
                            case 'dioceseDoc14':
                                $diocese = $elem['value'];
                            break;
                            case 'dioceseCifDoc14':
                                $dioceseCif = $elem['value'];
                            break;
                            case 'companyDoc14':
                                $company = $elem['value'];
                            break;
                            case 'companyCifDoc14':
                                $companyCif = $elem['value'];
                            break;
                            case 'companyAddressDoc14':
                                $companyAddress = $elem['value'];
                            break;
                            case 'locationDoc14':
                                $location = $elem['value'];
                            break;
                        }
                    }
                }else{
                    $church = '';
                    $diocese = '';
                    $dioceseCif = '';
                    $company = '';
                    $companyCif = '';
                    $companyAddress = '';
                    $location = '';
                }
        
                if($data[0]['deceasedDate'] == null){
                    $funerDate = "N/A";
                }else{
                    $funerDate = date('j-n-Y', strtotime($data[0]['deceasedDate']));

                }
                if($data[0]['clientName'] == null){
                    $data[0]['clientName'] = "N/A";
                }
                if($data[0]['clientCIF'] == null){
                    $data[0]['clientCIF'] = "N/A";
                }
                if($data[0]['clientAddress'] == null){
                    $data[0]['clientAddress'] = "N/A";
                }
                if($data[0]['familyContactName'] != ""){
                    $data[0]['familyContactName'] = $data[0]['familyContactName'] . " " . $data[0]['familyContactSurname'];
                }else{
                    $data[0]['familyContactName'] = "N/A";
                }
                $churchLocation = '';
                $churchLocationFooter = $location;
                if($data[0]['churchLocationName'] != null){
                    $churchLocation .= ' (' . $data[0]['churchLocationName'];
                    $churchLocationFooter = $data[0]['churchLocationName'];
                    if($data[0]['churchLocationProvince'] != null){
                        $churchLocation .= ' - ' . $data[0]['churchLocationProvince'];
                        $churchLocationFooter .= ' (' . $data[0]['churchLocationProvince'] . ')';
                    }
                    $churchLocation .= ')';
                }

                $background = $utils->getBackgroundDocuments();

                $text = 
                "   <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                    <div style='margin-right:50px;right:480px; position: absolute; text-align: right; padding-top: 50px;'>
                        <p>&nbsp;</p>
                        <p>EXP.: <strong>" . $data[0]['number'] . "</strong></p>
                    </div>
                    <div class='contenidoPompas' style='padding-top: -1px;'>
                    <br><br>
                ";
                    if($data[0]['clientType'] == 1){
                        $text .= "<div style='line-height: 2.5;'><p>&nbsp;</p><p class='text-justify'>
                            La Parroquia/Iglesia de " . $data[0]['church'] . "$churchLocation, adscrita a la Diócesis de $diocese con CIF $dioceseCif, ha recibido de la funeraria $company,
                            con CIF $companyCif y domicilio en $companyAddress ($location), la cantidad
                            de: (en letra) ______________________________________________ €, por los servicios prestados al fallecido que se detallan a continuación:                        
                        </p></div>";

                    }else{
                        $text .= "<div style='line-height: 2.5;'><p>&nbsp;</p><p class='text-justify'>
                            La Parroquia/Iglesia de " . $data[0]['church'] . "$churchLocation, adscrita a la Diócesis de $diocese con CIF $dioceseCif, ha recibido de la funeraria $company,
                            con CIF $companyCif y domicilio en $companyAddress ($location), por cuenta de <strong>" . $data[0]['brandName'] . "</strong>, 
                            con CIF <strong>" . $data[0]['clientCIF'] . "</strong> y domicilio en <strong>" . $data[0]['clientAddress'] . "</strong>, la cantidad
                            de: (en letra) ______________________________________________ €, por los servicios
                            prestados a los destinatarios asegurados de esa Compañía que se detallan a continuación,                        
                        </p></div>";
                    }
                    
                    if($data[0]['deceasedGender'] == 'Hombre'){
                        $pre = 'D.';
                    }else{
                        $pre = 'Dña.';
                    }

                    $text .= "<p>&nbsp;</p>
                    <p><strong>DATOS DEL DIFUNTO</strong></p>
                    <table class='tablePdf$tablePdfColor'>
                        <tbody>
                            <tr>
                                <td><div style='font-size:12px; text-align:center;'><strong>NOMBRE Y APELLIDOS</strong></div></td>
                                <td><div style='font-size:12px; text-align:center;'><strong>FECHA DE FALLECIMIENTO</strong></div></td>
                            </tr>
                            <tr>
                                <td><div style='font-size:12px; text-align:center;'> $pre " . $data[0]['deceasedName'] . " " . $data[0]['deceasedSurname'] . "</div></td>
                                <td><div style='font-size:12px; text-align:center;'>" . $funerDate . "</div></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <p>&nbsp;</p>";

                    if($data[0]['clientType'] != 1){
                        $text .= "<table class='tablePdf$tablePdfColor'>
                            <tbody>
                                <tr>
                                    <td style='width:70%'><div style='font-size:12px;'><strong>N&Uacute;MERO DE P&Oacute;LIZA</strong></div></td>
                                    <td><div style='font-size:12px;'>" . $data[0]['policy'] . "</div></td>
                                </tr>
                                <tr>
                                    <td style='width:70%'><div style='font-size:12px;'><strong>N&Uacute;MERO DE SINIESTRO</strong></div></td>
                                    <td><div style='font-size:12px;'>" . $data[0]['lossNumber'] . "</div></td>
                                </tr>
                            </tbody>
                        </table>

                    <p>&nbsp;</p>";
                    }
                    $text .= "<p>&nbsp;</p>

                    <p><strong>CONCEPTOS</strong></p>
                    <table class='tablePdf$tablePdfColor'>
                        <tbody>
                            <tr>
                                <td><div style='font-size:12px;'>Oficio religioso</div></td>
                                <td><div style='font-size:12px;'></div></td>
                            </tr>
                            <tr>
                                <td><div style='font-size:12px;'></div></td>
                                <td><div style='font-size:12px;'></div></td>
                            </tr>
                            <tr>
                                <td><div style='font-size:12px;'></div></td>
                                <td><div style='font-size:12px;'></div></td>
                            </tr>
                            <tr>
                                <td><div style='font-size:12px;'><strong>IMPORTE (Euros)</strong></div></td>
                                <td><div style='font-size:12px;'></div></td>
                            </tr>
                        </tbody>
                    </table>
                    <p>&nbsp;</p>
                    <div>
                        <div class='col-xs-12'>
                            <p>
                                <div class='text-right'>En $churchLocationFooter, a ".$utils->fechaCastellano2(date('Y'))."</div>
                            </p>
                        </div>
                    </div>
                    <div>
                        <div class='col-xs-5 firma$firmaColor'>
                            <p style='text-align:center'>
                                Firma del prestador del servicio:
                                <p>&nbsp;</p>
                            </p>
                            Fdo.:
                            
                        </div>
                                        
                    </div>
                </div></div></div>";

                return $text;

            break;  

            case "recordatorio":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/recordatorio.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $utils = new Utils;

                    $data = getRecordatorio($expedient);
                    $staticInfo = $documentsInfo->getByDocument('recordatorio');
                    if($staticInfo != null){
                        foreach($staticInfo as $elem){
                            switch($elem['name']){
                                case 'companyDoc15':
                                    $company = $elem['value'];
                                break;
                            }
                        }
                    }else{
                        $company = '';
                    }

                    $gender = $data['deceasedGender'];
                    switch($gender){
                        case 'Hombre':
                            $childGender = 'o';
                            $preGender = 'D.';
                            $preWidow = 'Vdo.';
                            $prom = 'él';
                        break;
                        case 'Mujer':
                            $childGender = 'a';
                            $preGender = 'Dña.';
                            $preWidow = 'Vda.';
                            $prom = 'ella';
                        break;
                        default:
                            $childGender = 'o';
                            $preGender = 'D.';
                            $preWidow = 'Vdo.';
                            $prom = 'él';
                        break;
                    }

                    if($data['deceasedMaritalStatus']){
                        if($data['deceasedSecondNuptials'] == ''){
                            $widow = $data['deceasedFirstNuptials'];
                        }else{
                            $widow = $data['deceasedSecondNuptials'];
                        }
                    }

                    $deceasedDate = $data['deceasedDate'];
                    $deceasedDate = strtotime($deceasedDate);
                    setlocale(LC_TIME, 'ES');
                    $day = strftime('%e', $deceasedDate);
                    $month = strftime('%B', $deceasedDate);
                    $year = strftime('%G', $deceasedDate);
                    $deceasedBirthday = $data['deceasedBirthday'];
                    $age = $year - strftime('%G', strtotime($deceasedBirthday));

                    $family = '';
                    if($data['spouseName'] != ''){
                        $family .= $data['spousePre'] . ' ' . $data['spouseName'] . '; ';
                    }
                    if($data['childrenNames'] != ''){
                        $family .= $data['childrenPre'] . ' ' . $data['childrenNames'] . '; ';
                    }
                    if($data['childrenInLawNames'] != ''){
                        $family .= $data['childrenInLawPre'] . ' ' . $data['childrenInLawNames'] . '; ';
                    }
                    if($data['grandchildrenNames'] != ''){
                        $family .= $data['grandchildrenPre'] . ' ' . $data['grandchildrenNames'] . '; ';
                    }
                    if($data['grandchildrenInLawNames'] != ''){
                        $family .= $data['grandchildrenInLawPre'] . ' ' . $data['grandchildrenInLawNames'] . '; ';
                    }
                    if($data['greatGrandchildrenNames'] != ''){
                        $family .= $data['greatGrandchildrenPre'] . ' ' . $data['greatGrandchildrenNames'] . '; ';
                    }
                    if($data['parentsNames'] != ''){
                        $family .= $data['parentsPre'] . ' ' . $data['parentsNames'] . '; ';
                    }
                    if($data['parentsInLawNames'] != ''){
                        $family .= $data['parentsInLawPre'] . ' ' . $data['parentsInLawNames'] . '; ';
                    }
                    if($data['paternalGrandfathersNames'] != ''){
                        $family .= $data['paternalGrandfathersPre'] . ' ' . $data['paternalGrandfathersNames'] . '; ';
                    }
                    if($data['paternalGrandmotherNames'] != ''){
                        $family .= $data['paternalGrandmotherPre'] . ' ' . $data['paternalGrandmotherNames'] . '; ';
                    }
                    if($data['siblingsNames'] != ''){
                        $family .= $data['siblingsPre'] . ' ' . $data['siblingsNames'] . '; ';
                    }
                    if($data['siblings'] == 1){
                        $family .= 'hermanos ';
                    }
                    if($data['politicalSiblings'] == 1){
                        $family .= 'hermanos políticos ';
                    }
                    if($data['grandchildren'] == 1){
                        $family .= 'nietos ';
                    }
                    if($data['politicalGrandchildren'] == 1){
                        $family .= 'nietos políticos ';
                    }
                    if($data['greatGrandchildren'] == 1){
                        $family .= 'bisnietos ';
                    }
                    if($data['uncles'] == 1){
                        $family .= 'tíos ';
                    }
                    if($data['nephews'] == 1){
                        $family .= 'sobrinos ';
                    }
                    if($data['cousins'] == 1){
                        $family .= 'primos ';
                    }
                    $family .= $data['restFamily'];

                    $location = $data['locationName'];

                    $text = '  
                        <div class="fondo" style="padding-top: 10px;"><div class="container '.$fuente.' folio">
                            <div style="width: 46%; float: left; margin-right: 8%;">
                                <div style="font-size: 14px; text-align: center;">
                                    <p>' . $data['prayForText'] . " " . $data['prayForGenre'] . '</p>
                                </div>
                                <div style="font-size: 18px; text-align: center;">
                                    <p><strong>' . $preGender . ' ' . $data['deceasedName'] . ' ' . $data['deceasedSurname'] . '</strong></p>
                                </div>
                                <div style="font-size: 18px; text-align: center;">
                                    <p><strong>"' . $data['extraText'] . '"</strong></p>
                                </div>
                    ';

                    if($data['deceasedMaritalStatus']){
                        $text .= '     
                            <div style="font-size: 16px; text-align: center;">
                                <p><strong>(' . $preWidow . ' ' . $widow . ')</strong></p>
                            </div>
                        ';
                    }

                    $text .= '         
                        <div style="font-size:16px; text-align: center;">
                                <p>' . $data['died'] . '</p>
                            </div>
                            <div style="font-size:16px; text-align: center;">
                                <p><strong>D.E.P.</strong></p>
                            </div>
                            <div style="text-align: justify; font-size: 18px;">
                                <p style="text-align: justify;">' . $family . '</p>
                            </div>
                            <div style="text-align: justify;">
                                <br>
                                <p>' . $data['pray'] . '</p>
                                <p>' . $data['busRoute'] . '</p>
                                <p>' . $location . ', ' . $utils->fechaCastellano3(date('Y', strtotime("$year-$month-01"))) . '</p>
                            </div>
                        </div>
                        <div style="width: 46%; float: right;">
                            <div>
                                <div style="clear: right; float: left; width: 25%; height: 240px; padding-top: 20px;">
                                    <img src="' . $utils->getRoute() . 'core/libraries/pdfs/images/cruz.jpg" width="70px">
                                </div>
                                <div style="float: right; width: 75%; font-size: 12px; font-style: italic; font-family: Comic Sans MS;">
                                    <p>Dale Señor el descanso eterno y brille para '.$prom.' la luz perpetua.</p><br>
                                    <p>Tuy'.$childGender.' . soy, Señor</p><br>
                                    <p>La muerte no es el final del camino.</p><br>
                                    <p>Caminando a tu lado, no va a faltarme tu amor.</p><br>
                                    <p>No lloréis, para vosotros no he muerto, sé que me amáis como si estuviera en la tierra y yo os amo desde el cielo.</p>
                                </div>
                            </div>
                            <div>
                                <div style="clear: right; float: left;"></div>
                                <div style="float: right;">
                                    <div style="text-align: center; font-size: 14px;">
                                        <p><strong>ORACIÓN</strong></p>
                                    </div>
                                    <div style="font-size: 12px; font-style: italic; font-family: Comic Sans MS;">
                                        <p>Dulce Jesús mío, por la sangre preciosa que derramasteis en el Calvario, tened piedad de vuestra hija Luisa y abridle las puertas de la mansión celestial. Amén</p>
                                    </div>
                                    <div style="font-size: 12px; font-style: italic;">
                                        <p><strong>' . $company . '</strong></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </div></div>
                    ';

                    return $text;
                }
            break;

            case "recordatorioSobre":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/recordatorioSobre.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $utils = new Utils();
                    $data = getRecordatorioSobre($expedient);

                    if($data['deceasedGender'] == 'Hombre'){
                        $pre = 'D. ';
                    }else{
                        $pre = 'Dña. ';
                    }

                    $img = str_replace('png', 'jpg', $utils->getLogo());
                    $img = explode(URL, $img);
                    $img = $_SESSION['basePath'] . $img[1];

                    return "
                        <div class='fondo'><div class='container $fuente folio'><div class='contenido'>
                            <div style='font-size:16px; height:350px;' class='text-center firma$firmaColor'>
                                <div style='clear: right; float: left; width: 15%;padding-top: 20px;'>
                                    <img src='" . $utils->getRoute() . "core/libraries/pdfs/images/cruz.jpg' width='80%'>
                                </div>      
                                <div style='width: 75%'>
                                    <p>&nbsp;</p>                                                                       
                                    <p>&nbsp;</p>                                                                       
                                    <p><strong>Recordatorio de: </strong></p> 
                                    <p><strong><i> $pre " . $data['deceasedName'] . " " . $data['deceasedSurname'] . " (Q.E.P.D.)</i></strong></p> 
                                </div>
                                <div style='clear: left;'>
                                    <img src='" . $img . "' width='30%'>
                                </div>                 
                            </div>
                        </div></div></div>
                    ";
                }
            break;

            case "recordatorioSobreCruz":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/recordatorioSobreCruz.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $utils = new Utils();
                    $data = getRecordatorioSobre($expedient);

                    if($data['deceasedGender'] == 'Hombre'){
                        $pre = 'D. ';
                    }else{
                        $pre = 'Dña. ';
                    }

                    $img = str_replace('png', 'jpg', $utils->getLogo());
                    $img = explode(URL, $img);
                    $img = $_SESSION['basePath'] . $img[1];

                    return "
                        <div class='fondo'><div class='container $fuente folio'><div class='contenido'>
                            <div style='font-size:16px; height:240px;' class='text-center'>
                                <div style='clear: right; float: left; width: 15%;padding-top: 20px;'>
                                    <img src='" . $utils->getRoute() . "core/libraries/pdfs/images/cruz.jpg' width='80%'>
                                </div>      
                                <div style='width: 75%'>
                                    <p>&nbsp;</p>                                                                       
                                    <p>&nbsp;</p>                                                                       
                                    <p><strong>Recordatorio de: </strong></p> 
                                    <p><strong><i> $pre " . $data['deceasedName'] . " " . $data['deceasedSurname'] . " (Q.E.P.D.)</i></strong></p> 
                                </div>
                                <div style='clear: left;'>
                                    <img src='" . $img . "' width='30%'>
                                </div>                 
                            </div>
                        </div></div></div>
                    ";
                }
            break;

            case "rendimientoEconomico":
                require_once($_SESSION['basePath'] . "core/invoices/functions.php");
                require_once($_SESSION['basePath'] . "core/mortuaries/functions.php");
                $utils = new Utils();
                $products = getProducts();
                $ownedCostCenter = getOwnMortuaries();
                $dates = $_POST['dates'];
                $text = "
                    <div class='container $fuente'>
                        <div>
                            <p><strong>Informe de costes y rendimiento:</strong></p>
                            <p style='padding-left:10%'>" . $utils->fechaCastellano2(date('Y-m-d', $dates[0])) . "</p>
                            <p style='padding-left:10%'>" . $utils->fechaCastellano2(date('Y-m-d', $dates[1])) . "</p>
                        </div>
                        <div>
                        <table class='tablePdf$tablePdfColor'>
                            <tbody>
                                <tr>
                                    <td style='text-align:center'><strong>Gasto</strong></td>
                ";

                foreach ($ownedCostCenter as $key => $value) {
                    $text .= "<td style='text-align:center'><strong>" . $value['name'] . "</strong></td>";
                }
                $text .= "</tr>";
                                    
                $total = array_fill(1, count($ownedCostCenter), 0);
                foreach ($products['fixedProducts'] as $key => $value) {
                    $prod = $value['ID'];
                    $text .="<tr>
                        <td style='text-align:right'><strong>" . $value['name']. "</strong> (F)</td>";
                        foreach ($ownedCostCenter as $key => $value) {
                            $performance = getPerformance($value['mortuaryID'], $prod, $dates[0], $dates[1]);
                            if(isset($performance['fixed'])){
                                $total[$value['mortuaryID']] = $total[$value['mortuaryID']] + $performance['fixed']['total'];
                                $text .= "<td style='text-align:center'>" . $performance['fixed']['total'] . " €</td>";
                            }else{
                                $text .= "<td style='text-align:center'><strong> - </strong></td>";
                            }
                        }
                    $text .= "</tr>";
                    
                }
                foreach ($products['variableProducts'] as $key => $value) {
                    $prod = $value['ID'];
                    $text .="<tr>
                    <td style='text-align:right'><strong>" . $value['name']. "</strong> (V)</td>";
                        foreach ($ownedCostCenter as $key => $value) {
                            $performance = getPerformance($value['mortuaryID'], $prod, $dates[0], $dates[1]);
                            if(isset($performance['variable'])){
                                $total[$value['mortuaryID']] = $total[$value['mortuaryID']] + $performance['variable']['total'];
                                $text .= "<td style='text-align:center'>" . $performance['variable']['total'] . " €</td>";
                            }else{
                                $text .= "<td style='text-align:center'><strong> - </strong></td>";
                            }
                        }
                    $text .= "</tr>";
                }
                $text .="<tr><td style='text-align:right'><strong>Gastos financieros</strong></td>";
                foreach ($ownedCostCenter as $key => $value) {
                    $financial = getFinancials($value['mortuaryID'], $dates[0], $dates[1]);
                    if(isset($financial['financial'])){
                        $total[$value['mortuaryID']] = $total[$value['mortuaryID']] + $financial['financial'];
                        $text .= "<td style='text-align:center'>" . $financial['financial'] . " €</td>";
                    }else{
                        $text .= "<td style='text-align:center'><strong> - </strong></td>";
                    }
                }
                $text .= "</tr><tr>";
                $text .="<td style='text-align:right'><strong>Sueldos y Salarios</strong></td>";
                foreach ($ownedCostCenter as $key => $value) {
                    $salaries = getSalaries($value['mortuaryID'], $dates[0], $dates[1]);
                    if(isset($salaries['salarie'])){
                        $total[$value['mortuaryID']] = $total[$value['mortuaryID']] + $salaries['salarie'];
                        $text .= "<td style='text-align:center'>" . $salaries['salarie'] . " €</td>";
                    }else{
                        $text .= "<td style='text-align:center'><strong> - </strong></td>";
                    }
                }
                $text .= "</tr><tr>";
                $text .="<td style='text-align:right'><strong>Total gastos</strong></td>";
                foreach ($ownedCostCenter as $key => $value) {
                    if(isset($total[$value['mortuaryID']])){
                        $text .= "<td style='text-align:center'>" . $total[$value['mortuaryID']] . " €</td>";
                    }else{
                        $text .= "<td style='text-align:center'><strong> - </strong></td>";
                    }
                }
                $text .= "</tr><tr>";
                $text .="<td style='text-align:right'><strong>Resultado</strong></td>";
                foreach ($ownedCostCenter as $key => $value) {
                    $result = getInvoicedByCenter($value['mortuaryID'], $dates[0], $dates[1]);
                    if(isset($result['result'])){
                        $tot = $result['result'] - $total[$value['mortuaryID']];
                        $text .= "<td style='text-align:center'>" . $tot . " €</td>";
                    }else{
                        $text .= "<td style='text-align:center'><strong> - </strong></td>";
                    }
                }
                $text .= "
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "retirarCenizas":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/retirarCenizas.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }

                $data = getRetirarCenizas($expedient);
                $staticInfo = $documentsInfo->getByDocument('retirarCenizas');
                if($staticInfo != null){
                    foreach($staticInfo as $elem){
                        switch($elem['name']){
                            case 'companyDoc21':
                                $company = $elem['value'];
                            break;
                            case 'companyAddressDoc21':
                                $address = $elem['value'];
                            break;
                            case 'companyLocationDoc21':
                                $location = $elem['value'];
                            break;
                            case 'provinceDoc21':
                                $province = $elem['value'];
                            break;
                        }
                    }
                }else{
                    $company = '';
                    $address = '';
                    $location = '';
                    $province = '';
                }
                
                $utils = new Utils();
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                }

                $background = $utils->getBackgroundDocuments();

                if(intval($_SESSION['company']) == 2){

                    $exhumation = $data['exhumation'];
                    $funeralNicheNumber = $data['funeralNicheNumber'];
                    $deceasedName = $data['deceasedName'];
                    $deceasedSurname = $data['deceasedSurname'];
                    $cemetery = $data['cemetery'] == null ? '' : $data['cemetery'];
                    $applicantName = $data['applicantName'];
                    $applicantSurname = $data['applicantSurname'];
                    $applicantNIF = $data['applicantNIF'];
                    $deceasedNiche = $data['deceasedNiche'];
                    $funeralDateNiche = $entregarCenizasFecha = date("d/m/Y", $data['funeralDateNiche']);
                    $cemeteryLocation = $data['cemeteryLocation'];
                    $cemeteryProvince = $data['cemeteryProvince'];

                    $text = "
                            <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='font-size: 16px!important'>
                                    <br><br><br><br><br>
                                    <p style='text-align: right;'>EXP.: <strong>" . $data['number'] . "</strong></p>
                                    <br><br>
                                    <div class='text-center' style='line-height: 2;'>
                                        <p>
                                            <strong>Autorización Reducción Restos</strong>
                                        </p>
                                    </div>
                                    <br><br><br>
                                    <div style='line-height: 2;'>
                                        <p>
                                            <strong>D/Dña. $applicantName $applicantSurname con DNI: $applicantNIF</strong>, como representante de la familia del fallecido $gender $deceasedName $deceasedSurname (D.E.P.), 
                                            como usufructario/a del panteón en regimen de propiedad con inscripción: $exhumation, como <strong>titular</strong> del <strong>nicho nº $funeralNicheNumber</strong> del 
                                            <strong>Cementerio Parroquial de $cemetery - $cemeteryLocation - $cemeteryProvince </strong>.
                                        </p>
                                    </div>
                                    <br><br>
                                    <div style='line-height: 2;'>
                                        <p>
                                            Autorizo a <strong>$company</strong> para que proceda a practicar una reducción de los restos mortales de <strong>D./Dña. $deceasedNiche fallecido el $funeralDateNiche</strong>, 
                                            según DECRETO 151/2014, de 20 de noviembre, de sanidad mortuaria de Galicia.
                                        </p>
                                    </div>
                                    <br>
                                    <div style='line-height: 2;'>
                                        <p>
                                            Atentamente,
                                        </p>
                                    </div>
                                    <br><br><br>
                                    <div>
                                        <p>En $location, a " . $utils->fechaCastellano2(date('Y')) . ".</p>
                                        <br><br><br><br>
                                        <div style='font-size: 14px; text-align: right;'><p>Fdo.: $applicantName $applicantSurname</p></div>
                                        <br><br><br><br>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";
                }else{

                    $deceasedName = $data['deceasedName'];
                    $deceasedSurname = $data['deceasedSurname'];

                    $dayA = $data['deceasedDate'] == null ? '' : date("d", strtotime($data['deceasedDate']));
                    $monthA = $data['deceasedDate'] == null ? '' : date("m", strtotime($data['deceasedDate']));
                    $monthA = getMonth($monthA);
                    $yearA = $data['deceasedDate'] == null ? '' : date("Y", strtotime($data['deceasedDate']));

                    $cemetery = $data['cemetery'] == null || $data['cemeteryLabel'] != 'Cementerio' ? '_______________________________________________ ' : $data['cemetery'];
                    if($cemetery != '_______________________________________________ '){
                        $cemeteryLocation = $data['cemeteryLocation'] == null ? '___________________________' : $data['cemeteryLocation'];
                        $cemeteryLocation .= $data['cemeteryProvince'] == null ? '' : ' de ' . $data['cemeteryProvince'];
                    }else{
                        $cemeteryLocation = '___________________________';
                    }

                    $cemetery2 = $data['cemetery'] == null ? '_______________________________________________ ' : $data['cemetery'];
                    if($cemetery2 != '_______________________________________________ '){
                        $cemeteryLocation2 = $data['cemeteryLocation'] == null ? '___________________________' : $data['cemeteryLocation'];
                        $cemeteryLocation2 .= $data['cemeteryProvince'] == null ? '' : ' de ' . $data['cemeteryProvince'];
                    }else{
                        $cemeteryLocation2 = '___________________________';
                    }

                    $cementerySelected = '';
                    $crematorioSelected = '';
                    if($data['cemeteryLabel'] == 'Cementerio'){
                        $cementerySelected = 'X';
                    }else if($data['cemeteryLabel'] == 'Crematorio'){
                        $crematorioSelected = 'X';
                    }

                    $nicheSelected = '';
                    $panteonSelected = '';
                    $fosaSelected = '';
                    $otherSelected = '';
                    switch($data['niche']){
                        case '2':
                            $nicheSelected = 'X';
                        break;
                        case '3':
                            $panteonSelected = 'X';
                        break;
                        case '4':
                            $fosaSelected = 'X';
                        break;
                        case '5':
                            $otherSelected = 'X';
                        break;
                    }

                    $numNiche = $data['funeralNicheNumber'] == null || $data['funeralNicheNumber'] == '' ? '_________ ' : $data['funeralNicheNumber'];
                    $nicheHeight = $data['nicheHeight'] == null || $data['nicheHeight'] == '' || $data['nicheHeight'] == '0' ? '__________ ' : $data['nicheHeight'] .'º';

                    $applicantLocation = $data['applicantLocation'] == null || $data['applicantLocation'] == '' ? '__________________' : $data['applicantLocation'];

                    $familyContactAddress = '';
                    if($data['familyContactLocality'] != null && $data['familyContactLocality'] != ''){
                        $familyContactAddress .=  $data['familyContactLocality'];
                    }
                    if($data['familyContactProvince'] != null && $data['familyContactProvince'] != ''){
                        $familyContactAddress .= ', ' . $data['familyContactProvince'];
                    }

                    $deceasedInName = $data['deceasedIn'];
                    if($data['deceasedInName'] != null && $data['deceasedInName'] != ''){
                        $deceasedInName .= ', ' . $data['deceasedInName'];
                    }

                    $text = "
                        <div class='fondo'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: -5px'>
                                    <div style='text-align: right; padding-top: 35px; line-height: 0.5'>
                                        <p><strong>$company</strong></p>
                                        <p>$address</p>
                                        <p>$location</p>
                                        <p>$province</p>
                                    </div>
                                    <div class='titulo' style='text-align:center;margin-top:30px'>
                                        <span>
                                            <strong>AUTORIZACI&Oacute;N PARA TRASLADO DE CENIZAS</strong>
                                            <br><br>
                                            <strong>RETIRADA DE CENIZAS</strong>
                                        </span>
                                    </div>
                                    <br>
                                    <div style='text-align:justify'>
                                        <span style='font-size:12px'>
                                            Por medio del presente documento, el abajo firmante, se declara representante acreditado por la familia y/o propietarios, 
                                            para dar autorizaci&oacute;n a <strong>$company</strong> a realizar la apertura del nicho indicado a continuaci&oacute;n, 
                                            eximiendo a ésta de toda responsabilidad frente a cualquier reclamaci&oacute;n que se pudiese presentar contra la misma, por carecer 
                                            de autorizaci&oacute;n suficiente para la apertura de la unidad de enterramiento. 
                                            Se libera por tanto a $company de la total responsabilidad, asumi&eacute;ndola el abajo firmante en este 
                                            documento de Autorizaci&oacute;n:
                                            <br><br>
                                            " . $gender . ": <strong><u>" . $data['familyContactName'] . " " . $data['familyContactSurname'] . "</u></strong>, 
                                            con DNI: <strong><u>" . $data['familyContactNIF'] . "</u></strong>, con domicilio en <strong><u>" . $data['familyContactAddress'] . 
                                            ", " . $familyContactAddress . "</u></strong>:
                                            <br>
                                            <p>
                                            <br>
                                            Como representante de la familia de $gender $deceasedName $deceasedSurname, fallecido el 
                                            $dayA de $monthA del $yearA en " . $deceasedInName . ".
                                                <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                                    <tr> 
                                                        <td style='width:3%'>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td style='width:5%;height: 25px'>
                                                            <span style='font-size: 12px;color:$colorStyle'>
                                                                &nbsp;Judicial
                                                            </span>
                                                        </td>
                                                        <td style='width:92%;height: 25px'>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </p>
                                        </span>
                                    </div>
                                    <div class='titulo' style='text-align:center;margin-top:15px'>
                                        <span>
                                            <strong><u>SOLICITO</u></strong>
                                        </span>
                                    </div>
                                    <div style='text-align:justify'>
                                        <span style='font-size:12px'>
                                            <p>
                                                <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'>
                                                    <tr>
                                                        <td style='height: 25px'>
                                                            <span style='font-size: 12px;color:$colorStyle'>
                                                                La apertura de la unidad de enterramiento
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span>$nicheSelected</span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td style='height: 25px'>
                                                            <span style='font-size: 12px;color:$colorStyle'>
                                                                &nbsp;Nicho&nbsp;
                                                            </span>
                                                        </td>
                                                        <td style=''>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span>$panteonSelected</span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td style='height: 25px'>
                                                            <span style='font-size: 12px;color:$colorStyle'>
                                                                &nbsp;Panteón&nbsp;
                                                            </span>
                                                        </td>
                                                        <td style=''>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span>$fosaSelected</span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td style='height: 25px'>
                                                            <span style='font-size: 12px;color:$colorStyle'>
                                                                &nbsp;Fosa&nbsp;
                                                            </span>
                                                        </td>
                                                        <td style=''>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span>$otherSelected</span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td style='height: 25px'>
                                                            <span style='font-size: 12px;color:$colorStyle'>
                                                                &nbsp;Otro: &nbsp;_____________
                                                            </span>
                                                        </td>
                                                    </tr>
                                                </table>
                                                <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'>
                                                    <tr style='line-height:2'>
                                                        Nº $numNiche  &nbsp;Altura: $nicheHeight  &nbsp;Calle: __________   &nbsp;Bloque: _________   &nbsp;Fila: _________   &nbsp;Otro: ____________
                                                        del cementerio $cemetery de $cemeteryLocation y de la que soy:
                                                    </tr>
                                                    <tr>
                                                        <td style=''>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td style='height: 25px'>
                                                            <span style='font-size: 12px;color:$colorStyle'>
                                                                Propietario
                                                            </span>
                                                        </td>
                                                        <td style=''>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td style='height: 25px'>
                                                            <span style='font-size: 12px;color:$colorStyle'>
                                                                Heredero
                                                            </span>
                                                        </td>
                                                        <td style=''>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td style='height: 25px'>
                                                            <span style='font-size: 12px;color:$colorStyle'>
                                                                Usufructario
                                                            </span>
                                                        </td>
                                                        <td style=''>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td style='height: 25px'>
                                                            <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Otro: &nbsp;__________________
                                                            </span>
                                                        </td>
                                                    </tr>
                                                </table>
                                                para que procedan a <strong>RETIRAR</strong> sus restos mortales (cenizas) y proceder a su traslado al:
                                                <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'>
                                                    <tr>
                                                        <td>
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span>$cementerySelected</span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td style='height: 25px'>
                                                            <span style='font-size: 12px;color:$colorStyle'>
                                                                &nbsp;Cementerio&nbsp;
                                                            </span>
                                                        </td>
                                                        <td>
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span>$crematorioSelected</span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td style='height: 25px'>
                                                            <span style='font-size: 12px;color:$colorStyle'>
                                                                &nbsp;Crematorio&nbsp;
                                                            </span>
                                                        </td>
                                                        <td style='height: 25px'>
                                                            <span style='font-size: 12px;color:$colorStyle'>
                                                                $cemetery2 de $cemeteryLocation2
                                                            </span>
                                                        </td>
                                                    </tr>
                                                </table>
                                                <br><br>
                                                A su vez, con la firma del presente, se exonera a <strong>$company</strong> de cualquier tipo de responsabilidad derivada 
                                                del depósito de los restos mortales del fallecido en el nicho indicado, asumiendo el firmante cualquier responsabilidad derivada 
                                                de este encargo, en especial, cualquier responsabilidad exigible en lo concerniente a la posesión o propiedad de este.
                                                <br><br><br>
                                                <i>
                                                    <strong>Nota: </strong> La empresa no se hace responsable de los daños que puedan sufrir tanto la lápida como los demás 
                                                    ornamentos que se encuentran en la misma. La empresa se compromete a realizar las tareas con la mayor cautela, tratando en 
                                                    todo momento de evitar cualquier daño. La familia puede solicitar la retirada de los ornamentos a su empresa marmolista de 
                                                    confianza, asumiendo ésta la responsabilidad de los posibles daños que puedan surgir.
                                                </i>
                                                <br><br><br>
                                                <div style='font-size: 14px; text-align: right;'>
                                                    <p>Para que así conste, firmo la presente en $applicantLocation, a ".date('d')." de " .getMonth(date('m')) ." de " .date('Y')."</p>
                                                </div>
                                                <br><br>
                                                <div style='font-size: 14px; text-align: right;'>
                                                    <p>
                                                        <i>
                                                            Fdo.: ".$data['familyContactName'] . " " . $data['familyContactSurname']."
                                                            <br>
                                                            DNI: ".$data['familyContactNIF'] ."
                                                        </i>
                                                    </p>
                                                </div>
                                            </p>
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";
                }
            
                return $text;
            break;

            case "actaExtraccionDispositivos":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/actaExtraccionDispositivos.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }

                $data = getActaExtraccionDispositivos($expedient);
                $staticInfo = $documentsInfo->getByDocument('actaExtraccionDispositivos');
                if($staticInfo != null){
                    foreach($staticInfo as $elem){
                        switch($elem['name']){
                            case 'companyDoc26':
                                $company = $elem['value'];
                            break;
                            case 'companyAddressDoc26':
                                $address = $elem['value'];
                            break;
                            case 'companyLocationDoc26':
                                $location = $elem['value'];
                            break;
                            case 'companyProvinceDoc26':
                                $province = $elem['value'];
                            break;
                        }
                    }
                }else{
                    $company = '';
                    $address = '';
                    $location = '';
                    $province = '';
                }
                
                $utils = new Utils();
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                }

                $background = $utils->getBackgroundDocuments();

                $deceasedName = $data['deceasedName'];
                $deceasedSurname = $data['deceasedSurname'];

                $dayA = $data['deceasedDate'] == null ? '' : date("d", strtotime($data['deceasedDate']));
                $monthA = $data['deceasedDate'] == null ? '' : date("m", strtotime($data['deceasedDate']));
                $monthA = getMonth($monthA);
                $yearA = $data['deceasedDate'] == null ? '' : date("Y", strtotime($data['deceasedDate']));

                $timeDeceased = $data['deceasedTime'] == null ? '' : date("H:i", strtotime($data['deceasedTime']));

                require_once($_SESSION['basePath'] . "model/users.php");
                $users = new Users;
                $userInfo = $users->getDataUserSession();

                if($userInfo[0]['userData'] != null && $userInfo[0]['userData'] != ''){
                    $userName = trim($userInfo[0]['userData']);
                }else{
                    $userName = "____________________________";
                }

                if($userInfo[0]['nif'] != null && $userInfo[0]['nif'] != ''){
                    $userNIF = trim($userInfo[0]['nif']);
                }else{
                    $userNIF = "_______________";
                }
                
                $text = "
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas' style='padding-top: -5px'>
                                <div style='text-align: right; padding-top: 35px; line-height: 0.5'>
                                    <p><strong>$company</strong></p>
                                    <p>$address</p>
                                    <p>$location</p>
                                    <p>$province</p>
                                </div>
                                <div class='titulo' style='text-align:center;margin-top:30px'>
                                    <span>
                                        <strong>ACTA</strong>
                                    </span>
                                </div>
                                <br>
                                <div style='text-align:justify'>
                                    <span style='font-size:12px'>
                                        <strong>D/Dña: $userName</strong>, con <strong>DNI: $userNIF</strong>, en posesión del
                                        <strong>Certificado de Profesionalidad de Tanatopraxia (SANP0108)</strong> certifica que:
                                        <br>
                                        <p>
                                            <br>
                                            Al cadáver de <strong>$gender $deceasedName $deceasedSurname</strong> (Q.P.E.D.), fallecido/a el día <strong> 
                                            $dayA de $monthA del $yearA </strong> a las <strong> $timeDeceased h </strong> le han sido extraídos de su cuerpo el/los siguiente/s:
                                            <br>
                                            <div class='titulo' style='text-align:center;margin-top:10px;margin-bottom:15px;'>
                                                <span>
                                                    <strong><u>Dispositivos*</u></strong>
                                                </span>
                                            </div>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                                <tr> 
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Marcapasos
                                                        </span>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            Marca: _____________ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Modelo: _____________ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nº de serie: ________________
                                                        </span>
                                                    </td>
                                                </tr>
                                                <tr> 
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Desfibrilador (DAI)
                                                        </span>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            Marca: _____________ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Modelo: _____________ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nº de serie: ________________
                                                        </span>
                                                    </td>
                                                </tr>
                                                <tr> 
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Otro
                                                        </span>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            Marca: _____________ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Modelo: _____________ &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Nº de serie: ________________
                                                        </span>
                                                    </td>
                                                </tr>
                                            </table>
                                            <br>
                                            <i>
                                                (*) Los dispositivos, una vez extraídos, se procede a su limpieza y desinfección para luego ser eliminados a través del servicio 
                                                de gestión de residuos correspondiente.
                                            </i>
                                        </p>
                                    </span>
                                </div>
                                <div class='titulo' style='text-align:center;margin-top:15px'>
                                    <span>
                                        <strong><u>Prótesis o Tejidos</u></strong>
                                    </span>
                                </div>
                                <div style='text-align:justify'>
                                    <span style='font-size:12px'>
                                        <p>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                                <tr> 
                                                    <td style='width:5%'>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='width:33%;height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Enucleación Globo Ocular
                                                        </span>
                                                    </td>
                                                    <td style='width:5%'>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='width:15%;height: 25px'>
                                                        <span style='font-size: 12px;color:#1f497dtext-align:left;'>
                                                            &nbsp;IZQUIERDO
                                                        </span>
                                                    </td>
                                                    <td style='width:5%'>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='width:15%;height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;DERECHO
                                                        </span>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        &nbsp;
                                                    </td>
                                                </tr>
                                            </table>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                                <tr> 
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Extracción Tejido 
                                                        </span>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            _____________________________________________________________________
                                                        </span>
                                                    </td>
                                                </tr>
                                                <tr> 
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Extracción de prótesis
                                                        </span>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            _____________________________________________________________________
                                                        </span>
                                                    </td>
                                                </tr>
                                                <tr> 
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Otras extracciones
                                                        </span>
                                                    </td>
                                                    <td style='height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            _____________________________________________________________________
                                                        </span>
                                                    </td>
                                                </tr>
                                            </table>
                                            <br><br><br>
                                            <div style='font-size: 14px; text-align: right;'>
                                                <p>Para que así conste, firmo la presente en __________________, a ".date('d')." de " .getMonth(date('m')) ." de " .date('Y')."</p>
                                            </div>
                                            <br><br>
                                            <div style='font-size: 14px; text-align: right;'>
                                                <p>
                                                    <i>
                                                        Fdo.: $userName
                                                        <br>
                                                        DNI: $userNIF
                                                    </i>
                                                </p>
                                            </div>
                                        </p>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                ";
                
            
                return $text;
            break;

            case "resumenServicio":
                $utils = new Utils();
                $data = getResumenServicio($expedient);

                $room = $data['sumary']['deceasedRoom'];
                $timeGo = $data['sumary']['funeralTime'];
                if($timeGo != null){
                    $time = explode(':', $timeGo);
                    $timeGo = $time[0] . ':' . $time[1];
                }
                $churchSummary = $data['sumary']['churchSummary'];
                $licenseSummary = $data['sumary']['licenseSummary'];
                $deliveryReceiptSummary = $data['sumary']['deliveryReceiptSummary'];
                $reminderSummary = $data['sumary']['reminderSummary'];
                $introduction = $data['sumary']['crematoriumIntroduction'] == 1 ? 'SI' : 'NO';
                $entregarCenizasPersona = $data['sumary']['authName'];

                if($data['sumary']['authDate'] != null && $data['sumary']['authDate'] != ''){
                    $entregarCenizasFecha = date("d/m/Y", $data['sumary']['authDate']);
                }else{
                    $entregarCenizasFecha = '';
                }
                if($data['sumary']['authTime'] != null && $data['sumary']['authTime'] != ''){
                    $entregarCenizasHora = date("H:i", $data['sumary']['authTime']);
                }else{
                    $entregarCenizasHora = '';
                }
            
                $entregarCenizasLugar = $data['sumary']['authPlace'];
                $waitOnRoom = $data['sumary']['crematoriumWaitOnRoom'] == 1 ? 'SI' : 'NO';
                $vaseBio = $data['sumary']['crematoriumVaseBio'] == 1 ? 'SI' : 'NO';
                $ecologic = $data['sumary']['ecologicCoffin'] == 1 ? 'SI' : 'NO';
                $pacemaker = $data['sumary']['crematoriumPacemaker'] == 1 ? 'SI' : 'NO';
                $background = $utils->getBackgroundDocuments();
                $text = "
                    <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                        <div style='margin-right:50px;right:480px; position: absolute; text-align: right; padding-top: 50px;'>
                            <p>EXP.: <strong>" . $data['sumary']['number'] . "</strong></p>
                        </div>
                        <br><br>
                        <div class='contenidoPompas' style='padding-top:-1px'>
                            <div class='titulo text-center' style='text-align: center;'>
                                <u><strong>RESUMEN SERVICIO</strong></u>
                            </div>
                            <br>
                            <table>
                ";
                    
                if(intval($data['sumary']['cremation']) == 1){
                    $crematoriumA = "Crematorio: <strong>" . $data['sumary']['crematorium'] . "</strong>";
                    $introduccion = "Introducción: <strong>$introduction</strong>";
                    $entregaCenizas = "Entregar cenizas:";
                    $entregaCenizasFecha = "Fecha: <strong>$entregarCenizasFecha</strong>";
                    $entregaCenizasHora = "Hora: <strong>$entregarCenizasHora</strong>";
                    $entregaCenizasLugar = "Lugar: <strong>$entregarCenizasLugar</strong>";
                    $urnaBio = "Urna biodegradable: <strong>$vaseBio</strong>";
                    $feretroEco = "Féretro ecológico: <strong>$ecologic</strong>";
                }else{
                    $crematoriumA = "";
                    $introduccion = "";
                    $urnaBio = "";
                    $feretroEco = "";
                    $entregaCenizas = "";
                    $entregaCenizasFecha = "";
                    $entregaCenizasHora = "";
                    $entregaCenizasLugar = "";
                }

                if($data['sumary']['deceasedGender'] == 'Hombre'){
                    $pre = 'D. ';
                }else{
                    $pre = 'Dña. ';
                }

                if($data['sumary']['cremation'] == 1){
                    $text .= "  
                            <tr>
                                <td style='width:60%;'><p style='color: $colorStyle font-size: 12px;'>Nombre: $pre <strong>" . $data['sumary']['deceasedName'] . " " . $data['sumary']['deceasedSurname'] . "</strong> (Q.E.P.D.)</p></td>
                                <td style='width:37%;'><p style='color: $colorStyle font-size: 12px;'>$crematoriumA</p></td>
                                <td style='width:2%;'></td>
                            </tr>
                            <tr>
                                <td style='line-height:0.7em'>&nbsp;</td>
                            </tr>
                            <tr>
                                <td><p style='color: $colorStyle font-size: 12px;'>Lugar: <strong>" . $data['sumary']['mortuary'] . "</strong>, Sala: <strong>" . $room . "</strong></p></td>
                                <td><p style='color: $colorStyle font-size: 12px;'>$introduccion</p></td>
                            </tr>
                            <tr>
                                    <td style='line-height:0.7em'>&nbsp;</td>
                            </tr>
                            <tr>
                                <td><p style='color: $colorStyle font-size: 12px;'>Iglesia: <strong>" . $data['sumary']['church'] . "</strong></p></td>
                                <td><p style='color: $colorStyle font-size: 12px;'>$urnaBio</p></td>
                            </tr>
                            <tr>
                                <td style='line-height:0.7em'>&nbsp;</td>
                            </tr>
                            <tr>
                                <td><p style='color: $colorStyle font-size: 12px;'>Hora de salida: <strong>" . date($timeGo) . "</strong></p></td>
                                <td><p style='color: $colorStyle font-size: 12px;'>$feretroEco</p></td>
                            </tr>
                            <tr>
                                <td style='line-height:0.7em'>&nbsp;</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td><p style='color: $colorStyle font-size: 12px;'>$entregaCenizas</p></td>
                            </tr>
                            <tr>
                                <td style='line-height:0.7em'>&nbsp;</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td><p style='color: $colorStyle font-size: 12px;'>&nbsp;&nbsp;&nbsp;&nbsp;$entregaCenizasFecha</p></td>
                            </tr>
                            <tr>
                                <td style='line-height:0.7em'>&nbsp;</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td><p style='color: $colorStyle font-size: 12px;'>&nbsp;&nbsp;&nbsp;&nbsp;$entregaCenizasHora</p></td>
                            </tr>
                            <tr>
                                <td style='line-height:0.7em'>&nbsp;</td>
                            </tr>
                            <tr>
                                <td></td>
                                <td><p style='color: $colorStyle font-size: 12px;'>&nbsp;&nbsp;&nbsp;&nbsp;$entregaCenizasLugar</p></td>
                            </tr>
                        </table>
                    ";
                }else{
                    $text .= "  
                            <tr>
                                <td style='width:60%;'><p style='color: $colorStyle font-size: 12px;'>Nombre: $pre <strong>" . $data['sumary']['deceasedName'] . " " . $data['sumary']['deceasedSurname'] . "</strong> (Q.E.P.D.)</p></td>
                            </tr>
                            <tr>
                                <td style='line-height:0.7em'>&nbsp;</td>
                            </tr>
                            <tr>
                                <td><p style='color: $colorStyle font-size: 12px;'>Lugar: <strong>" . $data['sumary']['mortuary'] . "</strong>, Sala: <strong>" . $room . "</strong></p></td>
                            </tr>
                            <tr>
                                    <td style='line-height:0.7em'>&nbsp;</td>
                            </tr>
                            <tr>
                                <td><p style='color: $colorStyle font-size: 12px;'>Iglesia: <strong>" . $data['sumary']['church'] . "</strong></p></td>
                            </tr>
                            <tr>
                                <td style='line-height:0.7em'>&nbsp;</td>
                            </tr>
                            <tr>
                                <td><p style='color: $colorStyle font-size: 12px;'>Hora de salida: <strong>" . date($timeGo) . "</strong></p></td>
                            </tr>
                        </table><br>
                    ";
                }

                $bus = $data['bus'];
                if($bus != null){
                    $text .= "<p class='separator'><strong>Autobuses:</strong></p>";
                    foreach($bus as $elem){
                        $text .= "  <p class='separator'>- Modelo: " . $elem['modelName'] . ", Proveedor: " . $elem['supplierName'] . "</p>";
                    }
                }

                $taxi = $data['taxi'];
                if($taxi != null){
                    $text .= "<p class='separator'><strong>Taxis:</strong></p>";
                    foreach($taxi as $elem){
                        $text .= "  <p class='separator'>- Modelo: " . $elem['modelName'] . ", Proveedor: " . $elem['supplierName'] . "</p>";
                    }
                }

                $reminder = $data['reminder'];
                if($reminder != null){
                    $text .= "<p class='separator'><strong>Recordatorios:</strong></p>";
                    foreach($reminder as $elem){
                        $text .= "  <p class='separator'>- Modelo: " . $elem['modelName'] . ", Proveedor: " . $elem['supplierName'] . "</p>";
                    }
                }

                $text .= "
                    <p class='separator'>Ruta a seguir:</p>     
                    <div style='min-height: 100px;' class='firma$firmaColor'>
                        <pre style='border: 0; background-color: none; color: $colorStyle font-size: 12px;'>" . $data['sumary']['routeSummary'] . "</pre><br>
                    </div>
                    <div style='display: inline-block;'>
                ";
                if($churchSummary == 1){
                    $text .= "  <span>Datos Iglesia: <strong>[X]</strong></span>&nbsp;&nbsp;";
                }
                if($licenseSummary == 1){
                    $text .= "  <span>Licencia: <strong>[X]</strong></span>&nbsp;&nbsp;";
                }
                if($deliveryReceiptSummary == 1){
                    $text .= "  <span>Recibís: <strong>[X]</strong></span>&nbsp;&nbsp;";
                }
                if($reminderSummary == 1){
                    $text .= "  <span>Recordatorio: <strong>[X]</strong></span>";
                }

                $text .= "
                    </div>
                    <br>
                    <div>
                        <p class='separator'>Porteadores:</p>
                    </div>
                    <div style='margin-left: 20px;'>
                ";

                if(isset($data['carriers']) && $data['carriers'] != null){
                    foreach ($data['carriers'] as $carrier) {
                        $confirm = "Confirmado";
                        $car = " - ";
                        if($carrier['brand'] != ''){
                            $car .= "<strong>" . $carrier['brand'] . "</strong> ";
                        }
                        if($carrier['model'] != ''){
                            $car .= "<strong>" . $carrier['model'] . "</strong> ";
                        }
                        if($carrier['licensePlate'] != ''){
                            $car .= "<strong>" . $carrier['licensePlate'] . "</strong>";
                        }
                        if($carrier['confirmed'] != 1){
                            $confirm = "No confirmado";
                        }
                        $text .= "<p class='separator'><strong>" . $carrier['name'] . " " . $carrier['surname'] . "</strong> (" . $confirm . ")" . $car . "</p>";
                    }
                }
                
                $text .= "
                        </div>                
                        <p class='separator'>Notas:</p>     
                        <div style='min-height: 100px;' class='firma$firmaColor'>
                            <pre style='border: 0; background-color: none; color: $colorStyle font-size: 12px;'>" . $data['sumary']['notesSummary'] . "</pre><br>
                        </div>                
                    </div>";

                return $text;
            break;

            case "resumenHoy":
                $utils = new Utils();
                $data = getResumenHoy();
                $hoy = date('d/m/Y', time());
                $text = "<p style='color:$colorStyle text-align:center;'><strong>RESUMEN DE HOY ".$hoy."</strong></p>";
                if($data["expedients"] != null){
                    $text .= "
                        <div class='contenido container $fuente folioApaisado'>
                    ";                        
                    foreach($data["expedients"] AS $key=> $expedient){

                        if($key % 3 == 0 && $key % 9 != 0 && $key != 0){
                            $text .= "</div><div class='clearfix'></div><div class='contenido container $fuente folioApaisado'>";
                        }else{
                            if($key % 9 == 0 && $key != 0){
                                $text .= "</div><div class='clearfix'></div><pagebreak><div class='contenido container $fuente folioApaisado'>";
                            }
                            if($key != 0){
                                $text .= "<div style='width:1%; float: left;'></div>";
                            }
                        }

                        // Hora salida
                        $funeralTimeInfo = '-';
                        if($expedient['funeralTime'] != null && $expedient['funeralTime'] != ''){
                            $funeralTimeInfo = date('H:i', strtotime($expedient['funeralTime']));
                        }

                        // Funeraria
                        $funeralHomeInfo = '-';
                        if($expedient['funeralHome'] != null && $expedient['funeralHome'] != ''){
                            $funeralHomeInfo = $expedient['funeralHome'];
                        }

                        // Casa mortuoria
                        $mortuaryNameInfo = "-";
                        if($expedient['mortuary'] != null && $expedient['mortuary'] != ''){
                            if($expedient['mortuary'] == 'Otro'){
                                $mortuaryNameInfo = $expedient['deceasedMortuaryAddress'];
                            }else{
                                $mortuaryNameInfo = $expedient['mortuary'];
                            }
                        }

                        // Sala
                        $deceasedRoomInfo = '-';
                        if($expedient['deceasedRoom'] != null && $expedient['deceasedRoom'] != ''){
                            if($expedient['deceasedRoom'] === 0 || $expedient['deceasedRoom'] === '0'){
                                $expedient['deceasedRoom'] = "O";
                            }
                            $deceasedRoomInfo = $expedient['deceasedRoom'];
                        }

                        // Autobuses
                        $busesInfo = '-';
                        if($expedient['buses'] != null){
                            $busesInfo = $expedient['buses'];
                        }

                        // Parroquia
                        $churchInfo = '-';
                        if($expedient['church'] != null && $expedient['church'] != ''){
                            $churchInfo = $expedient['church'];

                            if($expedient['ceremonyTime'] != null && $expedient['ceremonyTime'] != ''){
                                $churchInfo .= ' ('. date('H:i', strtotime($expedient['ceremonyTime'])) . ')';
                            }
                        }

                        // Cementerio / Crematorio
                        $cemeteryRow = '';
                        if(intval($expedient['cremation']) == 1){
                            $cemeteryRow = "<strong>Crematorio: </strong> ";

                            if($expedient['crematoriumName'] != null && $expedient['crematoriumName'] != ''){
                                $cemeteryRow .= $expedient['crematoriumName'];

                                if($expedient['crematoriumEntry'] != null && $expedient['crematoriumEntry'] != ''){
                                    $cemeteryRow .= ' ('. date('H:i', strtotime($expedient['crematoriumEntry'])) . ')';
                                }
                            }
                            

                            $cemeteryRow .= "<br>";
                        }else{
                            $cemeteryRow = "<strong>Cementerio: </strong> ";
                            
                            if($expedient['cemetery'] != null && $expedient['cemetery'] != ''){
                                $cemeteryRow .= $expedient['cemetery'];

                                if($expedient['funeralTimeBurial'] != null && $expedient['funeralTimeBurial'] != ''){
                                    $cemeteryRow .= ' ('. date('H:i', strtotime($expedient['funeralTimeBurial'])) . ')';
                                }
                            }

                            $cemeteryRow .= "<br>";
                        }

                        // Porteadores
                        $carriersInfo = "-";
                        if($expedient['carriersTime'] != null){
                            $carriersInfo = date('H:i', strtotime($expedient['carriersTime']));
                        }

                        $flag = false;
                        if($expedient['type'] == 3 || $expedient['type'] == '3'){
                            if($data['cremations'] != null){
                                foreach($data["cremations"] as $cremation){    
                                    if($expedient['expedientID'] == $cremation['expedientID']){
                                        $flag = true;
                                    }  
                                }
                            }
                        }else{
                            $flag = true;
                        }

                        if($flag){

                            if($expedient['deceasedGender'] == 'Hombre'){
                                $pre = 'D. ';
                            }else{
                                $pre = 'Dña. ';
                            }

                            $text .= "<div style='width:30%; background-color:#f5f0f0; float: left; border-bottom: 2px solid $colorStyle margin-left: 3px; margin-bottom:8px; padding: 10px; height:300px;'>
                                    <p>
                                        <strong>Hora de salida: $funeralTimeInfo</strong><br>
                                        <strong>Nº exp: </strong>" . $expedient['number'] . "<br>
                                        <strong>Nombre: </strong>" . $pre . $expedient['deceasedName'] . " " . $expedient['deceasedSurname'] . "<br>
                                        <strong>Funeraria del servicio: </strong>" . $funeralHomeInfo . "<br>
                                        <strong>Casa mortuoria: </strong>" . $mortuaryNameInfo . "<br>
                                        <strong>Sala: </strong>" . $deceasedRoomInfo . "<br>
                                        <strong>Nº Autobuses: </strong>" . $busesInfo . "<br>
                                        <strong>Parroquia: </strong>" . $churchInfo . "<br>
                                        $cemeteryRow
                                        <strong>Porteadores: </strong>$carriersInfo
                                    </p>
                            ";
                            if(isset($expedient['carriers']) && count($expedient['carriers']) > 0){
                                $brand ='';
                                $model = '';
                                $license = '';                                        
                                foreach($expedient['carriers'] AS $key=> $carrier){
                                    $flag = true;
                                    if($expedient['cars'] > 0){                                                              
                                        foreach($expedient['cars'] AS $key=> $car){
                                            if($flag){
                                                if($carrier['name'] . ' ' . $carrier['surname'] == $car['driverName'] . ' ' . $car['driverSurname']){
                                                    $brand = ' - ' . $car['brand'];
                                                    $model = $car['model'];
                                                    $license = $car['licensePlate'];
                                                    $flag = false;                                        
                                                }else{
                                                    $brand ='';
                                                    $model = '';
                                                    $license = '';
                                                }
                                            }
                                        }
                                    }
                                    if($carrier['confirmed'] == "1"){                                
                                        $text .= "<li style='list-style:none'>" . $carrier['name'] . " " . $carrier['surname'] . "<strong>" . $brand . " " . $model . " " . $license . "</strong></li>";      
                                    }else{                                
                                        $text .= "<li style='list-style:none'>(*) " . $carrier['name'] . " " . $carrier['surname'] . "<strong>" . $brand . " " . $model . " " . $license . "</strong></li>";
                                    }
                                }
                            }
                            $text .= "</div>";
                        }
                    }  
                }

                if($data["cremations"] != null){ //CREMACIONES
                    if($data["expedients"] != null){
                        $text .= "<pagebreak>";
                    }
                    usort($data["cremations"], function($a, $b) {return strcmp($a['crematoriumID'], $b['crematoriumID']);});

                    $currentCrematorium = null;
                    foreach($data["cremations"] AS $key=> $expedient){   
                        if($currentCrematorium != $expedient['crematoriumID']){
                            if($key != 0){
                                $text .= "<pagebreak>";
                            }

                            $text .= "<p style='color:$colorStyle text-align:center;'><strong>Crematorio ".$expedient['crematoriumName']."</strong></p>";
                            $currentCrematorium = $expedient['crematoriumID'];
                        }else{
                            if($key % 3 == 0 && $key % 9 != 0 && $key != 0){
                                $text .= "</div><div class='clearfix'></div><div class='contenido container $fuente folioApaisado'>";
                            }else{
                                if($key % 9 == 0 && $key != 0){
                                    $text .= "</div><div class='clearfix'></div><pagebreak><div class='contenido container $fuente folioApaisado'>";
                                }
                                if($key != 0){
                                    $text .= "<div style='width:1%; float: left;'></div>";
                                }
                            }
                        }

                        $start = $expedient['start'] == null ? '' : date('H:i', strtotime($expedient['start']));
                        $crematoriumArriveTime = $expedient['crematoriumArriveTime'] == null ? '' : date('H:i', strtotime($expedient['crematoriumArriveTime']));

                        $crematoriumIntroduction = 'No';
                        if($expedient['crematoriumIntroduction'] == "1"){
                            $crematoriumIntroduction = "Sí";
                        }
                        $crematoriumWaitOnRoom = 'No';
                        if($expedient['crematoriumWaitOnRoom'] == "1"){
                            $crematoriumWaitOnRoom = "Sí";
                        }
                        $crematoriumVaseBio = 'No';
                        if($expedient['crematoriumVaseBio'] == "1"){
                            $crematoriumVaseBio = "Sí";
                        }
                        $ecologicCoffin = 'No';
                        if($expedient['ecologicCoffin'] == "1"){
                            $ecologicCoffin = "Sí";
                        }
                        $crematoriumPacemaker = 'No';
                        if($expedient['crematoriumPacemaker'] == "1"){
                            $crematoriumPacemaker = "Sí";
                        }

                        if($expedient['deceasedGender'] == 'Hombre'){
                            $pre = 'D. ';
                        }else{
                            $pre = 'Dña. ';
                        }

                        $text .= "
                            <div class='$fuente' style='width:30%; background-color:#D1FAFF; float: left; border-bottom: 2px solid $colorStyle margin-left: 3px; margin-bottom:8px; padding: 10px; height:220px;'>
                            <p>
                                <strong>Crematorio: </strong>" . $expedient['crematoriumName'] . "<br>
                                <strong>Hora de introducción: </strong>" . $start . "<br>
                                <strong>Nº exp: </strong>" . $expedient['number'] . "<br>
                                <strong>Nombre: </strong>" . $pre . $expedient['deceasedName'] . " " . $expedient['deceasedSurname'] . "<br>
                                <strong>Funeraria: </strong>" . $expedient['funeralHome'] . "<br>
                                <strong>Familiar de contacto: </strong>" . $expedient['familyContactName'] . " ". $expedient['familyContactSurname'] . " " . $expedient['familyContactMobilePhone'] . "<br>
                                <strong>Introducción: </strong>" . $crematoriumIntroduction . "<br>
                        " ;

                        if($expedient['crematoriumIntroduction'] == "1"){
                            $text .=    "<strong>Hora llegada familia: </strong>" . $crematoriumArriveTime . "<br>";
                        }

                        $text .= " 
                            <strong>Esperar en sala: </strong>" . $crematoriumWaitOnRoom . "<br>
                            <strong>Urna biodegradable: </strong>" . $crematoriumVaseBio . "<br>
                            <strong>Féretro ecológico: </strong>" . $ecologicCoffin . "<br>
                        ";

                        $authDateTime = '';
                        if($expedient['authDate'] != null){
                            $authDateTime .= date('d/m/Y', $expedient['authDate']);
                        }
                        if($expedient['authTime'] != null){
                            $authDateTime .= ' ' . date('H:i', $expedient['authTime']);
                        }
                        $text .= " 
                            <strong>Entrega de cenizas: </strong>" . $authDateTime . "<br>
                            <strong>Lugar de entrega: </strong>" . $expedient['authPlace'] . "<br>
                        ";

                        $text .= '</div>';
                    } 
                }
                $text .= "</div></div></div>"; 

                return $text;
            break;

            case "resumenManhana":
                $utils = new Utils();
                $data = getResumenManhana();
                $tomorrow = new DateTime('tomorrow');            
                $tomorrow = $tomorrow->format('d/m/Y');
                $text = "<p style='color:$colorStyle text-align:center;'><strong>RESUMEN DE MAÑANA ".$tomorrow."</strong></p>";            
                if($data["expedients"] != null){ //EXPEDIENTES
                    $text .= "
                        <div class='contenido container $fuente folioApaisado'>
                    ";

                    foreach($data["expedients"] AS $key=> $expedient){
                       
                        if($key % 3 == 0 && $key % 9 != 0 && $key != 0){
                            $text .= "</div><div class='clearfix'></div><div class='contenido container $fuente folioApaisado'>";
                        }else{
                            if($key % 9 == 0 && $key != 0){
                                $text .= "</div><div class='clearfix'></div><pagebreak><div class='contenido container $fuente folioApaisado'>";
                            }
                            if($key != 0){
                                $text .= "<div style='width:1%; float: left;'></div>";
                            }
                        }

                        // Hora salida
                        $funeralTimeInfo = '-';
                        if($expedient['funeralTime'] != null && $expedient['funeralTime'] != ''){
                            $funeralTimeInfo = date('H:i', strtotime($expedient['funeralTime']));
                        }

                        // Funeraria
                        $funeralHomeInfo = '-';
                        if($expedient['funeralHome'] != null && $expedient['funeralHome'] != ''){
                            $funeralHomeInfo = $expedient['funeralHome'];
                        }

                        // Casa mortuoria
                        $mortuaryNameInfo = "-";
                        if($expedient['mortuary'] != null && $expedient['mortuary'] != ''){
                            if($expedient['mortuary'] == 'Otro'){
                                $mortuaryNameInfo = $expedient['deceasedMortuaryAddress'];
                            }else{
                                $mortuaryNameInfo = $expedient['mortuary'];
                            }
                        }

                        // Sala
                        $deceasedRoomInfo = '-';
                        if($expedient['deceasedRoom'] != null && $expedient['deceasedRoom'] != ''){
                            if($expedient['deceasedRoom'] === 0 || $expedient['deceasedRoom'] === '0'){
                                $expedient['deceasedRoom'] = "O";
                            }
                            $deceasedRoomInfo = $expedient['deceasedRoom'];
                        }

                        // Autobuses
                        $busesInfo = '-';
                        if($expedient['buses'] != null){
                            $busesInfo = $expedient['buses'];
                        }

                        // Parroquia
                        $churchInfo = '-';
                        if($expedient['church'] != null && $expedient['church'] != ''){
                            $churchInfo = $expedient['church'];

                            if($expedient['ceremonyTime'] != null && $expedient['ceremonyTime'] != ''){
                                $churchInfo .= ' ('. date('H:i', strtotime($expedient['ceremonyTime'])) . ')';
                            }
                        }

                        // Cementerio / Crematorio
                        $cemeteryRow = '';
                        if(intval($expedient['cremation']) == 1){
                            $cemeteryRow = "<strong>Crematorio: </strong> ";

                            if($expedient['crematoriumName'] != null && $expedient['crematoriumName'] != ''){
                                $cemeteryRow .= $expedient['crematoriumName'];

                                if($expedient['crematoriumEntry'] != null && $expedient['crematoriumEntry'] != ''){
                                    $cemeteryRow .= ' ('. date('H:i', strtotime($expedient['crematoriumEntry'])) . ')';
                                }
                            }
                            

                            $cemeteryRow .= "<br>";
                        }else{
                            $cemeteryRow = "<strong>Cementerio: </strong> ";
                            
                            if($expedient['cemetery'] != null && $expedient['cemetery'] != ''){
                                $cemeteryRow .= $expedient['cemetery'];

                                if($expedient['funeralTimeBurial'] != null && $expedient['funeralTimeBurial'] != ''){
                                    $cemeteryRow .= ' ('. date('H:i', strtotime($expedient['funeralTimeBurial'])) . ')';
                                }
                            }

                            $cemeteryRow .= "<br>";
                        }

                        // Porteadores
                        $carriersInfo = "-";
                        if($expedient['carriersTime'] != null){
                            $carriersInfo = date('H:i', strtotime($expedient['carriersTime']));
                        }

                        $flag = false;
                        if($expedient['type'] == 3 || $expedient['type'] == '3'){
                            if($data['cremations'] != null){
                                foreach($data["cremations"] as $cremation){    
                                    if($expedient['expedientID'] == $cremation['expedientID']){
                                        $flag = true;
                                    }  
                                }
                            }
                        }else{
                            $flag = true;
                        }

                        if($flag){

                            if($expedient['deceasedGender'] == 'Hombre'){
                                $pre = 'D. ';
                            }else{
                                $pre = 'Dña. ';
                            }

                            $text .= "
                                <div style='width:30%; background-color:#f5f0f0; float: left; border-bottom: 2px solid $colorStyle margin-left: 3px; margin-bottom:8px; padding: 10px; height:300px;'>
                                    <p><strong>Hora de salida: $funeralTimeInfo</strong><br>
                                        <strong>Nº exp: </strong>" . $expedient['number'] . "<br>
                                        <strong>Nombre: </strong>" . $pre . $expedient['deceasedName'] . " " . $expedient['deceasedSurname'] . "<br>
                                        <strong>Funeraria del servicio: </strong>" . $funeralHomeInfo . "<br>
                                        <strong>Casa mortuoria: </strong>" . $mortuaryNameInfo . "<br>
                                        <strong>Sala: </strong>" . $deceasedRoomInfo . "<br>
                                        <strong>Nº Autobuses: </strong>" . $busesInfo . "<br>
                                        <strong>Parroquia: </strong>" . $churchInfo . "<br>
                                        $cemeteryRow
                                        <strong>Porteadores: </strong>$carriersInfo
                                    </p>
                            ";

                            if(isset($expedient['carriers']) && count($expedient['carriers']) > 0){                                    
                                $brand ='';
                                    $model = '';
                                    $license = '';                                        
                                    foreach($expedient['carriers'] AS $key=> $carrier){
                                        $flag = true;
                                        if($expedient['cars'] > 0){                                                              
                                            foreach($expedient['cars'] AS $key=> $car){
                                                if($flag){
                                                    if($carrier['name'] . ' ' . $carrier['surname'] == $car['driverName'] . ' ' . $car['driverSurname']){                                      
                                                        $brand = ' - ' . $car['brand'];
                                                        $model = $car['model'];
                                                        $license = $car['licensePlate'];
                                                        $flag = false;                                        
                                                    }else{
                                                        $brand ='';
                                                        $model = '';
                                                        $license = '';                                            
                                                    }
                                                }
                                            }
                                        }
                                        if($carrier['confirmed'] == "1"){                                
                                            $text .= " <li style='list-style:none'>". $carrier['name'] . " " . $carrier['surname'] . "<strong>" . $brand . " ". $model . " " . $license . "</strong></li>";      
                                        }else{                                
                                            $text .= "<li style='list-style:none'>(*) " . $carrier['name'] . " " . $carrier['surname'] . "<strong>" . $brand . "  " . $model . " " . $license . "</strong></li>";
                                        }
                                    }
                            }
                            $text .= "</div>";
                        }
                    }  
                }
                if($data["cremations"] != null){ //CREMACIONES
                    if($data["expedients"] != null){
                        $text .= "<pagebreak>";
                    }
                    usort($data["cremations"], function($a, $b) {return strcmp($a['crematoriumID'], $b['crematoriumID']);});
                    
                    $currentCrematorium = null;
                    foreach($data["cremations"] AS $key=> $expedient){

                        if($currentCrematorium != $expedient['crematoriumID']){
                            if($key != 0){
                                $text .= "<pagebreak>";
                            }

                            $text .= "<p style='color:$colorStyle text-align:center;'><strong>Crematorio ".$expedient['crematoriumName']."</strong></p>";
                            $currentCrematorium = $expedient['crematoriumID'];
                        }else{
                            if($key % 3 == 0 && $key % 9 != 0 && $key != 0){
                                $text .= "</div><div class='clearfix'></div><div class='contenido container $fuente folioApaisado'>";
                            }else{
                                if($key % 9 == 0 && $key != 0){
                                    $text .= "</div><div class='clearfix'></div><pagebreak><div class='contenido container $fuente folioApaisado'>";
                                }
                                if($key != 0){
                                    $text .= "<div style='width:1%; float: left;'></div>";
                                }
                            }
                        }

                        $start = $expedient['start'] == null ? '' : date('H:i', strtotime($expedient['start']));
                        $crematoriumArriveTime = $expedient['crematoriumArriveTime'] == null ? '' : date('H:i', strtotime($expedient['crematoriumArriveTime']));

                        $crematoriumIntroduction = 'No';
                        if($expedient['crematoriumIntroduction'] == "1"){
                            $crematoriumIntroduction = "Si";
                        }
                        $crematoriumWaitOnRoom = 'No';
                        if($expedient['crematoriumWaitOnRoom'] == "1"){
                            $crematoriumWaitOnRoom = "Si";
                        }
                        $crematoriumVaseBio = 'No';
                        if($expedient['crematoriumVaseBio'] == "1"){
                            $crematoriumVaseBio = "Si";
                        }
                        $ecologicCoffin = 'No';
                        if($expedient['ecologicCoffin'] == "1"){
                            $ecologicCoffin = "Si";
                        }
                        $crematoriumPacemaker = 'No';
                        if($expedient['crematoriumPacemaker'] == "1"){
                            $crematoriumPacemaker = "Si";
                        }

                        if($expedient['deceasedGender'] == 'Hombre'){
                            $pre = 'D. ';
                        }else{
                            $pre = 'Dña. ';
                        }
                        
                        $text .= "
                            <div class='$fuente' style='width:30%; background-color:#D1FAFF; float: left; border-bottom: 2px solid $colorStyle margin-left: 3px; margin-bottom:8px; padding: 10px; height:220px;'>
                                <p>
                                <strong>Crematorio: </strong>" . $expedient['crematoriumName'] . "<br>
                                <strong>Hora de introducción: </strong>" . $start . "<br>
                                <strong>Nº exp: </strong>" . $expedient['number'] . "<br>
                                <strong>Nombre: </strong>$pre" . $expedient['deceasedName'] . " " . $expedient['deceasedSurname'] . " (Q.E.P.D.)<br>
                                <strong>Funeraria del servicio: </strong>" . $expedient['funeralHome'] . "<br>
                                <strong>Familiar de contacto: </strong>" . $expedient['familyContactName'] . " " . $expedient['familyContactSurname'] . " " . $expedient['familyContactMobilePhone'] . "<br>
                                <strong>Introducción: </strong>" . $crematoriumIntroduction . "<br>
                        ";

                        $text .= "
                                <strong>Esperar en sala: </strong>" . $crematoriumWaitOnRoom . "<br>
                                <strong>Urna biodegradable: </strong>" . $crematoriumVaseBio . "<br>
                                <strong>Féretro ecológico: </strong>" . $ecologicCoffin . "<br>
                        ";

                        $authDateTime = '';
                        if($expedient['authDate'] != null){
                            $authDateTime .= date('d/m/Y', $expedient['authDate']);
                        }
                        if($expedient['authTime'] != null){
                            $authDateTime .= ' ' . date('H:i', $expedient['authTime']);
                        }
                        $text .= " 
                            <strong>Entrega de cenizas: </strong>" . $authDateTime . "<br>
                            <strong>Lugar de entrega: </strong>" . $expedient['authPlace'] . "<br>
                        ";

                        $text .= '</div>';
                    }   
                }
                $text .= "</div>";

                return $text;
            break;

            case "buscarResumen":
        
                $utils = new Utils();
                $dates = $_POST;
            
                $data = getSearchSummary($dates["dateF"]);
        
                $text = "<p style='color:$colorStyle text-align:center;'><strong>RESUMEN Y CREMACIONES DEL DÍA ".$dates["dateS"]."</strong></p>";
                if($data["expedients"] != null){
                    $text .= "
                        <div class='contenido container $fuente folioApaisado'>
                    ";   

                    foreach($data["expedients"] AS $key=> $expedient){
                        
                        if($key % 3 == 0 && $key % 9 != 0 && $key != 0){
                            $text .= "</div><div class='clearfix'></div><div class='contenido container $fuente folioApaisado'>";
                        }else{
                            if($key % 9 == 0 && $key != 0){
                                $text .= "</div><div class='clearfix'></div><pagebreak><div class='contenido container $fuente folioApaisado'>";
                            }
                            if($key != 0){
                                $text .= "<div style='width:1%; float: left;'></div>";
                            }
                        }

                        // Hora salida
                        $funeralTimeInfo = '-';
                        if($expedient['funeralTime'] != null && $expedient['funeralTime'] != ''){
                            $funeralTimeInfo = date('H:i', strtotime($expedient['funeralTime']));
                        }

                        // Funeraria
                        $funeralHomeInfo = '-';
                        if($expedient['funeralHome'] != null && $expedient['funeralHome'] != ''){
                            $funeralHomeInfo = $expedient['funeralHome'];
                        }

                        // Casa mortuoria
                        $mortuaryNameInfo = "-";
                        if($expedient['mortuary'] != null && $expedient['mortuary'] != ''){
                            if($expedient['mortuary'] == 'Otro'){
                                $mortuaryNameInfo = $expedient['deceasedMortuaryAddress'];
                            }else{
                                $mortuaryNameInfo = $expedient['mortuary'];
                            }
                        }

                        // Sala
                        $deceasedRoomInfo = '-';
                        if($expedient['deceasedRoom'] != null && $expedient['deceasedRoom'] != ''){
                            if($expedient['deceasedRoom'] === 0 || $expedient['deceasedRoom'] === '0'){
                                $expedient['deceasedRoom'] = "O";
                            }
                            $deceasedRoomInfo = $expedient['deceasedRoom'];
                        }

                        // Autobuses
                        $busesInfo = '-';
                        if($expedient['buses'] != null){
                            $busesInfo = $expedient['buses'];
                        }

                        // Parroquia
                        $churchInfo = '-';
                        if($expedient['church'] != null && $expedient['church'] != ''){
                            $churchInfo = $expedient['church'];

                            if($expedient['ceremonyTime'] != null && $expedient['ceremonyTime'] != ''){
                                $churchInfo .= ' ('. date('H:i', strtotime($expedient['ceremonyTime'])) . ')';
                            }
                        }

                        // Cementerio / Crematorio
                        $cemeteryRow = '';
                        if(intval($expedient['cremation']) == 1){
                            $cemeteryRow = "<strong>Crematorio: </strong> ";

                            if($expedient['crematoriumName'] != null && $expedient['crematoriumName'] != ''){
                                $cemeteryRow .= $expedient['crematoriumName'];

                                if($expedient['crematoriumEntry'] != null && $expedient['crematoriumEntry'] != ''){
                                    $cemeteryRow .= ' ('. date('H:i', strtotime($expedient['crematoriumEntry'])) . ')';
                                }
                            }
                            
                            $cemeteryRow .= "<br>";
                        }else{
                            $cemeteryRow = "<strong>Cementerio: </strong> ";
                            
                            if($expedient['cemetery'] != null && $expedient['cemetery'] != ''){
                                $cemeteryRow .= $expedient['cemetery'];
                                if($expedient['funeralTimeBurial'] != null && $expedient['funeralTimeBurial'] != ''){
                                    $cemeteryRow .= ' ('. date('H:i', strtotime($expedient['funeralTimeBurial'])) . ')';
                                }
                            }

                            $cemeteryRow .= "<br>";
                        }

                        // Porteadores
                        $carriersInfo = "-";
                        if($expedient['carriersTime'] != null){
                            $carriersInfo = date('H:i', strtotime($expedient['carriersTime']));
                        }

                        $flag = false;
                        if($expedient['type'] == 3 || $expedient['type'] == '3'){
                            if($data['cremations'] != null){
                                foreach($data["cremations"] as $cremation){    
                                    if($expedient['expedientID'] == $cremation['expedientID']){
                                        $flag = true;
                                    }  
                                }
                            }
                        }else{
                            $flag = true;
                        }

                        if($flag){

                            if($expedient['deceasedGender'] == 'Hombre'){
                                $pre = 'D. ';
                            }else{
                                $pre = 'Dña. ';
                            }
                        
                            $text .= "
                                <div style='width:30%; background-color:#f5f0f0; float: left; border-bottom: 2px solid $colorStyle margin-left: 3px; margin-bottom:8px; padding: 10px; height:300px;'>
                                    <p>
                                        <strong>Hora de salida: $funeralTimeInfo</strong><br>
                                        <strong>Nº exp: </strong>" . $expedient['number'] . "<br>
                                        <strong>Nombre: </strong>" . $pre . $expedient['deceasedName'] . " " . $expedient['deceasedSurname'] . "<br>
                                        <strong>Funeraria del servicio: </strong>" . $funeralHomeInfo . "<br>
                                        <strong>Casa mortuoria: </strong>" . $mortuaryNameInfo . "<br>
                                        <strong>Sala: </strong>" . $deceasedRoomInfo . "<br>
                                        <strong>Nº Autobuses: </strong>" . $busesInfo . "<br>
                                        <strong>Parroquia: </strong>" . $churchInfo . "<br>
                                        $cemeteryRow
                                        <strong>Porteadores: </strong>$carriersInfo
                                    </p>
                            ";
                            if(isset($expedient['carriers']) && count($expedient['carriers']) > 0){
                                $brand ='';
                                $model = '';
                                $license = '';                                        
                                foreach($expedient['carriers'] AS $key=> $carrier){
                                    $flag = true;
                                    if(isset($expedient['cars'])){
                                        if($expedient['cars'] > 0){                                                              
                                            foreach($expedient['cars'] AS $key=> $car){
                                                if($flag){
                                                    if($carrier['name'] . ' ' . $carrier['surname'] == $car['driverName'] . ' ' . $car['driverSurname']){                                  
                                                        $brand = ' - ' . $car['brand'];
                                                        $model = $car['model'];
                                                        $license = $car['licensePlate'];
                                                        $flag = false;                                        
                                                    }else{
                                                        $brand ='';
                                                        $model = '';
                                                        $license = '';                                            
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    if(isset($carrier['confirmed'])){
                                        if($carrier['confirmed'] == "1"){                                
                                            $text .= "<li style='list-style:none'>" . $carrier['name'] . " " . $carrier['surname'] . "<strong>" . $brand . " " . $model . " " . $license . "</strong></li>";      
                                        }else{                                
                                            $text .= "<li style='list-style:none'>(*) " . $carrier['name'] . " " . $carrier['surname'] . "<strong>" . $brand . " " . $model . " " . $license . "</strong></li>";
                                        }
                                    }
                                }
                            }
                            $text .= "</div>";
                        }
                    }  
                }

                if($data["cremations"] != null){ //CREMACIONES
                    if($data["expedients"] != null){
                        $text .= "<pagebreak>";
                    }
                    usort($data["cremations"], function($a, $b) {return strcmp($a['crematoriumID'], $b['crematoriumID']);});

                    $currentCrematorium = null;
                    foreach($data["cremations"] AS $key=> $expedient){   
                        if($currentCrematorium != $expedient['crematoriumID']){
                            if($key != 0){
                                $text .= "<pagebreak>";
                            }

                            $text .= "<p style='color:$colorStyle text-align:center;'><strong>Crematorio ".$expedient['crematoriumName']."</strong></p>";
                            $currentCrematorium = $expedient['crematoriumID'];
                        }else{
                            if($key % 3 == 0 && $key % 9 != 0 && $key != 0){
                                $text .= "</div><div class='clearfix'></div><div class='contenido container $fuente folioApaisado'>";
                            }else{
                                if($key % 9 == 0 && $key != 0){
                                    $text .= "</div><div class='clearfix'></div><pagebreak><div class='contenido container $fuente folioApaisado'>";
                                }
                                if($key != 0){
                                    $text .= "<div style='width:1%; float: left;'></div>";
                                }
                            }
                        }

                        $start = $expedient['start'] == null ? '' : date('H:i', strtotime($expedient['start']));
                        $crematoriumArriveTime = $expedient['crematoriumArriveTime'] == null ? '' : date('H:i', strtotime($expedient['crematoriumArriveTime']));

                        $crematoriumIntroduction = 'No';
                        if($expedient['crematoriumIntroduction'] == "1"){
                            $crematoriumIntroduction = "Sí";
                        }
                        $crematoriumWaitOnRoom = 'No';
                        if($expedient['crematoriumWaitOnRoom'] == "1"){
                            $crematoriumWaitOnRoom = "Sí";
                        }
                        $crematoriumVaseBio = 'No';
                        if($expedient['crematoriumVaseBio'] == "1"){
                            $crematoriumVaseBio = "Sí";
                        }
                        $ecologicCoffin = 'No';
                        if($expedient['ecologicCoffin'] == "1"){
                            $ecologicCoffin = "Sí";
                        }
                        $crematoriumPacemaker = 'No';
                        if($expedient['crematoriumPacemaker'] == "1"){
                            $crematoriumPacemaker = "Sí";
                        }

                        if($expedient['deceasedGender'] == 'Hombre'){
                            $pre = 'D. ';
                        }else{
                            $pre = 'Dña. ';
                        }

                        $text .= "
                            <div class='$fuente' style='width:30%; background-color:#D1FAFF; float: left; border-bottom: 2px solid $colorStyle margin-left: 3px; margin-bottom:8px; padding: 10px; height:220px;'>
                            <p>
                                <strong>Crematorio: </strong>" . $expedient['crematoriumName'] . "<br>
                                <strong>Hora de introducción: </strong>" . $start . "<br>
                                <strong>Nº exp: </strong>" . $expedient['number'] . "<br>
                                <strong>Nombre: </strong>" . $pre . $expedient['deceasedName'] . " " . $expedient['deceasedSurname'] . "<br>
                                <strong>Funeraria: </strong>" . $expedient['funeralHome'] . "<br>
                                <strong>Familiar de contacto: </strong>" . $expedient['familyContactName'] . " ". $expedient['familyContactSurname'] . " " . $expedient['familyContactMobilePhone'] . "<br>
                                <strong>Introducción: </strong>" . $crematoriumIntroduction . "<br>
                        " ;

                        if($expedient['crematoriumIntroduction'] == "1"){
                            $text .=    "<strong>Hora llegada familia: </strong>" . $crematoriumArriveTime . "<br>";
                        }

                        $text .= " 
                            <strong>Esperar en sala: </strong>" . $crematoriumWaitOnRoom . "<br>
                            <strong>Urna biodegradable: </strong>" . $crematoriumVaseBio . "<br>
                            <strong>Féretro ecológico: </strong>" . $ecologicCoffin . "<br>
                        ";

                        $authDateTime = '';
                        if($expedient['authDate'] != null){
                            $authDateTime .= date('d/m/Y', $expedient['authDate']);
                        }
                        if($expedient['authTime'] != null){
                            $authDateTime .= ' ' . date('H:i', $expedient['authTime']);
                        }
                        $text .= " 
                            <strong>Entrega de cenizas: </strong>" . $authDateTime . "<br>
                            <strong>Lugar de entrega: </strong>" . $expedient['authPlace'] . "<br>
                        ";

                        $text .= '</div>';
                    } 
                }
                $text .= "</div></div></div>"; 

                return $text;
            break;

            case "cremacionesHoy":
                $utils = new Utils();
                $data = getResumenHoy();  
                $hoy = date('d/m/Y', time());
                $text = "<p style='color:$colorStyle text-align:center;'><strong>CREMACIONES DE HOY ".$hoy."</strong></p>";
               
                if($data["cremations"] != null){ //CREMACIONES

                    usort($data["cremations"], function($a, $b) {return strcmp($a['crematoriumID'], $b['crematoriumID']);});

                    $currentCrematorium = null;
                    foreach($data["cremations"] AS $key=> $expedient){                   
                        
                        if($currentCrematorium != $expedient['crematoriumID']){
                            if($key != 0){
                                $text .= "<pagebreak>";
                            }

                            $text .= "<p style='color:$colorStyle text-align:center;'><strong>Crematorio ".$expedient['crematoriumName']."</strong></p>";
                            $currentCrematorium = $expedient['crematoriumID'];
                        }else{

                            if($key % 3 == 0 && $key % 9 != 0 && $key != 0){
                                $text .= "</div><div class='contenido container $fuente folioApaisado'>";
                            }else{
                                if($key % 9 == 0 && $key != 0){
                                    $text .= "</div><pagebreak>";
                                }
                                if($key != 0){
                                    $text .= "<div style='width:1%; float: left;'></div>";
                                }
                            }
                        }

                        $start = $expedient['start'] == null ? '' : date('H:i', strtotime($expedient['start']));
                        $crematoriumArriveTime = $expedient['crematoriumArriveTime'] == null ? '' : date('H:i', strtotime($expedient['crematoriumArriveTime']));

                        $crematoriumIntroduction = 'No';
                        if($expedient['crematoriumIntroduction'] == "1"){
                            $crematoriumIntroduction = "Si";
                        }
                        $crematoriumWaitOnRoom = 'No';
                        if($expedient['crematoriumWaitOnRoom'] == "1"){
                            $crematoriumWaitOnRoom = "Si";
                        }
                        $crematoriumVaseBio = 'No';
                        if($expedient['crematoriumVaseBio'] == "1"){
                            $crematoriumVaseBio = "Si";
                        }
                        $ecologicCoffin = 'No';
                        if($expedient['ecologicCoffin'] == "1"){
                            $ecologicCoffin = "Si";
                        }
                        $crematoriumPacemaker = 'No';
                        if($expedient['crematoriumPacemaker'] == "1"){
                            $crematoriumPacemaker = "Si";
                        }

                        if($expedient['deceasedGender'] == 'Hombre'){
                            $pre = 'D. ';
                        }else{
                            $pre = 'Dña. ';
                        }
                        
                        $text .= "
                            <div class='$fuente' style='width:30%; background-color:#D1FAFF; float: left; border-bottom: 2px solid $colorStyle margin-left: 3px; margin-bottom:8px; padding: 10px; height:220px;'>
                                <p>
                                    <strong>Crematorio: </strong>" . $expedient['crematoriumName'] . "<br>
                                    <strong>Hora de introducción: </strong>" . $start . "<br>
                                    <strong>Nº exp: </strong>" . $expedient['number'] . "<br>
                                    <strong>Nombre: </strong> $pre " . $expedient['deceasedName'] . " " . $expedient['deceasedSurname'] . " (Q.E.P.D.)<br>
                                    <strong>Funeraria del servicio: </strong>" . $expedient['funeralHome'] . "<br>
                                    <strong>Familiar de contacto: </strong>" . $expedient['familyContactName'] . " ". $expedient['familyContactSurname'] . " " . $expedient['familyContactMobilePhone'] . "<br>
                                    <strong>Introducción: </strong>" . $crematoriumIntroduction . "<br>
                        ";

                        if($expedient['crematoriumIntroduction'] == "1"){
                            $text .=    "<strong>Hora llegada familia: </strong>" . $crematoriumArriveTime . "<br>";
                        }

                        $text .= "  
                                <strong>Esperar en sala: </strong>" . $crematoriumWaitOnRoom . "<br>
                                <strong>Urna biodegradable: </strong>" . $crematoriumVaseBio . "<br>
                                <strong>Féretro ecológico: </strong>" . $ecologicCoffin . "<br>
                        ";

                        $authDateTime = '';
                        if($expedient['authDate'] != null){
                            $authDateTime .= date('d/m/Y', $expedient['authDate']);
                        }
                        if($expedient['authTime'] != null){
                            $authDateTime .= ' ' . date('H:i', $expedient['authTime']);
                        }
                        $text .= " 
                            <strong>Entrega de cenizas: </strong>" . $authDateTime . "<br>
                            <strong>Lugar de entrega: </strong>" . $expedient['authPlace'] . "<br>
                        ";

                        $text .= '</div>';
                    } 

                    $text .= "</div>";
                }

                return $text;
            break;

            case "cremacionesMañana":
                $utils = new Utils();
                $data = getResumenManhana();
                $tomorrow = new DateTime('tomorrow');            
                $tomorrow = $tomorrow->format('d/m/Y');
                $text = "<p style='color:$colorStyle text-align:center;'><strong>CREMACIONES DE MAÑANA ".$tomorrow."</strong></p>";
                
                if($data["cremations"] != null){ //CREMACIONES

                    usort($data["cremations"], function($a, $b) {return strcmp($a['crematoriumID'], $b['crematoriumID']);});

                    $currentCrematorium = null;
                    foreach($data["cremations"] AS $key=> $expedient){

                        if($currentCrematorium != $expedient['crematoriumID']){
                            if($key != 0){
                                $text .= "<pagebreak>";
                            }

                            $text .= "<p style='color:$colorStyle text-align:center;'><strong>Crematorio ".$expedient['crematoriumName']."</strong></p>";
                            $currentCrematorium = $expedient['crematoriumID'];
                        }else{

                            if($key % 3 == 0 && $key % 9 != 0 && $key != 0){
                                $text .= "</div><div class='contenido container $fuente folioApaisado'>";
                            }else{
                                if($key % 9 == 0 && $key != 0){
                                    $text .= "</div><pagebreak>";
                                }
                                if($key != 0){
                                    $text .= "<div style='width:1%; float: left;'></div>";
                                }
                            }
                        }

                        $crematoriumIntroduction = 'No';
                        if($expedient['crematoriumIntroduction'] == "1"){
                            $crematoriumIntroduction = "Si";
                        }
                        $crematoriumWaitOnRoom = 'No';
                        if($expedient['crematoriumWaitOnRoom'] == "1"){
                            $crematoriumWaitOnRoom = "Si";
                        }
                        $crematoriumVaseBio = 'No';
                        if($expedient['crematoriumVaseBio'] == "1"){
                            $crematoriumVaseBio = "Si";
                        }
                        $ecologicCoffin = 'No';
                        if($expedient['ecologicCoffin'] == "1"){
                            $ecologicCoffin = "Si";
                        }
                        $crematoriumPacemaker = 'No';
                        if($expedient['crematoriumPacemaker'] == "1"){
                            $crematoriumPacemaker = "Si";
                        }

                        if($expedient['deceasedGender'] == 'Hombre'){
                            $pre = 'D. ';
                        }else{
                            $pre = 'Dña. ';
                        }

                        $start = $expedient['start'] == null ? '' : date('H:i', strtotime($expedient['start']));
                        $crematoriumArriveTime = $expedient['crematoriumArriveTime'] == null ? '' : date('H:i', strtotime($expedient['crematoriumArriveTime']));
                        
                        $text .= "
                            <div class='$fuente' style='width:30%; background-color:#D1FAFF; float: left; border-bottom: 2px solid $colorStyle margin-left: 3px; margin-bottom:8px; padding: 10px; height:220px;'>
                                <p><strong>Crematorio: </strong>" . $expedient['crematoriumName'] . "<br>
                                <strong>Hora de introducción: </strong>" . $start . "<br>
                                <strong>Nº exp: </strong>" . $expedient['number'] . "<br>
                                <strong>Nombre: </strong>$pre" . $expedient['deceasedName'] . " " . $expedient['deceasedSurname'] . " (Q.E.P.D.)<br>
                                <strong>Funeraria del servicio: </strong>" . $expedient['funeralHome'] . "<br>
                                <strong>Familiar de contacto: </strong>" . $expedient['familyContactName'] . " " . $expedient['familyContactSurname'] . " " . $expedient['familyContactMobilePhone'] . "<br>
                                <strong>Introducción: </strong>" . $crematoriumIntroduction . "<br>
                        ";

                        if($expedient['crematoriumIntroduction'] == "1"){
                            $text .=    "<strong>Hora llegada familia: </strong>" . $crematoriumArriveTime . "<br>";
                        }

                        $text .= "
                                <strong>Esperar en sala: </strong>" . $crematoriumWaitOnRoom . "<br>
                                <strong>Urna biodegradable: </strong>" . $crematoriumVaseBio . "<br>
                                <strong>Féretro ecológico: </strong>" . $ecologicCoffin . "<br>
                        ";

                        $authDateTime = '';
                        if($expedient['authDate'] != null){
                            $authDateTime .= date('d/m/Y', $expedient['authDate']);
                        }
                        if($expedient['authTime'] != null){
                            $authDateTime .= ' ' . date('H:i', $expedient['authTime']);
                        }
                        $text .= " 
                            <strong>Entrega de cenizas: </strong>" . $authDateTime . "<br>
                            <strong>Lugar de entrega: </strong>" . $expedient['authPlace'] . "<br>
                        ";

                        $text .= '</div>';
                    }

                    $text .= "</div>";
                }

                return $text;
            break;
            
            case "situacionNichoJudicial":
                $utils = new Utils();
                if(isset($_POST['service'])){
                    $expedient = $_POST['service'];
                }
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/nicheImage/image.jpg';
                if(file_exists($route)){
                    $niche = $utils->getRoute() . "resources/files/{$_SESSION['company']}/expedients/" . $expedient . "/docs/nicheImage/image.jpg";
                }
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/situacionNichoJudicial.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }

                $staticInfo = $documentsInfo->getByDocument('situacionNichoJudicial');
                if($staticInfo != null){
                    foreach($staticInfo as $elem){
                        switch($elem['name']){
                            case 'locationDoc11':
                                $location = $elem['value'];
                            break;
                        }
                    }
                }else{
                    $location = '';
                }
                $data = getSituacionNichoJudicial($expedient);
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                }
                $background = $utils->getBackgroundDocuments();
                $text = "
                    <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                        <div style='margin-right:50px;right:480px; position: absolute; text-align: right; padding-top: 50px;'>
                            <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                        </div>
                        <div class='contenidoPompas'>
                            <table>
                                <tr>
                                    <td style='height: 30px;'><span style='color:$colorStyle'>Nº </span></td>
                                </tr>
                                <tr>
                                    <td style='height: 30px;'><span style='color:$colorStyle'>JUZGADO DE INSTRUCCIÓN Nº </span></td>
                                </tr>
                                <tr>
                                    <td style='height: 30px;'><span style='color:$colorStyle'>DE </span></td>
                                </tr>
                            </table>
                            <br><br><br>
                            <div style='line-height: 2;'>
                                <p style='text-align: justify;'>Se le comunica a este juzgado que el cadáver de <strong>" . $gender . " " . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</strong> (Q.E.P.D.), se
                                encuentra cremado en el Crematorio <strong>" . $data['crematoriumName'] . "</strong> en el concello de <strong>" . $data['crematoriumLocation'] . "</strong> provincia de <strong>" . $data['crematoriumProvince'] . "</strong>, desde el día " . $utils->fechaCastellano2(date('Y')) . "
                                a las " . date("H:i") ." h.</p>
                            </div>
                            <br><br>
                "; 

                if(isset($niche)){
                    $text .= "<div class='centered' style='background-repeat: no-repeat; background-image: url(" . $niche . "); height: 400px; width: 600px'></div>";
                }

                $text .="
                        <br><br>
                        <div>
                            <p>En $location, a " . $utils->fechaCastellano2(date('Y')) . ".</p>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "solicitudLiterales":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/solicitudLiterales.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }

                $utils = new Utils();
                $data = getSolicitudLiterales($expedient);
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                    $deceased = "fallecida";
                }else{
                    $gender = "D.";
                    $deceased = "fallecido";
                }

                $deceasedLocation = $data['deceasedInLocation'];

                $staticInfo = $documentsInfo->getByDocument('solicitudLiterales');
                if($staticInfo != null){
                    foreach($staticInfo as $elem){
                        switch($elem['name']){
                            case 'companyDoc16':
                                $company = $elem['value'];
                            break;
                            case 'companyCifDoc16':
                                $companyCif = $elem['value'];
                            break;
                            case 'companyPhoneDoc16':
                                $companyPhone = $elem['value'];
                            break;
                            case 'companyAddressDoc16':
                                $companyAddress = $elem['value'];
                            break;
                            case 'companyLocationDoc16':
                                $companyLocation = $elem['value'];
                            break;
                            case 'companyPostalCodeDoc16':
                                $companyPostalCode = $elem['value'];
                            break;
                            case 'companyProvinceDoc16':
                                $companyProvince = $elem['value'];
                            break;
                            case 'locationDoc16':
                                $location = $elem['value'];
                            break;
                        }
                    }
                }else{
                    $company = '';
                    $companyCif = '';
                    $companyPhone = '';
                    $companyAddress = '';
                    $companyLocation = '';
                    $companyPostalCode = '';
                    $companyProvince = '';
                    $location = '';
                }

                require_once($_SESSION['basePath'] . "model/users.php");
                $users = new Users;
                $userInfo = $users->getDataUserSession();

                if($userInfo[0]['userData'] != null && $userInfo[0]['userData'] != ''){
                    $userName = $userInfo[0]['userData'];
                }else{
                    $userName = "__________________";
                }

                if($userInfo[0]['post'] != null && $userInfo[0]['post'] != ''){
                    $userPost = $userInfo[0]['post'];
                }else{
                    $userPost = "__________________";
                }

                if($userInfo[0]['nif'] != null && $userInfo[0]['nif'] != ''){
                    $userNif = $userInfo[0]['nif'];
                }else{
                    $userNif = "__________________";
                }

                $userAddress = '________________';
                if($userInfo[0]['address'] != null && $userInfo[0]['address'] != ''){
                    $userAddress = $userInfo[0]['address'];
                    if($userInfo[0]['userLocation'] != null && $userInfo[0]['userLocation'] != ''){
                        $userAddress .= ', ' . $userInfo[0]['userLocation'];
                    }
                    if($userInfo[0]['userProvince'] != null && $userInfo[0]['userProvince'] != ''){
                        $userAddress .= ', ' . $userInfo[0]['userProvince'];
                    }
                }

                $background = $utils->getBackgroundDocuments();

                $deceaedDate = 'N/A';
                if($data['deceasedDate'] != null && $data['deceasedDate'] != ''){
                    $deceaedDate = $utils->fechaCastellano2(date('Y-m-d', strtotime($data['deceasedDate'])));
                }

                return "
                    <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'><div class='contenidoPompas'>
                        <div class='text-right'>
                            <p style='text-align: right;'>Registro Civil de (ciudad)</p>
                        </div>
                        <br><br>
                        <div>
                            <p>D/Dña. $userName con D.N.I. $userNif y con domicilio en $userAddress en calidad de $userPost de
                            $company con CIF. $companyCif, Tlf. $companyPhone</p>
                        </div>
                        <br><br>
                        <div>
                            <p>SOLICITA: </p>
                        </div>
                        <div>
                            <p>Que desea proceder al traslado de <strong>" . $gender . " " . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</strong> (Q.E.P.D.)</p>
                            <p>Que por favor nos envíen 3 <strong><u>Certificados Literal de Defunción</u></strong> de 
                            <strong>" . $gender . " " . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</strong>(Q.E.P.D.), 
                            ".$deceased." el día <strong>" . $deceaedDate  . "</strong> 
                            en la localidad de <strong>" . $deceasedLocation . "</strong>,
                            a la siguiente dirección:</p>
                        </div>
                        <br><br>
                        <div>
                            <p>$company</p>
                            <p>$companyAddress</p>
                            <p>$companyAddress</p>
                            <p>C.P. $companyPostalCode</p>
                            <p>$companyProvince</p>
                            <p>Telf: $companyPhone</p>
                        </div>
                        <br><br>
                        <div>
                            <p>En $location, a " . $utils->fechaCastellano2(date('Y')) . ".</p>
                        </div>
                        <br><br><br><br><br><br>
                        <div>
                            <p>Fdo.: ___________________________</p>
                        </div>
                    </div>
                ";
            break;

            case "solicitudNecropsia":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/solicitudNecropsia.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $utils = new Utils();
                    $data = getSolicitudNecropsia($expedient);
                    if($data['deceasedGender'] == "Mujer"){
                        $gender = "Dña.";
                        $deceased = "fallecida";
                    }else{
                        $gender = "D.";
                        $deceased = "fallecido";
                    }
                    $staticInfo = $documentsInfo->getByDocument('solicitudNecropsia');
                    if($staticInfo != null){
                        foreach($staticInfo as $elem){
                            switch($elem['name']){
                                case 'locationDoc17':
                                    $location = $elem['value'];
                                break;
                            }
                        }
                    }else{
                        $location = '';
                    }
                    $background = $utils->getBackgroundDocuments();

                    $deceasedDate = 'N/A';
                    if($data['deceasedDate'] != null && $data['deceasedDate'] != ''){
                        $deceasedDate = $utils->fechaCastellano2(date('Y-m-d', strtotime($data['deceasedDate'])));
                    }

                    return "
                        <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'><div class='contenidoPompas'>
                            <div class='text-center' class='titulo'>
                                <strong><p><u>SOLICITUD NECROPSIA</u></p></strong>
                            </div>
                            <br><br>
                            <div style='line-height: 2; text-align: justify;'>
                                <p style='line-height: 2; text-align: justify;'>Yo, D/Dña. ________________________ con D.N.I. _______________, como AUTORIZADO de <strong>" . $gender . " " . $data['deceasedName'] . " " . $data['deceasedSurname'] . " (Q.E.P.D.)</strong> con D.N.I. <strong>" . $data['deceasedNIF'] . "</strong>, ".$deceased." el día <strong>" . $deceasedDate . "</strong>, autorizo el
                                estudio necrológico para diagnósticos y estudios de investigación que procedan y al servicio de
                                Anatomía Patológica del Hospital ________________________________ para realizar estudios,
                                asimismo autorizamos al Dr. ______________________________ otros estudios que procedan en función de estos
                                resultados.</p>
                            </div>
                            <br><br><br><br>
                            <div>
                                <p>En $location, a " . $utils->fechaCastellano2(date('Y')) . ".</p>
                                <br><br><br>
                                <div style='font-size: 14px;'><p>Fdo.: ______________________</p></div>
                                <br><br><br><br>
                            </div>
                        </div>
                    ";
                }

            break;

            case "tarjetas":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/tarjetas.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $utils = new Utils();
                    $data = getRecordatorioSobre($expedient);

                    $lafe = '';
                    if($data['nif'] == 'A36601052'){
                        $lafe = "<img style='margin-left: 10%; margin-right: 10%;' src='" . $utils->getRoute() . "resources/files/" . $_SESSION['company'] . "/obituaries/basic/lafe.jpg' width='30%'>";
                    }

                    if($data['deceasedGender'] == 'Hombre'){
                        $pre = 'D.';
                    }else{
                        $pre = 'Dña.';
                    }

                    $fontSize = '15px';
                    if(strlen($data['deceasedName'] . " " . $data['deceasedSurname']) > 25){
                        $fontSize = '12px';
                    }

                    $height = '';
                    $width = "width='40%'";
                    if(intval($_SESSION['company']) == 4){
                        $height = "height='30px'";
                        $width = "width='15%'";
                    }

                    $img = str_replace('png', 'jpg', $utils->getLogo());
                    $img = explode(URL, $img);
                    $img = $utils->getRoute() . $img[1];

                    return "
                        <div class='fondo' style='padding-bottom: 6px'><div class='container $fuente folioTarjeta'><div class=''>
                            <div class='firma2'>
                                <div style='font-size:$fontSize; color:#8b8b8b'>
                                    <p><strong>La familia de: </strong></p>
                                </div>
                                <div style='font-size:$fontSize; padding-top: 10px;' class='text-center $fuente'>
                                    <p><strong><i>". $pre . " " . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</i></strong></p> 
                                    <p><strong>(Q.E.P.D.)</strong></p>
                                </div>                                                                    
                                <div style='font-size:$fontSize; color:#8b8b8b; padding-bottom: 20px;' class='text-center'>                                                                 
                                    <p><strong>agradece sus condolencias.</strong></p> 
                                </div>
                                <div>
                                    <table>
                                        <tr>
                                        <td style='width:45%'><img style='margin-left: 10%; margin-right: 10%;' src='" . $img . "' $width $height></td>
                                        <td style='width:20%'></td>
                                        <td style='width:34%'>$lafe</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>                
                        </div>
                    ";
                }

            break; 

            case 'tarjetonAgradecimiento':
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/tarjetonAgradecimiento.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $utils = new Utils();
                    $data = getRecordatorioSobre($expedient);
                    $text = $_POST['data'][0];

                    if($data['deceasedGender'] == 'Hombre'){
                        $pre = 'D. ';
                    }else{
                        $pre = 'Dña. ';
                    }

                    return "
                        <div class='fondo'><div class='container $fuente folio' style='height: 250px'><div class=''>
                            <div>
                                <div style='width:54px; height:100px;float:left;display:block;'>
                                    <img src='" . $utils->getRoute() . "core/libraries/pdfs/images/tarjeton_cruz.jpg' width='54px' height='100px'>
                                </div>
                                <br>
                                <div style='width:calc(100% - 150px);height:250px;float:right;display:block;margin-left:-64px;'>
                                    <div style='font-size:13px; color: black;margin-top:25px;' class='text-center $fuente'>
                                        <p><strong>La familia de: </strong></p>
                                    </div>
                                    <div style='font-size:13px; color: black' class='text-center $fuente'>
                                        <p>&nbsp;</p>                                                                                      
                                        <p><strong><i>$pre " . $data['deceasedName'] . " " . $data['deceasedSurname'] . " (Q.E.P.D.)</i></strong></p> 
                                    </div>                                                                    
                                    <div style='font-size:16px; color: black' class='text-center'>    
                                    <p>&nbsp;</p>                                                               
                                        <p style='font-family: Comic Sans MS'>" . $text . "</p>                                                                                    
                                    </div>
                                </div>
                            </div>                
                        </div>
                    ";
                }
            break;
            
            case "trasladoCenizasCadaver":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/trasladoCenizasCadaver.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }
                $utils = new Utils();
                $background = $utils->getBackgroundDocuments();
                $data = getTrasladoCenizasCadaver($expedient);
                $staticInfo = $documentsInfo->getByDocument('trasladoCenizasCadaver');
                if($staticInfo != null){
                    foreach($staticInfo as $elem){
                        switch($elem['name']){
                            case 'companyDoc20':
                                $company = $elem['value'];
                            break;
                            case 'companyCifDoc20':
                                $companyCif = $elem['value'];
                            break;
                            case 'companyAddressDoc20':
                                $companyAddress = $elem['value'];
                            break;
                            case 'companyLocationDoc20':
                                $companyLocation = $elem['value'];
                            break;
                        }
                    }
                }else{
                    $company = '';
                    $companyCif = '';
                    $companyAddress = '';
                    $companyLocation = '';
                }

                if($data["deceasedGender"] == 'Mujer'){
                    $applicantPrefix = 'D.';
                }else{
                    $applicantPrefix = 'Dna.';
                }
                
                $deceasedName = $data['deceasedName'];
                $deceasedSurname = $data['deceasedSurname'];
                $deceasedDate = $data['deceasedDate'] == null ? '' : date('d/m/Y', strtotime($data['deceasedDate']));
                $cemetery = $data['deceasedCemetery'];
                $cemeteryLocation = $data['cemeteryLocation'];
                $funeralNicheNumber = $data['funeralNicheNumber'];
                $crematoriumName = $data['crematoriumName'] == null ? '' : $data['crematoriumName'];
                $crematoriumLocation = $data['crematoriumLocation'] == null ? '' : $data['crematoriumLocation'];
                $cremation = $data['cremation'];
                if(intval($cremation) == 1){
                    $cremationText = " al Crematorio de $crematoriumName</strong>, de <strong>$crematoriumLocation</strong></p>";
                }else{
                    $cremationText = " al <strong>nicho Nº </strong> del <strong>Cementerio Parroquial de ____________________</strong>, de <strong>____________________</strong></p>";
                }

                return "
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas' style='font-size: 16px'>
                                <br>
                                <p><u>TRASLADOS DE CADÁVERES Y REINHUMACIÓN RESTOS CADAVÉRICOS</u></p>
                                <br>
                                <p><strong>$company</strong>, con <strong>CIF.- $companyCif</strong> y con domicilio en <strong>$companyAddress $companyLocation</strong>, en calidad de Funeraria</p>
                                <br><p style='margin-left: 40%'><u><strong>EXPONE</strong></u></p>
                                <p>Que desea proceder al traslado de: </p>
                                <p>_____ <strong>Cadáver</strong></p><p>__X__ <strong>Restos cadavéricos</strong></p><br>
                                <p>
                                    Pertenecientes a <strong>$deceasedName $deceasedSurname</strong>, fallecido el día <strong>$deceasedDate</strong>
                                    desde el <strong>Cementerio Parroquial de $cemetery, nicho Nº $funeralNicheNumber</strong> de <strong>$cemeteryLocation</strong>
                                    $cremationText
                                <br><br>
                                <p>Para el cual adjunto la documentación necesaria, y SOLICITA</p>
                                <p>La concesión de la correspondiente autorización sanitaria, de conformidad con la legislación vigente.</p>
                                <br><br>
                                <p>SECCIÓN DE SANIDAD AMBIENTAL</p>
                                <p>Delegación Provincial de Sanidad</p>
                                <br>
                                <p>En _________, a " . $utils->fechaCastellano2(date('Y')) . ".</p>
                                <br><br><br>
                                <div><p>Fdo.: $company</p></div>
                                <br><br><br><br>
                            </div>
                        </div>
                    </div>
                ";
            break;

            case "trasladoHospital":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/trasladoHospital.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }

                $utils = new Utils();
                $data = getSolicitudNecropsia($expedient);
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                    $deceased = "Fallecida";
                }else{
                    $gender = "D.";
                    $deceased = "Fallecido";
                }
                $background = $utils->getBackgroundDocuments();
                $staticInfo = $documentsInfo->getByDocument('trasladoHospital');
                if($staticInfo != null){
                    foreach($staticInfo as $elem){
                        switch($elem['name']){
                            case 'companyDoc18':
                                $company = $elem['value'];
                            break;
                            case 'companyCifDoc18':
                                $companyCif = $elem['value'];
                            break;
                            case 'companyAddressDoc18':
                                $companyAddress = $elem['value'];
                            break;
                            case 'companyLocationDoc18':
                                $companyLocation = $elem['value'];
                            break;
                        }
                    }
                }else{
                    $company = '';
                    $companyCif = '';
                    $companyAddress = '';
                    $companyLocation = '';
                }
                $hospital = $_POST['hospital'];
                $destination = $_POST['destination'];
                $location = $_POST['location'];
                $date = $_POST['date'];

                if($location == '' || $location == null){
                    $location = "______________";
                }

                return "
                    <div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'><div class='contenidoPompas'>
                        <div class='text-center titulo'>
                            <strong><u><p>TRASLADO DE CADÁVERES</p></u></strong>
                        </div>
                        <br><br>
                        <div style='line-height: 2;'>
                            <p>$company, con C.I.F. $companyCif y domicilio en $companyAddress, $companyLocation, empresa funeraria.</p>
                        </div>
                        <br><br>
                        <div class='text-center'>
                            <p style='text-align: center;'><strong><u>EXPONE</u></strong></p>
                        </div>
                        <br><br>
                        <div>
                            <p>Que procede al traslado de: <strong>" . $gender . " " . $data['deceasedName'] . " " . $data['deceasedSurname'] . " (Q.E.P.D.)</strong></p>
                            <p>$deceased el día <strong>" . $utils->fechaCastellano2(date('Y-m-d', strtotime($data['deceasedDate']))) . "</strong> desde el Hospital $hospital al $destination en carroza fúnebre.</p>
                        </div>
                        <br><br>
                        <div>
                            <p>En $location, a " . $utils->fechaCastellano2(date('Y')) . ".</p>
                            <br><br><br><br>
                            <p>Fdo.: _____________________</p>
                        </div>
                        <br><br>
                    </div>
                ";

            break;

            case "vacaciones":
                $utils = new Utils;
                $background = $utils->getBackgroundDocuments();
                $text = "<div class='fondo'><div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>";
                
                $startDate = strtotime($_POST['year'] . "-" . $_POST['month'] . "-01");
                $endDate = strtotime($_POST['year'] . "-" . $_POST['month'] . "-31");

                require_once($_SESSION['basePath'] . 'model/holidays.php');
                $holidays = new Holidays;
                $data = $holidays->getVacaciones($startDate, $endDate);
                $monthName = getMonth($_POST['month']);
            
                $text .= "  
                    <div class='contenidoPompas'> 
                        <div style='margin-top: 10px;text-align: center'>
                ";

                if($data !== false){
                    $text .= "
                        <span style='font-size:15px'>LISTADO VACACIONES DE <strong>". strtoupper($monthName) ." ". $_POST['year'] ." </strong></span>
                        <table class='tablaVacaciones$tableVacacionesColor' style='font-size:12px; text-align:center;margin-top:10px'>
                                <thead style='text-align:center'>
                                    <tr>
                                        <td style='width: 10%'>
                                            <strong>CÓDIGO</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>EMPLEADO</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>DÍAS</strong>
                                        </td>
                                        <td style='width: 10%'>
                                            <strong>TOTAL</strong>
                                        </td>
                                    </tr>
                                </thead>
                                <tbody>
                    ";

                    foreach($data as $elem){
                        $code = $elem[0];
                        $name = $elem[1];
                        $totalDays = $elem[2];
                        $daysInterval = '';
        
                        foreach($elem[3] as $days){
                            $daysInterval .= $days[0] . "-" . $days[1] . ", ";
                        }
                        $daysInterval = substr($daysInterval, 0, -2);

                        $text .= "
                            <tr> 
                                <td>$code</td>  
                                <td>$name</td>  
                                <td>$daysInterval</td>  
                                <td>$totalDays días</td> 
                            </tr>
                        ";
                    }

                    $text .= " 
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    ";

                }else{
                    $text .="
                            <p><span style='font-size:15px;margin-top:10px'>Ningún empleado tiene vacaciones en este mes</span></p>
                                </div>
                            </div>
                        </div>
                    ";
                }                     
                return $text;
            break;

            case "solicitudModificacion":
                $utils = new Utils();

                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/solicitudModificacion.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $staticInfo = $documentsInfo->getByDocument('solicitudModificacion');
                    if($staticInfo != null){
                        foreach($staticInfo as $elem){
                            switch($elem['name']){
                                case 'companyLocationDoc22':
                                    $companyLocation = $elem['value'];
                                    break;
                            }
                        }
                    }else{
                        $companyLocation = '';
                    }

                    $data = getSolicitudModificacion($expedient);

                    $familyContact = $data['familyContact'];
                    $familyContactNif = $data['familyContactNIF'];
                    $familyContactRelationship = $data['familyContactRelationship'];
                    $deceased = $data['deceased'];
                    $policy = $data['policy'];

                    $background = $utils->getBackgroundDocumentsPreventiva();
                    return "
                        <div class='fondo'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: 125px; line-height: 2em;'>
                                    <table class='tablePdf$tablePdfColor' style='font-size: 14px;'>
                                        <tbody>
                                            <tr>
                                                <td><span>SOLICITUD DE MODIFICACIÓN EN LOS ELEMENTOS DEL SERVICIO FUNERARIO CONTRATADO</span></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <br>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <p style='font-size: 14px!important;'>SUCURSAL</p>
                                                    <br>
                                                    <p style='font-size: 10px!important;'></p>
                                                </td>
                                                <td>
                                                    <p style='font-size: 14px!important;'>NUM. PÓLIZA</p>
                                                    <br>
                                                    <p style='font-size: 10px!important;'>$policy</p>
                                                </td>
                                                <td>
                                                    <p style='font-size: 14px!important;'>ASEGURADO</p>
                                                    <br>
                                                    <p style='font-size: 10px!important;'>$deceased</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <p style='font-size: 14px!important;'>SOLICITANTE</p>
                                                    <br>
                                                    <p style='font-size: 10px!important;'>$familyContact</p>
                                                </td>
                                                <td>
                                                    <p style='font-size: 14px!important;'>DNI</p>
                                                    <br>
                                                    <p style='font-size: 10px!important;'>$familyContactNif</p>
                                                </td>
                                                <td>
                                                    <p style='font-size: 14px!important;'>PARENTESCO</p>
                                                    <br>
                                                    <p style='font-size: 10px!important;'>$familyContactRelationship</p>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <br>
                                    <p>* Solicita el intercambio del servicio indicado, includio en el valor de su póliza, por:</p>
                                    <p>- </p>
                                    <p>- </p>
                                    <p>- </p>
                                    <p>Quedando satisfecho con la prestación del servicio intercambiado, sin que se devengue devolución del capital.</p>
                                    <br>
                                    <br>
                                    <p>
                                        * Solicita la prestación de los siguientes complementos al servicio funerario contratado, por un importe total de
                                        ........................ €, con cargo al valor total de servicio de la póliza de referencia.
                                    </p>
                                    <p>- </p>
                                    <p>- </p>
                                    <p>- </p>
                                    <br>
                                    <br>
                                    <p>* Observaciones</p>
                                    <p>- </p>
                                    <p>- </p>
                                    <p>- </p>
                                    <div style='font-size: 14px; text-align: right;'><p>En $companyLocation, a " . $utils->fechaCastellano2(date('Y')) . "</p></div>
                                    <div class='col-xs-12' style='margin-top:20px'>
                                        <div style='width:40%; float:left' class='pull-left'>
                                            <table class='tablePdfNoBorder' style='color:$colorStyle!important;'>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            <p>El solicitante,</p>                
                                                            <p></p>
                                                            <p></p>
                                                            <p>Fdo.: ______________________</p>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div style='width:40%; float:right' class='pull-right'>
                                            <table class='tablePdfNoBorder' style='color:$colorStyle!important;'>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            <p>Por PREVENTIVA,</p>                
                                                            <p></p>   
                                                            <p></p>   
                                                            <p>______________________</p>                   
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";
                }
            break;

            case "fichaAsistencia":
                $utils = new Utils();
                $data = getFichaAsistencia($expedient);

                $deceased = $data['deceased'];
                $deceasedNIF = $data['deceasedNIF'];
                $deceasedDate = $data['deceasedDate'] == '' || $data['deceasedDate'] == null ? '' : date('d-m-Y', strtotime($data['deceasedDate']));
                $policy = $data['policy'];
                $capital = $data['capital'];
                $familyContact = $data['familyContact'];
                $familyContactRelationship = $data['familyContactRelationship'];
                $familyContactPhone = $data['familyContactPhone'];
                $familyContactMobilePhone = $data['familyContactMobilePhone'];
                $familyContactAddress = $data['familyContactAddress'];
                $familyContactMail = $data['familyContactMail'];
                $otherContactName = $data['otherContactName'];
                $otherContactPhone = $data['otherContactPhone'];
                $otherContactRelationship = $data['otherContactRelationship'];
                $cremation = $data['cremation'];
                $isCremation = $cremation == 0 || $cremation == '0' ? '' : 'X';
                if($data['deceasedLocation'] == '0'){
                    $deceasedLocation = $data['otherDeceasedLocation'] == null ? '' : $data['otherDeceasedLocation'];
                }else{
                    $deceasedLocation = $data['deceasedLocation'] == null ? '' : $data['deceasedLocation'];
                }
                $cemeteryLocation = $data['cemeteryLocation'] == null ? '' : $data['cemeteryLocation'];
                $cemetery = $data['cemetery'] == null ? '' : $data['cemetery'];
                $crematorium = $data['crematorium'] == null ? '' : $data['crematorium'];
                $crematoriumLocation = $data['crematoriumLocation'] == null ? '' : $data['crematoriumLocation'];
                $locality = $cremation == 0 || $cremation == '0' ? $cemeteryLocation : $crematoriumLocation;
                $cemetery = $cremation == 0 || $cremation == '0' ? $cemetery : $crematorium;
                $funeralHome = $data['funeralHome'] == null ? '' : $data['funeralHome'];
                $mortuary = $data['mortuary'] == null ? '' : $data['mortuary'];
                if($mortuary == 'Otro'){
                    $mortuary = $data['deceasedMortuaryAddress'];
                }
                $supplier = $data['supplier'];
                $deceasedTime = $data['deceasedTime'] == null ? '' : date('H:i', strtotime($data['deceasedTime']));
                $ceremonyDate = $data['ceremonyDate'] == null ? '' : date('d-m-y', strtotime($data['ceremonyDate']));
                $ceremonyTime = $data['ceremonyTime'] == null ? '' : date('H:i', strtotime($data['ceremonyTime']));
                $crematoriumDate = $data['start'] == null ? '' : date('d-m-y', strtotime($data['start']));
                $crematoriumTime = $data['end'] == null ? '' : date('H:i', strtotime($data['end']));

                $background = $utils->getBackgroundDocumentsPreventiva();

                $text = "
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div style='right: 520px; position: absolute; text-align: right; padding-top: 75px;'>
                                <p></p>
                            </div>
                            <div class='contenidoPompas' style='padding-top: -5px'>
                                <div style='text-align:center' class='text-center'>
                                    <p><strong><u>FICHA ASISTENCIA</u></strong></p>
                                </div>
                                <table class='tablePdfNoBorder' style='font-size:12px; color:$colorStyle!important;'>
                                    <tbody>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Gestor: &nbsp;&nbsp;&nbsp;&nbsp;____________________________</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <table class='tablePdfNoBorder' style='font-size:12px; color:$colorStyle!important;'>
                                    <tbody>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Asegurado fallecido: &nbsp;&nbsp;&nbsp;&nbsp;$deceased</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>DNI: &nbsp;&nbsp;&nbsp;&nbsp;$deceasedNIF</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <table class='tablePdfNoBorder' style='font-size:12px; color:$colorStyle!important;'>
                                    <tbody>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Fecha defunción: &nbsp;&nbsp;&nbsp;&nbsp;$deceasedDate</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>Número de póliza: &nbsp;&nbsp;&nbsp;&nbsp;$policy</p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Categoría/Traslado: &nbsp;&nbsp;&nbsp;&nbsp;____________________________</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>Valor servicio: &nbsp;&nbsp;&nbsp;&nbsp;$capital</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <table class='tablePdfNoBorder' style='font-size:12px; color:$colorStyle!important;'>
                                    <tbody>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Causa fallecimiento (natural / accidental): &nbsp;&nbsp;&nbsp;&nbsp;____________________________</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div>----------------------------------------------------------------------------------------------------------------------------------------------------------</div>
                                <table class='tablePdfNoBorder' style='font-size:12px; color:$colorStyle!important; margin-top: -5px!important;'>
                                    <tbody>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Contratante: &nbsp;&nbsp;&nbsp;&nbsp;$familyContact</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <table class='tablePdfNoBorder' style='font-size:12px; color:$colorStyle!important;'>
                                    <tbody>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Teléfono fijo: &nbsp;&nbsp;&nbsp;&nbsp;$familyContactPhone</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>Teléfono móvil: &nbsp;&nbsp;&nbsp;&nbsp;$familyContactMobilePhone</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>Parentesco: &nbsp;&nbsp;&nbsp;&nbsp;$familyContactRelationship</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <table class='tablePdfNoBorder' style='font-size:12px; color:$colorStyle!important;'>
                                    <tbody>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Domicilio: &nbsp;&nbsp;&nbsp;&nbsp;$familyContactAddress</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div>----------------------------------------------------------------------------------------------------------------------------------------------------------</div>
                                <table class='tablePdfNoBorder' style='font-size:12px; color:$colorStyle!important;'>
                                    <tbody>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Localidad fallecimiento: &nbsp;&nbsp;&nbsp;&nbsp;$deceasedLocation</p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Localidad inhumación / incineración: &nbsp;&nbsp;&nbsp;&nbsp;$locality</p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Funeraria origen: &nbsp;&nbsp;&nbsp;&nbsp;$funeralHome</p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Funeraria destino: &nbsp;&nbsp;&nbsp;&nbsp;$funeralHome</p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Marmolista: &nbsp;&nbsp;&nbsp;&nbsp;____________________________</p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Floristería: &nbsp;&nbsp;&nbsp;&nbsp;$supplier</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <table class='tablePdfNoBorder' cellspacing='0' cellpadding='4'>
                                    <tr> 
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Inhumación temporal&nbsp;</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span></span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Inhumación propiedad&nbsp;</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span></span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Incineración&nbsp;</span></td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span>$isCremation</span></td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfNoBorder' style='font-size:12px; color:$colorStyle!important;'>
                                    <tbody>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Tanatorio: &nbsp;&nbsp;&nbsp;&nbsp;$mortuary</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>Cementerio / Crematorio: &nbsp;&nbsp;&nbsp;&nbsp;$cemetery</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <table class='tablePdfNoBorder' style='font-size:12px; color:$colorStyle!important;'>
                                    <tbody>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Elementos del servicio no utilizados: </p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <table class='tablePdfNoBorder' cellspacing='0' cellpadding='4'>
                                                    <tr> 
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Corona/s&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Tanatorio&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Nicho&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Lápida&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Esquela&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Iglesia&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Acompañamiento&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Recordatorios&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Otros: &nbsp;&nbsp;&nbsp;&nbsp;____________________________</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <table class='tablePdfNoBorder' style='font-size:12px; color:$colorStyle!important;'>
                                    <tbody>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Elementos del servicio contratados de forma particular: </p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <table class='tablePdfNoBorder' cellspacing='0' cellpadding='4'>
                                                    <tr> 
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Corona/s&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Tanatorio&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Nicho&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Lápida&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Esquela&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Iglesia&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Acompañamiento&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                        <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;Recordatorios&nbsp;</span></td>
                                                        <td>    
                                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                                <tr>
                                                                    <td><span></span></td>
                                                                </tr>
                                                            </table>
                                                        </td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Otros:: &nbsp;&nbsp;&nbsp;&nbsp;____________________________</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div style='text-align:center; padding-top: 5px;' class='text-center'>
                                    <p><strong><u>CONTRATANTE</u></strong></p>
                                </div>
                                <table class='tablePdf$tablePdfColor' style='font-size:12px; color:$colorStyle!important;'>
                                    <tbody>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>Nombre y apellidos</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>Parentesco</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>Teléfono fijo</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>Teléfono móvil</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>Correo electrónico</p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>$familyContact</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>$familyContactRelationship</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>$familyContactPhone</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>$familyContactMobilePhone</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>$familyContactMail</p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p>$otherContactName</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>$otherContactRelationship</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p>$otherContactPhone</p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div style='text-align:center; padding-top: 5px;' class='text-center'>
                                    <p><strong><u>OBSERVACIONES</u></strong></p>
                                </div>
                                <table class='tablePdf$tablePdfColor' style='font-size:12px; color:$colorStyle!important;'>
                                    <tbody>
                                        <tr>
                                            <td style='height: 22px!important;'>
                                                <p></p>
                                                <p></p>
                                                <p></p>
                                                <p></p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <div style='width:40%; float:right' class='pull-right'>
                                    <table class='tablePdfNoBorder' style='color:$colorStyle!important;'>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <p></p>                
                                                    <p></p>   
                                                    <p></p>   
                                                    <p>Fdo.: ______________________</p>                   
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <pagebreak>
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div style='right: 520px; position: absolute; text-align: right; padding-top: 75px;'>
                                <p></p>
                            </div>
                            <div class='contenidoPompas' style='padding-top: -5px'>
                                <div style='text-align:center' class='text-center'>
                                    <p><strong><u>DATOS COMPLEMENTARIOS (CALIDAD)</u></strong></p>
                                </div>
                                <p>Estado de la sala/tanatorio: &nbsp;&nbsp;&nbsp;&nbsp;________________________________________________</p>
                                <p>Hora de contacto del Gestor de Asistencia con los familiares: &nbsp;&nbsp;&nbsp;&nbsp;____________________</p>
                                <table class='tablePdfNoBorder' style='font-size:12px; color:$colorStyle!important;'>
                                    <tbody>
                                        <tr>
                                            <td style='height: 30px!important;'>
                                                <p>Fecha inhumación: &nbsp;&nbsp;&nbsp;&nbsp;$deceasedDate</p>
                                            </td>
                                            <td style='height: 30px!important;'>
                                                <p>Hora inhumación: &nbsp;&nbsp;&nbsp;&nbsp;$deceasedTime</p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 30px!important;'>
                                                <p>Fecha incineración: &nbsp;&nbsp;&nbsp;&nbsp;$crematoriumDate</p>
                                            </td>
                                            <td style='height: 30px!important;'>
                                                <p>Hora incineración: &nbsp;&nbsp;&nbsp;&nbsp;$crematoriumTime</p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td style='height: 30px!important;'>
                                                <p>Fecha servicio religioso: &nbsp;&nbsp;&nbsp;&nbsp;$ceremonyDate</p>
                                            </td>
                                            <td style='height: 30px!important;'>
                                                <p>Hora servicio religioso: &nbsp;&nbsp;&nbsp;&nbsp;$ceremonyTime</p>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                                <br>
                                <p>INCIDENCIAS &nbsp;&nbsp;&nbsp;&nbsp;____________________________________________________________</p>
                                <p>Gestoría / Despacho de abogados asignado &nbsp;&nbsp;&nbsp;&nbsp;____________________________</p>
                                <p>Distancia recorrida hasta el lugar de la asistencia &nbsp;&nbsp;&nbsp;&nbsp;____________________________ km</p>
                                <p>Aviso recibido por &nbsp;&nbsp;&nbsp;&nbsp;____________________________</p>
                                <p>Día/Hora recibo de aviso del fallecimiento &nbsp;&nbsp;&nbsp;&nbsp;____________________________</p>
                            </div>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "autorizacionPreventiva":
                $utils = new Utils();

                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/autorizacionPreventiva.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $staticInfo = $documentsInfo->getByDocument('autorizacionPreventiva');
                    if($staticInfo != null){
                        foreach($staticInfo as $elem){
                            switch($elem['name']){
                                case 'companyLocationDoc24':
                                    $companyLocation = $elem['value'];
                                    break;
                            }
                        }
                    }else{
                        $companyLocation = '';
                    }

                    $data = getAutorizacionPreventiva($expedient);

                    $familyContact = $data['familyContact'];
                    $familyContactNif = $data['familyContactNIF'];
                    $deceased = $data['deceased'];
                    $deceasedNif = $data['deceasedNIF'];
                    $deceasedGender = $data['deceasedGender'] == 'Hombre' ? 'D.' : 'Dña.';
                    $policy = $data['policy'];

                    $background = $utils->getBackgroundDocumentsPreventiva();
                    return "
                        <div class='fondo'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: 125px; line-height: 2em;'>
                                    <br><br>
                                    <p>
                                        Yo, D./Dña. $familyContact, con DNI nº $familyContactNif, 
                                        y en representación de la familia del fallecido/ de la fallecida $deceasedGender $deceased con DNI $deceasedNif.
                                    </p>
                                    <br>
                                    <p>
                                        <strong>AUTORIZO, POR MANDATO EXPRESO,</strong> a PREVENTIVA COMPAÑÍA DE SEGUROS Y REASEGUROS, S.A., con NIF A28027332, a satisfacer, 
                                        <u>con cargo al valor del servicio contratado en la póliza nº $policy</u>, el total de los gastos incurridos para la prestación de los 
                                        servicios comprometidos y realizados o por realizar.
                                    </p>
                                    <br>
                                    <div>
                                        <p>En $companyLocation, a " . $utils->fechaCastellano2(date('Y')) . "</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";
                }
            break;

            case "prestacionServicio":
                $utils = new Utils();

                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/prestacionServicio.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    require_once($_SESSION['basePath'] . "model/settings.php");

                    $settings = new Settings;
                    $company = $settings->getCompanyName();

                    $data = getPrestacionServicio($expedient);

                    $familyContact = $data['familyContact'];
                    $familyContactNif = $data['familyContactNIF'];
                    $familyContactRelationship = $data['familyContactRelationship'];
                    $deceasedGender = $data['deceasedGender'] == 'Hombre' ? 'D.' : 'Dña.';
                    $deceased = $data['deceased'];
                    $policy = $data['policy'];
                    $cremation = $data['cremation'];
                    $total = $data['total'] == null ? '' : $data['total'];
                    $deceasedDate = $data['deceasedDate'] == null ? '' : date('d-m-Y', strtotime($data['deceasedDate']));
                    $mortuary = $data['mortuary'] == null ? '' : $data['mortuary'];
                    if($mortuary == 'Otro'){
                        $mortuary = $data['deceasedMortuaryAddress'];
                    }
                    if($data['expedientDL'] == '0'){
                        $deceasedLocation = $data['otherDeceasedLocation'] == null ? '' : $data['otherDeceasedLocation'];
                    }else{
                        $deceasedLocation = $data['deceasedLocation'] == null ? '' : $data['deceasedLocation'];
                    }

                    $cemeteryLocation = $data['cemeteryLocation'] == null ? '' : $data['cemeteryLocation'];
                    $crematoriumLocation = $data['crematoriumLocation'] == null ? '' : $data['crematoriumLocation'];
                    $locality = $cremation == 0 || $cremation == '0' ? $cemeteryLocation : $crematoriumLocation;

                    $background = $utils->getBackgroundDocumentsPreventiva();
                    return "
                        <div class='fondo'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: 125px; line-height: 2em;'>
                                    <div style='text-align:center' class='text-center'>
                                        <p><strong><u>AUTORIZACIÓN PARA LA PRESTACIÓN DE SERVICIO FUNERARIO</u></strong></p>
                                        <p><strong>(INFORTUNIO/ASISTENCIA 21)</strong></p>
                                    </div>
                                    <br><br><br>
                                    <p>
                                        Preventiva Seguros gestionará la prestación de un servicio fúnebre con la funeraria $company, a petición de
                                        D./Dña. $familyContact con N.I.F. $familyContactNif, en calidad de $familyContactRelationship de nuestro asegurado $deceasedGender $deceased
                                        con número de Póliza $policy. No teniendo contratada la garantía de Decesos, el coste total del servicio se
                                        descontará del capital de fallecimiento contratado en dicha póliza, que asciende a ____________________________________________________ euros 
                                        ($total €), según se detalla a continuación:
                                    </p>
                                    <br><br><br><br>
                                    <p>Fecha de fallecimiento: $deceasedDate</p>
                                    <p>Localidad de fallecimiento: $deceasedLocation</p>
                                    <p>Tanatorio: $mortuary</p>
                                    <p>Localidad inhumación / incineración: $locality</p>
                                    <br><br><br><br><br>
                                    <div class='col-xs-12' style='margin-top:20px'>
                                        <div style='width:40%; float:left' class='pull-left'>
                                            <table class='tablePdfNoBorder' style='color:$colorStyle!important;'>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            <p>CONFORME,</p>
                                                            <p>El solicitante / familiar</p>                
                                                            <p></p>
                                                            <p></p>
                                                            <p>Fdo.: ______________________</p>
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                        <div style='width:40%; float:right' class='pull-right'>
                                            <table class='tablePdfNoBorder' style='color:$colorStyle!important;'>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            <p></p>   
                                                            <p>El tramitador de Preventiva</p>                
                                                            <p></p>   
                                                            <p></p>   
                                                            <p>______________________</p>                   
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";
                }
            break;

            case "recibisCampaneroLaFE":
                $utils = new Utils();

                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/recibisCampaneroLaFE.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    require_once($_SESSION['basePath'] . "model/settings.php");
                    $settings = new Settings;
                    $companyLocation = $settings->getCompanyLocation();

                    $data = getRecibisCampanerosLaFE($expedient);

                    $background = $utils->getBackgroundDocuments();

                    if($data['deceasedGender'] == "Mujer"){
                        $gender = "Dña.";
                    }else{
                        $gender = "D.";
                    }
                    $deceasedName = $data['deceasedName'] . " " .$data['deceasedSurname'];

                    $policy = $data['policy'] != null && $data['policy'] != '' ? $data['policy'] : '___________';
                    $deceasedLocationInfo = '_______________________________________';
                    if($data['deceasedInName'] != null){
                        $deceasedLocationInfo = $data['deceasedInName'];
                        if($data['deceasedLocality'] != null){
                            $deceasedLocationInfo .= ', ' . $data['deceasedLocality'];
                        }

                        if($data['deceasedProvince'] != null){
                            $deceasedLocationInfo .= ', ' . $data['deceasedProvince'];
                        }
                    }
                    
                    return "
                        <div class='fondo'>
                            <div class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: 80px; line-height: 2em;'>
                                    <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2'>
                                        <tr>
                                            <td style='width:45%; font-size: 18px!important; line-height: 10px; color:$colorStyle!important' valign='bottom'>
                                                <p>
                                                    <img src='" . $utils->getRoute() . "resources/files/" . $_SESSION['company'] . "/obituaries/basic/lafe.jpg'>
                                                    <br><br>
                                                    <span style='color:$colorStyle'>
                                                        C/ Elduayen, 32<br>36202 - Vigo
                                                    </span>
                                                </p>
                                            </td>
                                        </tr>
                                    </table>
                                    <br><br><br><br>
                                    <div style='font-size: 14px!important; line-height: 30px;'>
                                        <p>
                                            Recibí de los señores Directores de <strong>'La Fe Previsora Cía. de Seguros, S.A.'</strong> la cantidad de _____________________
                                            por <strong>INDEMNIZACIÓN ART. 11 AL ASEGURADO PÓLIZA Nº $policy $gender $deceasedName</strong>
                                            (Q.E.P.D.) con domicilio en $deceasedLocationInfo.
                                        </p>
                                        <br><br>
                                        <p>
                                            En $companyLocation, a ".date('d')." de " .getMonth(date('m')) ." de " .date('Y').".
                                        </p>
                                        <br><br><br><br>
                                        <div style='font-size: 14px; text-align: right;'>
                                            <p>
                                                Fdo.: __________________________
                                            </p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";
                }
            break;

            case "autoPrestacionServicio":
                $utils = new Utils();

                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/autoPrestacionServicio.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    require_once($_SESSION['basePath'] . "model/settings.php");

                    $settings = new Settings;
                    $company = $settings->getCompanyName();
                    $companyAddress = $settings->getCompanyAddress();
                    $companyNIF = $settings->getCompanyNIF();
                    $companyPostalCode = $settings->getCompanyPostalCode();

                    $companyLocation = $settings->getCompanyLocation();
                    $substringLocation = str_replace(")","",$companyLocation);
                    $substringLocation = str_replace(" ("," - ",$substringLocation);
                    $substringLocation = explode(" - ",$substringLocation);

                    $substringLocationP1 = '';
                    if(isset($substringLocation[0])){
                        $substringLocationP1 = $companyPostalCode . " - ".$substringLocation[0];
                    }else{
                        $substringLocationP1 = $companyPostalCode;
                    }

                    $substringLocationP2 = '';
                    if(isset($substringLocation[1])){
                        $substringLocationP2 = $substringLocation[1];
                    }

                    $data = getAutoPrestacionServicio($expedient);
                    $requestDate = $data['requestDate'] == null ? '__-__-____' : date('d-m-Y', strtotime($data['requestDate']));
                    $funeralHomeEntryDate = $data['funeralHomeEntryDate'] == null ? '__-__-____' : date('d-m-Y', strtotime($data['funeralHomeEntryDate']));

                    $requestTime = $data['requestTime'] == null ? '--:--' : date('H:i', strtotime($data['requestTime']));
                    $arriveTime = $data['arriveTime'] == null ? '--:--' : date('H:i', strtotime($data['arriveTime']));
                    $funeralHomeEntryTime = $data['funeralHomeEntryTime'] == null ? '--:--' : date('H:i', strtotime($data['funeralHomeEntryTime']));

                    $familyContact = $data['familyContact'] == null || $data['familyContact'] == ' ' ? '___________________' : $data['familyContact'];
                    $familyContactNif = $data['familyContactNIF'] == null ? '_________' : $data['familyContactNIF'];
                    $familyContactRelationship = $data['familyContactRelationship'] == null ? '__________' : $data['familyContactRelationship'];
                    if($data['familyContactPhone'] == null || $data['familyContactPhone'] == ''){
                        if($data['familyContactMobilePhone'] == null || $data['familyContactMobilePhone'] == ''){
                            $familyContactPhone = '__________';
                        }else{
                            $familyContactPhone = $data['familyContactMobilePhone'];
                        }
                    }else{
                        $familyContactPhone = $data['familyContactPhone'];
                    }
                    $familyContactAddress = $data['familyContactDom'] == null ? '__________' : $data['familyContactDom'];
                    if($data['familyContactAddress'] != null && $data['familyContactAddress'] != ''){
                        $familyContactAddress .= ', ' . $data['familyContactAddress'];
                    }
                    $deceasedGender = $data['deceasedGender'] == null ? 'D/Dña ' : ($data['deceasedGender'] == 'Hombre' ? 'D.' : 'Dña.');
                    $deceasedDate = $data['deceasedDate'] == null ? '__-__-____' : date('d-m-Y', strtotime($data['deceasedDate']));
                    $deceased = $data['deceased'] == null ? '__________' : $data['deceased'];

                    $deceasedLocation = $data['deceasedInName'];
                    if($data['deceasedLocation'] != null && $data['deceasedLocation'] != ''){
                        $deceasedLocation .= ', ' . $data['deceasedLocation'];
                    }
                    if($data['deceasedProvince'] != null && $data['deceasedProvince'] != ''){
                        $deceasedLocation .= ', ' . $data['deceasedProvince'];
                    }

                    $staticInfo = $documentsInfo->getByDocument('autoPreparacionServicio');
                    if($staticInfo != null){
                        foreach($staticInfo as $elem){
                            switch($elem['name']){
                                case 'emailDoc25':
                                    $emailInfo = $elem['value'];
                                break;
                            }
                        }
                    }else{
                        $emailInfo = '';
                    }

                    $background = $utils->getBackgroundDocuments();
                    return "
                        <div class='fondo'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div style='margin-right:50px;right:480px; position: absolute; text-align: right; padding-top: 50px; line-height: 0.5'>
                                    <p><strong>" . $company . "</strong></p>
                                    <p><strong>" . $companyAddress . "</strong></p>
                                    <p><strong>" . $substringLocationP1 ."</strong></p>
                                    <p><strong>" . $substringLocationP2 . "</strong></p>
                                </div>
                                <div class='contenidoPompas' style='line-height: 2em;font-size:13px;padding-top:-1px'>
                                    <br>
                                    <div style='text-align:center' class='text-center'>
                                        <p><strong><u>AUTORIZACIÓN PARA LA PRESTACIÓN DE SERVICIO</u></strong></p>
                                    </div>
                                    <br>
                                    <p style='text-align:center'>
                                        Hora Solicitud: <strong>$requestTime</strong>. Hora de llegada: <strong>$arriveTime</strong>. Hora entrada Tanatorio: <strong>$funeralHomeEntryTime</strong>
                                    </p>
                                    <p style='text-align:center'>
                                        Fecha Solicitud <strong>$requestDate</strong>. Fecha de llegada: <strong>$requestDate</strong> Fecha entrada Tanatorio: <strong>$funeralHomeEntryDate</strong>
                                    </p>
                                    <p style='text-align:center'>
                                        Quien suscribe, <strong> $familyContact </strong> con domicilio en <strong>$familyContactAddress</strong> con teléfono <strong>$familyContactPhone</strong> y con N.I.F.: <strong>$familyContactNif</strong>
                                        en calidad de <strong>$familyContactRelationship</strong> y en relación al óbito de: <strong>$deceasedGender $deceased</strong> ocurrido el día <strong>$deceasedDate</strong> en <strong>$deceasedLocation</strong>.
                                    </p>
                                    <p></p>
                                    <p>
                                        Por medio del presente documento <strong>AUTORIZA Y ENCARGA EXPRESAMENTE A " . mb_strtoupper($company) . "</strong> la prestación del servicio funerario del fallecido, arriba reseñado,
                                        así como la recogida, custodia y gestión de todo tipo de documentación ante cualquier organismo público o privado, la inhumación o incineración, así como cualquier práctica sanitaria legalmente exigida,
                                        traslado del fallecido y esquelas.
                                    </p>
                                    <p>
                                    El pago de todos los gastos que se devenguen por los servicios suplidos y suministrados conforme al presupuesto o al valor de la suma asegurada contratada en la póliza, corresponderá,
                                    contra la prestación de la correspondiente factura, a la Entidad Aseguradora del fallecido o en su defecto del firmante de la presenta autorización.
                                    </p>
                                    <p>
                                    El declarante manifiesta, bajo su responsabilidad, la veracidad de los datos aquí expresados.
                                    </p>

                                    <br><br><br>
                                    <div class='col-xs-12' style='margin-top:20px'>
                                        <div style='width:50%; float:left' class='pull-left'>
                                            <table class='tablePdf$tablePdfColor' style='color:$colorStyle!important;'>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            <p></p>
                                                            <p></p>
                                                            <p></p>
                                                            <p>Fdo.: <strong>$familyContact</strong> con N.I.F: <strong>$familyContactNif</strong></p>                
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                            <br><br>
                                            <p style='text-align:left'><span style='font-size:13px'>En $companyLocation, a ".$utils->fechaCastellano2(date('Y'))."</span></p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <pagebreak>
                        <div class='fondo'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='line-height: 2em;font-size:9px;margin-top:20px'>
                                    <br>
                                    <p>
                                        <span style='text-decoration:underline;'><strong>INFORMACION BÁSICA SOBRE PROTECCION DE DATOS</strong></span>
                                    </p>
                                    <p>
                                        Responsable: " . mb_strtoupper($company) . "
                                    </p>
                                    <p>
                                        Finalidades: presentar presupuestos con información sobre nuestros productos y servicios funerarios, así como prestar los servicios funerarios solicitados ofreciendo nuestra mejor atención en la prestación y realizar la facturación de los mismos.
                                        Solicito su autorización para las siguientes finalidades adicionales:
                                    </p>
                                    <p>
                                        - Enviar publicidad relacionada con nuestros productos y servicios por cualquier medio (postal, email o teléfono) e invitarle a eventos organizados por la empresa.
                                    </p>
                                    <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:50px'>
                                        <tr> 
                                            <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;<strong>SI</strong>&nbsp;</span></td>
                                            <td>    
                                                <table class='tablePdfv2$tablePdfV2Color'>
                                                    <tr>
                                                        <td><span>&nbsp;</span></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr> 
                                            <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;<strong>NO</strong>&nbsp;</span></td>
                                            <td>    
                                                <table class='tablePdfv2$tablePdfV2Color'>
                                                    <tr>
                                                        <td><span>&nbsp;</span></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                    </table>
                                    <br>
                                    <p>
                                        - Enviar publicidad relacionada con productos financieros y aseguradores del Grupo empresarial al que pertenece la empresa por cualquier medio (postal, email o teléfono)
                                        Con el fin de poder ofrecerle productos y servicios de acuerdo con sus intereses elaboramos un “perfil comercial”, en base a la información facilitada. No se tomarán decisiones
                                        automatizadas en base a dicho perfil.
                                    </p>
                                    <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:50px'>
                                        <tr> 
                                            <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;<strong>SI</strong>&nbsp;</span></td>
                                            <td>    
                                                <table class='tablePdfv2$tablePdfV2Color'>
                                                    <tr>
                                                        <td><span>&nbsp;</span></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                        <tr> 
                                            <td><span style='font-size: 12px;color:$colorStyle'>&nbsp;<strong>NO</strong>&nbsp;</span></td>
                                            <td>    
                                                <table class='tablePdfv2$tablePdfV2Color'>
                                                    <tr>
                                                        <td><span>&nbsp;</span></td>
                                                    </tr>
                                                </table>
                                            </td>
                                        </tr>
                                    </table>
                                    <br>
                                    <p>
                                        Legitimación: 
                                    <br/>
                                        Formalización, ejecución y desarrollo de relaciones contractuales y/o precontractuales. 
                                    <br/>
                                        Cumplimiento de obligaciones legales aplicables a " . mb_strtoupper($company) . "
                                    <br/>
                                        Será necesario el consentimiento del titular de los datos para determinados tratamientos.
                                    </p>
                                    <p>
                                        Destinarios: Se cederán datos a terceros cuya participación es necesaria para la prestación de servicio final. Previsión de transferencias a terceros países cuando el servicio lo requiera. 
                                    </p>
                                    <p>
                                        Derechos: Vd. Tiene derecho a acceder, rectificar y suprimir los datos, limitar su tratamiento, oponerse al tratamiento y ejercer su derecho a la portabilidad de los datos 
                                        de carácter personal, todo ello de forma gratuita, tal como se detalla en la información completa sobre protección de datos. Le recordamos además que Vd, podrá oponerse 
                                        en cualquier momento al tratamiento de sus datos con fines publicitarios o promocionales. Para ejercer sus derechos puede escribirnos un correo electrónico a 
                                        $emailInfo en el que debe identificarse adjuntando copia de su DNI e indicar el derecho que desea ejercer y el motivo.
                                        Procedencia: Los datos son facilitados por el representante de la familia y/o la compañía de seguros encargada del deceso. 
                                    </p>
                                    <p>
                                        <span style='text-decoration:underline;'><strong>INFORMACION ADICIONAL SOBRE LA PROTECCIÓN DE DATOS</strong></span>
                                        <ol> 
                                            <li>
                                                RESPONSABLE: EMPRESA " . mb_strtoupper($company) . " CIF: $companyNIF , con domicilio en $companyAddress, Correo electrónico: $emailInfo 
                                            </li>
                                            <br/>
                                            <li>
                                                <strong>¿CON QUÉ FINALIDAD TRATAMOS SUS DATOS PERSONALES?</strong> <br/>
                                                En $company tratamos la información que nos facilitan las personas interesadas para las siguientes finalidades: Con el fin de presentar presupuestos con información 
                                                sobre nuestros productos y servicios funerarios, así como prestar los servicios funerarios solicitados ofreciendo nuestra mejor atención en la prestación y realizar 
                                                la facturación de los mismos.
                                                Adicionalmente, en caso de que lo hubieras aceptado en el formulario habilitado al efecto, podremos tratar tus datos para las siguientes finalidades adicionales:
                                                <br/>- Enviar publicidad relacionada con nuestros productos y servicios por cualquier medio (postal, email o teléfono) e invitarle a eventos organizados por la empresa. 
                                                <br/>- Enviar publicidad relacionada con productos financieros y aseguradores del Grupo empresarial al que pertenece la empresa por cualquier medio (postal, email o teléfono) 
                                                Con el fin de poder ofrecerle productos y servicios de acuerdo con sus intereses elaboramos un “perfil comercial”, en base a la información facilitada. No se tomarán 
                                                decisiones automatizadas en base a dicho perfil.
                                            </li>
                                        </ol>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <pagebreak>
                        <div class='fondo'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='line-height: 2em;font-size:9px;margin-top:20px'>
                                    <br>
                                    <ol>
                                        <li value='3'>
                                            <strong>LIMITACIÓN PLAZO DE CONSERVACION</strong>
                                            ¿Por cuánto tiempo conservaremos sus datos? Los datos proporcionados para la prestación del servicio funerario se conservarán 
                                            al menos durante 7 años de conformidad con la legislación mercantil y de protección de datos. Los datos de contacto para el envío de publicidad sobre productos o 
                                            servicios se conservarán mientras se mantenga la relación comercial o mientras el titular no solicite la supresión. 
                                        </li>
                                        <br/>
                                        <li value='4'>
                                            <strong>LEGITIMACION:</strong> ¿Cuál es la legitimación para el tratamiento de sus datos? La base legal para el tratamiento de los datos es la ejecución del contrato para 
                                            la prestación de los servicios funerarios solicitados y el consentimiento obtenido del interesado para el envío de publicidad. 
                                        </li>
                                        <br/>
                                        <li value='5'>
                                            <strong>DESTINATARIOS:</strong> ¿A qué destinatarios se comunicarán sus datos? Los datos se comunicarán a:<br/> 
                                            - Administración Tributaria - Bancos y Entidades Financieras 
                                            <br/>- Administración Pública: Sanidad, Cementerios, Registro Civil, Juzgados, etc. 
                                            <br/>- Compañía aseguradora, cuando sea ésta la responsable de abonar la factura por los servicios prestados. 
                                            <br/>- A las empresas pertenecientes al Grupo societario al que pertenece la empresa a las que se les comunican los datos de los CV recibidos para ocupación de puestos vacantes. 
                                            Se realizarán transferencias de datos a terceros países cuando los servicios funerarios se realicen fuera de España. En estos casos en particular, además se comunicarán los datos a:
                                            - Embajada y/o Consulado del país de destino. - Además, en el caso de países no comunitarios a o Aduanas.  o Gestoría encargada de realizar los trámites con Aduanas. 
                                        </li>
                                        <br/>
                                        <li value='6'>
                                            <strong>¿CUÁLES SON SUS DERECHOS CUANDO NOS FACILITA SUS DATOS?</strong><br/>
                                            La empresa le informa de que tiene derecho a acceder a sus datos personales y obtener información sobre cómo se están tratando dichos datos. Asimismo, tiene derecho a solicitar la rectificación de 
                                            los datos inexactos o, en su caso, solicitar su supresión cuando, entre otros motivos, los datos ya no sean necesarios para los fines para los que fueron recabados.<br/>
                                            Le recordamos que tiene derecho a oponerse, en cualquier momento, al tratamiento de sus datos y la empresa dejará de tratar los datos, salvo por motivos 
                                            legítimos imperiosos o para garantizar la defensa ante posibles reclamaciones<br/>
                                            Asimismo, también podrá solicitar el derecho de portabilidad y obtener para sí mismo o para otro prestador de servicios determinada información.<br/> 
                                            En determinadas circunstancias, podrá solicitar la limitación del tratamiento de sus datos, en cuyo caso la empresa únicamente los conservará para el ejercicio o defensa de las posibles reclamaciones. <br/> 
                                            El interesado tiene derecho a retirar el consentimiento en cualquier momento, sin que ello afecte a la licitud del tratamiento basado en el consentimiento previo a su retirada. <br/> 
                                            Vd podrá ejercer tales derechos mediante: 
                                            <ul>
                                                <li type='disc'>
                                                    Correo electrónico a $emailInfo
                                                </li>
                                            </ul>
                                            Se exige acreditar la identidad de la persona que ejerce sus derechos, mediante el envío de copia de DNI, NIE, pasaporte o documento equivalente, por las dos caras.<br/>
                                            La empresa le facilitará la información en el plazo máximo de un mes a partir de la recepción de la solicitud. Dicho plazo podrá prorrogarse dos meses en caso necesario, 
                                            teniendo en cuenta la complejidad y el número de solicitudes.<br/>
                                            Vd. Podrá presentar reclamación ante la Autoridad de Control competente en materia de protección de datos. No obstante, en primera instancia, podrá presentar reclamación 
                                            ante el Delegado de Protección de Datos, en el caso de que hubiese sido designado, 
                                            quien resolverá la reclamación en el plazo máximo de dos meses.<br/>
                                            Para obtener información adicional sobre sus derechos visite la página Web de la Agencia Española de Protección de Datos (https://www.agpd.es/). 
                                        </li>
                                        <br/>
                                        <li value='7'>
                                            <strong>¿CÓMO HEMOS OBTENIDO SUS DATOS?</strong><br/>
                                            Los datos personales que tratamos en $company proceden propio interesado, del representante de la familia y/o de la compañía de seguros encargada del deceso.
                                            - Las categorías de datos que se tratan son: o Datos de identificación (Nombre, apellidos, DNI, Dirección, Telf., Correo electrónico). o Características personales (Estado Civil, Fecha y lugar de nacimiento, sexo, nacionalidad) o Datos Económicos - No se tratan datos especialmente protegidos
                                        </li>
                                    </ol>
                                </div>
                            </div>
                        </div>
                    ";
                }
            break;

            case "reciboOcaso":
                $utils = new Utils();

                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/reciboOcaso.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $staticInfo = $documentsInfo->getByDocument('reciboOcaso');
                    if($staticInfo != null){
                        foreach($staticInfo as $elem){
                            switch($elem['name']){
                                case 'companyLocationDoc23':
                                    $companyLocation = $elem['value'];
                                    break;
                            }
                        }
                    }else{
                        $companyLocation = '';
                    }

                    require_once($_SESSION['basePath'] . "model/settings.php");

                    $settings = new Settings;
                    $company = $settings->getCompanyName();
                    $companyNif = $settings->getCompanyNIF();

                    $data = getRecibidoConformePoliza($expedient);

                    $policy = $data['policy'];
                    $lossNumber = $data['lossNumber'];
                    $deceased = $data['deceased'];
                    $deceasedDate = $data['deceasedDate'] == '' || $data['deceasedDate'] == null ? '' : date('d-m-Y', strtotime($data['deceasedDate']));
                    $familyContact = $data['familyContact'];
                    $familyContactNIF = $data['familyContactNIF'];
                    $familyContactRelationship = $data['familyContactRelationship'];
                    $gender = $data['deceasedGender'] == 'Hombre' ? 'D.' : 'Dña.';

                    $background = $utils->getBackgroundDocuments();
                    return "
                        <div class='fondo'>
                            <div class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: 70px; line-height: 2em;'>
                                    <div style='text-align:center' class='text-center'>
                                        <p><strong><u>RECIBIDO Y CONFORME PÓLIZA</u></strong></p>
                                    </div>
                                    <div style='padding-bottom: 0px;'><strong>OCASO, S.A.</strong></div>
                                    <div style='padding-bottom: 0px;'>NIF A28016608</div>
                                    <table class='tablePdfNoBorder' style='color:$colorStyle!important;'>
                                        <tbody>
                                            <tr>
                                                <td style='height: 25px!important;'><div style='font-size: 12px!important;'>Número de Póliza: $policy</div></td>
                                                <td style='height: 25px!important;'><div style='font-size: 12px!important;'>Número de siniestro: $lossNumber</div></td>
                                            </tr>
                                            <tr>
                                                <td style='height: 25px!important;'><div style='font-size: 12px!important;'>Nombre del fallecido: $deceased</div></td>
                                                <td style='height: 25px!important;'><div style='font-size: 12px!important;'>Fecha fallecimiento: $deceasedDate</div></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <br>
                                    <p>
                                        Yo $familyContact, con DNI/NIF: $familyContactNIF en calidad de $familyContactRelationship y representante de la familia de $gender: $deceased (q.e.p.d), asegurado en OCASO, S.A., autoriza a la funeraria $company
                                        con CIF/NIF $companyNif, para que en mi nombre reciba de OCASO, S.A., SEGUROS Y REASEGUROS, con cargo al capital/garantías de la póliza de referencia la 
                                        cantidad de ___________ Euros, con el exclusivo fin de gestionar y abonar los gastos y servicios funerarios que se detallan a continuación, derivados del 
                                        fallecimiento de la persona arriba indicada, manifestando mi conformidad y aceptación con los mismos:
                                    </p>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align: center;'>
                                                    <p style='font-size: 14px!important;'>Concepto</p>
                                                </td>
                                                <td style='text-align: center;'>
                                                    <p style='font-size: 14px!important;'>Importe</p>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                            </tr>
                                            <tr>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                            </tr>
                                            <tr>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                            </tr>
                                            <tr>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                            </tr>
                                            <tr>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                            </tr>
                                            <tr>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                            </tr>
                                            <tr>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                            </tr>
                                            <tr>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                            </tr>
                                            <tr>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                                <td><p style='font-size: 14px!important;'></p></td>
                                            </tr>
                                            <tr>
                                                <td style='text-align: right;'><p style='font-size: 14px!important;'>Total</p></td>
                                                <td style='text-align: right;'><p style='font-size: 14px!important;'> €</p></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <br>
                                    <div style='font-size: 12px; text-align: right;'><p>En $companyLocation, a " . $utils->fechaCastellano2(date('Y')) . "</p></div>
                                    <br><br>
                                    <div style='font-size: 14px; text-align: right;'><p>Fdo.: ______________________</p></div>
                                    <div style='padding-bottom: 0px;'><strong>Conforme:</strong></div>
                                    <div style='padding-bottom: 0px;'>D./Dña.: $familyContact</div>
                                    <div style='padding-bottom: 0px;'>DNI/NIF: $familyContactNIF</div>
                                    <br>
                                    <div style='font-size: 10px!important; line-height: 15px; text-align: justify;'>
                                        <strong>Información sobre Protección de Datos Personales</strong>
                                    </div>
                                    <div style='font-size: 10px!important; line-height: 15px; text-align: justify;'>
                                        <strong>Responsable del tratamiento:</strong> OCASO, S.A. y ETERNA ASEGURADORA, S.A.U.
                                    </div>
                                    <div style='font-size: 10px!important; line-height: 15px; text-align: justify;'>
                                        <strong>Finalidad del tratamiento:</strong> Prestación del servicio garantizado en la póliza en la que estaba asegurado el fallecido
                                    </div>
                                    <div style='font-size: 10px!important; line-height: 15px; text-align: justify;'>
                                        <strong>Legitimación para el tratamiento:</strong> Cumplimiento de obligaciones derivadas de la prestación del servicio
                                    </div>
                                    <div style='font-size: 10px!important; line-height: 15px; text-align: justify;'>
                                        <strong>Destinatarios:</strong> los organismos oficiales y administraciones públicas que deban estar informados; las entidades financieras con interés en el asunto; los prestadores 
                                        de los distintos servicios
                                    </div>
                                    <div style='font-size: 10px!important; line-height: 15px; text-align: justify;'>
                                        <strong>Derechos del interesado:</strong> Vd. tiene derecho a acceder, rectificar y suprimir los datos, limitar su tratamiento, oponerse al tratamiento, ejercer su derecho a la 
                                        portabilidad de los datos de carácter personal, y consultar todas las cuestiones relativas al tratamiento de sus datos, todo ello de forma gratuita, remitiendo 
                                        su solicitud a protección_datos@ocaso.es, como se detalla en la información completa sobre protección de datos.
                                    </div>
                                    <div style='font-size: 10px!important; line-height: 15px; text-align: justify;'>
                                        <strong>Información completa:</strong> Puede consultar la información adicional y detallada sobre protección de datos en https://www.ocaso.es/es/proteccion-de-datos/asistencia-decesos 
                                    </div>
                            </div>
                        </div>
                    ";
                }
            break;

            case "hojaDatosServicio":
                $utils = new Utils();

                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/hojaDatosServicio.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $data = getHojaDatosServicio($expedient);

                    $lossNumber = $data['lossNumber'];
                    $deceasedName = $data['deceasedName'];
                    $deceasedSurname = $data['deceasedSurname'];
                    $deceasedNIF = $data['deceasedNIF'];
                    $deceasedBirthday = $data['deceasedBirthday'] == null ? '' : date('d/m/Y', strtotime($data['deceasedBirthday']));
                    $deceasedChildOfFather = $data['deceasedChildOfFather'];
                    $deceasedChildOfMother = $data['deceasedChildOfMother'];
                    $deceasedMaritalStatus = $data['deceasedMaritalStatus'];
                    switch($deceasedMaritalStatus){
                        case 'Soltero':
                            $deceasedMaritalStatus = 'Soltero/a';
                        break;
                        case 'Casado':
                            $deceasedMaritalStatus = 'Casado/a';
                        break;
                        case 'Divorciado':
                            $deceasedMaritalStatus = 'Divorciado/a';
                        break;
                        case 'Viudo':
                            $deceasedMaritalStatus = 'Viudo/a';
                        break;
                    }
                    $deceasedFirstNuptials = $data['deceasedFirstNuptials'];
                    $deceasedDate = $data['deceasedDate'] == null ? '' : date('d/m/Y', strtotime($data['deceasedDate']));
                    $funeralDate = $data['funeralDate'] == null ? '' : date('d/m/Y', strtotime($data['funeralDate']));
                    $funeralTime = $data['funeralTime'] == null ? '' : substr($data['funeralTime'], 0, -3);
                    $familyContactName = $data['familyContactName'];
                    $familyContactSurname = $data['familyContactSurname'];
                    $familyContactNIF = $data['familyContactNIF'];
                    $familyContactPhone = $data['familyContactPhone'];
                    if($familyContactPhone == ''){
                        $familyContactPhone = $data['familyContactMobilePhone'];
                    }
                    $familyContactAddress = $data['familyContactAddress'];
                    $deceasedBirthdayLocation = $data['deceasedBirthdayLocation'];
                    $deceasedLocation = $data['deceasedInName'];
                    if($data['deceasedLocation'] != null && $data['deceasedLocation'] != ''){
                        $deceasedLocation .= ', ' . $data['deceasedLocation'];
                    }
                    if($data['deceasedProvince'] != null && $data['deceasedProvince'] != ''){
                        $deceasedLocation .= ', ' . $data['deceasedProvince'];
                    }

                    $familyContactLocation = $data['familyContactLocation'];
                    if($data['familyContactProvince'] != null && $data['familyContactProvince'] != ''){
                        $familyContactLocation .= ', ' . $data['familyContactProvince'];
                    }

                    $background = $utils->getBackgroundDocuments();
                    return "
                        <div class='fondo'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: 90px; line-height: 2em;'>
                                    <div style='text-align:center; font-size: 18px!important; line-height: 15px;' class='text-center'>
                                        <p><strong><u>HOJA DE DATOS DEL SERVICIO</u></strong></p>
                                    </div>
                                    <br><br>
                                    <div style='font-size: 14px!important; line-height: 16px; text-align: center;'>
                                        <p>Número de siniestro: $lossNumber</p> 
                                    </div>
                                    <br>
                                    <div style='font-size: 16px!important; line-height: 15px;'>
                                        <p><strong>DATOS DEL FALLECIDO</strong></p>
                                    </div>
                                    <br>
                                    <div style='font-size: 14px!important; line-height: 15px;'>
                                        <p>Nombre y apellidos del fallecido: $deceasedName $deceasedSurname</p>
                                        <p>DNI: $deceasedNIF</p>
                                        <p>Fecha nacimiento: $deceasedBirthday</p>
                                        <p>Lugar de nacimiento: $deceasedBirthdayLocation</p>
                                        <p>Hijo de: $deceasedChildOfFather y de $deceasedChildOfMother</p>
                                        <p>Estado civil: $deceasedMaritalStatus</p>
                                        <p>Casado/Viudo de: $deceasedFirstNuptials</p>
                                        <p>Fecha fallecimiento: $deceasedDate</p>
                                        <p>Fallecido en: $deceasedLocation</p>
                                        <p>Fecha inhumación: $funeralDate - Hora: $funeralTime</p>
                                    </div>
                                    <br>
                                    <div style='font-size: 16px!important; line-height: 15px;'>
                                        <p><strong>DATOS DEL CONTRATANTE</strong></p>
                                    </div>
                                    <br>
                                    <div style='font-size: 14px!important; line-height: 15px;'>
                                        <p>Nombre y apellidos: $familyContactName $familyContactSurname</p>
                                        <p>DNI: $familyContactNIF</p>
                                        <p>Teléfono de contacto: $familyContactPhone</p>
                                        <p>Domicilio: $familyContactAddress</p>
                                        <p>Localidad: $familyContactLocation</p>
                                    </div>
                                    <br><br><br>
                                    <div style='font-size: 14px!important; line-height: 15px;'>
                                        <p><strong>Documentación a adjuntar</strong></p>
                                    </div>
                                    <br>
                                    <div style='font-size: 14px!important; line-height: 15px;'>
                                        <p>- Copia DNI fallecido</p>
                                        <p>- Copia de la licencia para dar sepultura</p>
                                        <p>- Copia del certificado médico</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";
                }
            break;

            case "formularioPedido":
                $utils = new Utils();

                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/formularioPedido.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $data = getFormularioPedido($expedient);

                    // $age = $data['deceasedBirthday'] != null && $data['deceasedDate'] != null ? intval((strtotime($data['deceasedDate']) - strtotime($data['deceasedBirthday'])) / (60 * 60 * 24 * 365)) : '';
                    if($data['deceasedBirthday'] != null && $data['deceasedDate'] != null){
                        $date1 = new DateTime($data['deceasedBirthday']);
                        $date2 = new DateTime($data['deceasedDate']);
                        $interval = $date1->diff($date2);
                        $age = $interval->y;
                    }else{
                        $age = '';
                    }

                    $lossNumber = $data['lossNumber'];
                    if($lossNumber == null){
                        $lossNumber = '';
                    }

                    $deceasedBirthday = $data['deceasedBirthday'] == null ? '' : date('d/m/Y', strtotime($data['deceasedBirthday']));
                    $data['requestDate'] = $data['requestDate'] == null ? '' : date('d/m/Y', strtotime($data['requestDate']));
                    $data['deceasedDate'] = $data['deceasedDate'] == null ? '' : date('d/m/Y H:i', strtotime($data['deceasedDate']));
                    $data['ceremonyDate'] = $data['ceremonyDate'] == null ? '' : date('d/m/Y', strtotime($data['ceremonyDate']));
                    $data['entryDate'] = $data['entryDate'] == null ? '' : date('d/m/Y H:i', strtotime($data['entryDate']));
                    $entryDates = $data['funeralHomeEntryDate'] == null ? '' : date('d/m/Y', strtotime($data['funeralHomeEntryDate']));
                    $funeralTime = $data['funeralHomeEntryTime'] == null ? '' : substr($data['funeralHomeEntryTime'], 0, -3);
                    $entryDates .= " $funeralTime";
                    $data['ceremonyTime'] = $data['ceremonyTime'] == null ? '' : substr($data['ceremonyTime'], 0, -3);

                    if($data['cremation'] == '0'){
                        $entierro = 'X';
                        $incineracion = '';
                    }else{
                        $entierro = '';
                        $incineracion = 'X';
                    }

                    if(!isset($data['mortuaryName']) || $data['mortuaryName'] == null){
                        $data['mortuaryName'] = '';
                    }

                    if($data['deceasedRoom'] == '' || $data['deceasedRoom'] == null){
                        $data['deceasedRoom'] = '';
                    }

                    if(!isset($data['churchName']) || $data['churchName'] == null){
                        $data['churchName'] = '';
                    }

                    require_once($_SESSION['basePath'] . "model/settings.php");
                    $settings = new Settings;
                    $company = $settings->getCompanyName();
                    $companyAddress = $settings->getCompanyAddress();
                    $companyNIF = $settings->getCompanyNIF();

                    require_once($_SESSION['basePath'] . "model/users.php");
                    $users = new Users;
                    $userInfo = $users->getDataUserSession();

                    $narbonInfo = '';
                    if(intval($_SESSION['company']) == 1){
                        $narbonInfo = "
                            <p><span style='color:$colorStyle!important; font-size: 22px!important'><img src='" . $utils->getRoute() . "resources/files/" . $_SESSION['company'] . "/settings/narbon.jpg'></span></p>
                            <p><span style='color:$colorStyle!important'>pedidos@narbon.com</span></p>
                            <p><span style='color:$colorStyle!important'>Telf. 915 598 488</span></p>
                        ";
                    }

                    $mortuaryName = $data['mortuaryName'];
                    if($mortuaryName == 'Otro'){
                        $mortuaryName = $data['deceasedMortuaryAddress'];
                    }

                    if($data['deceasedProvince'] != null){
                        $data['deceasedLocation'] .= ', ' . $data['deceasedProvince'];
                    }
                    if($data['deceasedInName'] != null && $data['deceasedInName'] != ''){
                        $data['deceasedLocation'] = $data['deceasedInName'] .', ' . $data['deceasedLocation'];
                    }

                    return "
                        <div class='fondo'>
                            <div class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: 20px; line-height: 2em;'>
                                    <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2'>
                                        <tr>
                                            <td style='width:70%; font-size: 18px!important; line-height: 15px;' valign='bottom'>
                                                <span style='color:$colorStyle!important'><strong>FORMULARIO DE SOLICITUD DE PEDIDO</strong></span>
                                            </td>
                                            <td style='width:30%; font-size: 18px!important; line-height: 10px;' valign='bottom'>
                                                " . $narbonInfo . "
                                            </td>
                                        </tr>
                                    </table>
                                    <div style='float:none; width:100%;clear:both;padding-top:10px'>
                                        <p>Fecha solicitud: <strong>".$data['requestDate']."</strong></p>
                                    </div>
                                    <div style='padding-top: 10px; line-height: 10px'>
                                        <div style='font-size: 15px!important;'>
                                            <strong>ENTIDAD SOLICITANTE</strong>
                                        </div>
                                        <div style='padding-top:10px;'> 
                                            <table style='width: 100%; color: #00305c;'>
                                                <tr>
                                                    <td style='width:50%;height:25px;'><span style='color:$colorStyle!important;'><strong>Empresa:</strong> ".$company."</strong></span></td>
                                                    <td style='width:50%;height:25px'><span style='color:$colorStyle!important;'><strong>Agente:</strong> ".$userInfo[0]['userData']."</span></td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    <div style='padding-top: 20px; line-height: 10px'>
                                        <div style='font-size: 15px!important;'>
                                            <strong>INFORMACIÓN DEL FALLECIMIENTO</strong>
                                        </div>
                                        <div style='padding-top:10px;'> 
                                            <table style='width: 100%; color: #00305c;'>
                                                <tr>
                                                    <td style='height: 25px;width:80%'><span style='color:$colorStyle!important;'><strong>Fallecido:</strong> ".$data['deceased']."</span></td>
                                                    <td style='height: 25px;width:20%'><span style='color:$colorStyle!important;'><strong>Edad</strong>: ".$age."</span></td>
                                                </tr>
                                            </table>
                                            <table style='width: 100%; color: #00305c;'>
                                                <tr>
                                                    <td style='height: 25px;width:50%'><span style='color:$colorStyle!important;'><strong>Nº Siniestro/Expediente:</strong> ".$lossNumber."</span></td>
                                                    <td style='height: 25px;width:50%'><span style='color:$colorStyle!important;'><strong>Fecha nacimiento:</strong> ".$deceasedBirthday."</span></td>
                                                </tr>
                                                <tr>
                                                    <td style='height: 25px;width:50%'><span style='color:$colorStyle!important;'><strong>Fecha defunción:</strong> ".$data['deceasedDate']."</span></td>
                                                    <td style='height: 25px;width:50%'><span style='color:$colorStyle!important;'><strong>Lugar defunción:</strong> ".$data['deceasedLocation']."</span></td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    <div style='padding-top: 20px; line-height: 10px'>
                                        <div style='font-size: 15px!important;'>
                                            <strong>INFORMACIÓN ACTOS FÚNEBRES</strong>
                                        </div>
                                        <div style='padding-top:10px;'> 
                                            <table style='width: 100%; color: #00305c;'>
                                                <tr>
                                                    <td style='height: 25px;width:50%'><span style='color:$colorStyle!important;'><strong>Velatorio:</strong> ".$mortuaryName.",  Sala: " .$data['deceasedRoom']."</span></td>
                                                    <td style='height: 25px;width:50%'><span style='color:$colorStyle!important;'><strong>Fecha/Hora velación:</strong> ".$entryDates."</span></td>
                                                </tr>
                                                <tr>
                                                    <td style='height: 25px;width:50%'><span style='color:$colorStyle!important;'><strong>Misa en: </strong> ".$data['churchName']."</span></td>
                                                    <td style='height: 25px;width:50%'><span style='color:$colorStyle!important;'><strong>Fecha/Hora misa:</strong> ".$data['ceremonyDate']." ".$data['ceremonyTime']."</span></td>
                                                </tr>
                                            </table>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2'>
                                                <tr> 
                                                    <td style='width=100px;'><span style='font-size: 15px;color:$colorStyle'></span></td>
                                                    <td style='height: 25px'><span style='font-size: 14px;color:$colorStyle'><strong>Entierro</strong></span></td>
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td style='font-size: 14px'><span>".$entierro."</span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td><span style='height: 25px;font-size: 14px;color:$colorStyle'><strong>Incinera</strong></span></td>
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td style='font-size: 14px'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$incineracion."</td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td>
                                                        <span style='font-size: 14px;color:$colorStyle'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                            <strong>Fecha/Hora:</strong> ".$data['ceremonyDate']." ".$data['ceremonyTime']." &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                        </span>
                                                    </td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>
                                    <div style='padding-top: 20px; line-height: 10px'>
                                        <div style='font-size: 15px!important;'>
                                            <strong>ARTÍCULOS COMUNICACIÓN IMPRESA</strong>
                                        </div>
                                        <div style='padding-top:10px;'>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2'>
                                                <tr> 
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'><span style='font-size: 12px;color:$colorStyle'><strong>Libro para recuerdo</strong></span></td>
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'><span style='font-size: 12px;color:$colorStyle'><strong>Pack 10 tarjetas plástico</strong></span></td>
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'><span style='font-size: 12px;color:$colorStyle'><strong>Prelápida temporal</strong></span></td>
                                                </tr>
                                                <tr> 
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'><span style='font-size: 12px;color:$colorStyle'><strong>Agradecimientos</strong> ________ </span></td>
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'><span style='font-size: 12px;color:$colorStyle'><strong>Comunicados</strong> ________</span></td>
                                                </tr>
                                                <tr> 
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'><span style='font-size: 12px;color:$colorStyle'><strong>Recordatorios</strong> ________</span></td>
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'><span style='font-size: 12px;color:$colorStyle'><strong>Mesa/Tanatorio</strong></span></td>
                                                    <td>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='height: 25px'><span style='font-size: 12px;color:$colorStyle'><strong>Cementerio</strong></span></td>
                                                </tr>
                                            </table>
                                            <p></p>
                                            <p><strong style='font-size:12px'>Lugar de entrega:</strong> ".$data['mortuaryName'].",  Sala: " .$data['deceasedRoom']."</p>
                                        </div>
                                    </div>
                                    <div style='padding-top: 30px; line-height: 10px'>
                                        <div style='font-size: 15px!important;'>
                                            <strong>ARTÍCULOS EMOCIONALES PERSONALIZADOS</strong>
                                        </div>
                                        <div style='padding-top:20px;'>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                                <tr> 
                                                    <td style='width:2%'>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='width:88%;height: 25px'><span style='font-size: 12px;color:$colorStyle'><strong>3D Memories</strong></span></td>
                                                </tr>
                                            </table>
                                            <table style='width:100%'> 
                                                <tr>
                                                    <td>
                                                        <table class='tablePdf$tablePdfColor' style='width:100%; margin-top:10px; font-size:12px'
                                                            <tr>
                                                                <td style='text-align:center; font-size:12px; color:$colorStyle!important'><strong>Cantidad</strong> </td>
                                                                <td style='text-align:center; font-size:12px; color:$colorStyle!important'><strong>Referencia</strong> </td>
                                                                <td style='text-align:center; font-size:12px; color:$colorStyle!important'><strong>Acabado </strong></td>
                                                            </tr>
                                                            <tr>
                                                                <td style='height:20px; width:20%; color:$colorStyle'>&nbsp;</td>
                                                                <td style='height:20px; width:40%; color:$colorStyle'>&nbsp;</td>
                                                                <td style='height:20px; width:40%; color:$colorStyle'>&nbsp;</td>
                                                            </tr>  
                                                        </table>
                                                    </td>
                                                </tr>
                                            </table>                                    
                                        </div>
                                        <div style='padding-top:20px;'>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                                <tr> 
                                                    <td style='width:2%'>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='width:88%;height: 25px'><span style='font-size: 12px;color:$colorStyle'><strong>Medallas para el recuerdo</strong></span></td>
                                                </tr>
                                            </table>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                                <tr>
                                                    <td>
                                                    <table class='tablePdf$tablePdfColor' cellspacing='0' cellpadding='2' style='width:100%;'>
                                                        <tr>
                                                            <td style='text-align:center; width:20%; height:20px; font-size:12px; color:$colorStyle'><strong>Cantidad</strong> </td>
                                                            <td style='text-align:center; width:80%; height:20px; font-size:12px; color:$colorStyle'><strong>Tipo(oro, plata - cadena o cordón de cuero)</strong> </td>
                                                        </tr>
                                                        <tr>
                                                            <td style='height:20px; width:20%; color:$colorStyle'></td>
                                                            <td style='height:20px; width:80%; color:$colorStyle'></td>
                                                        </tr>   
                                                        <tr>
                                                            <td style='width:20%;height:20px; font-size:12px; color:$colorStyle'>Cara A</td>
                                                            <td style='height:20px; width:80%; color:$colorStyle'></td>
                                                        </tr>   
                                                        <tr>
                                                            <td style='width:20%;height:20px; font-size:12px; color:$colorStyle'>Cara B</td>
                                                            <td style='height:20px; width:80%; color:$colorStyle'></td>
                                                        </tr>   
                                                    </table>
                                                    </td>
                                                </tr>
                                            </table>                                    
                                        </div>
                                        <div style='padding-top:20px;'>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                                <tr> 
                                                    <td style='width:2%'>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='width:88%;height: 25px'><span style='font-size: 12px;color:$colorStyle'><strong>Pack de 5 Tarjetas para el recuerdo personalizadas</strong></span></td>
                                                </tr>
                                            </table>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                                <tr>
                                                    <td>
                                                    <table class='tablePdf$tablePdfColor' cellspacing='0' cellpadding='2' style='width:100%;'>
                                                        <tr>
                                                            <td style='width:20%;height:20px; font-size:12px; color:$colorStyle'>Cara A</td>
                                                            <td style='height:20px; width:80%; color:$colorStyle'></td>
                                                        </tr>   
                                                        <tr>
                                                            <td style='width:20%;height:20px; font-size:12px; color:$colorStyle'>Cara B</td>
                                                            <td style='height:20px; width:80%; color:$colorStyle'></td>
                                                        </tr>   
                                                    </table>
                                                    </td>
                                                </tr>
                                            </table>                                    
                                        </div>
                                        <div style='padding-top:10px;'>
                                            <table style='width: 100%; color: #00305c;'>
                                                <tr>
                                                    <td style='height: 25px;width:100%'><span style='color:$colorStyle!important;'><strong>Observaciones:</strong></span></td>
                                                </tr>
                                                <tr>
                                                    <td style='height: 25px;width:100%'><span style='color:$colorStyle!important;'><strong>Entregar en:</strong></span></td>
                                                </tr>
                                                <tr>
                                                    <td style='height: 25px;width:100%'><span style='color:$colorStyle!important;'><strong>A la atención de:</strong></span></td>
                                                </tr>
                                            </table>
                                        </div>
                                    </div>  
                                </div>
                            </div>
                        </div>
                    ";
                }
            break;

            case "hojaPedidos":
                $utils = new Utils();

                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/hojaPedidos.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $data = getHojaPedido($expedient);

                    require_once($_SESSION['basePath'] . "model/settings.php");
                    $settings = new Settings;
                    $company = $settings->getCompanyName();

                    $requestDate = $data['expedient']['requestDate'] == null ? '' : date('d/m/Y', strtotime($data['expedient']['requestDate']));

                    $albiaImg = $utils->getRoute() . "resources/files/" . $_SESSION['company'] . "/settings/albia.jpg";
                    
                    $rows = '';
                    $currentText = count($data['texts']) > 0 ? $data['texts'][0]['model_name'] : '';
                    foreach($data['texts'] as $indexText => $text){
                        if($currentText == $text['model_name'] && $indexText > 0){
                            $rows .= "
                                <tr>
                                    <td style='height: 25px;width:30%'><strong></strong></td>
                                    <td style='height: 25px;width:50%'><strong></strong> ".$text['value']."</td>
                                    <td style='height: 25px;width:20%'><strong></strong></td>
                                </tr>
                            ";
                        }else{
                            $rows .= "
                                <tr>
                                    <td style='height: 25px;width:30%'><strong></strong> ".$text['model_name']."</td>
                                    <td style='height: 25px;width:50%'><strong></strong> ".$text['value']."</td>
                                    <td style='height: 25px;width:20%'><strong></strong></td>
                                </tr>
                            ";
                            $currentText = $text['model_name'];
                        }
                    }

                    for($i = count($data['texts']); $i<10; $i++){
                        $rows .= "
                            <tr>
                                <td style='height: 25px;width:30%'><strong></strong></td>
                                <td style='height: 25px;width:50%'><strong></strong></td>
                                <td style='height: 25px;width:20%'><strong></strong></td>
                            </tr>
                        ";
                    }

                    $albiaHeader = '';
                    if(intval($_SESSION['company']) == 1){
                        $albiaHeader = "
                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2'>
                                <tr>
                                    <td style='width:45%; font-size: 18px!important; line-height: 10px;' valign='bottom'>
                                        <p><img src='" . $albiaImg . "'></p>
                                        <div style='line-height: 8px; font-size: 10px;'>
                                            <p><span style='color:$colorStyle!important'>C/ Avda. Manuel del Palacio, 5 bajo 36003 Pontevedra</span></p>
                                            <p><span style='color:$colorStyle!important'>CIF. B 11630886 - Tlf: 986 859 214 - Fax: 986 842 437</span></p>
                                        </div>
                                    </td>
                                    <td style='width:55%; font-size: 18px!important; line-height: 15px;' valign='middle'>
                                        <span style='color:$colorStyle!important'><strong>Albia - Pontevedra Servicios Funerarios</strong></span>
                                    </td>
                                </tr>
                            </table>
                            <br><br><br>
                        ";
                    }

                    $background = $utils->getBackgroundDocuments();
                    return "
                        <div class='fondo'>
                            <div class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: 70px; line-height: 2em;'>
                                    " . $albiaHeader . "
                                    <div style='font-size: 20px!important; line-height: 15px;'>
                                        <p><strong>HOJA DE PEDIDOS</strong></p>
                                    </div>
                                    <br>
                                    <table style='width: 100%; color: #00305c;'>
                                        <tr>
                                            <td style='height: 25px;width:60%'><span style='color:$colorStyle!important'><strong>De: </strong>".$company."</span></td>
                                            <td style='height: 25px;width:40%'><span style='color:$colorStyle!important'><strong>Fecha:</strong> " . $requestDate . "</span></td>
                                        </tr>
                                        <tr>
                                            <td style='height: 25px;width:60%'><span style='color:$colorStyle!important'><strong>Asunto:</strong> Pedido en Flor</span></td>
                                            <td style='height: 25px;width:40%'><span style='color:$colorStyle!important'><strong>Páginas:</strong></span></td>
                                        </tr>
                                        <tr><td></td><td></td></tr>
                                        <tr>
                                            <td style='height: 25px;width:60%'><span style='color:$colorStyle!important'><strong>Tanatorio:</strong> ".$data['expedient']['mortuary_name']."</span></td>
                                            <td style='height: 25px;width:40%'><span style='color:$colorStyle!important'><strong>Sala:</strong> ".$data['expedient']['deceasedRoom']."</span></td>
                                        </tr>
                                        <tr>
                                            <td style='height: 25px;width:60%'><span style='color:$colorStyle!important'><strong>Fallecido:</strong> ".$data['expedient']['deceasedName']. " " .$data['expedient']['deceasedSurname']."</span></td>
                                            <td style='height: 25px;width:40%'><span style='color:$colorStyle!important'><strong>Nº Siniestro:</strong> ".$data['expedient']['lossNumber']."</span></td>
                                        </tr>
                                    </table>
                                    <br>
                                    <div style='font-size: 16px!important; line-height: 15px;'>
                                        <p><u><strong>REFERENCIAS DE PEDIDOS Y TEXTOS</strong></u></p>
                                    </div>
                                    <br>
                                    <table class='tablePdf$tablePdfColor' style='width: 100%; color: #00305c;'>
                                        <tr>
                                            <td style='height: 25px;width:25%; text-align:center'><strong>REF.</strong></td>
                                            <td style='height: 25px;width:40%; text-align:center'><strong>TEXTO CINTA</strong></td>
                                            <td style='height: 25px;width:35%; text-align:center'><strong>OBSERVACIONES</strong></td>
                                        </tr>
                                        " . $rows . "
                                    </table>
                                    <br>
                                    <div style='text-align: justify; color:$colorStyle font-size: 8px; line-height: 10px;'>
                                        De acuerdo con lo establecido en el Art. 5 de la Ley Organica 15/1999 del 13 de D1c1embre, de Protección de Datos (L.O.P.D.), Alb1a Gesllon de Serv1c1os, S.L.U., le informa de
                                        que los datos personales que nos facilite serán incorporados a un Fichero Expedientes (automatizado o no), con la finalidad de llevar a cabo el mantenimiento de la relación
                                        contractual. Así mismo, le informo que sus datos serán o podrán ser comunicados a aquellos organismos públicos obligados por la normativa correspondiente. Podrá ejercer en
                                        todo momento los derechos de acceso, rectificación, cancelación y oposición garantizados por la legislación vigente enviando un escrito y adjuntando una copia del DNI del interesado a la
                                        dirección c/ Julián Camarilla nº 36, 3ª planta 28037 Madrid. En el caso de producirse alguna modificación en los datos, rogamos nos lo comunique debidamente por escrito con
                                        la finalidad de mantener los datos actualizados. La cumplimentación de los campos tiene carácter obligatorio con la finalidad de mantener y ga rantizar el cumplimiento de la
                                        relación contractual.
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";
                }
            break;

            case "autoSepultura":
                $utils = new Utils();

                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/autoSepultura.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $data = getAutoSepultura($expedient);

                    $background = $utils->getBackgroundDocuments();

                    $number = $data['number'];
                    $familyContact = $data['familyContact'];
                    $familyContactNIF = $data['familyContactNIF'];
                    $deceased = $data['deceased'];
                    $deceasedGender = $data['deceasedGender'] == 'Hombre' ? 'D.' : 'Dña.';
                    $deceasedRoom = $data['deceasedRoom'];
                    $dayA = $data['deceasedDate'] == null ? '' : date("d", strtotime($data['deceasedDate']));
                    $monthA = $data['deceasedDate'] == null ? '' : date("m", strtotime($data['deceasedDate']));
                    $monthA = getMonth($monthA);
                    $yearA = $data['deceasedDate'] == null ? '' : date("Y", strtotime($data['deceasedDate']));
                    $funeralNicheNumber = $data['funeralNicheNumber'];
                    $cemetery = $data['cemetery'];
                    $cemeteryLocation = $data['cemeteryLocation'];
                    $cemeteryProvince = $data['cemeteryProvince'];
                    $mortuary = $data['mortuary'];
                    $mortuaryLocation = $data['mortuaryLocation'];
                    $funeralHome = $data['funeralHome'];
                    $funeralHomeCif = $data['funeralHomeCif'];
                    $funeralHomeLocation = $data['funeralHomeLocation'];
                    $userName = $data['userName'];
                    $userPosts = $data['userPosts'];
                    $exhumation = $data['exhumation'];
                    $dayB = $data['deceasedDate'] == null ? '' : date("d", time());
                    $monthB = $data['deceasedDate'] == null ? '' : date("m", time());
                    $monthB = getMonth($monthB);
                    $yearB = $data['deceasedDate'] == null ? '' : date("Y", time());
                    $locationData = $funeralHomeLocation;
                    $textUser = "<p>" . $userName . " (" . $userPosts . ")</p>";

                    $space = '';
                    if(intval($_SESSION['company']) == 2){
                        $space = '<br><br><br>';
                        $locationData = $mortuaryLocation;
                        $textUser = "<p>" . $userName . "</p>";
                    }

                    return "
                        <div class='fondo'>
                            <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                                ".$space."
                                <div style='margin-right:50px;right:480px; position: absolute; text-align: right; padding-top: 80px;'>
                                    <p>EXP.: <strong>" . $number . "</strong></p>
                                </div>
                                <div class='contenidoPompas' style='padding-top: 80px; line-height: 2em;'>
                                    <div style='font-size: 20px!important; line-height: 15px;'>
                                        <p><strong>AUTORIZACIÓN SEPULTURA</strong></p>
                                    </div>
                                    <br>
                                    <div style='font-size: 14px!important; line-height: 30px;'>
                                        <p>
                                            Por la presente " . $familyContact . " representante de la familia del fallecido " . $deceasedGender . " " . $deceased . " (Q.E.P.D.)
                                            que se encuentra velándose en nuestras instalaciones " . $mortuary . ",
                                            en la sala " . $deceasedRoom . " a día " . $dayA . " de " . $monthA . " de " . $yearA . ", y como usufructuario del panteón familiar con inscripción: ".$exhumation.",
                                            como titular del nicho " . $funeralNicheNumber . " del " . $cemetery . " (".$cemeteryLocation.", ".$cemeteryProvince.").
                                        </p>
                                        <br>
                                        <p>
                                            Autorizo a " . $funeralHome . " para que proceda a depositar los restos mortales de " . $deceasedGender . " " . $deceased . " en el mencionado nicho.
                                        </p>
                                        <p>
                                            A su vez, con la firma del presente, se exonera a " . $funeralHome . " con " . $funeralHomeCif . " de cualquier tipo de responsabilidad derivada del depósito de los restos mortales
                                            del fallecido en el nicho indicado, asumiendo el firmante cualquier responsabilidad exigible en lo concerniente a la concesión o propiedad del mismo.
                                        </p>
                                        <br>
                                        <p>
                                            En " . $locationData . ", a " . $dayA . " de " . $monthA . " de " . $yearA . ".
                                        </p>
                                        <br><br><br><br>
                                        <p>Fdo.: <strong>".$familyContact."</strong> con N.I.F: <strong>".$familyContactNIF."</strong></p>
                                        " . $textUser . "
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";
                }
            break;

            case "resumenCremacion":
                    
                $utils = new Utils();
                $data = getCrematoriumSummary($expedient);
                $data = $data[0];
                $background = $utils->getBackgroundDocuments();

                $room = $data['deceasedRoom'];
                $timeGo = $data['funeralTime'];
                if($timeGo != null){
                    $time = explode(':', $timeGo);
                    $timeGo = $time[0] . ':' . $time[1];
                }
                if($data['deceasedGender'] == 'Hombre'){
                    $pre = 'D. ';
                }else{
                    $pre = 'Dña. ';
                }

                //RESUMEN SERVICIO
                $text =  "
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div style='right: 520px; position: absolute; text-align: right; padding-top: 30px;'>
                                <p>EXP.: <strong>" . $data['number'] . "</strong></p>
                            </div>
                            <div class='contenidoPompas' style='padding-top: 5px'>
                                <div style='text-align:center' class='text-center'>
                                    <p><strong><u>RESUMEN SERVICIO</u></strong></p>
                                </div>
                                <br>
                                <br>
                                <table>
                                    <tr>
                                        <td><p style='color: $colorStyle font-size: 12px;'>Nombre: $pre <strong>" . $data['deceasedName'] . " " . $data['deceasedSurname'] . "</strong> (Q.E.P.D.)</p></td>
                                    </tr>
                                    <tr>
                                        <td style='line-height:0.7em'>&nbsp;</td>
                                    </tr>
                                    <tr>
                                        <td><p style='color: $colorStyle font-size: 12px;'>Lugar: <strong>" . $data['mortuary'] . "</strong>, Sala: <strong>" . $room . "</strong></p></td>
                                    </tr>
                                    <tr>
                                            <td style='line-height:0.7em'>&nbsp;</td>
                                    </tr>
                                    <tr>
                                        <td><p style='color: $colorStyle font-size: 12px;'>Iglesia: <strong>" . $data['church'] . "</strong></p></td>
                                    </tr>
                                    <tr>
                                        <td style='line-height:0.7em'>&nbsp;</td>
                                    </tr>
                                    <tr>
                                        <td><p style='color: $colorStyle font-size: 12px;'>Hora de salida: <strong>" . date($timeGo) . "</strong></p></td>
                                    </tr>
                                </table>
                ";

                //RESUMEN CREMACION
                $technicalName = '-';
                if($data['technicalName'] != null && $data['technicalName'] != ''){
                    $technicalName = $data['technicalName'];
                }

                $crematoriumName = $data['crematorium'];
                $introduction = $data['crematoriumIntroduction'] == 1 ? 'SI' : 'NO';
                $vaseBio = $data['crematoriumVaseBio'] == 1 ? 'SI' : 'NO';
                $ecologic = $data['ecologicCoffin'] == 1 ? 'SI' : 'NO';

                if($data['authDate'] != null && $data['authDate'] != ''){
                    $entregarCenizasFecha = date("d/m/Y", $data['authDate']);
                }else{
                    $entregarCenizasFecha = '';
                }
                if($data['authTime'] != null && $data['authTime'] != ''){
                    $entregarCenizasHora = date("H:i", $data['authTime']);
                }else{
                    $entregarCenizasHora = '';
                }
            
                $entregarCenizasLugar = $data['authPlace'];
                $whoDelivered = '-';
                if($data['crematoriumWhoDelivered'] != null && $data['crematoriumWhoDelivered'] != ''){
                    $whoDelivered = $data['crematoriumWhoDelivered'];
                }
                $entregarCenizasPersona = $data['authName'];

                $notes = '-';
                if($data['crematoriumNotes'] != null && $data['crematoriumNotes'] != ''){
                    $notes = $data['crematoriumNotes'];
                }
                
                $text .= "      <br><br>
                                <div style='text-align:center' class='text-center'>
                                    <p><strong><u>RESUMEN CREMACIÓN</u></strong></p>
                                </div>
                                <div>
                                    <table class='tablePdfNoBorder' style='color:$colorStyle!important;'>
                                        <tbody>
                                            <tr>
                                                <td>&nbsp;</td>
                                            </tr>               
                                            <tr>
                                                <td><p style='text-align:right'><strong>Técnico de cremación: </strong> " . $technicalName . "</p></td>
                                            </tr>
                                            <tr>
                                                <td>&nbsp;</td>
                                            </tr>
                                            <tr>
                                                <td><p style='text-align:right'><strong>Crematorio: </strong> " . $crematoriumName . "</p></td>
                                            </tr>
                                            <tr>
                                                <td>&nbsp;</td>
                                            </tr>
                                            <tr>
                                                <td><p style='text-align:right'><strong>Introducción: </strong> " . $introduction . "</p></td>
                                            </tr>
                                            <tr>
                                                <td>&nbsp;</td>
                                            </tr>
                                            <tr>
                                                <td><p style='text-align:right'><strong>Urna biodegradable: </strong> " . $vaseBio . "</p></td>
                                            </tr>
                                            <tr>
                                                <td>&nbsp;</td>
                                            </tr>
                                            <tr>
                                                <td><p style='text-align:right'><strong>Féretro ecológico: </strong> " . $ecologic . "</p></td>
                                            </tr>
                                            <tr>
                                                <td>&nbsp;</td>
                                            </tr>
                                            <tr>
                                                <td><p style='text-align:right'><strong>Entrega de cenizas: </strong></p></td>
                                            </tr>
                                            <tr>
                                                <td>&nbsp;</td>
                                            </tr>
                                            <tr>
                                                <td><p style='text-align:right;'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Fecha: </strong> " . $entregarCenizasFecha . "</p></td>
                                            </tr>
                                            <tr>
                                                <td>&nbsp;</td>
                                            </tr>
                                            <tr>
                                                <td><p style='text-align:right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Hora: </strong> " . $entregarCenizasHora . "</p></td>
                                            </tr>
                                            <tr>
                                                <td>&nbsp;</td>
                                            </tr>
                                            <tr>
                                                <td><p style='text-align:right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Lugar: </strong> " . $entregarCenizasLugar . "</p></td>
                                            </tr>
                                            <tr>
                                                <td>&nbsp;</td>
                                            </tr>
                                            <tr>
                                                <td><p style='text-align:right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>Quién entrega: </strong> " . $whoDelivered . "</p></td>
                                            </tr>
                                            <tr>
                                                <td>&nbsp;</td>
                                            </tr>
                                            <tr>
                                                <td><p style='text-align:right'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<strong>A quién: </strong> " . $entregarCenizasPersona . "</p></td>
                                            </tr>
                                            <tr>
                                                <td>&nbsp;</td>
                                            </tr>
                                            <tr>
                                                <td><p style='text-align:right'><strong>Notas: </strong> " . $notes . "</p></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                ";

                // Sets firts generate doc
                if(
                    ($data['crematoriumFirstGenerateDocDate'] == null || $data['crematoriumFirstGenerateDocDate'] == '') &&
                    ($data['crematoriumFirstGenerateDocUser'] == null || $data['crematoriumFirstGenerateDocUser'] == '')
                ){
                    updateFirstSummaryDoc($expedient);
                }

                return $text;
            break;

            case "mandatoExpreso":
                $utils = new Utils();

                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/mandatoExpreso.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $data = getMandatoExpreso($expedient);

                    $background = $utils->getBackgroundDocuments();

                    $enterprise = '';
                    $logoEnterprise = "";
                    if(intval($_SESSION['company']) == 1){
                        $enterprise = ', a AVANTIA SERVICIOS DE GESTIÓN S.L. con CIF B-84.042.589,';
                        $logoEnterprise = $utils->getRoute() . 'resources/files/default/avantia.jpg';
                    }
                    
                    $deceasedGender = $data['deceasedGender'];
                    $deceased = $data['deceased'];
                    $deceasedNIF = $data['deceasedNIF'];
                    $familyContact = $data['familyContact'];
                    $familyContactNIF = $data['familyContactNIF'];
                    $funeralHomeLocation = $data['funeralHomeLocation'];
                    $clientName = $data['clientName'];
                    $policy = $data['policy'];
                    $dayB = $data['deceasedDate'] == null ? '' : date("d", time());
                    $monthB = $data['deceasedDate'] == null ? '' : date("m", time());
                    $monthB = getMonth($monthB);
                    $yearB = $data['deceasedDate'] == null ? '' : date("Y", time());
                
                    return "
                        <div class='fondo'>
                            <div class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: 80px; line-height: 2em;'>
                                    <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2'>
                                        <tr>
                                            <td style='width:45%; font-size: 18px!important; line-height: 10px; color:$colorStyle!important' valign='bottom'>
                                                <p><img src='" . $logoEnterprise . "'></p>
                                            </td>
                                        </tr>
                                    </table>
                                    <br><br><br><br>
                                    <div style='font-size: 14px!important; line-height: 30px;'>
                                        <p>
                                        Yo, D./Dña. ".$familyContact." con D.N.I. nº, ".$familyContactNIF." y en representación de la familia del fallecido/da de la fallecida 
                                        " . ($deceasedGender == 'Hombre' ? 'D.' : 'Dña.') . " ".$deceased." con D.N.I ".$deceasedNIF.".
                                        </p>
                                        <br>
                                        <p>
                                            <strong>AUTORIZO, POR MANDATO EXPRESO</strong> ".$enterprise." a satisfacer
                                            <u> con cargo al valor del servicio contratado en la póliza nº ".$policy." </u> de la Aseguradora ________________________________________ el total de los 
                                            gastos incurridos para la prestación de los servicios comprometidos y realizados o por realizar.
                                        </p>
                                        <br>
                                        <p>
                                            En " . $funeralHomeLocation . ", a " . $dayB . " de " . $monthB . " de " . $yearB . ".
                                        </p>
                                        <br><br><br><br>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";
                }
            break;
        
            case "reconocPrevioIncineracion":
                $utils = new Utils();

                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/reconocPrevioIncineracion.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $data = getReconocPrevioIncineracion($expedient);

                    $background = $utils->getBackgroundDocuments();

                    $familyContact = $data['familyContact'];
                    $familyContactNIF = $data['familyContactNIF'];
                    $familyContactPhone = $data['familyContactPhone'];
                    $familyContactAddress = $data['familyContactAddress'];
                    if($data['familyContactLocation'] != '' && $data['familyContactLocation'] != null){
                        $familyContactAddress .= ', ' . $data['familyContactLocation'];
                    }
                    if($data['familyContactProvince'] != '' && $data['familyContactProvince'] != null){
                        $familyContactAddress .= ', ' . $data['familyContactProvince'];
                    }
                    $familyContactRelationship = $data['familyContactRelationship'];
                    $deceased = $data['deceased'];

                    $deceasedLocation = '';
                    if($data['deceasedInLocation'] != null && $data['deceasedInLocation'] != ''){
                        $deceasedLocation .= $data['deceasedInLocation'];
                    }
                    if($data['deceasedInProvince'] != null && $data['deceasedInProvince'] != ''){
                        $deceasedLocation .= ', ' . $data['deceasedInProvince'];
                    }
                    $dayA = $data['deceasedDate'] == null ? '' : date("d", strtotime($data['deceasedDate']));
                    $monthA = $data['deceasedDate'] == null ? '' : date("m", strtotime($data['deceasedDate']));
                    $monthA = getMonth($monthA);
                    $yearA = $data['deceasedDate'] == null ? '' : date("Y", strtotime($data['deceasedDate']));
                    $dayB = $data['deceasedDate'] == null ? '' : date("d", time());
                    $monthB = $data['deceasedDate'] == null ? '' : date("m", time());
                    $monthB = getMonth($monthB);
                    $yearB = $data['deceasedDate'] == null ? '' : date("Y", time());
                    $mortuaryLocation = $data['mortuaryLocation'];

                    return "
                        <div class='fondo'>
                            <div class='$fuente folioPompas' style='background-image: url(" . $background . ")'>
                                <div class='contenidoPompas' style='padding-top: 120px; line-height: 2em;'>
                                    <div class='text-center'>
                                        <strong><p><u>RECONOCIMIENTO PREVIO INCINERACIÓN</u></p></strong>
                                    </div>
            
                                    <div style='font-size: 14px!important; line-height: 30px;'>
                                        <p>
                                        Quien suscribe, D. ".$familyContact." con domicilio en ".$familyContactAddress.", con DNI número ".$familyContactNIF."
                                        en calidad de ".$familyContactRelationship.", y en relación al óbito de D. ".$deceased." ocurrido el día ".$dayA." de ".$monthA." de ".$yearA.",
                                        en la localidad de ".$deceasedLocation.".
                                        </p>
                                        <br>
                                        <p><u>DECLARA:</u></p>
                                        <div style='line-height: 10px'>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                                <tr> 
                                                    <td style='width:2%'>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='width:88%;height: 25px'><span style='font-size: 12px;color:$colorStyle'>
                                                        Que ha reconocido al fallecido con carácter inmediato a la incineración, autorizando el inicio de la misma.
                                                    </span></td>
                                                </tr>
                                            </table>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%; margin-top:1%'> 
                                                <tr> 
                                                    <td style='width:2%'>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='width:88%;height: 25px'><span style='font-size: 12px;color:$colorStyle'>
                                                        Que renuncia a efectuar el reconomiento del fallecido, autorizando el inicio de la incineración.
                                                    </span></td>
                                                </tr>
                                            </table>
                                        </div>
                                        <br>
                                        <p>El declarante manifiesta, bajo su responsabilidad, la veracidad de los datos aquí expresados.</p>
                                        <br>
                                        <p>
                                            En " . $mortuaryLocation . ", a " . $dayB . " de " . $monthB . " de " . $yearB . ".
                                        </p>
                                        <br><br>
                                        <div style='font-size: 14px; text-align: right;'><p>FDO. $familyContact</p></div>
                                        <div style='font-size: 14px; text-align: right;'><p>DNI. $familyContactNIF</p></div>
                                        <br><br><br><br>
                                        <div class='text-center'>
                                            <p>CLÁUSULA LOPD NECESARIO SI DIFIERE DEL DECLARANTE</p>
                                        </div>
                                        <br>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";
                }
            break;
        
            case "modificacionServicioFunerario":
                $utils = new Utils();

                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/modificacionServicioFunerario.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $data = getModificacionServicioFunerario($expedient);

                    $background = $utils->getBackgroundDocuments();

                    $clientName = $data['clientName'] == null ? "................" : $data['clientName'] ;
                    $policy = $data['policy'] == null ? "................" : $data['policy'] ;
                    $familyContact = $data['familyContact'] == null ? "................" : $data['familyContact'] ;
                    $familyContactNIF = $data['familyContactNIF'] == null ? "................" : $data['familyContactNIF'] ;
                    $familyContactRelationship = $data['familyContactRelationship'] == null ? "................" : $data['familyContactRelationship'] ;
                    $deceased = $data['deceased'] == null ? "................" : $data['deceased'] ;
                    $dayB =  date("d", time());
                    $monthB =  date("m", time());
                    $monthB = getMonth($monthB);
                    $yearB =  date("Y", time());

                    $privacyPolicy = '';
                    $logoEnterprise = "";
                    $privacyPolicy = "
                        POLÍTICA DE PRIVACIDAD: Avantia, Servicios de Gestión, actúa como encargado del tratamiento en nombre de la compañía aseguradora 
                        titular de la póliza de decesos. Dicho tratamiento tiene como finalidad la gestión de la póliza y el siniestro correspondiente, y está 
                        legitimado por la ejecución del contrato de seguro, incluida la tramitación de la cobertura de gestiones jurídicas posteriores al 
                        fallecimiento por sí misma o mediante proveedores que actúen por cuenta de Avantia Servicios de Gestión, y el cumplimiento de las 
                        obligaciones legales. En caso de que el firmante comunique datos de terceros, éste se compromete a informar a los terceros sobre tal 
                        comunicación y la presente política de privacidad. Puede ejercer los derechos de acceso, rectificación, supresión, oposición, limitación 
                        a su tratamiento o portabilidad, de conformidad con el procedimiento descrito en la política de privacidad que podrá consultar en las 
                        condiciones particulares o generales de la póliza o en la web de la entidad titular de la póliza de decesos.
                    ";
                    $logoEnterprise =  $utils->getRoute() . "resources/files/default/avantia.jpg";

                    $signLocation = '____________';
                    if($data['mortuaryLocation'] != null && $data['mortuaryLocation'] != ''){
                        $signLocation = $data['mortuaryLocation'];
                    }
                    
                    return "
                        <div class='fondo'>
                            <div class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: 80px; line-height: 2em;'>    
                                    <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2'>
                                        <tr>
                                            <td style='width:45%; font-size: 18px!important; line-height: 10px; color:$colorStyle!important' valign='bottom'>
                                                <p><img src='" . $logoEnterprise . "' width='100px'></p>
                                            </td>
                                        </tr>
                                    </table>
                                    <br><br>
                                    <div class='text-center' style='line-height: 10px'>
                                        <table class='tablePdf$tablePdfColor' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='height: 25px'>
                                                    SOLICITUD DE MODIFICACIÓN EN LOS ELEMENTOS DEL SERVICIO FUNERARIO CONTRATADO
                                                </td>
                                            </tr>
                                        </table>
                                    </div> 
                                    <div style='padding-top:20px;'>
                                        <table style='width:100%'> 
                                            <tr>
                                                <td>
                                                    <table class='tablePdf$tablePdfColor' style='width:100%; font-size:12px'>
                                                        <tr>
                                                            <td style='width:39%; text-align:left; font-size:12px; color:$colorStyle!important'>ASEGURADORA <br><br> &nbsp; </td>
                                                            <td style='width:22%; text-align:left; font-size:12px; color:$colorStyle!important'>NUM. PÓLIZA <br><br> ".$policy."</td>
                                                            <td style='width:39%; text-align:left; font-size:12px; color:$colorStyle!important'>ASEGURADO <br><br> ".$deceased."</td>
                                                        </tr>
                                                        <tr>
                                                            <td style='width:39%; text-align:left; font-size:12px; color:$colorStyle!important'>SOLICITANTE <br><br> ".$familyContact."</td>
                                                            <td style='width:22%; text-align:left; font-size:12px; color:$colorStyle!important'>DNI <br><br> ".$familyContactNIF."</td>
                                                            <td style='width:39%; text-align:left; font-size:12px; color:$colorStyle!important'>PARENTESCO <br><br> ".$familyContactRelationship."</td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>                                    
                                    </div>
                                    <br>
                                    <div style='font-size: 12px!important; line-height: 30px;'>
                                        <p>*Solicita el intercambio de servicio indicado, incluido en el valor de su póliza por:</p>
                                        <div>
                                            <table style='width:100%'> 
                                                <tr>
                                                    <td>
                                                        <table class='tablePdfNoBorder' style='width:100%; font-size:12px; line-height: 40px;'>
                                                            <tr>
                                                                <td style='width:45%; text-align:left; font-size:12px; color:$colorStyle!important'><div style='color:$colorStyle!important;'>..................................................................................................</div></td>
                                                                <td style='width:10%; text-align:left; font-size:12px; color:$colorStyle!important'></td>
                                                                <td style='width:45%; text-align:left; font-size:12px; color:$colorStyle!important'><div style='color:$colorStyle!important;'>..................................................................................................</div></td>
                                                            </tr>
                                                            <tr style='padding-bottom: 0; margin-bottom:0;'>
                                                                <td style='width:45%; text-align:left; font-size:12px; color:$colorStyle!important'><div style='color:$colorStyle!important;'>..................................................................................................</div></td>
                                                                <td style='width:10%; text-align:left; font-size:12px; color:$colorStyle!important'></td>
                                                                <td style='width:45%; text-align:left; font-size:12px; color:$colorStyle!important'><div style='color:$colorStyle!important;'>..................................................................................................</div></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                </tr>
                                            </table>                                    
                                        </div>
                                    </div>
                                    <div style='font-size: 12px!important; line-height: 30px;'>
                                        <p>Quedando satisfecho con la presentación del servicio intercambiado, sin que se devengue devolución del capital.</p>
                                        <br><br>
                                        <p>*Solicita la prestación de los siguientes complementos al servicio funerarios contratado, por un importe total de ..............,
                                        con cargo al valor total de servicio de la póliza de referencia.</p>
                                        <div>
                                            <table style='width:100%'> 
                                                <tr>
                                                    <td>
                                                        <table class='tablePdfNoBorder' style='width:100%; font-size:12px; line-height: 40px;'>
                                                            <tr>
                                                                <td style='width:45%; text-align:left; font-size:12px; color:$colorStyle!important'><div style='color:$colorStyle!important;'>..................................................................................................</div></td>
                                                                <td style='width:10%; text-align:left; font-size:12px; color:$colorStyle!important'></td>
                                                                <td style='width:45%; text-align:left; font-size:12px; color:$colorStyle!important'><div style='color:$colorStyle!important;'>..................................................................................................</div></td>
                                                            </tr>
                                                            <tr style='padding-bottom: 0; margin-bottom:0;'>
                                                                <td style='width:45%; text-align:left; font-size:12px; color:$colorStyle!important'><div style='color:$colorStyle!important;'>..................................................................................................</div></td>
                                                                <td style='width:10%; text-align:left; font-size:12px; color:$colorStyle!important'></td>
                                                                <td style='width:45%; text-align:left; font-size:12px; color:$colorStyle!important'><div style='color:$colorStyle!important;'>..................................................................................................</div></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                </tr>
                                            </table>                                    
                                        </div>
                                    </div>
                                    <br>
                                    <div style='font-size: 12px!important; line-height: 30px;'>
                                        <p>*Observaciones<br>
                                        ....................................................................................................................................................................................................................................................................................................................................................
                                        </p>
                                        <br>
                                        <div style='font-size: 12px; text-align: right; padding-right:30px;'>En $signLocation, a " . $dayB . " de " . $monthB . " de " . $yearB . ".</div>
                                    </div>
                                    <div style='padding-top:20px;'>
                                        <table style='width:100%'> 
                                            <tr>
                                                <td>
                                                    <table class='tablePdfNoBorder' style='width:100%; font-size:12px; line-height: 45px;'>
                                                        <tr>
                                                            <td style='width:50%; text-align:center; font-size:12px; color:$colorStyle!important'><div style='color:$colorStyle!important;'>El Solicitante</div></td>
                                                            <td style='width:50%; text-align:center; font-size:12px; color:$colorStyle!important'><div style='color:$colorStyle!important;'>Por ASEGURADORA</div></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>                                    
                                    </div>
                                    <div style='text-align:justify; font-size:9px; margin-top:40px; line-height:10px;'>
                                        <p>".$privacyPolicy."</p>
                                    </div>
                                    <br>
                                </div>
                            </div>
                        </div>
                    ";
                }
            break;
        
            case "modeloHojaDeDatos":
                $utils = new Utils();

                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/modeloHojaDeDatos.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }else{
                    $data = getModeloHojaDeDatos($expedient);

                    $background = $utils->getBackgroundDocuments();
                    
                    $familyContact = $data['familyContact'] == null ? "" : $data['familyContact'] ;
                    $familyContactNIF = $data['familyContactNIF'] == null ? "" : $data['familyContactNIF'] ;
                    $familyContactAddress = $data['familyContactAddress'] == null ? "" : $data['familyContactAddress'] ;
                    if($data['familyContactLocation'] != null && $data['familyContactLocation'] != ''){
                        $familyContactAddress .= ', ' . $data['familyContactLocation'];
                        if($data['familyContactProvince'] != null && $data['familyContactProvince'] != ''){
                            $familyContactAddress .= ', ' . $data['familyContactProvince'];
                        }
                    }
                    $familyContactRelationship = $data['familyContactRelationship'] == null ? "" : $data['familyContactRelationship'] ;
                    $familyContactMobilePhone = $data['familyContactMobilePhone'] == null ? "" : $data['familyContactMobilePhone'] ;
                    $deceased = $data['deceased'] == null ? "" : $data['deceased'] ;
                    $deceasedNIF = $data['deceasedNIF'] == null ? "" : $data['deceasedNIF'] ;
                    $deceasedDate = $data['deceasedDate'] == null ? "" : date("j-n-Y", strtotime($data['deceasedDate']));
                    $applicant = $data['applicant'] == null ? "" : $data['applicant'];
                    $applicantAddress = $data['applicantAddress'] == null ? "" : $data['applicantAddress'];
                    $applicantMail = $data['applicantMail'] == null ? "" : $data['applicantMail'];
                    $applicantMobilePhone = $data['applicantMobilePhone'] == null ? "" : $data['applicantMobilePhone'];
                    $policy = $data['policy'] == null ? "" : $data['policy'] ;
                    $clientName = $data['clientName'] == null ? "" : $data['clientName'] ;
                    $familyContact = $data['familyContact'] == null ? "" : $data['familyContact'] ;
                    // $familyContactPhone = $data['familyContactPhone'] == null ? "" : $data['familyContactPhone'] ;
                    $familyContactMail  = $data['familyContactMail'] == null ? "" : $data['familyContactMail'] ;
                    $otherContactRelationship = $data['otherContactRelationship'] == null ? "" : $data['otherContactRelationship'] ;
                    $familyContactLocation = $data['familyContactLocation'] == null ? "" : $data['familyContactLocation'] ;
                    $familyContactPostalCode = $data['familyContactPostalCode'] == null ? "" : $data['familyContactPostalCode'] ;
                    $deceasedLocation = $data['deceasedInName'] == null ? "" : $data['deceasedInName'] ;
                    $cemeteryLocation = $data['cemeteryLocation'] == null ? "" : $data['cemeteryLocation'] ;
                    $sourceFuneralHome = $data['sourceFuneralHome'] == null ? "" : $data['sourceFuneralHome'] ;
                    $destinationFuneralHome = $data['destinationFuneralHome'] == null ? "" : $data['destinationFuneralHome'] ;

                    if($data['mortuaryName'] == null){
                        $mortuaryName = "_____________________________________";
                    }else{
                        if($data['mortuaryName'] == 'Otro'){
                            $mortuaryName = $data['deceasedMortuaryAddress'];
                        }else{
                            $mortuaryName = $data['mortuaryName'];
                        }
                    }

                    $cemeteryName = $data['cemeteryName'] == null ? "____________________________________" : $data['cemeteryName'] ;
                    $dayB =  date("d", time());
                    $monthB =  date("m", time());
                    $monthB = getMonth($monthB);
                    $yearB =  date("Y", time());

                    $privacyPolicy = '';
                    $privacyPolicy = "
                        POLÍTICA DE PRIVACIDAD: Avantia, Servicios de Gestión, actúa como encargado del tratamiento en nombre de la compañía aseguradora 
                        titular de la póliza de decesos. Dicho tratamiento tiene como finalidad la gestión de la póliza y el siniestro correspondiente, y está 
                        legitimado por la ejecución del contrato de seguro, incluida la tramitación de la cobertura de gestiones jurídicas posteriores al 
                        fallecimiento por sí misma o mediante proveedores que actúen por cuenta de Avantia Servicios de Gestión, y el cumplimiento de las 
                        obligaciones legales. En caso de que el firmante comunique datos de terceros, éste se compromete a informar a los terceros sobre tal 
                        comunicación y la presente política de privacidad. Puede ejercer los derechos de acceso, rectificación, supresión, oposición, limitación 
                        a su tratamiento o portabilidad, de conformidad con el procedimiento descrito en la política de privacidad que podrá consultar en las 
                        condiciones particulares o generales de la póliza o en la web de la entidad titular de la póliza de decesos.
                    ";

                    return "
                        <div class='fondo'>
                            <div class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: 80px; line-height: 2em;'>    
                                    <div class='text-center' style='font-size: 24px;'>
                                        <strong><p>DATOS DEL SERVICIO</p></strong>
                                    </div>
                                    <div style='font-size: 11px; text-align: center; margin: 0 auto;'>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:15%;height: 25px'><span style='font-size: 11px;color:$colorStyle'></td>
                                                <td style='width:20%;height: 25px'><span style='font-size: 12px;color:$colorStyle'><strong>Aseguradora</strong></span></td>
                                                <td style='width:50%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span>&nbsp;</span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:15%;height: 25px'><span style='font-size: 11px;color:$colorStyle'></td>
                                            </tr>
                                        </table>
                                    </div>
                                    <br>
                                    <div style='font-size: 11px; text-align: center; margin: 0 auto;'>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:7%;height: 25px'><span style='font-size: 11px;color:$colorStyle'></td>
                                                <td style='width:22%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Asegurado Fallecido</span></td>
                                                <td style='width:64%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span>&nbsp;".$deceased."</span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:7%;height: 25px'><span style='font-size: 11px;color:$colorStyle'></td>
                                            </tr>
                                        </table>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:7%;height: 25px'><span style='font-size: 11px;color:$colorStyle'></td>
                                                <td style='width:7%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>DNI</span></td>
                                                <td style='width:20%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span>&nbsp;".$deceasedNIF."</span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td class='text-center' style='width:37%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Causa fallecimiento (natural / accidental)</span></td>
                                                <td style='width:20%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:7%;height: 25px'><span style='font-size: 11px;color:$colorStyle'></td>
                                            </tr>
                                        </table>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:7%;height: 25px'><span style='font-size: 11px;color:$colorStyle'></td>
                                                <td style='width:17%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Fecha defunción</span></td>
                                                <td style='width:22%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span>&nbsp;".$deceasedDate."</span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:16%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Número Póliza</span></td>
                                                <td style='width:29%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span>&nbsp;".$policy."</span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:7%;height: 25px'><span style='font-size: 11px;color:$colorStyle'></td>
                                            </tr>
                                        </table>
                                    </div>
                                    <br>
                                    <div style='font-size: 11px; text-align: center; line-height: 5px; margin: 3px 0; background-color:#bcbbbb'></div>
                                    <div style='font-size: 11px; text-align: center; margin: 0 auto;'>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:13%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Contratante</span></td>
                                                <td style='width:87%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span> &nbsp;".$familyContact."</span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:11%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Teléfono</span></td>
                                                <td style='width:15%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span> &nbsp;".$familyContactMobilePhone."</span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:9%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>E-mail</span></td>
                                                <td style='width:24%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span> &nbsp;".$familyContactMail."</span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:11%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Parentesco</span></td>
                                                <td style='width:26%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'><span> &nbsp;".$familyContactRelationship."</span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:13%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Domicilio</span></td>
                                                <td style='width:87%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span> &nbsp;".$familyContactAddress."</span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                        <div style='font-size: 8px;text-align:justify;  line-height: 10px;'>
                                            <p><i>(*)En caso de que el contratante no sea la persona encargada de gestiones posteriores relacionadas con la póliza, cumplimentar el siguiente apartado</i></p>
                                        </div>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:13%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Contacto G.J.</span></td>
                                                <td style='width:87%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:13%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Teléfono</span></td>
                                                <td style='width:15%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>

                                                <td style='width:7%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>E-mail</span></td>
                                                <td style='width:24%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:11%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Parentesco</span></td>
                                                <td style='width:26%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:22%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Localidad de residencia</span></td>
                                                <td style='width:43%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:13%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Código Postal</span></td>
                                                <td style='width:20%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div style='font-size: 11px; text-align: center; line-height: 5px; margin: 3px 0; background-color:#bcbbbb'></div>
                                    <div style='font-size: 11px; text-align: center; margin: 0 auto;'>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:22%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Localidad fallecimiento</span></td>
                                                <td style='width:78%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span> &nbsp;".$deceasedLocation."</span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:32%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Localidad inhumación/incineración</span></td>
                                                <td style='width:68%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span> &nbsp;".$cemeteryLocation."</span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:20%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Funeraria origen</span></td>
                                                <td style='width:80%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span> &nbsp;".$sourceFuneralHome."</span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:20%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Funeraria destino</span></td>
                                                <td style='width:80%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td style='text-align: left;!important'> <span> &nbsp;".$destinationFuneralHome."</span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:20%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Inhumación temporal</span></td>
                                                <td style='width:2%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:20%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Inhumación propiedad</span></td>
                                                <td style='width:2%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:13%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Incineración</span></td>
                                                <td style='width:2%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:8%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Lápida</span></td>
                                                <td style='width:27%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='width:100%; font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%;text-align: left;font-size: 11px;'> 
                                            <tr> 
                                                <td style='width:1%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Tanatorio:</span></td>
                                                <td style='width:35%'>    
                                                    <table class='tablePdfNoBorder' style='width:100%;font-size: 11px;text-align: left;!important'>
                                                        <tr>
                                                            <td style='text-align: left;!important'><span><div style='color:$colorStyle!important;'>".$mortuaryName."</div></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:21%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Cementerio / Crematorio: </span></td>
                                                <td style='width:32%'>    
                                                    <table class='tablePdfNoBorder' style='width:100%;font-size: 11px;text-align: left;!important'>
                                                        <tr>
                                                            <td style='text-align: left;!important'><span><div style='color:$colorStyle!important;'>".$cemeteryName."</div></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div style='line-height: 10px; margin-top:11px; border-style:solid; border-color: $colorStyle border-width: 1px;'>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:100%;height: 20px'><span style='font-size: 11px;color:$colorStyle'>
                                                    Elementos del servicio no utilizados:
                                                </span></td>
                                            </tr>
                                        </table>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:1%;height: 25px'></td>
                                                <td style='width:10%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Corona/s</span></td>
                                                <td style='width:2%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:7%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Nicho</span></td>
                                                <td style='width:2%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:8%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Lápida</span></td>
                                                <td style='width:2%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:9%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Esquela</span></td>
                                                <td style='width:2%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:17%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Acompañamiento</span></td>
                                                <td style='width:2%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:13%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Recordatorios</span></td>
                                                <td style='width:2%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:3%;height: 25px'></td>
                                            </tr>
                                        </table>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:1%;height: 25px'></td>
                                                <td style='width:5%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Otros:</span></td>
                                                <td style='width:91%'>    
                                                    <table class='tablePdfNoBorder'>
                                                        <tr>
                                                            <td><span><div style='color:$colorStyle!important;'>______________________________________________________________________________________________</div></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:3%;height: 25px'></td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div style='line-height: 10px; margin-top:11px; border-style:solid; border-color: $colorStyle border-width: 1px;'>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:100%;height: 20px'><span style='font-size: 11px;color:$colorStyle'>
                                                    Elementos del servicio contratados de forma particular:
                                                </span></td>
                                            </tr>
                                        </table>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:1%;height: 25px'></td>
                                                <td style='width:10%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Corona/s</span></td>
                                                <td style='width:2%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:7%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Nicho</span></td>
                                                <td style='width:2%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:8%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Lápida</span></td>
                                                <td style='width:2%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:9%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Esquela</span></td>
                                                <td style='width:2%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:17%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Acompañamiento</span></td>
                                                <td style='width:2%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:2%;height: 25px'></td>
                                                <td style='width:13%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Recordatorios</span></td>
                                                <td style='width:2%'>    
                                                    <table class='tablePdfv2$tablePdfV2Color' style='font-size: 11px;'>
                                                        <tr>
                                                            <td><span></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:3%;height: 25px'></td>
                                            </tr>
                                        </table>
                                        <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                            <tr> 
                                                <td style='width:1%;height: 25px'></td>
                                                <td style='width:5%;height: 25px'><span style='font-size: 11px;color:$colorStyle'>Otros:</span></td>
                                                <td style='width:91%'>    
                                                    <table class='tablePdfNoBorder'>
                                                        <tr>
                                                            <td><span><div style='color:$colorStyle!important;'>______________________________________________________________________________________________</div></span></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                                <td style='width:3%;height: 25px'></td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class='text-center' style='font-size: 11px!important; margin-top:14px;'>
                                        <table class='text-center' style='width:100%'> 
                                            <tr style='height: 10px;'>
                                                <td>
                                                    <div style='color:$colorStyle !important; font-size:12px;'><p>OBSERVACIONES</p></div>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <table class='tablePdf$tablePdfColor' style='width:100%; font-size:11px; line-height: 18px;'>
                                                        <tr>
                                                            <td style='text-align:left; font-size:11px; color:$colorStyle!important'></td>
                                                        </tr>
                                                        <tr>
                                                            <td style='text-align:left; font-size:11px; color:$colorStyle!important'></td>
                                                        </tr>
                                                        <tr>
                                                            <td style='text-align:left; font-size:11px; color:$colorStyle!important'></td>
                                                        </tr>
                                                    </table>
                                                </td>
                                            </tr>
                                        </table>                                    
                                        <br>
                                        <table class='tablePdfNoBorder' style='color:$colorStyle!important;'>
                                            <tbody>
                                                <tr>
                                                    <td>
                                                        <p></p>                
                                                        <p></p>
                                                        <p></p>
                                                        <p>Fdo.: ______________________</p>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                    <div style='text-align:justify; font-size:9px; margin-top:60px; line-height:10px;'>
                                        <p>".$privacyPolicy."</p>
                                    </div>
                                    <br>
                                </div>
                            </div>
                        </div>
                    ";
                }
            break;

            case "update":
                $utils = new Utils();
                $background = $utils->getBackgroundDocuments();

                require_once($_SESSION['basePath'] . "model/updates.php");
                $updates = new Updates();
                $updateID['ID'] = $_POST['update'];
                $data = $updates->read($updateID);

                $publishDate = $utils->fechaCastellano2(date('Y'), $data['publishDate']);

                return "
                        <div class='fondo'>
                            <div class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: 80px; line-height: 2em;'>
                                    <div style='font-size: 14px!important; line-height: 30px;'>
                                        <p>
                                            <strong>".$data['title']."</strong>
                                        </p>
                                        <p>
                                            ".$data['message']."
                                        </p>
                                        <br>
                                        <p>
                                            Actualización publicada el <strong>".$publishDate.".</strong>
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    ";
            break;

            case "instanciaSanJose":
                $utils = new Utils();
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/instanciaSanJose.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }
            
                // $data = getAutoCremacion($expedient);

                // $background = $utils->getBackgroundDocuments();
                $background =  $utils->getRoute() . "resources/files/" . $_SESSION['company'] . "/settings/backgroundSanJose.jpg";

                $text ="
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas' style='padding-top: 125px'>
                                <strong><span style='color:#000000'>SOL·LICITANT</span></strong>
                                <br>
                                <table class='tablePdfBlack' style='width: 100%;'> 
                                    <tr>
                                        <td style='width: 200px!important;'>
                                            <div style='font-size:12px;'>
                                                <strong>Nom i llinatges / Raó social</strong>:
                                            </div>
                                        </td>
                                        <td style='width: 100px!important;'>
                                            <div style='font-size:12px;'>
                                                <strong>DNI / CIF</strong>:
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfBlack' style='width: 100%;'> 
                                    <tr>
                                        <td style='width: 150px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Adreça a efectes de notificació</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 30px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Núm.</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 30px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Bloc</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 30px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Esc.</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 30px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Pis.</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 30px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Porta.</strong>: </p>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfBlack' style='width: 100%;'> 
                                    <tr>
                                        <td style='width: 40px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>CP</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 160px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Localitat</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 100px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Provincia</strong>: </p>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfBlack' style='width: 100%;'> 
                                    <tr>
                                        <td style='width: 60px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Telèfono fix</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 60px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Telèfono mòbil</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 180px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>E-mail</strong>: </p>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <br>
                                <strong><span style='color:#000000'>REPRESENTANT</strong></strong>
                                <div style='font-size: 10px!important;'>
                                    <span style='color:#000000'><i>(Emplenau aquestes dades si actuau com a representant d\'una persona física o jurídica i aportau la documentació que acrediti aquesta autorització)</i></span>
                                </div>
                                <br>
                                <table class='tablePdfBlack' style='width: 100%;'> 
                                    <tr>
                                        <td style='width: 200px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Nom i llinatges / Raó social</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 100px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>DNI / CIF</strong>: </p>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfBlack' style='width: 100%;'> 
                                    <tr>
                                        <td style='width: 150px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Adreça a efectes de notificació</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 30px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Núm.</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 30px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Bloc</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 30px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Esc.</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 30px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Pis.</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 30px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Porta.</strong>: </p>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfBlack' style='width: 100%;'> 
                                    <tr>
                                        <td style='width: 40px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>CP</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 160px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Localitat</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 100px!important;'>
                                            <div style='font-size:12px;'>
                                                <p><strong>Provincia</strong>: </p>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfBlack' style='width: 100%;border: solid 1px black!important;'> 
                                    <tr>
                                        <td style='width: 60px!important;'>
                                            <div style='font-size:12px;color: #000000!important;'>
                                                <p><strong>Telèfono fix</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 60px!important;'>
                                            <div style='font-size:12px;color: #000000!important;'>
                                                <p><strong>Telèfono mòbil</strong>: </p>
                                            </div>
                                        </td>
                                        <td style='width: 180px!important;'>
                                            <div style='font-size:12px;color: #000000!important;'>
                                                <p><strong>E-mail</strong>: </p>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <br>
                                <div style='color: #000000!important;'><strong>EXPÒS:</strong></div>
                                <div style='font-size:12px;height:140px;border: solid 1px black;padding: 5px;'></div>
                                <br>
                                <div style='color: #000000!important;'><strong>I, per tota això, SOL·LICIT:</strong></div>
                                <div style='font-size:12px;height:140px;border: solid 1px black;padding: 5px;'></div>
                                <br>
                                <div style='color: #000000!important;'>San Josep de sa Talaia, ____ d __________________ de 20___.</div>
                                <div style='color: #000000!important;'>(Signatura)</div>
                                <br>
                                <br>
                                <div style='color: #000000!important;'><strong>Documents que adjuntau o ref. expedient:</strong></div>
                                <div style='font-size:12px;height:100px;border: solid 1px black;padding: 5px;color: #000000!important;'></div>
                            </div>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "instanciaSEulalia":
                $utils = new Utils();
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/instanciaSEulalia.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }
            
                // $data = getAutoCremacion($expedient);

                // $background = $utils->getBackgroundDocuments();
                $background =  $utils->getRoute() . "resources/files/" . $_SESSION['company'] . "/settings/backgroundSEulaia.jpg";

                $text ="
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas' style='padding-top: 125px'>
                                <div class='text-center' style='font-size: 24px;'>
                                    <strong><span style='color:#c0c0c0;font-size:16px'>INSTANCIA GENERAL</span></strong>
                                </div>
                                <div style='color: #000000!important;border: solid 1px black;padding:3px'><strong><span style='font-size:14px'>Interesado</span></strong></div>
                                <table class='tablePdfBlack' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 200px!important;'>
                                            <div style='font-size:10px;'>
                                                Apellidos y nombre o Razón social
                                            </div>
                                            <div style='font-size:12px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td style='width: 100px!important;'>
                                            <div style='font-size:10px;'>
                                                DNI / CIF
                                            </div>
                                            <div style='font-size:12px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfBlack' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 170px!important;'>
                                            <div style='font-size:10px;'>
                                                Domicilio a efectos de notificación
                                            </div>
                                            <div style='font-size:12px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td style='width: 120px!important;'>
                                            <div style='font-size:10px;'>
                                                Municipio/Población
                                            </div>
                                            <div style='font-size:12px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfBlack' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 80px!important;'>
                                            <div style='font-size:10px;text-align:center'>
                                                C.P.
                                            </div>
                                            <div style='font-size:12px;text-align:center'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td style='width: 80px!important;'>
                                            <div style='font-size:10px;text-align:center'>
                                                Teléfono
                                            </div>
                                            <div style='font-size:12px;text-align:center'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td style='width: 80px!important;'>
                                            <div style='font-size:10px;text-align:center'>
                                                Fax
                                            </div>
                                            <div style='font-size:12px;text-align:center'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td style='width: 200px!important;'>
                                            <div style='font-size:10px;text-align:center'>
                                                Correo electrónico
                                            </div>
                                            <div style='font-size:12px;text-align:center'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <br>
                                <div style='color: #000000!important;border: solid 1px black;padding:3px'><strong><span style='font-size:14px'>Representante</span></strong></div>
                                <table class='tablePdfBlack' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 200px!important;'>
                                            <div style='font-size:10px;'>
                                                Apellidos y nombre o Razón social
                                            </div>
                                            <div style='font-size:12px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td style='width: 100px!important;'>
                                            <div style='font-size:10px;'>
                                                DNI / CIF
                                            </div>
                                            <div style='font-size:12px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfBlack' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 170px!important;'>
                                            <div style='font-size:10px;'>
                                                Domicilio a efectos de notificación
                                            </div>
                                            <div style='font-size:12px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td style='width: 120px!important;'>
                                            <div style='font-size:10px;'>
                                                Municipio/Población
                                            </div>
                                            <div style='font-size:12px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfBlack' style='width: 100%;'>
                                    <tr>
                                        <td style='width: 80px!important;'>
                                            <div style='font-size:10px;text-align:center'>
                                                C.P.
                                            </div>
                                            <div style='font-size:12px;text-align:center'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td style='width: 80px!important;'>
                                            <div style='font-size:10px;text-align:center'>
                                                Teléfono
                                            </div>
                                            <div style='font-size:12px;text-align:center'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td style='width: 80px!important;'>
                                            <div style='font-size:10px;text-align:center'>
                                                Fax
                                            </div>
                                            <div style='font-size:12px;text-align:center'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td style='width: 200px!important;'>
                                            <div style='font-size:10px;text-align:center'>
                                                Correo electrónico
                                            </div>
                                            <div style='font-size:12px;text-align:center'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <br>
                                <div style='color: #000000!important;border: solid 1px black;padding:3px'><strong>EXPONE</strong></div>
                                <div style='font-size:12px;height:140px;border: solid 1px black;padding: 5px;'></div>
                                <br>
                                <div style='color: #000000!important;border: solid 1px black;padding:3px'><strong>SOLICITA</strong> que teniendo por presentada en tiempo y forma la presenta, se sirva admitirla y</div>
                                <div style='font-size:12px;height:60px;border: solid 1px black;padding: 5px;'></div>
                                <br>
                                <div style='color: #000000!important;border: solid 1px black;padding:3px'><strong>Documentos aportados</strong></div>
                                <div style='font-size:12px;height:60px;border: solid 1px black;padding: 5px;'></div>
                                <br>
                                <div style='color: #000000!important;padding-left:40px'>En _________________________________, a ______ de __________________ de 20___.</div>
                                <br><br><br><br><br><br><br>
                                <div class='text-center' style='font-size: 10px;color: #000000!important;'>
                                    FIRMA
                                </div>
                            </div>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "instanciaInhumacionIbiza":
                $utils = new Utils();
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/instanciaInhumacionIbiza.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }
            
                $background =  $utils->getRoute() . "resources/files/" . $_SESSION['company'] . "/settings/backgroundInstanciaGeneral.jpg";

                $text ="
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas' style='padding-top: 110px'>
                                <div class='text-center' style='font-size: 24px;'>
                                    <strong><span style='color:#000000;font-size:16px'>SOLICITUD INHUMACIÓN</span></strong>
                                </div>
                                <div style='color: #000000!important;'><strong><span style='font-size:15px'>PERSONA SOLICITANTE</span></strong></div>
                                <table class='tablePdfBlack' style='width: 100%;'>
                                    <tr>
                                        <td colspan='4'>
                                            <div style='font-size:13px;'>
                                                Nombre y apellidos:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td  colspan='3'>
                                            <div style='font-size:13px;'>
                                                Doc. de identidad:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan='2'>
                                            <div style='font-size:13px;'>
                                                Dirección:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td 
                                            <div style='font-size:13px;'>
                                                Núm.:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td 
                                            <div style='font-size:13px;'>
                                                Bloque:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td 
                                            <div style='font-size:13px;'>
                                                Esc.:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td 
                                            <div style='font-size:13px;'>
                                                Piso:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td 
                                            <div style='font-size:13px;'>
                                                Puerta:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan='2'>
                                            <div style='font-size:13px;'>
                                                Municipio:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td  colspan='3'>
                                            <div style='font-size:13px;'>
                                                Provincia:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td  colspan='2'>
                                            <div style='font-size:13px;'>
                                                C.P.:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan='2'>
                                            <div style='font-size:13px;'>
                                                Otros:<span style='font-size:10px'>(Polígono, nombre de la casa, etc):</span>
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td  colspan='5'>
                                            <div style='font-size:13px;'>
                                                Correo electrónico:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan='2'>
                                            <div style='font-size:13px;'>
                                                Teléfono:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td  colspan='3'>
                                            <div style='font-size:13px;'>
                                                Fax:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td  colspan='2'>
                                            <div style='font-size:13px;'>
                                                Móvil:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <div style='color: #000000!important;'><strong><span style='font-size:15px'>PERSONA DIFUNTA</span></strong></div>
                                <table class='tablePdfBlack' style='width: 100%;'>
                                    <tr>
                                        <td>
                                            <div style='font-size:13px;'>
                                                Nombre y apellidos:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td>
                                            <div style='font-size:13px;'>
                                                Doc. de identidad:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div style='font-size:13px;'>
                                                Dirección:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td>
                                            <div style='font-size:13px;'>
                                                Fecha de la muerte:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <div style='color: #000000!important;'><strong><span style='font-size:15px'>LUGAR INHUMACIÓN</span></strong></div>
                                <table class='tablePdfBlack' style='width: 100%;'>
                                    <tr>
                                        <td colspan='2'>
                                            <div style='font-size:13px;'>
                                                Cementerio:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td>
                                            <div style='font-size:13px;'>
                                                Nicho Núm.:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td>
                                            <div style='font-size:13px;'>
                                                Grupo.:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <div style='font-size:13px;'>
                                                Capilla:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td>
                                            <div style='font-size:13px;'>
                                                Patio:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td>
                                            <div style='font-size:13px;'>
                                                Cripta:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                        <td>
                                            <div style='font-size:13px;'>
                                                Sepultura:
                                            </div>
                                            <div style='font-size:13px;'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td colspan='4'>
                                            <div style='font-size:13px;'>
                                                Cantidad de restes:
                                            </div>
                                            <div style='font-size:13px;height:30px'>
                                                &nbsp;
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                                <br>
                                <div style='font-size:12px;height:330px;border: solid 1px black;padding: 5px;color:black!important'>
                                    <span><strong>EXPONGO:</strong></span>
                                    <p>
                                        Que el funeral del difunto mencionado se llevará a cabo en la iglesia: __________________________ a las ________ horas del día _________________
                                        esperando la llegada del cortejo fúnebre al citado Cementerio a las __________ horas.
                                    </p>
                                    <p>
                                        Que en virtud de lo previsto en el artículo 4.15 del Reglamenteo municipal de cementerios se adjunta la siguiente documentación:
                                    </p>

                                    <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                        <tr> 
                                            <td style='width:3%'>    
                                                <table class='tablePdfv4'>
                                                    <tr>
                                                        <td><span></span></td>
                                                    </tr>
                                                </table>
                                            </td>
                                            <td style='width:97%;height: 25px'>
                                                <span style='font-size: 12px;'>
                                                    &nbsp;Título acreditativo de la concesión funeraria.
                                                </span>
                                            </td>
                                        </tr>
                                        <tr> 
                                            <td style='width:3%'>    
                                                <table class='tablePdfv4'>
                                                    <tr>
                                                        <td><span></span></td>
                                                    </tr>
                                                </table>
                                            </td>
                                            <td style='width:97%;height: 25px'>
                                                <span style='font-size: 12px;'>
                                                    &nbsp;Autorización del titular para llevar a cabo la inhumación.
                                                </span>
                                            </td>
                                        </tr>
                                        <tr> 
                                            <td style='width:3%'>    
                                                <table class='tablePdfv4'>
                                                    <tr>
                                                        <td><span></span></td>
                                                    </tr>
                                                </table>
                                            </td>
                                            <td style='width:97%;height: 25px'>
                                                <span style='font-size: 12px;'>
                                                    &nbsp;Certificado médico de defunción.
                                                </span>
                                            </td>
                                        </tr>
                                        <tr> 
                                            <td style='width:3%'>    
                                                <table class='tablePdfv4'>
                                                    <tr>
                                                        <td><span></span></td>
                                                    </tr>
                                                </table>
                                            </td>
                                            <td style='width:97%;height: 25px'>
                                                <span style='font-size: 12px;'>
                                                    &nbsp;Parte de defunción.
                                                </span>
                                            </td>
                                        </tr>
                                        <tr> 
                                            <td style='width:3%'>    
                                                <table class='tablePdfv4'>
                                                    <tr>
                                                        <td><span></span></td>
                                                    </tr>
                                                </table>
                                            </td>
                                            <td style='width:97%;height: 25px'>
                                                <span style='font-size: 12px;'>
                                                    &nbsp;DNI tanto del titular como del difunto.
                                                </span>
                                            </td>
                                        </tr>
                                        <tr> 
                                            <td style='width:3%'>    
                                                <table class='tablePdfv4'>
                                                    <tr>
                                                        <td><span></span></td>
                                                    </tr>
                                                </table>
                                            </td>
                                            <td style='width:97%;height: 25px'>
                                                <span style='font-size: 12px;'>
                                                    &nbsp;Licencia para dar sepultura, expedida por el Registre Civil.
                                                </span>
                                            </td>
                                        </tr>
                                        <tr> 
                                            <td style='width:3%'>    
                                                <table class='tablePdfv4'>
                                                    <tr>
                                                        <td><span></span></td>
                                                    </tr>
                                                </table>
                                            </td>
                                            <td style='width:97%;height: 25px'>
                                                <span style='font-size: 12px;'>
                                                    &nbsp;Permiso de traslado por el Juzgado si procede.
                                                </span>
                                            </td>
                                        </tr>
                                    </table>
                                    Y por esto,<br>
                                    <strong>SOLICITO:</strong>
                                    <br>
                                    Autorización para el entierro.
                                </div>
                                <br><br><br>
                            </div>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "recepcionCadaveresOtrasFunerarias":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/recepcionCadaveresOtrasFunerarias.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }
            
                $staticInfo = $documentsInfo->getByDocument('recepcionCadaveresOtrasFunerarias');
                if($staticInfo != null){
                    foreach($staticInfo as $elem){
                        switch($elem['name']){
                            case 'companyDoc27':
                                $company = $elem['value'];
                            break;
                            case 'companyAddressDoc27':
                                $address = $elem['value'];
                            break;
                            case 'companyLocationDoc27':
                                $location = $elem['value'];
                            break;
                            case 'companyProvinceDoc27':
                                $province = $elem['value'];
                            break;
                        }
                    }
                }else{
                    $company = '';
                    $address = '';
                    $location = '';
                    $province = '';
                }

                $data = getRecepcionCadaveresOtrasFunerarias($expedient);

                // Datos del Fallecido
                $deceasedName = $data['deceased'] != null && $data['deceased'] != '' ? $data['deceased'] : '&nbsp;';
                $deceasedNif = $data['deceasedNIF'] != null && $data['deceasedNIF'] != '' ? $data['deceasedNIF'] : '&nbsp;';
                $deceasedDate = $data['deceasedDate'] != null && $data['deceasedDate'] != '' ? date("d/m/Y", strtotime($data['deceasedDate'])) : '&nbsp;';
                $deceasedTime = $data['deceasedTime'] != null && $data['deceasedTime'] != '' ? date("H:i", strtotime($data['deceasedTime'])) : '&nbsp;';
            
                // Féretro
                $feretroComun = '';
                $feretroTraslado = '';
                $feretroEcologico = '';
                $feretroOtro = '';
                $feretroOtroText = '________________';
                $feretroCamilla = '';
                $feretroCajaRestos = '';
                $feretroArcaTraslados = '';

                if($data['coffin'] != null && $data['coffin']){
                    switch($data['coffin']){
                        case '0':
                            $feretroComun = 'X';
                        break;
                        case '1':
                            $feretroTraslado = 'X';
                        break;
                        case '2':
                            $feretroEcologico = 'X';
                        break;
                        case '3':
                            $feretroOtro = 'X';
                            $feretroOtroText = $data['otherCoffin'] != null && $data['otherCoffin'] != '' ? $data['otherCoffin'] : '________________';
                        break;
                        case '4':
                            $feretroCamilla = 'X';
                        break;
                        case '5':
                            $feretroCajaRestos = 'X';
                        break;
                        case '6':
                            $feretroArcaTraslados = 'X';
                        break;
                    }
                }

                // Funeraria que entrega
                $funeralHomeName = $data['funeralHomeName'] != null && $data['funeralHomeName'] != '' ? $data['funeralHomeName'] : '&nbsp;';
                $funeralHomeNif = $data['funeralHomeNif'] != null && $data['funeralHomeNif'] != '' ? $data['funeralHomeNif'] : '&nbsp;';
                $funeralHomeAddress = $data['funeralHomeAddress'] != null && $data['funeralHomeAddress'] != '' ? $data['funeralHomeAddress'] : '&nbsp;';
                $funeralHomeLocation = $data['funeralHomeLocation'] != null && $data['funeralHomeLocation'] != '' ? $data['funeralHomeLocation'] : '&nbsp;';
                $funeralHomePostalCode = $data['funeralHomePostalCode'] != null && $data['funeralHomePostalCode'] != '' ? $data['funeralHomePostalCode'] : '&nbsp;';
                $funeralHomeProvince = $data['funeralHomeProvince'] != null && $data['funeralHomeProvince'] != '' ? $data['funeralHomeProvince'] : '&nbsp;';
                $funeralHomePhone = $data['funeralHomePhone'] != null && $data['funeralHomePhone'] != '' ? $data['funeralHomePhone'] : '&nbsp;';
                $funeralHomeEmail = $data['funeralHomeEmail'] != null && $data['funeralHomeEmail'] != '' ? $data['funeralHomeEmail'] : '&nbsp;';
                
                $utils = new Utils();
                $background = $utils->getBackgroundDocuments();

                $text = "
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas' style='padding-top: -5px'>
                                <div style='text-align: right; padding-top: 35px; line-height: 0.5'>
                                    <p><strong>$company</strong></p>
                                    <p>$address</p>
                                    <p>$location</p>
                                    <p>$province</p>
                                </div>
                                <div class='titulo' style='text-align:center;margin-top:10px'>
                                    <span>
                                        <strong>RECEPCIÓN DE CADÁVERES PROCEDENTES DE OTRAS FUNERARIAS</strong>
                                    </span>
                                </div>
                                <br>
                                <div class='titulo' style='margin-top:5px;margin-bottom:8px'>
                                    <span>
                                        <strong><u>DATOS DEL FALLECIDO</u></strong>
                                    </span>
                                </div>
                                <table class='tablePdfNoBorder' style='width: 100%;'>
                                    <tr>
                                        <td style='height: 20px;width: 110px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            NOMBRE Y APELLIDOS:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 215px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>$deceasedName</span>
                                        </td>
                                        <td style='height: 20px;width: 10px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            NIF/CIF:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 130px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>$deceasedNif</span>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfNoBorder' style='width: 100%;'>
                                    <tr>
                                        <td style='height: 20px;width: 100px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            FECHA DE FALLECIMIENTO:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 120px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>$deceasedDate</span>
                                        </td>
                                        <td style='height: 20px;width: 100px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            HORA DE FALLECIMIENTO:&nbsp;&nbsp;&nbsp;
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 120px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>$deceasedTime</span>
                                        </td>
                                    </tr>
                                </table>
                                <div class='titulo' style='margin-top:15px;margin-bottom:8px'>
                                    <span>
                                        <strong><u>FÉRETRO</u></strong>
                                    </span>
                                </div>
                                <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'>
                                    <tr>
                                        <td>
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span>$feretroCamilla</span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                                &nbsp;CAMILA&nbsp;&nbsp;&nbsp;&nbsp;
                                            </span>
                                        </td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span>$feretroTraslado</span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            &nbsp;TRASLADO&nbsp;&nbsp;&nbsp;&nbsp;
                                            </span>
                                        </td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span>$feretroComun</span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            &nbsp;COMÚN&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            </span>
                                        </td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span>$feretroEcologico</span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            &nbsp;ECOLÓGICO&nbsp;&nbsp;&nbsp;&nbsp;
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='margin-top:5px!important;width:100%'>
                                    <tr>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span>$feretroCajaRestos</span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            &nbsp;CAJA DE RESTOS&nbsp;&nbsp;&nbsp;&nbsp;
                                            </span>
                                        </td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span>$feretroArcaTraslados</span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            &nbsp;ARCA DE TRASLADO&nbsp;&nbsp;&nbsp;&nbsp;
                                            </span>
                                        </td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span>$feretroOtro</span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            &nbsp;OTRO: &nbsp;$feretroOtroText
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                                <div class='titulo' style='margin-top:15px;margin-bottom:8px'>
                                    <span>
                                        <strong><u>ACTIVIDADES DE PREPARACIÓN DEL CADÁVER</u></strong>
                                    </span>
                                </div>
                                <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'>
                                    <tr>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                                ENTREGAN ROPA
                                            </span>
                                        </td>
                                        <td>
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span></span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            &nbsp;SI
                                            </span>
                                        </td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span></span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            &nbsp;NO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            </span>
                                        </td>

                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span></span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            &nbsp;SIN PREPARAR&nbsp;&nbsp;
                                            </span>
                                        </td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span></span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            &nbsp;TANATOESTÉTICA&nbsp;&nbsp;
                                            </span>
                                        </td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span></span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            &nbsp;TANATOPRAXIA&nbsp;&nbsp;
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='margin-top:5px!important;width:100%'>
                                    <tr>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span></span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                                &nbsp;CONSERVACIÓN TEMPORAL&nbsp;&nbsp;
                                            </span>
                                        </td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span></span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                                &nbsp;EMBALSAMAMIENTO&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            </span>
                                        </td>
                                        <td>    
                                            <table class='tablePdfv2$tablePdfV2Color'>
                                                <tr>
                                                    <td><span></span></td>
                                                </tr>
                                            </table>
                                        </td>
                                        <td style='height: 20px'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                                &nbsp;OTRAS _____________________
                                            </span>
                                        </td>
                                    </tr>
                                </table>
                                <div class='titulo' style='margin-top:15px;margin-bottom:8px'>
                                    <span>
                                        <strong><u>DATOS DE LA FUNERARIA QUE ENTREGA</u></strong>
                                    </span>
                                </div>
                                <table class='tablePdfNoBorder' style='width: 100%;'>
                                    <tr>
                                        <td style='height: 20px;width: 20px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            NOMBRE:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 350px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>$funeralHomeName</span>
                                        </td>
                                        <td style='height: 20px;width: 20px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            NIF/CIF:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 100px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>$funeralHomeNif</span>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfNoBorder' style='width: 100%;'>
                                    <tr>
                                        <td style='height: 20px;width: 20px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            DIRECCIÓN:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 300px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>$funeralHomeAddress</span>
                                        </td>
                                        <td style='height: 20px;width: 20px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            LOCALIDAD:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 150px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>$funeralHomeLocation</span>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfNoBorder' style='width: 100%;'>
                                    <tr>
                                        <td style='height: 20px;width: 80px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                                CÓDIGO POSTAL:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 80px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>$funeralHomePostalCode</span>
                                        </td>
                                        <td style='height: 20px;width: 20px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            PROVINCIA:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 100px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>$funeralHomeProvince</span>
                                        </td>
                                        <td style='height: 20px;width: 20px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                                TELÉFONO:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 100px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>$funeralHomePhone</span>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfNoBorder' style='width: 100%;'>
                                    <tr>
                                        <td style='height: 20px;width: 60px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                                E-MAIL:
                                            </span>
                                        </td>
                                        <td style='height: 20px;'>
                                            <span style='font-size: 12px;color:$colorStyle'>$funeralHomeEmail</span>
                                        </td>
                                    </tr>
                                </table>
                                <div class='titulo' style='margin-top:15px;margin-bottom:8px'>
                                    <span>
                                        <strong><u>DATOS DEL VEHÍCULO</u></strong>
                                    </span>
                                </div>
                                <table class='tablePdfNoBorder' style='width: 100%;'>
                                    <tr>
                                        <td style='height: 20px;width: 40px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                                MARCA:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 150px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>&nbsp;</span>
                                        </td>
                                        <td style='height: 20px;width: 40px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                                MODELO:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 150px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>&nbsp;</span>
                                        </td>
                                        <td style='height: 20px;width: 40px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                                MATRÍCULA:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 150px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>&nbsp;</span>
                                        </td>
                                    </tr>
                                </table>
                                <div class='titulo' style='margin-top:15px;margin-bottom:8px'>
                                    <span>
                                        <strong><u>DATOS DE ENTREGA DEL CADÁVER</u></strong>
                                    </span>
                                </div>
                                <div class='titulo' style='text-align:center;margin-bottom:8px'>
                                    <span>
                                        <strong>FUNERARIO QUE ENTREGA</strong>
                                    </span>
                                </div>
                                <table class='tablePdfNoBorder' style='width: 100%;'>
                                    <tr>
                                        <td style='height: 20px;width: 90px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            NOMBRE Y APELLIDOS:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 200px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>&nbsp;</span>
                                        </td>
                                        <td style='height: 20px;width: 10px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            DNI:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 75px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>&nbsp;</span>
                                        </td>
                                    </tr>
                                </table>
                                <div class='titulo' style='margin-top:10px;text-align:center;margin-bottom:8px'>
                                    <span>
                                        <strong>FUNERARIO QUE RECEPCIONA</strong>
                                    </span>
                                </div>
                                <table class='tablePdfNoBorder' style='width: 100%;'>
                                    <tr>
                                        <td style='height: 20px;width: 90px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            NOMBRE Y APELLIDOS:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 200px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>&nbsp;</span>
                                        </td>
                                        <td style='height: 20px;width: 10px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            DNI:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 75px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>&nbsp;</span>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdfNoBorder' style='width: 100%;margin-top:5px!important'>
                                    <tr>
                                        <td style='height: 20px;width: 100px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            FECHA DE ENTRADA:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 120px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>&nbsp;</span>
                                        </td>
                                        <td style='height: 20px;width: 100px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>
                                            HORA DE ENTRADA:
                                            </span>
                                        </td>
                                        <td style='height: 20px;width: 120px!important;'>
                                            <span style='font-size: 12px;color:$colorStyle'>&nbsp;</span>
                                        </td>
                                    </tr>
                                </table>
                                <table class='tablePdf$tablePdfColor' style='width: 100%;margin-top:10px!important'>
                                    <tr>
                                        <td>
                                            <strong><u><span style='color:$colorStyle'>
                                            ARTÍCULOS PERSONALES
                                            </span></u></strong>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <span style='font-size: 12px;color:$colorStyle'>&nbsp;</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <span style='font-size: 12px;color:$colorStyle'>&nbsp;</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <span style='font-size: 12px;color:$colorStyle'>&nbsp;</span>
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>
                                            <span style='font-size: 12px;color:$colorStyle'>&nbsp;</span>
                                        </td>
                                    </tr>
                                </table>
                                <br>
                                <table class='tablePdfNoBorder' style='width: 100%;'>
                                    <tr>
                                        <td>
                                            <strong>
                                                <span style='color:$colorStyle'>
                                                    FIRMA FUNERARIO QUE ENTREGA
                                                </span>
                                            </strong>
                                            <table class='tablePdf$tablePdfColor'>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            <br><br><br><br><br>               
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </td>
                                        <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp</td>
                                        <td>
                                            <strong>
                                                <span style='color:$colorStyle'>
                                                    FIRMA FUNERARIO QUE RECEPCIONA
                                                </span>
                                            </strong>
                                            <table class='tablePdf$tablePdfColor'>
                                                <tbody>
                                                    <tr>
                                                        <td>
                                                            <br><br><br><br><br>               
                                                        </td>
                                                    </tr>
                                                </tbody>
                                            </table>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                    </div>
                ";
                
                return $text;
            break;

            case "hojaCementerioCiudadReal":
                $utils = new Utils();
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/hojaCementerioCiudadReal.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }
                
                $background =  $utils->getRoute() . "resources/files/" . $_SESSION['company'] . "/settings/backgroundAytoCiudadReal.jpg";
                $data = getHojaCementerio($expedient);
                
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                }else{
                    $gender = "D.";
                }

                $deceasedName = '__________';
                if($data['deceasedName'] != null && $data['deceasedName'] != ''){
                    $deceasedName = $data['deceasedName'];
                }
                if($data['deceasedSurname'] != null && $data['deceasedSurname'] != ''){
                    $deceasedSurname = $data['deceasedSurname'];
                }

                if($data['deceasedDate'] != null){
                    $deceasedDate = date("j-n-Y", strtotime($data['deceasedDate']));
                }else{
                    $deceasedDate = "______________";
                }

                $deceasedTime = '__:__';
                if($data['deceasedTime'] != null && $data['deceasedTime'] != ''){
                    $deceasedTime = date("H:i", strtotime($data['deceasedTime']));
                }

                // $age = $data['deceasedBirthday'] != null && $data['deceasedDate'] != null ? intval((strtotime($data['deceasedDate']) - strtotime($data['deceasedBirthday'])) / (60 * 60 * 24 * 365)) : '__________';
                if($data['deceasedBirthday'] != null && $data['deceasedDate'] != null){
                    $date1 = new DateTime($data['deceasedBirthday']);
                    $date2 = new DateTime($data['deceasedDate']);
                    $interval = $date1->diff($date2);
                    $age = $interval->y;
                }else{
                    $age = '__________';
                }

                if($data['deceasedUsualAddress'] != null){
                    $deceasedUsualAddress = $data['deceasedUsualAddress'];
                }else{
                    $deceasedUsualAddress = "Calle ______________";
                }

                if($data['deceasedCause'] != null){
                    $deceasedCause = $data['deceasedCause'];
                }else{
                    $deceasedCause = "______________";
                }

                $settings = new Settings;
                $company = $settings->getCompanyName();

                $fdoAyto = $utils->getRoute() . "resources/files/" . $_SESSION['company'] . "/settings/fdoAytoCiudadReal.jpg";

                $text ="
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas' style='padding-top: 110px'>
                                <table class='tablePdfNoBorder' style='width: 100%;'>
                                    <tr>
                                        <td style='width:50%'>
                                            <br><br>
                                            <strong><span style='font-size: 14px;color:#000000;'>
                                            Sr. Regente del Cementerio Municipal:
                                            </span></strong>
                                        </td>
                                        <td style='width:50%'>
                                            <strong><u><span style='font-size: 12px;color:#000000;'>
                                                Orden de enterramiento Núm. &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                            </span></u></strong>
                                        </td>
                                    </tr>
                                </table>
                                <br>
                                <div style='text-align:justify; line-height: 1.75;'>
                                    <span style='font-size:14px; color:#000000;'>
                                        &nbsp;&nbsp;&nbsp;&nbsp;En Virtud de la licencia de enterramiento expedida por el Sr. Juez encargado del Registro de Ciudad Real, de el cadáver de $gender 
                                        $deceasedName  $deceasedSurname de $age años de edad, se haya domiciliada en esta capital $deceasedUsualAddress Nº ______
                                        Piso _________.
                                        <br>
                                        Fallecida el $deceasedDate a las $deceasedTime horas, a consecuencia de $deceasedCause
                                        <br>
                                        &nbsp;&nbsp;&nbsp;&nbsp;Previa licencia de enterramientos y transcurrido el tiempo correspondiente se procede a la inhumación en este cementerio.
                                        <br>
                                        &nbsp;&nbsp;&nbsp;&nbsp;Patio ______________________________ Departamento _________________________________________
                                        <br>
                                        &nbsp;&nbsp;&nbsp;&nbsp;Calle Nº ____________________________  Fila Nº _______________  Sepultura Nº ___________________
                                        <br>
                                        &nbsp;&nbsp;&nbsp;&nbsp;Empresa Funeraria <strong>$company</strong>
                                        <br>
                                        &nbsp;&nbsp;&nbsp;&nbsp;Servicios Prestados en Cementerio _________________________________________________________
                                        <br>
                                        &nbsp;&nbsp;&nbsp;&nbsp;Solicita el servicio D.: ________________________________________ Tlf. __________________________
                                        <br>
                                    </span>
                                </div>
                                <br>
                                <div>
                                    <div class='col-xs-12'>              
                                        <table class='tablePdfNoBorder'>
                                            <tbody>
                                                <tr>
                                                    <td>
                                                        <p style='text-align:center;'><span style='color:#000000;'>Por el Alcalde/sa</span></p>                
                                                        <p style='text-align:center;'><span style='color:#000000;'>P.A. El Regente</span></p>  
                                                    </td>
                                                    <td style='text-align:center;'>
                                                        <img src='$fdoAyto' width='50px'>
                                                    </td>
                                                    <td style='text-align:right;'>
                                                        <i><span style='color:#000000;'>Ciudad Real, ________ de _______ de 20__</span></i>
                                                    </td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                ";

                return $text;
            break;

            case "conservacionAutorizacionFamiliar":
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/conservacionAutorizacionFamiliar.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }

                $data = getConservacionAutorizacionFamiliar($expedient);
                $staticInfo = $documentsInfo->getByDocument('conservacionAutorizacionFamiliar');
                if($staticInfo != null){
                    foreach($staticInfo as $elem){
                        switch($elem['name']){
                            case 'companyDoc28':
                                $company = $elem['value'];
                            break;
                            case 'companyAddressDoc28':
                                $address = $elem['value'];
                            break;
                            case 'companyLocationDoc28':
                                $location = $elem['value'];
                            break;
                            case 'companyProvinceDoc28':
                                $province = $elem['value'];
                            break;
                        }
                    }
                }else{
                    $company = '';
                    $address = '';
                    $location = '';
                    $province = '';
                }
                
                if(strpos($location, '-') === false){
                    $locationAux = $location;
                }else{
                    $locationAux = trim(explode("-", $location)[1]);
                }

                $utils = new Utils();
                if($data['deceasedGender'] == "Mujer"){
                    $gender = "Dña.";
                    $genderLetter = "a";
                    $genderArticle = "de la";
                }else{
                    $gender = "D.";
                    $genderLetter = "o";
                    $genderArticle = "del";
                }

                $background = $utils->getBackgroundDocuments();

                // Deceased info 
                $deceased = $gender . ' ' . $data['deceased'];

                if($data['deceasedDate'] != null){
                    // $deceasedDate = date("j-n-Y", strtotime($data['deceasedDate']));
                    $deceasedDate = date('d/m/Y', strtotime($data['deceasedDate']));
                }else{
                    $deceasedDate = "______________";
                }

                $deceasedTime = '__:__';
                if($data['deceasedTime'] != null && $data['deceasedTime'] != ''){
                    $deceasedTime = date("H:i", strtotime($data['deceasedTime']));
                }

                // Applicant info
                $applicant = $data['applicant'] == null ? '____________________________' : $data['applicant'];
                $applicantNIF = $data['applicantNIF'] == null ? '__________' : $data['applicantNIF'];
                $applicantRelationship = $data['applicantRelationship'] == null ? '__________' : strtolower($data['applicantRelationship']);

                // Responsible
                $funeralHome = $data['funeralHomeName'] == null ? '____________________________' : $data['funeralHomeName'];
                $responsible = $data['responsibleUser'] == null ? '____________________________' : $data['responsibleUser'];
                $responsibleNIF = $data['responsibleUserNif'] == null ? '__________' : $data['responsibleUserNif'];
                
                $text = "
                    <div class='fondo'>
                        <div style='background-image: url(" . $background . ")' class='$fuente folioPompas'>
                            <div class='contenidoPompas' style='padding-top: -5px'>
                                <div style='text-align: right; padding-top: 35px; line-height: 0.5'>
                                    <p><strong>$company</strong></p>
                                    <p>$address</p>
                                    <p>$location</p>
                                    <p>$province</p>
                                </div>
                                <div class='titulo' style='text-align:center;margin-top:30px'>
                                    <p style='text-align:center'><strong><u>CONSERVACI&Oacute;N TEMPORAL</u></strong></p>
                                </div>
                                <br>
                                <div style='text-align:justify'>
                                    <span style='font-size:12px'>
                                        Yo, <strong>$applicant</strong>, <strong>$applicantRelationship</strong> $genderArticle fallecid$genderLetter, <strong>$deceased (Q.E.P.D.)</strong>, 
                                        fallecid$genderLetter el día <strong>$deceasedDate</strong> a las <strong>$deceasedTime</strong>.
                                        <br><br><br>
                                        <p>
                                            <strong><u>AUTORIZO</u></strong> a <strong>$responsible</strong>, Tanapractor Cualificado de la empresa <strong>$funeralHome</strong> a
                                            realizar la técnica de conservación necesaria de las siguientes:
                                        </p>
                                    </span>
                                </div>
                                <br>
                                <div style='text-align:justify'>
                                    <span style='font-size:12px'>
                                        <p>
                                            <strong>Tipo de conservación a aplicar:</strong>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                                <tr> 
                                                    <td style='width:5%'>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='width:30%;height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Conservación Temporal
                                                        </span>
                                                    </td>
                                                    <td style='width:5%'>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='width:30%;height: 25px'>
                                                        <span style='font-size: 12px;color:#1f497dtext-align:left;'>
                                                            &nbsp;Embalsamamiento
                                                        </span>
                                                    </td>
                                                    <td style='width:30%'>    
                                                        <span>&nbsp;</span>
                                                    </td>
                                                </tr>
                                            </table>

                                            <br><br>
                                            <strong>Motivo:</strong>
                                            <table class='tablePdfNoBorder' cellspacing='0' cellpadding='2' style='width:100%'> 
                                                <tr> 
                                                    <td style='width:4%'>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='width:38%;height: 25px'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Inhumación - Cremación pasadas 48 h.
                                                        </span>
                                                    </td>
                                                    <td style='width:4%'>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='width:27%;height: 25px'>
                                                        <span style='font-size: 12px;color:#1f497dtext-align:left;'>
                                                            &nbsp;Velación en lugar público
                                                        </span>
                                                    </td>
                                                    <td style='width:4%'>    
                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                            <tr>
                                                                <td><span></span></td>
                                                            </tr>
                                                        </table>
                                                    </td>
                                                    <td style='width:23%;height: 25px'>
                                                        <span style='font-size: 12px;color:#1f497dtext-align:left;'>
                                                            &nbsp;Requerida por traslado
                                                        </span>
                                                    </td>
                                                </tr>
                                                <tr>
                                                    <td style='height: 25px' colspan='6'>
                                                        <span style='font-size: 12px;color:$colorStyle'>
                                                            &nbsp;Otros:
                                                        </span>
                                                    </td>
                                                </tr>
                                            </table>
                                            <br><br>
                                            Los costes derivados de este servicio, serán presupuestados y serán asumidos por el autorizante o por su Compañía de Seguros.
                                            <br><br><br><br>
                                            <div class='col-xs-12'>
                                                <div style='width:40%; float:left' class='pull-left'>
                                                    <table class='tablePdf$tablePdfColor' style='color:$colorStyle!important;'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <p</p>
                                                                    <p></p>
                                                                    <p></p>           
                                                                    <p></p>
                                                                    <p></p>
                                                                    <p></p>
                                                                    <p>
                                                                        Fdo.: $responsible
                                                                        <br>
                                                                        DNI: $responsibleNIF
                                                                    </p>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div style='width:5%; float:left' class='pull-left'></div>
                                                <div style='width:40%; float:right' class='pull-right'>
                                                    <table class='tablePdf$tablePdfColor' style='color:$colorStyle!important;'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <p</p>
                                                                    <p></p>
                                                                    <p></p>           
                                                                    <p></p>
                                                                    <p></p>
                                                                    <p></p>
                                                                    <p>
                                                                        Fdo.: $applicant
                                                                        <br>
                                                                        DNI: $applicantNIF
                                                                    </p>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            <br>
                                        </p>
                                        <p style='text-align:right;margin-right:15px;'><span style='font-size:13px'>En $locationAux, a ".$utils->fechaCastellano2(date('Y'))."</span></p>
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                ";
            
                return $text;
            break;

            case "parteDefuncion":

                $utils = new Utils();
                $route = $_SESSION['basePath'] . 'resources/files/' . $_SESSION['company'] . '/expedients/' . $expedient . '/docs/parteDefuncion.html';
                if(file_exists($route)){
                    return file_get_contents($route);
                }
                
                $background = $utils->getBackgroundDocuments();

                $data = getParteDefuncion($expedient);

                $img = str_replace('png', 'jpg', $utils->getLogo());
                $img = explode(URL, $img);
                $img = $_SESSION['basePath'] . $img[1];

                $img = "<img src='" . $img . "' width='25%'>";

                $tablePdfColor = '-black';
                $tablePdfV2Color = '-black';

                $deceasedName = $data['deceasedName'] . ' ' . $data['deceasedSurname'];
                $expedientNumber = $data['number'];

                $requestDate = $data['requestDate'] == null ? '-' : date("j/n/Y", strtotime($data['requestDate']));

                $familyAssistance = $data['familyAssistanceName'] . ' ' . $data['familyAssistanceSurname'];
                $familyAssistance != '' ? $familyAssistance : '______________________________________';

                $corpseCollection1 = $data['corpseCollection1Name'] . ' ' . $data['corpseCollection1Surname'];
                $corpseCollection1 != '' ? $corpseCollection1 : '_______________________________';

                $corpseCollection2 = $data['corpseCollection2Name'] . ' ' . $data['corpseCollection2Surname'];
                $corpseCollection2 != '' ? $corpseCollection2 : '_______________________________';

                $entryDateBarrow = $data['entryDateBarrow'] == null ? '' : date("j/n/Y", strtotime($data['entryDateBarrow']));
                $entryTimeBarrow = $data['entryTimeBarrow'] == null ? '' : date("H:i", strtotime($data['entryTimeBarrow']));

                $text = 
                    "   <div class='fondo'>
                            <div class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: 15px;'>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center; width: 25%'>
                                                    $img
                                                </td>
                                                <td style='text-align:center; width: 50%; background-color: #a6a6a6!important; '>
                                                    <strong><span style='font-size:25px'>PARTE DE DEFUNCIÓN</span></strong>
                                                </td>
                                                <td style='text-align:center; width: 25%'>
                                                    <span style='font-size:15px'>Código: _________</span>
                                                    <br>
                                                    <span style='font-size:15px'>Rev: ____________</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor' style='margin-top:5px'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center; width: 22%'>
                                                   <strong><span style='font-size:12px'>NOMBRE FALLECIDO:</span></strong>
                                                </td>
                                                <td style='text-align:center; width: 40%'>
                                                   <span style='font-size:12px'>$deceasedName</span>
                                                </td>
                                                <td style='text-align:center; width: 8%'>
                                                   <strong><span style='font-size:12px'>EXP:</span></strong>
                                                </td>
                                                <td style='text-align:center; width: 12%'>
                                                    <span style='font-size:12px'>$expedientNumber</span>
                                                </td>
                                                <td style='text-align:center; width: 8%'>
                                                   <strong><span style='font-size:12px'>FECHA:</span></strong>
                                                </td>
                                                <td style='text-align:center; width: 10%'>
                                                    <span style='font-size:12px'>$requestDate</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor' style='margin-top:5px'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center; width: 100%; background-color: #a6a6a6!important;' colspan='2'>
                                                    <strong><span style='font-size:17px'>RECOGIDA DEL FALLECIDO</span></strong>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width: 30%'>
                                                   <span style='font-size:12px'>Identificación del Fallecido por: ________________________________</span>
                                                </td>
                                                <td style='width: 70%'>
                                                   <span style='font-size:12px'>Recogido por: $corpseCollection1 / $corpseCollection2</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width: 30%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>X</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>SIN Incidencias </span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                    <div style='margin-top:5px;'>
                                                        <table class='tablePdfNoBorder'>
                                                            <tbody>
                                                                <tr>
                                                                    <td>
                                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                                            <tr>
                                                                                <td>&nbsp;</td>
                                                                            </tr>
                                                                        </table>
                                                                    </td>
                                                                    <td>
                                                                        <span style='font-size:12px'>CON Incidencias </span>
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </td>
                                                <td style='width: 70%'>
                                                   <span style='font-size:12px'>Incidencias: </span>
                                                   <br><br><br><br> 
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center; width: 100%; background-color: #a6a6a6!important;' colspan='3'>
                                                    <strong><span style='font-size:17px'>SUPERVISIÓN DEL SERVICIO DE RECOGIDA</span></strong>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width: 50%'>
                                                    <span style='font-size:12px'>Supervisado por: $familyAssistance</span>
                                                </td>
                                                <td style='width: 25%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>X</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>SIN Incidencias </span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td style='width: 25%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>CON Incidencias </span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width: 100%;' colspan='3'>
                                                   <span style='font-size:12px'>Incidencias detectadas: </span>
                                                   <br><br>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center; width: 100%; background-color: #a6a6a6!important;' colspan='2'>
                                                    <strong><span style='font-size:17px'>REQUISITOS SOLICITADOS POR EL CLIENTE, NO ESPECÍFICADOS EN LA APP</span></strong>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width: 30%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>X</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px!important;'>Féretro Abierto</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                    <div style='margin-top:5px;'>
                                                        <table class='tablePdfNoBorder'>
                                                            <tbody>
                                                                <tr>
                                                                    <td>
                                                                        <table class='tablePdfv2$tablePdfV2Color'>
                                                                            <tr>
                                                                                <td>&nbsp;</td>
                                                                            </tr>
                                                                        </table>
                                                                    </td>
                                                                    <td>
                                                                        <span style='font-size:12px!important;'>Féretro Cerrado</span>
                                                                    </td>
                                                                </tr>
                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </td>
                                                <td style='width: 70%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td colspan='4'>
                                                                    <span style='font-size:14px'><strong>Complemento en Féretro:</strong></span>
                                                                </td>
                                                            </tr>
                                                            <tr>
                                                                <td style='width:15%'>
                                                                    <table class='tablePdfNoBorder'>
                                                                        <tbody>
                                                                            <tr>
                                                                                <td>
                                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                                        <tr>
                                                                                            <td>X</td>
                                                                                        </tr>
                                                                                    </table>
                                                                                </td>
                                                                                <td>
                                                                                    <span style='font-size:14px'>Cruz</span>
                                                                                </td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </td>
                                                                <td style='width:15%'>
                                                                    <table class='tablePdfNoBorder'>
                                                                        <tbody>
                                                                            <tr>
                                                                                <td>
                                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                                        <tr>
                                                                                            <td>X</td>
                                                                                        </tr>
                                                                                    </table>
                                                                                </td>
                                                                                <td>
                                                                                    <span style='font-size:14px'>Cristo</span>
                                                                                </td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </td>
                                                                <td style='width:15%'>
                                                                    <table class='tablePdfNoBorder'>
                                                                        <tbody>
                                                                            <tr>
                                                                                <td>
                                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                                        <tr>
                                                                                            <td>&nbsp;&nbsp;&nbsp;</td>
                                                                                        </tr>
                                                                                    </table>
                                                                                </td>
                                                                                <td>
                                                                                    <span style='font-size:14px'>Ninguno</span>
                                                                                </td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </td>
                                                                <td style='width:55%'></td>
                                                            </tr>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfNoBorder'>
                                                                        <tbody>
                                                                            <tr>
                                                                                <td>
                                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                                        <tr>
                                                                                            <td>&nbsp;&nbsp;&nbsp;</td>
                                                                                        </tr>
                                                                                    </table>
                                                                                </td>
                                                                                <td>
                                                                                    <span style='font-size:14px'>Otros:</span>
                                                                                </td>
                                                                            </tr>
                                                                        </tbody>
                                                                    </table>
                                                                </td>
                                                                <td colspan='3'>
                                                                   <span style='font-size:14px'>__________________ / __________________</span> 
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='width: 75%'>
                                                    <span style='font-size:14px'>Entregan pertenencias para incluir en el féretro:</span>
                                                </td>
                                                <td style='width: 25%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>X</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:14px'>No Entregan</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td style='width: 25%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;&nbsp;&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:14px'>Entregan</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width: 100%;' colspan='3'>
                                                   <span style='font-size:14px'>Pertenencias entregadas por la familia: _________________________________</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center; width: 100%; background-color: #a6a6a6!important;' colspan='3'>
                                                    <strong><span style='font-size:17px'>SUPERVISIÓN DE LA CONTRATACIÓN</span></strong>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width: 50%'>
                                                    <span style='font-size:12px'>Supervisado por: ______________________________________</span>
                                                </td>
                                                <td style='width: 25%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>X</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>SIN Incidencias</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td style='width: 25%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>CON Incidencias</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width: 100%;' colspan='3'>
                                                   <span style='font-size:12px'>Incidencias detectadas: </span>
                                                   <br><br>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center; width: 100%; background-color: #a6a6a6!important;' colspan='3'>
                                                    <strong><span style='font-size:17px'>SUPERVISIÓN DE LA PREPARACIÓN DEL FALLECIDO</span></strong>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width: 50%'>
                                                    <span style='font-size:12px'>Supervisado por: $familyAssistance</span>
                                                </td>
                                                <td style='width: 25%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>X</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>SIN Incidencias</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td style='width: 25%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>CON Incidencias</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width: 100%;' colspan='3'>
                                                   <span style='font-size:12px'>Incidencias detectadas: </span>
                                                   <br><br>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center; width: 1 00%; background-color: #a6a6a6!important;' colspan='3'>
                                                    <strong><span style='font-size:17px'>PREPARACIÓN DEL FALLECIDO</span></strong>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width: 54%'>
                                                    <span style='font-size:12px'>Identificación del difunto antes de entrada en Sala Velatoria</span>
                                                    <br><br>
                                                    <span style='font-size:12px'>Identificado por: ______________________________________</span>
                                                </td>
                                                <td style='width: 23%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>X</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>SIN Incidencias</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td style='width: 23%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>CON Incidencias</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width: 100%;' colspan='3'>
                                                   <span style='font-size:12px'>Incidencias detectadas: </span>
                                                   <br><br>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='width: 24%'>
                                                    <span style='font-size:12px'>Despedida de la Familia:</span>
                                                </td>
                                                <td style='width: 21%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>SIN Despedida</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td style='width: 22%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>X</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>CON Despedida</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td style='width: 33%'>
                                                    <span style='font-size:12px'>Entrada en Túmulo: $entryDateBarrow $entryTimeBarrow</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <span style='font-size:12px'>Momento de la despedida:</span>
                                                </td>
                                                <td>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>X</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>Antes de la Salida</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>Después de la preparación</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>Ambas</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div style='width:100%; float:right; text-align:right; margin-top:15px' class='pull-right'>
                                        <span style='font-size:12px; color:black;'><i>Página 1 de 2</i></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <pagebreak>
                        <div class='fondo'>
                            <div class='$fuente folioPompas'>
                                <div class='contenidoPompas' style='padding-top: 15px;'>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center; width: 25%'>
                                                </td>
                                                <td style='text-align:center; width: 50%; background-color: #a6a6a6!important; '>
                                                    <strong><span style='font-size:25px'>PARTE DE DEFUNCIÓN</span></strong>
                                                </td>
                                                <td style='text-align:center; width: 25%'>
                                                    <span style='font-size:15px'>Código: _________</span>
                                                    <br>
                                                    <span style='font-size:15px'>Rev: ____________</span>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor' style='margin-top:5px'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center; width: 100%; background-color: #a6a6a6!important;' colspan='5'>
                                                    <strong><span style='font-size:17px'>REVISIÓN DE NICHO EN CEMENTERIO</span></strong>
                                                    <br>
                                                    (Cubrir en caso de que haya que hacer modificaciones por medidas)
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width: 35%'>
                                                   <span style='font-size:12px'>Medidas de la unidad de enterramiento:</span>
                                                </td>
                                                <td style='width: 15%'>
                                                    <span style='font-size:12px'>Alto: _____ cm.</span>
                                                </td>
                                                <td style='width: 16%'>
                                                    <span style='font-size:12px'>Ancho: _____ cm.</span>
                                                </td>
                                                <td style='width: 15%'>
                                                    <span style='font-size:12px'>Largo: _____ cm.</span>
                                                </td>
                                                <td style='width: 19%'>
                                                    <span style='font-size:12px'>Altura/Piso: _____ </span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                   <span style='font-size:12px'>Medidas del Féretro:</span>
                                                </td>
                                                <td>
                                                    <span style='font-size:12px'>Alto: _____ cm.</span>
                                                </td>
                                                <td>
                                                    <span style='font-size:12px'>Ancho: _____ cm.</span>
                                                </td>
                                                <td>
                                                    <span style='font-size:12px'>Largo: _____ cm.</span>
                                                </td>
                                                <td></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td>
                                                   <span style='font-size:12px'>Instrucciones complementos del Féretro:</span>
                                                </td>
                                                <td>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>No incluir cruz</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>No incluir Cristo</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>No incluir Patas</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='width:30%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>Cambio a féretro especial</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td>
                                                    <span style='font-size:12px'>Modelo: _____________________________________</span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width:30%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>Reducción de Restos</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td>
                                                    <span style='font-size:12px'>Otras observaciones:</span>
                                                    <br><br><br><br>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center; width: 100%; background-color: #a6a6a6!important;' colspan='3'>
                                                    <strong><span style='font-size:17px'>IDENTIFICACIÓN PREVIA A LA SALIDA</span></strong>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width: 56%'>
                                                    <span style='font-size:11px'>
                                                        Identificación y revisión del estado del fallecido antes de la despedida
                                                    </span>
                                                    <br><br>
                                                    <span style='font-size:11px'>Revisado por: ______________________________________</span>
                                                </td>
                                                <td style='width: 22%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>X</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>SIN Incidencias</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td style='width: 22%'>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;&nbsp;&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>CON Incidencias</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td style='width: 100%;' colspan='3'>
                                                   <span style='font-size:12px'>Incidencias detectadas: </span>
                                                   <br>
                                                   <br>
                                                   <br>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center; width: 100%; background-color: #a6a6a6!important;' colspan='5'>
                                                    <strong><span style='font-size:17px'>CEREMONIA</span></strong>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan='3' style='text-align:center'>
                                                    <span style='font-size:12px;'>Tipo de Ceremonia: </span>
                                                </td>
                                                <td colspan='2' style='text-align:center'>
                                                    <span style='font-size:12px'>Porteo del Féretro: </span>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>X</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>RELIGIOSA</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>LAICA</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>OTRA ______________</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>&nbsp;&nbsp;</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>POR LA FAMILIA</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                                <td>
                                                    <table class='tablePdfNoBorder'>
                                                        <tbody>
                                                            <tr>
                                                                <td>
                                                                    <table class='tablePdfv2$tablePdfV2Color'>
                                                                        <tr>
                                                                            <td>X</td>
                                                                        </tr>
                                                                    </table>
                                                                </td>
                                                                <td>
                                                                    <span style='font-size:12px'>FUNERARIA</span>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td colspan='5'>
                                                    <span style='font-size:12px;'>Detalles o peticiones de la Ceremonia no incluidos en la Aplicación:</span>
                                                    <br><br><br><br><br>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>

                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center; width: 100%; background-color: #a6a6a6!important;'>
                                                    <strong><span style='font-size:17px'>NECESIDADES DETECTADAS POR LA FAMILIA Y QUE NO OFRECEMOS:</span></strong>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <br><br><br><br><br><br>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <table class='tablePdf$tablePdfColor'>
                                        <tbody>
                                            <tr>
                                                <td style='text-align:center; width: 100%; background-color: #a6a6a6!important;'>
                                                    <strong><span style='font-size:17px'>QUEJAS, RECLAMACIONES, SUGERENCIAS O AGRADECIMIENTOS:</span></strong>
                                                </td>
                                            </tr>
                                            <tr>
                                                <td>
                                                    <br><br><br><br><br><br>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div style='width:100%; float:right; text-align:right; margin-top:15px' class='pull-right'>
                                        <span style='font-size:12px; color:black;'><i>Página 2 de 2</i></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                ";

                return $text;

            break;
        }
    }
?>